This file is a merged representation of the entire codebase, combined into a single document by Repomix.
The content has been processed where security check has been disabled.

<file_summary>
This section contains a summary of this file.

<purpose>
This file contains a packed representation of the entire repository's contents.
It is designed to be easily consumable by AI systems for analysis, code review,
or other automated processes.
</purpose>

<file_format>
The content is organized as follows:
1. This summary section
2. Repository information
3. Directory structure
4. Repository files (if enabled)
5. Multiple file entries, each consisting of:
  - File path as an attribute
  - Full contents of the file
</file_format>

<usage_guidelines>
- This file should be treated as read-only. Any changes should be made to the
  original repository files, not this packed version.
- When processing this file, use the file path to distinguish
  between different files in the repository.
- Be aware that this file may contain sensitive information. Handle it with
  the same level of security as you would the original repository.
</usage_guidelines>

<notes>
- Some files may have been excluded based on .gitignore rules and Repomix's configuration
- Binary files are not included in this packed representation. Please refer to the Repository Structure section for a complete list of file paths, including binary files
- Files matching patterns in .gitignore are excluded
- Files matching default ignore patterns are excluded
- Security check has been disabled - content may contain sensitive information
- Files are sorted by Git change count (files with more changes are at the bottom)
</notes>

</file_summary>

<directory_structure>
app/
  Console/
    Kernel.php
  Exceptions/
    Handler.php
  Http/
    Controllers/
      AuthController.php
      BrandController.php
      BSCalendarController.php
      CategoryController.php
      Controller.php
      DashboardController.php
      DepartmentController.php
      EmployeeAuthController.php
      EmployeeController.php
      EmployeeStoreOutController.php
      ItemCategoryController.php
      ProductController.php
      PurchaseController.php
      PurchaseSlipController.php
      StoreEntryController.php
      StoreOutController.php
      SupplierController.php
    Middleware/
      Authenticate.php
      EncryptCookies.php
      EnsureAdmin.php
      EnsureEmployeePasswordChanged.php
      EnsureStudent.php
      PreventRequestsDuringMaintenance.php
      RedirectIfAuthenticated.php
      TrimStrings.php
      TrustHosts.php
      TrustProxies.php
      ValidateSignature.php
      VerifyCsrfToken.php
    Kernel.php
  Models/
    Admin.php
    Brand.php
    Category.php
    Department.php
    Employee.php
    ItemCategory.php
    Product.php
    Purchase.php
    PurchaseItem.php
    PurchaseSlip.php
    PurchaseSlipItem.php
    StoreEntry.php
    StoreEntryItem.php
    StoreOut.php
    StoreOutItem.php
    Supplier.php
    User.php
  Providers/
    AppServiceProvider.php
    AuthServiceProvider.php
    BroadcastServiceProvider.php
    EventServiceProvider.php
    RouteServiceProvider.php
  Services/
    BSDateService.php
bootstrap/
  cache/
    .gitignore
  app.php
config/
  app.php
  auth.php
  broadcasting.php
  cache.php
  cors.php
  database.php
  filesystems.php
  hashing.php
  logging.php
  mail.php
  queue.php
  sanctum.php
  services.php
  session.php
  view.php
database/
  factories/
    UserFactory.php
  migrations/
    2014_10_12_000000_create_users_table.php
    2014_10_12_100000_create_password_reset_tokens_table.php
    2019_08_19_000000_create_failed_jobs_table.php
    2019_12_14_000001_create_personal_access_tokens_table.php
    2023_08_21_084253_create_categories_table.php
    2023_08_21_084353_create_brands_table.php
    2025_09_14_121306_create_admins_table.php
    2025_10_07_034553_create_suppliers_table.php
    2025_10_07_041600_create_item_categories_table.php
    2025_10_08_032327_create_departments_table.php
    2025_10_08_041051_create_products_table.php
    2025_10_08_041052_create_purchase_slips_table.php
    2025_10_08_041214_create_purchases_table.php
    2025_10_20_073427_create_purchase_slip_items_table.php
    2025_10_20_130421_create_purchase_items_table.php
    2025_11_02_092000_create_store_entries_table.php
    2025_11_02_092214_create_store_entry_items_table.php
    2025_11_14_013154_create_employees_table.php
    2025_11_14_041543_create_store_outs_table.php
    2025_11_14_041640_create_store_out_items_table.php
  seeders/
    AdminSeeder.php
    DatabaseSeeder.php
  .gitignore
public/
  .htaccess
  bs-datepicker.js
  index.php
  robots.txt
resources/
  css/
    app.css
  js/
    app.js
    bootstrap.js
  views/
    Backend/
      brands/
        create.blade.php
        edit.blade.php
        index.blade.php
      categories/
        create.blade.php
        edit.blade.php
        index.blade.php
      dashboard/
        index.blade.php
      departments/
        index.blade.php
      employees/
        create.blade.php
        edit.blade.php
        index.blade.php
      items/
        create.blade.php
        edit.blade.php
        index.blade.php
      layouts/
        app.blade.php
        header.blade.php
      products/
        _form.blade.php
        create.blade.php
        edit.blade.php
        index.blade.php
      purchases/
        create.blade.php
        edit.blade.php
        index.blade.php
        show_print.blade.php
        show.blade.php
      slips/
        create.blade.php
        edit.blade.php
        index.blade.php
        print.blade.php
        show.blade.php
      store/
        browse_ic_categories.blade.php
        browse_item_categories.blade.php
        browse_root.blade.php
        categories.blade.php
        category_items.blade.php
        index.blade.php
        ledger_category.blade.php
        prepare.blade.php
        show.blade.php
      store_out/
        create.blade.php
        index.blade.php
      supplier/
        create.blade.php
        edit.blade.php
        index.blade.php
      index.blade.php
    Frontend/
      auth/
        student-login.blade.php
      dashboard/
        application.blade.php
        form.blade.php
        index.blade.php
      employee/
        auth/
          change_password.blade.php
          login.blade.php
        dashboard.blade.php
        index.blade.php
      layouts/
        app.blade.php
        header.blade.php
      index.blade.php
routes/
  api.php
  channels.php
  console.php
  web.php
storage/
  app/
    public/
      .gitignore
    .gitignore
  framework/
    cache/
      data/
        .gitignore
      .gitignore
    sessions/
      .gitignore
    testing/
      .gitignore
    views/
      .gitignore
    .gitignore
  logs/
    .gitignore
tests/
  Feature/
    ExampleTest.php
  Unit/
    ExampleTest.php
  CreatesApplication.php
  TestCase.php
.editorconfig
.env.example
.gitattributes
.gitignore
artisan
composer.json
package.json
phpunit.xml
README.md
vite.config.js
</directory_structure>

<files>
This section contains the contents of the repository's files.

<file path="app/Console/Kernel.php">
<?php

namespace App\Console;

use Illuminate\Console\Scheduling\Schedule;
use Illuminate\Foundation\Console\Kernel as ConsoleKernel;

class Kernel extends ConsoleKernel
{
    /**
     * Define the application's command schedule.
     */
    protected function schedule(Schedule $schedule): void
    {
        // $schedule->command('inspire')->hourly();
    }

    /**
     * Register the commands for the application.
     */
    protected function commands(): void
    {
        $this->load(__DIR__.'/Commands');

        require base_path('routes/console.php');
    }
}
</file>

<file path="app/Exceptions/Handler.php">
<?php

namespace App\Exceptions;

use Illuminate\Foundation\Exceptions\Handler as ExceptionHandler;
use Throwable;

class Handler extends ExceptionHandler
{
    /**
     * The list of the inputs that are never flashed to the session on validation exceptions.
     *
     * @var array<int, string>
     */
    protected $dontFlash = [
        'current_password',
        'password',
        'password_confirmation',
    ];

    /**
     * Register the exception handling callbacks for the application.
     */
    public function register(): void
    {
        $this->reportable(function (Throwable $e) {
            //
        });
    }
}
</file>

<file path="app/Http/Controllers/AuthController.php">
<?php

namespace App\Http\Controllers;


use App\Models\Admin;
use App\Models\Student;
use Illuminate\Http\Request;
use Illuminate\Support\Facades\Hash;


class AuthController extends Controller
{
    // STUDENT
    public function showStudentLogin()

    {
        if (session()->has('student_id')) {
            return redirect()->route('student.dashboard');
        }
        return view('Frontend.auth.student-login');
    }




    // ADMIN
    public function showAdminLogin()
    {
        if (session()->has('admin_id')) {
            return redirect()->route('admin.dashboard');
        }
        return view('Backend.index');
    }


    public function adminLogin(Request $request)
    {
        $request->validate([
            'email' => ['required', 'email'],
            'password' => ['required', 'string', 'min:6'],
        ]);


        $admin = Admin::where('email', $request->email)->first();
        if (!$admin || !Hash::check($request->password, $admin->password)) {
            return back()->withInput()->with('error', 'Invalid credentials.');
        }


        session(['admin_id' => $admin->id]);
        return redirect()->route('admin.dashboard');
    }


    // LOGOUT (shared)
    public function logout()
    {
        session()->forget(['admin_id', 'student_id']);
        return redirect()->route('home')->with('success', 'Logged out successfully.');
    }
}
</file>

<file path="app/Http/Controllers/BrandController.php">
<?php
namespace App\Http\Controllers;

use App\Models\Brand;
use Illuminate\Http\Request;

class BrandController extends Controller
{
   public function index(Request $request)
{
    $query = Brand::query();

    // Search filter
    if ($request->filled('search')) {
        $search = $request->string('search');
        $query->where('name', 'like', "%{$search}%");
    }

    $brands = $query->latest()->paginate(10)->appends($request->only('search'));

    return view('Backend.brands.index', compact('brands'));
}


    public function create()
    {
        return view('Backend.brands.create');
    }

    public function store(Request $request)
    {
        $request->validate([
            'name' => 'required|string|max:255|unique:brands,name',
            'is_active' => 'nullable|boolean',
        ]);

        Brand::create([
            'name' => $request->name,
            'is_active' => $request->has('is_active'),
        ]);

        return redirect()->route('brands.index')->with('success', 'Brand created successfully');
    }

    public function edit(Brand $brand)
    {
        return view('Backend.brands.edit', compact('brand'));
    }

    public function update(Request $request, Brand $brand)
    {
        $request->validate([
            'name' => 'required|string|max:255|unique:brands,name,' . $brand->id,
            'is_active' => 'nullable|boolean',
        ]);

        $brand->update([
            'name' => $request->name,
            'is_active' => $request->has('is_active'),
        ]);

        return redirect()->route('brands.index')->with('success', 'Brand updated successfully');
    }

    public function destroy(Brand $brand)
    {
        $brand->delete();
        return redirect()->route('brands.index')->with('success', 'Brand deleted successfully');
    }
}
</file>

<file path="app/Http/Controllers/BSCalendarController.php">
<?php

namespace App\Http\Controllers;

use Illuminate\Http\Request;
use App\Services\BSDateService;
use Carbon\Carbon;

class BSCalendarController extends Controller
{
    public function __construct(private BSDateService $svc) {}

public function bsMonth(Request $req)
{
    $y = (int)$req->query('year');
    $m = (int)$req->query('month');

    $weeks = $this->svc->monthGrid($y, $m); // 6 arrays of 7 each
    // flatten to 42 cells
    $grid = [];
    foreach ($weeks as $w) { foreach ($w as $cell) { $grid[] = $cell; } }

    return response()->json([
        'year'  => $y,
        'month' => $m,
        'grid'  => $grid,  // ðŸ‘ˆ picker uses this
        'weeks' => $weeks, // optional (kept for other views)
    ]);
}


    public function adToBs(Request $req)
    {
        $date = Carbon::parse(
            $req->query('date', now('Asia/Kathmandu')->toDateString()),
            'Asia/Kathmandu'
        );
        $bs = $this->svc->adToBs($date);
        return response()->json([
            'input' => ['ad' => $date->toDateString()],
            'result' => ['bs' => sprintf('%04d-%02d-%02d', $bs['year'], $bs['month'], $bs['day'])]
        ]);
    }

    public function bsToAd(Request $req)
    {
        $y = (int)$req->query('year');
        $m = (int)$req->query('month');
        $d = (int)$req->query('day');

        $ad = $this->svc->bsToAd($y, $m, $d);
        return response()->json([
            'input' => ['bs' => sprintf('%04d-%02d-%02d', $y, $m, $d)],
            'result' => ['ad' => $ad->format('Y-m-d')]
        ]);
    }
}
</file>

<file path="app/Http/Controllers/CategoryController.php">
<?php
namespace App\Http\Controllers;

use App\Models\Category;
use Illuminate\Http\Request;
use Illuminate\Validation\Rule;



class CategoryController extends Controller
{
   public function index(Request $request)
{
    $query = Category::query();

    // Search filter
    if ($request->filled('search')) {
        $search = $request->string('search');
        $query->where('name', 'like', "%{$search}%");
    }

    $categories = $query->latest()->paginate(10)->appends($request->only('search'));

    return view('Backend.categories.index', compact('categories'));
}


    public function create()
    {
        return view('backend.categories.create');
    }

    public function store(Request $request)
    {
        $request->validate([
            'name' => 'required|string|max:255|unique:categories,name',
            'is_active' => 'nullable|boolean',
        ]);

        Category::create([
            'name' => $request->name,
            'is_active' => $request->has('is_active'),
        ]);

        return redirect()->route('product_categories.index')->with('success', 'Category created successfully');
    }

public function edit(Category $product_category)

{
  $category = $product_category;
    return view('backend.categories.edit', compact('category'));
}


  public function update(Request $request, Category $product_category)
{
    // Normalize input
    $request->merge([
        'name' => trim((string) $request->name),
    ]);

    $validated = $request->validate([
        'name' => [
            'required',
            'string',
            'max:255',
            Rule::unique('categories', 'name')->ignore($product_category->id),
            // ->withoutTrashed(), // uncomment if Category uses SoftDeletes
        ],
        'is_active' => ['nullable', 'boolean'],
    ]);

    $product_category->update([
        'name'      => $validated['name'],
        'is_active' => $request->boolean('is_active'),
    ]);

    return redirect()
        ->route('product_categories.index')
        ->with('success', 'Category updated successfully.');
}


    public function destroy(Category $category)
    {
        $category->delete();
        return redirect()->route('product_categories.index')->with('success', 'Category deleted successfully');
    }
}
</file>

<file path="app/Http/Controllers/Controller.php">
<?php

namespace App\Http\Controllers;

use Illuminate\Foundation\Auth\Access\AuthorizesRequests;
use Illuminate\Foundation\Validation\ValidatesRequests;
use Illuminate\Routing\Controller as BaseController;

class Controller extends BaseController
{
    use AuthorizesRequests, ValidatesRequests;
}
</file>

<file path="app/Http/Controllers/DashboardController.php">
<?php

namespace App\Http\Controllers;


use App\Models\Student;
use App\Models\Admin;


class DashboardController extends Controller
{
    public function home()
    {
        return view('Frontend.index');
    }

    public function admin()
    {
        $admin = Admin::find(session('admin_id'));
 
      return view('Backend.dashboard.index', compact('admin'));
     }
}
</file>

<file path="app/Http/Controllers/DepartmentController.php">
<?php

namespace App\Http\Controllers;

use Illuminate\Http\Request;
use Illuminate\Support\Facades\Session;
use App\Models\Department;

class DepartmentController extends Controller
{
    private $departmentModel;

    public function __construct(Department $department)
    {
        $this->departmentModel = $department;
    }

    /**
     * Display a listing of departments.
     *
     * @return \Illuminate\View\View
     */
    public function index()
    {
        // Get all departments with type 0, ordered by latest
        $department = $this->departmentModel
                            ->latest()
                            ->get();

        return view('Backend.departments.index', compact('department'));
    }

    /**
     * Store a newly created department.
     *
     * @param  \Illuminate\Http\Request  $request
     * @return \Illuminate\Http\RedirectResponse
     */
    public function store(Request $request)
    {
        $validated = $request->validate([
            'name' => 'required|max:255',
        ]);

        $this->departmentModel->create([
            'name' => $validated['name'],
            'status' => 1, // default active
            'type' => 0,   // default type
        ]);

        Session::flash('message', 'Department successfully added!');
        return redirect()->back();
    }

    /**
     * Update the specified department.
     *
     * @param  \Illuminate\Http\Request  $request
     * @param  int  $id
     * @return \Illuminate\Http\RedirectResponse
     */
    public function update(Request $request, int $id)
    {
        $validated = $request->validate([
            'name' => 'required|max:255',
            'status' => 'required|boolean',
        ]);

        $department = $this->departmentModel->findOrFail($id);
        $department->update([
            'name' => $validated['name'],
            'status' => $validated['status'],
        ]);

        Session::flash('message', 'Department successfully updated!');
        return redirect()->back();
    }

    /**
     * Remove the specified department.
     *
     * @param  int  $id
     * @return \Illuminate\Http\RedirectResponse
     */
    public function destroy(int $id)
    {
        $department = $this->departmentModel->findOrFail($id);
        $department->delete();

        Session::flash('message', 'Department successfully deleted!');
        return redirect()->back();
    }
}
</file>

<file path="app/Http/Controllers/EmployeeAuthController.php">
<?php
namespace App\Http\Controllers;
use Illuminate\Http\Request;
use Illuminate\Support\Facades\Auth;
use Illuminate\Validation\ValidationException;
use Illuminate\Support\Facades\Hash;

class EmployeeAuthController extends Controller
{
    public function showLogin()
    {
        if (Auth::guard('employee')->check()) {
            return redirect()->route('employee.dashboard');
        }
        return view('Frontend.employee.auth.login');
    }

    public function login(Request $request)
    {
        $credentials = $request->validate([
            'email'    => ['required','email'],
            'password' => ['required','string'],
        ]);

        if (!Auth::guard('employee')->attempt($credentials, $request->boolean('remember'))) {
            throw ValidationException::withMessages(['email' => 'Invalid credentials.']);
        }

        $request->session()->regenerate();

        $user = Auth::guard('employee')->user();
        if (!$user->is_active) {
            Auth::guard('employee')->logout();
            throw ValidationException::withMessages(['email' => 'Your account is disabled.']);
        }

        if ($user->must_change_password) {
            return redirect()->route('employee.password.show');
        }

        return redirect()->route('employee.dashboard');
    }

    public function logout(Request $request)
    {
        Auth::guard('employee')->logout();
        $request->session()->invalidate();
        $request->session()->regenerateToken();
        return redirect()->route('employee.login');
    }

    public function showChangePassword()
    {
        return view('Frontend.employee.auth.change_password');
    }

    public function updatePassword(Request $request)
    {
        $data = $request->validate([
            'current_password' => ['required','string'],
            'password'         => ['required','string','min:6','max:64','confirmed'],
        ]);

        $user = Auth::guard('employee')->user();

        if (!Hash::check($data['current_password'], $user->password)) {
            return back()->withErrors(['current_password' => 'Current password is incorrect.']);
        }

        $user->update([
            'password' => Hash::make($data['password']),
            'must_change_password' => false,
        ]);

        return redirect()->route('employee.dashboard')->with('success','Password changed successfully.');
    }
}
</file>

<file path="app/Http/Controllers/EmployeeController.php">
<?php

namespace App\Http\Controllers;

use App\Models\Employee;
use App\Models\Department;
use Illuminate\Http\Request;
use Illuminate\Support\Facades\Hash;

use Illuminate\Validation\Rule;

class EmployeeController extends Controller
{
    public function search(Request $request)
    {
        $q = trim((string)$request->get('q',''));
        if ($q === '') {
            return response()->json([]);
        }

        $employees = Employee::query()
            ->where(function ($w) use ($q) {
                $w->where('full_name','like',"%{$q}%")
                  ->orWhere('email','like',"%{$q}%")
                  ->orWhere('atten_no','like',"%{$q}%");
            })
            ->orderBy('full_name')
            ->limit(15)
            ->get(['id','full_name','email','atten_no','employee_type']);

        return response()->json(
            $employees->map(fn($e) => [
                'id'   => $e->id,
                'text' => $e->full_name
                         . ($e->employee_type ? " ({$e->employee_type})" : '')
                         . ($e->atten_no ? " [{$e->atten_no}]" : ''),
                'email' => $e->email,
            ])
        );
    }
    public function index(Request $request)
    {
        $q = Employee::query()->with('department')->latest();
        if ($s = trim($request->get('search',''))) {
            $q->where('full_name','like',"%{$s}%")
              ->orWhere('email','like',"%{$s}%")
              ->orWhere('atten_no','like',"%{$s}%");
        }
        $employees = $q->paginate(15)->appends($request->only('search'));
        return view('Backend.employees.index', compact('employees'));
    }

    public function create()
    {
        return view('Backend.employees.create', [
            'departments' => Department::orderBy('name')->get(),
        ]);
    }

    public function store(Request $request)
    {
        $data = $request->validate([
            'department_id' => ['required','exists:departments,id'],
            'full_name'     => ['required','string','max:150'],
            'contact'       => ['nullable','string','max:30'],
            'atten_no'      => ['nullable','string','max:50'],
            'email'         => ['nullable','email','max:150','unique:employees,email'],
            'password'      => ['required','string','min:6','max:64'], // admin sets first time
            'is_active'     => ['nullable','boolean'],
        ]);

        Employee::create([
            'department_id'       => $data['department_id'],
            'full_name'           => $data['full_name'],
            'contact'             => $data['contact'] ?? null,
            'atten_no'            => $data['atten_no'] ?? null,
            'email'               => $data['email'] ?? null,
            'password'            => Hash::make($data['password']),
            'must_change_password'=> true,   // first login must change
            'is_active'           => (bool)($data['is_active'] ?? true),
        ]);

        return redirect()->route('employees.index')->with('success','Employee created.');
    }

    public function edit(Employee $employee)
    {
        return view('Backend.employees.edit', [
            'employee'    => $employee,
            'departments' => Department::orderBy('name')->get(),
        ]);
    }

    public function update(Request $request, Employee $employee)
    {
        $data = $request->validate([
            'department_id' => ['required','exists:departments,id'],
            'full_name'     => ['required','string','max:150'],
            'contact'       => ['nullable','string','max:30'],
            'atten_no'      => ['nullable','string','max:50'],
            'email'         => ['nullable','email','max:150', Rule::unique('employees','email')->ignore($employee->id)],
            'password'      => ['nullable','string','min:6','max:64'], // admin can reset
            'is_active'     => ['nullable','boolean'],
            'must_change_password' => ['nullable','boolean'],
        ]);

        $payload = [
            'department_id' => $data['department_id'],
            'full_name'     => $data['full_name'],
            'contact'       => $data['contact'] ?? null,
            'atten_no'      => $data['atten_no'] ?? null,
            'email'         => $data['email'] ?? null,
            'is_active'     => (bool)($data['is_active'] ?? $employee->is_active),
        ];

        if (!empty($data['password'])) {
            $payload['password'] = Hash::make($data['password']);
            // If admin resets, you may force change again:
            $payload['must_change_password'] = true;
        } elseif (array_key_exists('must_change_password',$data)) {
            $payload['must_change_password'] = (bool)$data['must_change_password'];
        }

        $employee->update($payload);

        return redirect()->route('employees.index')->with('success','Employee updated.');
    }

    public function destroy(Employee $employee)
    {
        $employee->delete();
        return back()->with('success','Employee deleted.');
    }
}
</file>

<file path="app/Http/Controllers/EmployeeStoreOutController.php">
<?php

namespace App\Http\Controllers;

use App\Models\StoreOut;
use Illuminate\Http\Request;

class EmployeeStoreOutController extends Controller
{
    public function index(Request $request)
    {
        $user = auth('employee')->user();

        $q = StoreOut::query()
            ->with('items')
            ->where('employee_id', $user->id)
            ->latest('store_out_date_bs');

        $outs = $q->paginate(15);

        return view('employee.store_out.index', compact('outs'));
    }
}
</file>

<file path="app/Http/Controllers/ItemCategoryController.php">
<?php

namespace App\Http\Controllers;

use App\Models\ItemCategory;
use Illuminate\Http\Request;

class ItemCategoryController extends Controller
{
    public function index()
    {
        // Use pagination so you can safely call ->total() in the view
        $categories = ItemCategory::latest()->paginate(10);
        return view('Backend.items.index', compact('categories'));
    }

    public function create()
    {
        return view('Backend.items.create');
    }

    public function store(Request $request)
    {
        $data = $request->validate([
            'name_en' => 'required|string|max:100',
            'name_np' => 'nullable|string|max:100',
        ]);

        ItemCategory::create($data);
        return redirect()->route('categories.index')->with('success', 'Item category added successfully.');
    }

    public function destroy(ItemCategory $category)
    {
        $category->delete();
        return redirect()->back()->with('success', 'Item category deleted successfully.');
    }

   public function edit(ItemCategory $category) // <-- type-hinted model
    {
        return view('Backend.items.edit', compact('category'));
    }

   public function update(Request $request, ItemCategory $category)
    {
        $data = $request->validate([
            'name_en' => 'required|string|max:100',
            'name_np' => 'nullable|string|max:100',
        ]);

        $category->update($data);

        return redirect()->route('categories.index')
            ->with('success', 'Item category updated successfully.');
    
}
}
</file>

<file path="app/Http/Controllers/ProductController.php">
<?php

// app/Http/Controllers/ProductController.php
namespace App\Http\Controllers;

use App\Models\{Product, ItemCategory, Category, Brand};
use Illuminate\Http\Request;
use Illuminate\Validation\Rule;
use Illuminate\Support\Str;

class ProductController extends Controller
{
    public function index(Request $request)
    {
        $q = Product::query()->with(['itemCategory','productCategory','brand']);

        if ($s = $request->string('search')->toString()) {
            $q->where(fn($x)=>$x->where('name','like',"%$s%")->orWhere('sku','like',"%$s%"));
        }

        $products = $q->latest()->paginate(10)->appends($request->only('search'));
        return view('backend.products.index', compact('products'));
    }

    public function create()
    {
        return view('backend.products.create', [
            'itemCategories' => ItemCategory::orderBy('name_en')->get(),
            'productCategories' => Category::orderBy('name')->get(),
            'brands' => Brand::orderBy('name')->get(),
        ]);
    }

    public function store(Request $request)
    {
        $data = $request->validate([
            'name' => ['required','string','max:150'],
            'sku'  => ['required','string','max:50','unique:products,sku'],
            'item_category_id' => ['nullable','exists:item_categories,id'],
            'product_category_id' => ['nullable','exists:categories,id'],
            'brand_id' => ['nullable','exists:brands,id'],
            'unit' => ['required','string','max:20'],
            'reorder_level' => ['nullable','integer','min:0'],
            'image' => ['nullable','image','max:2048'],
            'is_active' => ['nullable','boolean'],
        ]);

        if ($request->hasFile('image')) {
            $data['image_path'] = $request->file('image')->store('products','public');
        }
        $data['is_active'] = $request->boolean('is_active');

        Product::create($data);

        return redirect()->route('products.index')->with('success','Product created.');
    }

    public function edit(Product $product)
    {
        return view('backend.products.edit', [
            'product' => $product,
            'itemCategories' => ItemCategory::orderBy('name_en')->get(),
            'productCategories' => Category::orderBy('name')->get(),
            'brands' => Brand::orderBy('name')->get(),
        ]);
    }

    public function update(Request $request, Product $product)
    {
        $data = $request->validate([
            'name' => ['required','string','max:150'],
            'sku'  => ['required','string','max:50', Rule::unique('products','sku')->ignore($product->id)],
            'item_category_id' => ['nullable','exists:item_categories,id'],
            'product_category_id' => ['nullable','exists:categories,id'],
            'brand_id' => ['nullable','exists:brands,id'],
            'unit' => ['required','string','max:20'],
            'reorder_level' => ['nullable','integer','min:0'],
            'image' => ['nullable','image','max:2048'],
            'is_active' => ['nullable','boolean'],
        ]);

        if ($request->hasFile('image')) {
            $data['image_path'] = $request->file('image')->store('products','public');
        }
        $data['is_active'] = $request->boolean('is_active');

        $product->update($data);

        return redirect()->route('products.index')->with('success','Product updated.');
    }

    public function destroy(Product $product)
    {
        $product->delete();
        return back()->with('success','Product deleted.');
    }
}
</file>

<file path="app/Http/Controllers/PurchaseController.php">
<?php

namespace App\Http\Controllers;

use App\Models\{
    Purchase,
    PurchaseItem,
    PurchaseSlip,
    Supplier,
    Department,
    Product
};
use Illuminate\Http\Request;
use Illuminate\Support\Facades\DB;
use Illuminate\Validation\Rule;
use Illuminate\Validation\ValidationException;

class PurchaseController extends Controller
{
    public function index(Request $request)
    {
        $q = Purchase::query()
            ->with(['supplier','slip','department'])
            ->latest('purchase_date');

        if ($s = trim((string) $request->get('search'))) {
            // Group search to avoid precedence bugs
            $q->where(function ($w) use ($s) {
                if (preg_match('/^\d{4}-\d{2}-\d{2}$/', $s)) {
                    $w->whereDate('purchase_date', $s);
                } else {
                    $w->where('purchase_sn', 'like', "%{$s}%");
                }

                $w->orWhereHas('supplier', fn($x) => $x->where('name','like',"%{$s}%"))
                  ->orWhereHas('slip', fn($x)    => $x->where('po_sn','like',"%{$s}%"));
            });
        }

        $orders = $q->paginate(10)->appends($request->only('search'));

        return view('backend.purchases.index', compact('orders'));
    }

  public function show(Purchase $purchase)
{
    // Load all relations we need
    $purchase->load(['supplier','department','slip','items.product']);

    // Build printable rows
    $items = $purchase->items->values()->map(function ($line, $idx) {
        $name = $line->temp_name ?: ($line->product->name ?? 'â€”');
        $unit = $line->unit ?: ($line->product->unit ?? '');
        $qty  = (float) $line->qty;
        $rate = (float) $line->rate;

        return [
            'sn'        => $idx + 1,
            'desc'      => $name,
            'unit'      => $unit,
            'store_entry_sn' => $line->store_entry_sn ?? 'â€”',
            'required'  => number_format($qty, 3),             // quantity
            'rate'      => number_format($rate, 2),            // unit price
            'amount'    => number_format($line->line_subtotal ?? ($qty * $rate), 2),
            'remark'    => $line->notes ?? '',                 // per-line remark if you use it
        ];
    });

    // Header/meta for the print header
    $meta = [
        'purchase_sn'   => $purchase->purchase_sn,
        'purchase_date' => $purchase->purchase_date,
        'supplier'      => $purchase->supplier->name ?? 'â€”',
        'dept'          => $purchase->department->name
                           ?? $purchase->slip?->department?->name
                           ?? 'â€”',
        'tax_mode'      => $purchase->tax_mode ?? 'PAN',
        'vat_percent'   => $purchase->tax_mode === 'VAT' ? (float)$purchase->vat_percent : 0.0,
        'sub_total'     => number_format((float)$purchase->sub_total, 2),
        'vat_amount'    => number_format((float)$purchase->vat_amount, 2),
        'grand_total'   => number_format((float)($purchase->grand_total ?: $purchase->total_amount), 2),

        // Slip (optional)
        'slip_sn'       => $purchase->slip?->po_sn,
        'slip_date'     => optional($purchase->slip?->po_date)->format('Y-m-d'),
        'remarks'       => $purchase->remarks ?? 'â€”',
    ];

    return view('backend.purchases.show_print', compact('purchase','items','meta'));
}


    public function create(Request $request)
    {
        $slip = PurchaseSlip::with('items')->findOrFail($request->get('slip_id')); // must select a slip

        return view('backend.purchases.create', [
            'slip'       => $slip,
            'suppliers'  => Supplier::orderBy('name')->get(),
            'departments'=> Department::orderBy('name')->get(),
            'products'   => Product::orderBy('name')->get(),
        ]);
    }

public function store(Request $request)
{
    // Slip is optional now
    $slipId = $request->input('purchase_slip_id');
    $slip   = $slipId ? PurchaseSlip::findOrFail($slipId) : null;

    // Build rules (date after-or-equal only if slip exists)
    $rules = [
        'purchase_sn'      => ['required','string','max:50','unique:purchases,purchase_sn'],
        'purchase_date'    => ['required','date'],
        'supplier_id'      => ['nullable','exists:suppliers,id'], // supplier optional if you want
        'purchase_slip_id' => ['nullable','exists:purchase_slips,id'],
        'department_id'    => ['nullable','exists:departments,id'],
        
        'remarks'          => ['nullable','string','max:2000'],

        'tax_mode'         => ['nullable','in:VAT,PAN'],
        'vat_percent'      => ['nullable','numeric','gte:0','lte:100'],
        'bill_no'         => ['required','string','max:100'],

        'items'                 => ['required','array','min:1'],
        'items.*.name'          => ['required','string','max:255'],
        'items.*.qty'           => ['required','numeric','gt:0'],
        'items.*.rate'          => ['required','numeric','gte:0'],
        'items.*.unit'          => ['required','string','max:20'],
        'items.*.item_category_id' => ['nullable','exists:item_categories,id'],
        'items.*.temp_sn'       => ['nullable','string','max:100'],
    ];

    if ($slip) {
        $rules['purchase_date'][] = 'after_or_equal:'.$slip->po_date->toDateString();
    }

    $data = $request->validate($rules);

    DB::transaction(function() use ($data, $slip) {
        $purchase = Purchase::create([
            'purchase_sn'      => $data['purchase_sn'],
            'purchase_date'    => $data['purchase_date'],
            'supplier_id'      => $data['supplier_id'] ?? null,
            'purchase_slip_id' => $data['purchase_slip_id'] ?? null,
            'department_id'    => $data['department_id'] ?? ($slip->department_id ?? null),
            'remarks'          => $data['remarks'] ?? null,

            'tax_mode'         => $data['tax_mode'] ?? 'PAN',
            'bill_no'         => $data['bill_no'],
            'vat_percent'      => $data['vat_percent'] ?? 13.00,
            'sub_total'        => 0,
            'vat_amount'       => 0,
            'grand_total'      => 0,
            'total_amount'     => 0,
        ]);

        $bulk = [];
        foreach ($data['items'] as $row) {
            $qty  = (float)$row['qty'];
            $rate = (float)$row['rate'];

            $bulk[] = new PurchaseItem([
                'product_id'       => null,                     // no mapping now
                'item_category_id' => $row['item_category_id'] ?? null,
                'temp_name'        => $row['name'],
                'temp_sn'          => $row['temp_sn'] ?? null,
                'unit'             => $row['unit'] ?? null,
                'qty'              => $qty,
                'rate'             => $rate,
                'discount_percent' => 0,
                'discount_amount'  => 0,
                'line_subtotal'    => round($qty * $rate, 2),
                'notes'            => null,
            ]);
        }

        $purchase->items()->saveMany($bulk);

        $purchase->load('items');
        $purchase->recomputeTotals();
        $purchase->save();
    });

    return redirect()->route('purchases.index')->with('success','Purchase saved.');
}




    public function edit(Purchase $purchase)
    {
         if ($purchase->storeEntry) {
        return redirect()
            ->route('purchases.index')
            ->with('error', 'This purchase is already posted to store and cannot be edited.');
    }
        $purchase->load(['items.product','supplier','department','slip.items']);
        return view('backend.purchases.edit', [
            'purchase'   => $purchase,
            'suppliers'  => Supplier::orderBy('name')->get(),
            'departments'=> Department::orderBy('name')->get(),
        ]);
    }

public function update(Request $request, Purchase $purchase)
{
    // Slip is optional; if exists apply date constraint only
    $slip = $purchase->purchase_slip_id ? PurchaseSlip::find($purchase->purchase_slip_id) : null;

    $rules = [
        'purchase_sn'      => ['required','string','max:50', Rule::unique('purchases','purchase_sn')->ignore($purchase->id)],
        'purchase_date'    => ['required','date'],
        'supplier_id'      => ['nullable','exists:suppliers,id'],
        'department_id'    => ['nullable','exists:departments,id'],
        'remarks'          => ['nullable','string','max:2000'],

        'tax_mode'         => ['nullable','in:VAT,PAN'],
        'vat_percent'      => ['nullable','numeric','gte:0','lte:100'],

        'items'                 => ['required','array','min:1'],
        'items.*.name'          => ['required','string','max:255'],
        'items.*.qty'           => ['required','numeric','gt:0'],
        'items.*.rate'          => ['required','numeric','gte:0'],
        'items.*.unit'          => ['nullable','string','max:20'],
        'items.*.item_category_id' => ['nullable','exists:item_categories,id'],
        'items.*.temp_sn'       => ['nullable','string','max:100'],
    ];

    if ($slip) {
        $rules['purchase_date'][] = 'after_or_equal:'.$slip->po_date->toDateString();
    }

    $data = $request->validate($rules);

    DB::transaction(function () use ($data, $purchase) {
        $purchase->update([
            'purchase_sn'      => $data['purchase_sn'],
            'purchase_date'    => $data['purchase_date'],
            'supplier_id'      => $data['supplier_id'] ?? null,
            'department_id'    => $data['department_id'] ?? $purchase->department_id,
            'remarks'          => $data['remarks'] ?? null,
            'tax_mode'         => $data['tax_mode'] ?? $purchase->tax_mode ?? 'PAN',
            'vat_percent'      => $data['vat_percent'] ?? $purchase->vat_percent ?? 13.00,
        ]);

        // replace items
        $purchase->items()->delete();

        $bulk = [];
        foreach ($data['items'] as $row) {
            $qty  = (float)$row['qty'];
            $rate = (float)$row['rate'];

            $bulk[] = new PurchaseItem([
                'product_id'       => null,
                'item_category_id' => $row['item_category_id'] ?? null,
                'temp_name'        => $row['name'],
                'temp_sn'          => $row['temp_sn'] ?? null,
                'unit'             => $row['unit'] ?? null,
                'qty'              => $qty,
                'rate'             => $rate,
                'discount_percent' => 0,
                'discount_amount'  => 0,
                'line_subtotal'    => round($qty * $rate, 2),
                'notes'            => null,
            ]);
        }
        $purchase->items()->saveMany($bulk);

        $purchase->load('items');
        $purchase->recomputeTotals();
        $purchase->save();
    });

    return redirect()->route('purchases.index')->with('success','Purchase updated.');
}


    public function destroy(Purchase $purchase)
    {
        $purchase->items()->delete();
        $purchase->delete();
        return back()->with('success','Purchase deleted.');
    }
}
</file>

<file path="app/Http/Controllers/PurchaseSlipController.php">
<?php

/**
 * Edit a specific purchase slip.
 *
 * @param \App\Models\PurchaseSlip $slip
 */

namespace App\Http\Controllers;

use App\Models\{
    PurchaseSlip,
    PurchaseSlipItem,
    Department,
    PurchaseLine,
    ItemCategory
};
use Illuminate\Http\Request;
use Illuminate\Support\Facades\DB;
use Illuminate\Validation\Rule;


class PurchaseSlipController extends Controller
{
    /** AJAX: suggest previously ordered slip items */
    public function productSearch(Request $request)
    {
        $q = trim((string)$request->get('q', ''));
        if ($q === '') {
            return response()->json([]);
        }

        // Pull recent matches by name or detail (temp_sn)
        $pool = PurchaseSlipItem::query()
            ->whereNotNull('temp_name')
            ->where(function ($x) use ($q) {
                $x->where('temp_name', 'like', "%{$q}%")
                    ->orWhere('temp_sn', 'like', "%{$q}%");
            })
            ->orderByDesc('created_at')
            ->limit(50)
            ->get([
                'id',
                'temp_name',
                'temp_sn',
                'ordered_qty',
                'max_rate',
                'unit',
                'item_category_id',
                'created_at'
            ]);

        // Unique by (name|sn) - case insensitive
        $unique = $pool->unique(function ($i) {
            return mb_strtolower(trim($i->temp_name ?? '')) . '|' . mb_strtolower(trim($i->temp_sn ?? ''));
        })->take(10)->values();

        // Preload categories
        $catIds = $unique->pluck('item_category_id')->filter()->unique()->values();
        $catMap = ItemCategory::whereIn('id', $catIds)->get()
            ->keyBy('id')
            ->map(fn($c) => $c->name_en . ' (' . $c->name_np . ')');

        return response()->json(
            $unique->map(function ($i) use ($catMap) {
                return [
                    'id'                 => $i->id,
                    'text'               => trim($i->temp_name . ($i->temp_sn ? " ({$i->temp_sn})" : "")),
                    'temp_name'          => $i->temp_name ?? '',
                    'temp_sn'            => $i->temp_sn ?? '',
                    'last_qty'           => (string)($i->ordered_qty ?? ''),
                    'last_rate'          => (string)($i->max_rate ?? ''),
                    'last_unit'          => (string)($i->unit ?? ''),
                    'last_category_id'   => $i->item_category_id,
                    'last_category_name' => $i->item_category_id ? ($catMap[$i->item_category_id] ?? '') : '',
                ];
            })
        );
    }

    public function index(Request $request)
    {
        $q = PurchaseSlip::query()
            ->with('department')
            ->withCount('purchases')
            ->latest('po_date');

        if ($s = trim((string)$request->get('search'))) {
            $q->where(function ($w) use ($s) {
                if (preg_match('/^\d{4}-\d{2}-\d{2}$/', $s)) {
                    $w->whereDate('po_date', $s);
                } else {
                    $w->where('po_sn', 'like', "%{$s}%");
                }
                $w->orWhereHas('department', fn($x) => $x->where('name', 'like', "%{$s}%"));
            });
        }

        $slips = $q->paginate(10)->appends($request->only('search'));
        return view('backend.slips.index', compact('slips'));
    }

    public function create()
    {
        return view('backend.slips.create', [
            'departments'   => Department::orderBy('name')->get(),
            'item_category' => ItemCategory::orderBy('name_en')->get(),
        ]);
    }

    /** Store slip + items */
    public function store(Request $request)
    {
        $payload = $request->all();
        if (isset($payload['items']) && is_array($payload['items'])) {
            foreach ($payload['items'] as $k => $row) {
                if (($row['product_id'] ?? null) === '__new__') {
                    $payload['items'][$k]['product_id'] = null;
                }
            }
        }

        $data = validator($payload, [
            'po_sn'         => ['required', 'string', 'max:50', 'unique:purchase_slips,po_sn'],
            'po_date'       => ['required', 'date'],
            'department_id' => ['required', 'exists:departments,id'],
            'remarks'       => ['nullable', 'string', 'max:2000'],

            'items'                        => ['required', 'array', 'min:1'],
            'items.*.product_id'           => ['nullable', 'exists:products,id', 'required_without:items.*.temp_name'],
            'items.*.temp_name'            => ['nullable', 'string', 'max:255', 'required_without:items.*.product_id'],
            'items.*.temp_sn'              => ['nullable', 'string', 'max:100'],
            'items.*.unit'                 => ['nullable', 'string', 'max:20'],
            'items.*.ordered_qty'          => ['required', 'numeric', 'gt:0'],
            'items.*.max_rate'             => ['required', 'numeric', 'gte:0'],
            'items.*.item_category_id'     => ['required', 'exists:item_categories,id'],
        ], [
            'items.*.product_id.required_without' => 'Pick from suggestions or type an item name.',
            'items.*.temp_name.required_without'  => 'Type an item name if not selecting a suggestion.',
        ])->validate();

        DB::transaction(function () use ($data) {
            $slip = PurchaseSlip::create([
                'po_sn'         => trim($data['po_sn']),
                'po_date'       => $data['po_date'],
                'department_id' => $data['department_id'],
                'remarks'       => $data['remarks'] ?? null,
            ]);

            foreach ($data['items'] as $row) {
                PurchaseSlipItem::create([
                    'purchase_slip_id' => $slip->id,
                    'product_id'       => $row['product_id'] ?? null,
                    'temp_name'        => $row['temp_name'] ?? null,
                    'temp_sn'          => $row['temp_sn'] ?? null,
                    'unit'             => $row['unit'] ?? null,
                    'item_category_id' => $row['item_category_id'] ?? null,
                    'ordered_qty'      => $row['ordered_qty'],
                    'max_rate'         => $row['max_rate'],
                    'line_total'       => (float)$row['ordered_qty'] * (float)$row['max_rate'],
                ]);
            }
        });

        return redirect()->route('slips.index')->with('success', 'Purchase slip created.');
    }

    public function show(PurchaseSlip $slip)
    {
        $slip->load(['department', 'items.itemCategory']);

        // If you need purchased qty by product from purchases linked to this slip:
        $purchasedByProduct = PurchaseSlip::query()
            ->selectRaw(' SUM(qty) as qty')
            ->whereHas('purchase', fn($p) => $p->where('purchase_slip_id', $slip->id))
        
            ->pluck('qty');

        return view('backend.slips.show', [
            'slip' => $slip,
            'purchasedByProduct' => $purchasedByProduct,
        ]);
    }

    public function edit(PurchaseSlip $slip)
    {
        $slip->load('items');

        // Prepare items for JavaScript
        $slipItemsForJs = $slip->items->map(function ($item) {
            return [
                'product_id'        => $item->product_id,
                'temp_name'         => $item->temp_name,
                'temp_sn'           => $item->temp_sn,
                'ordered_qty'       => $item->ordered_qty,
                'max_rate'          => $item->max_rate,
                'unit'              => $item->unit,
                'item_category_id'  => $item->item_category_id,
            ];
        })->toArray();

        return view('backend.slips.edit', [
            'slip'           => $slip,
            'slipItemsForJs' => $slipItemsForJs,
            'departments'    => Department::orderBy('name')->get(),
            'item_category'  => ItemCategory::orderBy('name_en')->get(),
        ]);
    }

    public function update(Request $request, PurchaseSlip $slip)
    {
        $payload = $request->all();
        if (isset($payload['items']) && is_array($payload['items'])) {
            foreach ($payload['items'] as $k => $row) {
                if (($row['product_id'] ?? null) === '__new__') {
                    $payload['items'][$k]['product_id'] = null;
                }
            }
        }

        $data = validator($payload, [
            'po_sn'         => ['required', 'string', 'max:50', Rule::unique('purchase_slips', 'po_sn')->ignore($slip->id)],
            'po_date'       => ['required', 'date'],
            'department_id' => ['required', 'exists:departments,id'],
            'remarks'       => ['nullable', 'string', 'max:2000'],

            'items'                        => ['required', 'array', 'min:1'],
            'items.*.product_id'           => ['nullable', 'exists:products,id', 'required_without:items.*.temp_name'],
            'items.*.temp_name'            => ['nullable', 'string', 'max:255', 'required_without:items.*.product_id'],
            'items.*.temp_sn'              => ['nullable', 'string', 'max:100'],
            'items.*.unit'                 => ['nullable', 'string', 'max:20'],
            'items.*.ordered_qty'          => ['required', 'numeric', 'gt:0'],
            'items.*.max_rate'             => ['required', 'numeric', 'gte:0'],
            'items.*.item_category_id'     => ['required', 'exists:item_categories,id'],
        ], [
            'items.*.product_id.required_without' => 'Pick from suggestions or type an item name.',
            'items.*.temp_name.required_without'  => 'Type an item name if not selecting a suggestion.',
        ])->validate();

        DB::transaction(function () use ($slip, $data) {
            $slip->update([
                'po_sn'         => $data['po_sn'],
                'po_date'       => $data['po_date'],
                'department_id' => $data['department_id'],
                'remarks'       => $data['remarks'] ?? null,
            ]);

            // If you want to block reducing qty below already purchased qty for same product_id:
            $purchasedByProduct = PurchaseSlip::query()
                ->selectRaw('product_id, SUM(qty) as qty')
                ->whereHas('purchase', fn($p) => $p->where('purchase_slip_id', $slip->id))
       ;

            // Replace items
            $slip->items()->delete();

            foreach ($data['items'] as $row) {
                $productId = $row['product_id'] ?? null;
                if ($productId) {
                    $alreadyPurchased = (float)($purchasedByProduct[$productId] ?? 0);
                    if ((float)$row['ordered_qty'] + 1e-9 < $alreadyPurchased) {
                        abort(422, "Ordered qty cannot be less than already purchased ({$alreadyPurchased}).");
                    }
                }

                PurchaseSlipItem::create([
                    'purchase_slip_id' => $slip->id,
                    'product_id'       => $productId,
                    'temp_name'        => $row['temp_name'] ?? null,
                    'temp_sn'          => $row['temp_sn'] ?? null,
                    'unit'             => $row['unit'] ?? null,
                    'item_category_id' => $row['item_category_id'] ?? null,
                    'ordered_qty'      => $row['ordered_qty'],
                    'max_rate'         => $row['max_rate'],
                    'line_total'       => (float)$row['ordered_qty'] * (float)$row['max_rate'],
                ]);
            }
        });

        return redirect()->route('slips.index')->with('success', 'Purchase slip updated.');
    }

    public function destroy(PurchaseSlip $slip)
    {
        if ($slip->purchases()->exists()) {
            return back()->with('error', 'Cannot delete slip with existing purchases.');
        }
        $slip->delete();
        return back()->with('success', 'Purchase slip deleted.');
    }

    public function print(PurchaseSlip $slip)
    {
        $slip->load(['department', 'items.itemCategory']);

        $items = $slip->items->map(function ($it, $idx) {
            $desc   = $it->temp_name ?: ('Product #' . $it->product_id);
            $unit   = $it->unit ?: '';
            $qty    = (float)$it->ordered_qty;
            $rate   = (float)$it->max_rate;
            $total  = $it->line_total ?: $qty * $rate;
            $cat = $it->itemCategory?->name_en
                ? ( ' (' . mb_substr($it->itemCategory->name_np ?? '', 0, 2) . ')')
                : '';


            return [
                'sn'        => $idx + 1,
                'desc'      => $desc,
                'category'  => $cat,
                'unit'      => $unit,
                'min_stock' => '',
                'store_bal' => '',
                'required'  => number_format($qty, 3),
                'amount'    => number_format($total, 2),
                'budget'    => $cat,
                'remark'    => '',
            ];
        });

        return view('backend.slips.print', [
            'slip'  => $slip,
            'items' => $items,
        ]);
    }
}
</file>

<file path="app/Http/Controllers/StoreEntryController.php">
<?php
// app/Http/Controllers/StoreEntryController.php
namespace App\Http\Controllers;

use App\Models\{
    StoreEntry, StoreEntryItem, Purchase, PurchaseItem,
    ItemCategory, Category, Brand
};
use Illuminate\Http\Request;
use Illuminate\Support\Facades\DB;

class StoreEntryController extends Controller
{
     public function index(Request $request)
    {
        $q = StoreEntry::with(['purchase','supplier'])->latest('id');

        if ($s = trim((string)$request->get('search'))) {
            $q->where(function($w) use ($s){
                $w->where('purchase_sn','like',"%{$s}%")
                  ->orWhere('supplier_name','like',"%{$s}%");
            });
        }

        $entries = $q->paginate(15)->appends($request->only('search'));
        return view('backend.store.index', compact('entries'));
    }

    /** Step 1: Let user pick Item Category / Product Category / Brand per line */
    public function prepare(Purchase $purchase)
    {
        $purchase->load(['supplier','items.product']);
        $itemCategories = ItemCategory::orderBy('name_en')->get(['id','name_en']);
        $productCategories = Category::orderBy('name')->get(['id','name']);
        $brands = Brand::orderBy('name')->get(['id','name']);

        // Build rows with smart defaults (from line, else product)
        $rows = $purchase->items->map(function($line){
            $name = $line->temp_name ?: ($line->product->name ?? 'â€”');
            $sn   = $line->temp_sn   ?: ($line->product->sku ?? null);
            return [
                'purchase_item_id' => $line->id,
                'display_name'     => $name,
                'sn'               => $sn,
                'unit'             => $line->unit ?: ($line->product->unit ?? null),
                'qty'              => (float)$line->qty,
                'rate'             => (float)$line->rate,
                'total'            => round((float)$line->qty * (float)$line->rate, 2),

                // defaults
                'item_category_id' => $line->item_category_id
                    ?? ($line->product->item_category_id ?? null),
                'category_id'      => $line->product->category_id ?? null,
                'brand_id'         => $line->product->brand_id ?? null,
            ];
        });

        return view('backend.store.prepare', compact(
            'purchase','rows','itemCategories','productCategories','brands'
        ));
    }

    /** Step 2: Create/refresh Store Entry using the user's selections */
    public function postFromPurchase(Request $request, Purchase $purchase)
{
    $data = $request->validate([
        'mapping'                               => ['required', 'array', 'min:1'],
        'mapping.*.purchase_item_id'            => ['required', 'exists:purchase_items,id'],
        'mapping.*.item_category_id'            => ['nullable', 'exists:item_categories,id'],
        'mapping.*.category_id'                 => ['nullable', 'exists:categories,id'],
        'mapping.*.brand_id'                    => ['nullable', 'exists:brands,id'],
    ]);

    $purchase->load(['supplier', 'items.product']);
    $mapById = collect($data['mapping'])->keyBy('purchase_item_id');

    return DB::transaction(function () use ($purchase, $mapById) {

        // 1ï¸âƒ£ Create or update Store Entry header
        $entry = StoreEntry::updateOrCreate(
            ['purchase_id' => $purchase->id],
            [
                'supplier_id'   => $purchase->supplier_id,
                'purchase_sn'   => $purchase->purchase_sn,
                'purchase_date' => (string)$purchase->purchase_date,
                'supplier_name' => $purchase->supplier->name ?? null,
                'remarks'       => $purchase->remarks,
            ]
        );

        // 2ï¸âƒ£ Rebuild all store_entry_items
        $entry->items()->delete();

        $bulk = [];
        $storeDate = now()->toDateString();

        foreach ($purchase->items as $line) {
            $choice = $mapById->get($line->id) ?? [];

            $name = $line->temp_name ?: ($line->product->name ?? 'â€”');
            $sn   = $line->temp_sn   ?: ($line->product->sku ?? null);
            $unit = $line->unit      ?: ($line->product->unit ?? null);

            $qty  = (float)$line->qty;
            $rate = (float)$line->rate;

            // Selected categories/brand
            $itemCategoryId = $choice['item_category_id']
                ?? $line->item_category_id
                ?? ($line->product->item_category_id ?? null);

            $categoryId = $choice['category_id']
                ?? ($line->product->category_id ?? null);

            $brandId = $choice['brand_id']
                ?? ($line->product->brand_id ?? null);

            // 3ï¸âƒ£ Build Store Entry Item
            $bulk[] = new StoreEntryItem([
                'purchase_item_id' => $line->id,
                'product_id'       => $line->product_id,
                'item_category_id' => $itemCategoryId,
                'category_id'      => $categoryId,
                'brand_id'         => $brandId,
                'item_name'        => $name,
                'item_sn'          => $sn,
                'unit'             => $unit,
                'qty'              => $qty,
                'rate'             => $rate,
                'total_price'      => round($qty * $rate, 2),
            ]);

            // 4ï¸âƒ£ Update purchase_items table
            //     store_entry_sn â† category_id
            //     store_entry_date â† current date
            $line->update([
                'store_entry_sn'   => $categoryId,
                'store_entry_date' => $storeDate,
                'item_category_id' => $itemCategoryId, // keep consistent
            ]);
        }

        // 5ï¸âƒ£ Save all items in one go
        if ($bulk) {
            $entry->items()->saveMany($bulk);
        }

        return redirect()
            ->route('store.show', $entry)
            ->with('success', 'Store entry created and purchase items updated with store entry data.');
    });
}

// app/Http/Controllers/StoreEntryController.php

public function show(\App\Models\StoreEntry $storeEntry)
{
    $storeEntry->load([
        'purchase.supplier',
        'purchase.slip',
        'items' => function ($q) {
            $q->with(['categoryRef','product','purchaseItem']);
        },
    ]);

    // Header/meta used by the view
    $meta = [
        'purchase_sn'   => $storeEntry->purchase_sn,
        'purchase_date' => $storeEntry->purchase_date,
        'supplier'      => $storeEntry->supplier_name ?? $storeEntry->purchase?->supplier?->name ?? 'â€”',
        'slip_sn'       => $storeEntry->purchase?->slip?->po_sn,
        'slip_date'     => optional($storeEntry->purchase?->slip?->po_date)->format('Y-m-d'),
        'remarks'       => $storeEntry->purchase?->remarks ?? '',
        'id'            => $storeEntry->id,
    ];

    // Rows for table
    $rows = $storeEntry->items->map(function ($it, $i) {
        $amt = (float) $it->total_price;
        return [
            'sn'         => $i+1,
            'name'       => $it->item_name,
            'sn_code'    => $it->item_sn,
            'unit'       => $it->unit ?: 'â€”',
            'qty'        => number_format((float)$it->qty, 1),
            'rate'       => number_format((float)$it->rate, 2),
            'amount'     => number_format($amt, 2),
            'category'   => $it->categoryRef?->name ?? 'â€”',   // Product Category
            'category_id'=> $it->category_id,
            'ledger'     => $it->purchaseItem?->store_entry_sn ?? '', // you stored category_id here
        ];
    });

    return view('backend.store.show', compact('storeEntry','meta','rows'));
}


public function ledgerByCategory(int $categoryId, Request $request)
{
    // Optional filters
    $from = $request->date('from');
    $to   = $request->date('to');

    $q = StoreEntryItem::query()
        ->with([
            'entry.purchase.supplier',
            'entry.purchase.slip',
        ])
        ->where('category_id', $categoryId)
        ->orderBy('id', 'asc');

    if ($from) {
        $q->whereHas('entry.purchase', fn($p) => $p->whereDate('purchase_date', '>=', $from));
    }
    if ($to) {
        $q->whereHas('entry.purchase', fn($p) => $p->whereDate('purchase_date', '<=', $to));
    }

    $items = $q->get();

    $rows = [];
    $grand = 0;

    foreach ($items as $i => $it) {
        $p   = $it->entry->purchase;
        $sl  = $p->slip;

        $amt = (float)$it->total_price;
        $grand += $amt;

        $rows[] = [
            'sn'             => $i+1,
            // Source basics
            'slip_sn'        => $sl?->po_sn ?? 'â€”',
            'slip_date'      => optional($sl?->po_date)->format('Y-m-d'),
            'purchase_sn'    => $p->purchase_sn,
            'purchase_date'  => optional($p->purchase_date)->format('Y-m-d'),
            'supplier'       => $p->supplier->name ?? 'â€”',
            'desc'           => $it->item_name,
            'unit'           => $it->unit ?: 'â€”',
            'qty'            => number_format((float)$it->qty, 1),
            'rate'           => number_format((float)$it->rate, 2),
            'amount'         => number_format($amt, 2),
            'ledger'         => $it->purchaseItem?->store_entry_sn ?? '',
            'remarks'        => $p->remarks ?? '',
        ];

    }

    // For header
    $categoryName = Category::find($categoryId)?->name ?? "Category #$categoryId";

    $meta = [
        'category_id'   => $categoryId,
        'category_name' => $categoryName,
        'from'          => $from ? \Illuminate\Support\Carbon::parse($from)->format('Y-m-d') : null,
        'to'            => $to   ? \Illuminate\Support\Carbon::parse($to)->format('Y-m-d')   : null,
        'grand_total'   => number_format($grand, 2),
    ];

    return view('backend.store.ledger_category', compact('meta','rows'));
}

public function ledger(Request $request)
{
    // Optional date filters (apply to purchase_date)
    $from = $request->date('from');
    $to   = $request->date('to');

    $q = StoreEntryItem::query()
        ->selectRaw('category_id, COUNT(*) as items_count, SUM(total_price) as total_amount')
        ->with(['category']) // needs relation on StoreEntryItem
        ->whereNotNull('category_id')
        ->when($from, fn($x) =>
            $x->whereHas('entry.purchase', fn($p) => $p->whereDate('purchase_date', '>=', $from))
        )
        ->when($to, fn($x) =>
            $x->whereHas('entry.purchase', fn($p) => $p->whereDate('purchase_date', '<=', $to))
        )
        ->groupBy('category_id')
        ->orderBy('category_id');

    $groups = $q->get();

    // Decorate for view
    $rows = $groups->map(function ($g) {
        $name = optional($g->category)->name ?? ('Category #'.$g->category_id);
        return [
            'category_id'   => (int)$g->category_id,
            'category_name' => $name,
            'items_count'   => (int)$g->items_count,
            'total_amount'  => number_format((float)$g->total_amount, 2),
        ];
    });

    return view('backend.store.categories', [
        'rows' => $rows,
        'filters' => [
            'from' => $from ? $from->format('Y-m-d') : null,
            'to'   => $to   ? $to->format('Y-m-d')   : null,
        ],
    ]);
}



// public function categoryItems(int $categoryId, Request $request)
// {
//     $search = trim((string)$request->get('search', ''));
//     $from   = $request->date('from');
//     $to     = $request->date('to');

//     $q = \App\Models\StoreEntryItem::query()
//         ->with([
//             'category:id,name',
//             'entry:id,purchase_id',
//             'entry.purchase:id,purchase_sn,purchase_date,supplier_id,purchase_slip_id,remarks',
//             'entry.purchase.supplier:id,name',
//             'entry.purchase.slip:id,po_sn,po_date',
//         ])
//         ->where('category_id', $categoryId);

//     if ($search !== '') {
//         $q->where(function($w) use ($search) {
//             $w->where('item_name', 'like', "%{$search}%")
//               ->orWhere('item_sn', 'like', "%{$search}%")
//               ->orWhereHas('entry.purchase.supplier', fn($s) => $s->where('name', 'like', "%{$search}%"))
//               ->orWhereHas('entry.purchase', fn($p) => $p->where('purchase_sn', 'like', "%{$search}%"))
//               ->orWhereHas('entry.purchase.slip', fn($sl) => $sl->where('po_sn', 'like', "%{$search}%"));
//         });
//     }

//     if ($from) {
//         $q->whereHas('entry.purchase', fn($p) => $p->whereDate('purchase_date', '>=', $from));
//     }
//     if ($to) {
//         $q->whereHas('entry.purchase', fn($p) => $p->whereDate('purchase_date', '<=', $to));
//     }

//     $items = $q->orderBy('id', 'desc')->paginate(20)->appends($request->only('search','from','to'));

//     $categoryName = \App\Models\Category::find($categoryId)?->name ?? "Category #{$categoryId}";

//     return view('backend.store.category_items', [
//         'categoryId'   => $categoryId,
//         'categoryName' => $categoryName,
//         'items'        => $items,
//         'filters'      => [
//             'search' => $search,
//             'from'   => $from ? $from->format('Y-m-d') : null,
//             'to'     => $to   ? $to->format('Y-m-d')   : null,
//         ],
//     ]);
// }

public function browseRoot()
{
    return view('backend.store.browse_root');
}

/** List only Item Categories that have Store Entry Items */
public function browseItemCategories()
{
    $ics = StoreEntryItem::query()
        ->selectRaw('item_category_id, COUNT(*) as items_count, SUM(total_price) as total_amount')
        ->whereNotNull('item_category_id')
        ->groupBy('item_category_id')
        ->orderBy('item_category_id')
        ->get()
        ->map(function($row){
            $ic = ItemCategory::find($row->item_category_id);
            return [
                'item_category_id' => $row->item_category_id,
                'name'             => $ic?->name_en ?? ("Item Category #".$row->item_category_id),
                'items_count'      => (int)$row->items_count,
                'total_amount'     => number_format((float)$row->total_amount, 2),
            ];
        });

    return view('backend.store.browse_item_categories', compact('ics'));
}

/** From a chosen Item Category, show only Product Categories that exist under it */
public function browseProductCategoriesUnderIC(int $itemCategoryId)
{
    $ic = ItemCategory::find($itemCategoryId);

    // Aggregate product categories within this item category
    $rows = StoreEntryItem::query()
        ->where('item_category_id', $itemCategoryId)
        ->whereNotNull('category_id')
        ->selectRaw('category_id, COUNT(*) as items_count, SUM(total_price) as total_amount')
        ->groupBy('category_id')
        ->orderBy('category_id')
        ->get()
        ->map(function($row){
            $cat = Category::find($row->category_id);
            return [
                'category_id'  => $row->category_id,
                'category'     => $cat?->name ?? ("Category #".$row->category_id),
                'items_count'  => (int)$row->items_count,
                'total_amount' => number_format((float)$row->total_amount, 2),
            ];
        });

    return view('backend.store.browse_ic_categories', [
        'itemCategoryId'   => $itemCategoryId,
        'itemCategoryName' => $ic?->name_en ?? ("Item Category #".$itemCategoryId),
        'rows'             => $rows,
    ]);
}

/**
 * EXISTING: List StoreEntryItems for a product category
 * UPDATE: accept optional item_category filter via ?ic=ID
 */
public function categoryItems(int $categoryId, \Illuminate\Http\Request $request)
{
    $search = trim((string)$request->get('search', ''));
    $from   = $request->date('from');
    $to     = $request->date('to');
    $icId   = $request->integer('ic') ?: null;   // NEW optional filter

    $q = StoreEntryItem::query()
        ->with([
            'category:id,name',
            'entry:id,purchase_id',
            'entry.purchase:id,purchase_sn,purchase_date,supplier_id,purchase_slip_id,remarks',
            'entry.purchase.supplier:id,name',
            'entry.purchase.slip:id,po_sn,po_date',
        ])
        ->where('category_id', $categoryId);

    if ($icId) {
        $q->where('item_category_id', $icId);
    }

    if ($search !== '') {
        $q->where(function($w) use ($search) {
            $w->where('item_name', 'like', "%{$search}%")
              ->orWhere('item_sn', 'like', "%{$search}%")
              ->orWhereHas('entry.purchase.supplier', fn($s) => $s->where('name', 'like', "%{$search}%"))
              ->orWhereHas('entry.purchase', fn($p) => $p->where('purchase_sn', 'like', "%{$search}%"))
              ->orWhereHas('entry.purchase.slip', fn($sl) => $sl->where('po_sn', 'like', "%{$search}%"));
        });
    }

    if ($from) {
        $q->whereHas('entry.purchase', fn($p) => $p->whereDate('purchase_date', '>=', $from));
    }
    if ($to) {
        $q->whereHas('entry.purchase', fn($p) => $p->whereDate('purchase_date', '<=', $to));
    }

    $items = $q->orderBy('id', 'desc')->paginate(20)->appends($request->only('search','from','to','ic'));

    $categoryName = Category::find($categoryId)?->name ?? "Category #{$categoryId}";
    $icName = $icId ? (ItemCategory::find($icId)?->name_en ?? "Item Category #{$icId}") : null;

    return view('backend.store.category_items', [
        'categoryId'   => $categoryId,
        'categoryName' => $categoryName,
        'items'        => $items,
        'filters'      => [
            'search' => $search,
            'from'   => $from ? $from->format('Y-m-d') : null,
            'to'     => $to   ? $to->format('Y-m-d')   : null,
            'ic'     => $icId,
            'icName' => $icName,
        ],
    ]);
}




}
</file>

<file path="app/Http/Controllers/StoreOutController.php">
<?php

namespace App\Http\Controllers;

use App\Models\{
    StoreOut,
    StoreOutItem,
    StoreEntry,
    StoreEntryItem,
    ItemCategory,
    Employee
};
use Illuminate\Http\Request;
use Illuminate\Support\Facades\DB;

class StoreOutController extends Controller
{
    // List all store outs (admin side)
    public function index(Request $request)
    {
        $q = StoreOut::query()
            ->with(['employee','items'])
            ->latest('store_out_date_bs')
            ->latest();

        if ($s = trim((string)$request->get('search',''))) {
            $q->where('store_out_sn','like',"%{$s}%")
              ->orWhere('store_out_date_bs','like',"%{$s}%")
              ->orWhereHas('employee', function ($w) use ($s) {
                  $w->where('full_name','like',"%{$s}%")
                    ->orWhere('email','like',"%{$s}%")
                    ->orWhere('atten_no','like',"%{$s}%");
              });
        }

        $outs = $q->paginate(15)->appends($request->only('search'));

        return view('backend.store_out.index', compact('outs'));
    }

    // Create: optionally preselect a store_entry_item via ?item_id=
    public function create(Request $request)
    {
        $itemId = $request->query('item_id');
        $prefillItem = null;

        if ($itemId) {
            $prefillItem = StoreEntryItem::with(['entry','itemCategory'])->find($itemId);
        }

        return view('backend.store_out.create', [
            'prefillItem' => $prefillItem,
        ]);
    }

    public function store(Request $request)
    {
        $data = $request->validate([
            'store_out_sn'      => ['required','string','max:50','unique:store_outs,store_out_sn'],
            'store_out_date_bs' => ['required','string','max:10'],
            'employee_id'       => ['required','exists:employees,id'],
            'remarks'           => ['nullable','string','max:2000'],

            'items'             => ['required','array','min:1'],
            'items.*.store_entry_item_id' => ['nullable','exists:store_entry_items,id'],
            'items.*.item_name'  => ['required','string','max:255'],
            'items.*.item_sn'    => ['nullable','string','max:100'],
            'items.*.unit'       => ['nullable','string','max:20'],
            'items.*.qty'        => ['required','numeric','gt:0'],
            'items.*.item_category_id' => ['nullable','exists:item_categories,id'],
        ]);

        DB::transaction(function () use ($data) {
            $storeOut = StoreOut::create([
                'employee_id'      => $data['employee_id'],
                'store_entry_id'   => null, // you can fill later if you want
                'store_out_sn'     => $data['store_out_sn'],
                'store_out_date_bs'=> $data['store_out_date_bs'],
                'remarks'          => $data['remarks'] ?? null,
            ]);

            $bulk = [];
            foreach ($data['items'] as $row) {
                $bulk[] = new StoreOutItem([
                    'store_entry_item_id' => $row['store_entry_item_id'] ?? null,
                    'item_category_id'    => $row['item_category_id'] ?? null,
                    'category_id'         => null,
                    'brand_id'            => null,
                    'item_name'           => $row['item_name'],
                    'item_sn'             => $row['item_sn'] ?? null,
                    'unit'                => $row['unit'] ?? null,
                    'qty'                 => $row['qty'],
                ]);
            }

            $storeOut->items()->saveMany($bulk);
        });

        return redirect()->route('store.out.index')->with('success','Store OUT created.');
    }

    public function show(StoreOut $storeOut)
    {
        $storeOut->load(['employee','items']);
        return view('backend.store_out.show', compact('storeOut'));
    }
}
</file>

<file path="app/Http/Controllers/SupplierController.php">
<?php

namespace App\Http\Controllers;

use App\Models\Supplier;
use Illuminate\Http\Request;
use Illuminate\Validation\Rule;

class SupplierController extends Controller
{
  public function index(Request $request)
{
    $query = Supplier::query();

    // Apply filters
    if ($request->filled('search')) {
        $search = $request->input('search');
        $query->where(function ($q) use ($search) {
            $q->where('name', 'like', "%{$search}%")
              ->orWhere('pan', 'like', "%{$search}%");
        });
    }

    // Get paginated results
    $suppliers = $query->latest()->paginate(10);

    // Keep search term across pagination
    $suppliers->appends($request->only('search'));

    return view('Backend.supplier.index', compact('suppliers'));
}


    public function create()
    {
        return view('Backend.supplier.create');
    }

    public function store(Request $request)
    {
        $data = $request->validate([
            'name'    => ['required','string','max:150'],
            // 9-digit PAN (Nepal). If your college uses different format, adjust regex.
            'pan'     => ['required','regex:/^\d{9}$/', 'unique:suppliers,pan'],
            'address' => ['nullable','string','max:255'],
        ]);

        Supplier::create($data);

        return redirect()->route('suppliers.index')->with('success', 'Supplier created successfully.');
    }

    public function edit(Supplier $supplier)
    {
        return view('Backend.supplier.edit', compact('supplier'));
    }

    public function update(Request $request, Supplier $supplier)
    {
        $data = $request->validate([
            'name'    => ['required','string','max:150'],
            'pan'     => [
                'required','regex:/^\d{9}$/',
                Rule::unique('suppliers','pan')->ignore($supplier->id),
            ],
            'address' => ['nullable','string','max:255'],
        ]);

        $supplier->update($data);

        return redirect()->route('suppliers.index')->with('success', 'Supplier updated successfully.');
    }

    public function destroy(Supplier $supplier)
    {
        $supplier->delete();
        return redirect()->route('suppliers.index')->with('success', 'Supplier deleted.');
    }
}
</file>

<file path="app/Http/Middleware/Authenticate.php">
<?php

namespace App\Http\Middleware;

use Illuminate\Auth\Middleware\Authenticate as Middleware;
use Illuminate\Http\Request;

class Authenticate extends Middleware
{
    /**
     * Get the path the user should be redirected to when they are not authenticated.
     */
    protected function redirectTo(Request $request): ?string
    {
        return $request->expectsJson() ? null : route('employee.login');
    }
}
</file>

<file path="app/Http/Middleware/EncryptCookies.php">
<?php

namespace App\Http\Middleware;

use Illuminate\Cookie\Middleware\EncryptCookies as Middleware;

class EncryptCookies extends Middleware
{
    /**
     * The names of the cookies that should not be encrypted.
     *
     * @var array<int, string>
     */
    protected $except = [
        //
    ];
}
</file>

<file path="app/Http/Middleware/EnsureAdmin.php">
<?php
namespace App\Http\Middleware;


use Closure;
use Illuminate\Http\Request;
use Symfony\Component\HttpFoundation\Response;


class EnsureAdmin
{
public function handle(Request $request, Closure $next): Response
{
if (!session()->has('admin_id')) {
return redirect()->route('admin.login.form')->with('error','Please login as Admin.');
}
return $next($request);
}
}
</file>

<file path="app/Http/Middleware/EnsureEmployeePasswordChanged.php">
<?php

namespace App\Http\Middleware;

use Closure;
use Illuminate\Http\Request;
use Illuminate\Support\Facades\Auth;

class EnsureEmployeePasswordChanged
{
    public function handle(Request $request, Closure $next)
    {
        $user = Auth::guard('employee')->user();
        if ($user && $user->must_change_password && !$request->routeIs('employee.password.show','employee.password.update','employee.logout')) {
            return redirect()->route('employee.password.show')
                ->with('warning', 'Please change your password to continue.');
        }
        return $next($request);
    }
}
</file>

<file path="app/Http/Middleware/EnsureStudent.php">
<?php
namespace App\Http\Middleware;

use Closure;
use Illuminate\Http\Request;
use Symfony\Component\HttpFoundation\Response;
use App\Models\Student;

class EnsureStudent
{
    public function handle(Request $request, Closure $next): Response
    {
        // Check if student is logged in
        if (!session()->has('student_id')) {
            return redirect()->route('student.login.form')->with('error', 'Please login as Student.');
        }

        $student = Student::find(session('student_id'));
        if (!$student) {
            session()->forget('student_id');
            return redirect()->route('student.login.form')->with('error', 'Invalid session. Please login again.');
        }

        // Verify roll number if present in route
        $routeRoll = $request->route('roll');
        if ($routeRoll && $routeRoll !== $student->roll_num) {
            abort(403, 'Unauthorized access.');
        }

        // Verify token if present in route
        $routeToken = $request->route('token');
        if ($routeToken && $routeToken !== $student->token_num) {
            abort(403, 'Unauthorized access.');
        }

        return $next($request);
    }
}
</file>

<file path="app/Http/Middleware/PreventRequestsDuringMaintenance.php">
<?php

namespace App\Http\Middleware;

use Illuminate\Foundation\Http\Middleware\PreventRequestsDuringMaintenance as Middleware;

class PreventRequestsDuringMaintenance extends Middleware
{
    /**
     * The URIs that should be reachable while maintenance mode is enabled.
     *
     * @var array<int, string>
     */
    protected $except = [
        //
    ];
}
</file>

<file path="app/Http/Middleware/RedirectIfAuthenticated.php">
<?php

namespace App\Http\Middleware;

use App\Providers\RouteServiceProvider;
use Closure;
use Illuminate\Http\Request;
use Illuminate\Support\Facades\Auth;
use Symfony\Component\HttpFoundation\Response;

class RedirectIfAuthenticated
{
    /**
     * Handle an incoming request.
     *
     * @param  \Closure(\Illuminate\Http\Request): (\Symfony\Component\HttpFoundation\Response)  $next
     */
    public function handle(Request $request, Closure $next, string ...$guards): Response
    {
        $guards = empty($guards) ? [null] : $guards;

        foreach ($guards as $guard) {
            if (Auth::guard($guard)->check()) {
                return redirect(RouteServiceProvider::HOME);
            }
        }

        return $next($request);
    }
}
</file>

<file path="app/Http/Middleware/TrimStrings.php">
<?php

namespace App\Http\Middleware;

use Illuminate\Foundation\Http\Middleware\TrimStrings as Middleware;

class TrimStrings extends Middleware
{
    /**
     * The names of the attributes that should not be trimmed.
     *
     * @var array<int, string>
     */
    protected $except = [
        'current_password',
        'password',
        'password_confirmation',
    ];
}
</file>

<file path="app/Http/Middleware/TrustHosts.php">
<?php

namespace App\Http\Middleware;

use Illuminate\Http\Middleware\TrustHosts as Middleware;

class TrustHosts extends Middleware
{
    /**
     * Get the host patterns that should be trusted.
     *
     * @return array<int, string|null>
     */
    public function hosts(): array
    {
        return [
            $this->allSubdomainsOfApplicationUrl(),
        ];
    }
}
</file>

<file path="app/Http/Middleware/TrustProxies.php">
<?php

namespace App\Http\Middleware;

use Illuminate\Http\Middleware\TrustProxies as Middleware;
use Illuminate\Http\Request;

class TrustProxies extends Middleware
{
    /**
     * The trusted proxies for this application.
     *
     * @var array<int, string>|string|null
     */
    protected $proxies;

    /**
     * The headers that should be used to detect proxies.
     *
     * @var int
     */
    protected $headers =
        Request::HEADER_X_FORWARDED_FOR |
        Request::HEADER_X_FORWARDED_HOST |
        Request::HEADER_X_FORWARDED_PORT |
        Request::HEADER_X_FORWARDED_PROTO |
        Request::HEADER_X_FORWARDED_AWS_ELB;
}
</file>

<file path="app/Http/Middleware/ValidateSignature.php">
<?php

namespace App\Http\Middleware;

use Illuminate\Routing\Middleware\ValidateSignature as Middleware;

class ValidateSignature extends Middleware
{
    /**
     * The names of the query string parameters that should be ignored.
     *
     * @var array<int, string>
     */
    protected $except = [
        // 'fbclid',
        // 'utm_campaign',
        // 'utm_content',
        // 'utm_medium',
        // 'utm_source',
        // 'utm_term',
    ];
}
</file>

<file path="app/Http/Middleware/VerifyCsrfToken.php">
<?php

namespace App\Http\Middleware;

use Illuminate\Foundation\Http\Middleware\VerifyCsrfToken as Middleware;

class VerifyCsrfToken extends Middleware
{
    /**
     * The URIs that should be excluded from CSRF verification.
     *
     * @var array<int, string>
     */
    protected $except = [
        //
    ];
}
</file>

<file path="app/Http/Kernel.php">
<?php

namespace App\Http;

use Illuminate\Foundation\Http\Kernel as HttpKernel;

class Kernel extends HttpKernel
{
    /**
     * The application's global HTTP middleware stack.
     *
     * These middleware are run during every request to your application.
     *
     * @var array<int, class-string|string>
     */
    protected $middleware = [
        // \App\Http\Middleware\TrustHosts::class,
        \App\Http\Middleware\TrustProxies::class,
        \Illuminate\Http\Middleware\HandleCors::class,
        \App\Http\Middleware\PreventRequestsDuringMaintenance::class,
        \Illuminate\Foundation\Http\Middleware\ValidatePostSize::class,
        \App\Http\Middleware\TrimStrings::class,
        \Illuminate\Foundation\Http\Middleware\ConvertEmptyStringsToNull::class,
    ];

    /**
     * The application's route middleware groups.
     *
     * @var array<string, array<int, class-string|string>>
     */
    protected $middlewareGroups = [
        'web' => [
            \App\Http\Middleware\EncryptCookies::class,
            \Illuminate\Cookie\Middleware\AddQueuedCookiesToResponse::class,
            \Illuminate\Session\Middleware\StartSession::class,
            \Illuminate\View\Middleware\ShareErrorsFromSession::class,
            \App\Http\Middleware\VerifyCsrfToken::class,
            \Illuminate\Routing\Middleware\SubstituteBindings::class,
        ],

        'api' => [
            // \Laravel\Sanctum\Http\Middleware\EnsureFrontendRequestsAreStateful::class,
            \Illuminate\Routing\Middleware\ThrottleRequests::class . ':api',
            \Illuminate\Routing\Middleware\SubstituteBindings::class,
        ],
    ];

    /**
     * The application's middleware aliases.
     *
     * Aliases may be used instead of class names to conveniently assign middleware to routes and groups.
     *
     * @var array<string, class-string|string>
     */
    protected $middlewareAliases = [
        'auth' => \App\Http\Middleware\Authenticate::class,
        'auth.basic' => \Illuminate\Auth\Middleware\AuthenticateWithBasicAuth::class,
        'auth.session' => \Illuminate\Session\Middleware\AuthenticateSession::class,
        'cache.headers' => \Illuminate\Http\Middleware\SetCacheHeaders::class,
        'can' => \Illuminate\Auth\Middleware\Authorize::class,
        'guest' => \App\Http\Middleware\RedirectIfAuthenticated::class,
        'password.confirm' => \Illuminate\Auth\Middleware\RequirePassword::class,
        'precognitive' => \Illuminate\Foundation\Http\Middleware\HandlePrecognitiveRequests::class,
        'signed' => \App\Http\Middleware\ValidateSignature::class,
        'throttle' => \Illuminate\Routing\Middleware\ThrottleRequests::class,
        'verified' => \Illuminate\Auth\Middleware\EnsureEmailIsVerified::class,
        'admin.auth' => \App\Http\Middleware\EnsureAdmin::class,
        'student.auth' => \App\Http\Middleware\EnsureStudent::class,
        'employee.mustChange' => \App\Http\Middleware\EnsureEmployeePasswordChanged::class,

    ];
}
</file>

<file path="app/Models/Admin.php">
<?php
namespace App\Models;


use Illuminate\Database\Eloquent\Factories\HasFactory;
use Illuminate\Database\Eloquent\Model;
use Illuminate\Support\Facades\Hash;


class Admin extends Model
{
use HasFactory;


protected $fillable = ['name','email','password','contact'];


protected $hidden = ['password'];


public function setPasswordAttribute($value)
{
$this->attributes['password'] = Hash::needsRehash($value) ? Hash::make($value) : $value;
}
}
</file>

<file path="app/Models/Brand.php">
<?php
namespace App\Models;

use Illuminate\Database\Eloquent\Factories\HasFactory;
use Illuminate\Database\Eloquent\Model;

class Brand extends Model
{
    use HasFactory;

    protected $fillable = ['name', 'is_active'];

    public function scopeActive($query)
    {
        return $query->where('is_active', true);
    }
    public function products()
    {
        return $this->hasMany(Product::class); // FK: products.brand_id
    }
}
</file>

<file path="app/Models/Category.php">
<?php
namespace App\Models;

use Illuminate\Database\Eloquent\Factories\HasFactory;
use Illuminate\Database\Eloquent\Model;

class Category extends Model
{
    use HasFactory;

    protected $fillable = ['name', 'is_active'];

    public function scopeActive($query)
    {
        return $query->where('is_active', true);
    }
     public function products()
    {
        return $this->hasMany(Product::class);
    }
}
</file>

<file path="app/Models/Department.php">
<?php

namespace App\Models;

use Illuminate\Database\Eloquent\Factories\HasFactory;
use Illuminate\Database\Eloquent\Model;

class Department extends Model
{
    use HasFactory;
    public $fillable = ['name','status'];
}
</file>

<file path="app/Models/Employee.php">
<?php

namespace App\Models;

use Illuminate\Foundation\Auth\User as Authenticatable; // so we can log them in
use Illuminate\Database\Eloquent\Relations\BelongsTo;

class Employee extends Authenticatable
{
    protected $fillable = [
        'department_id',
        'full_name',
        'contact',
        'atten_no',
        'email',
        'password',
        'must_change_password',
        'is_active',
    ];

    protected $hidden = [
        'password',
        'remember_token',
    ];

    protected $casts = [
        'must_change_password' => 'boolean',
        'is_active' => 'boolean',
    ];

    public function department(): BelongsTo
    {
        return $this->belongsTo(Department::class);
    }

    // Use email for auth if provided; otherwise you can pivot to atten_no later
    public function getAuthIdentifierName()
    {
        return 'email';
    }
}
</file>

<file path="app/Models/ItemCategory.php">
<?php

namespace App\Models;

use Illuminate\Database\Eloquent\Factories\HasFactory;
use Illuminate\Database\Eloquent\Model;

class ItemCategory extends Model
{
    use HasFactory;

    protected $fillable = [
        'name_en',
        'name_np',
    ];
}
</file>

<file path="app/Models/Product.php">
<?php

namespace App\Models;

use Illuminate\Database\Eloquent\Model;
use Illuminate\Database\Eloquent\Factories\HasFactory;
use Illuminate\Database\Eloquent\Casts\Attribute;
use Illuminate\Database\Eloquent\SoftDeletes;

class Product extends Model
{
    use HasFactory;
    // use SoftDeletes; // uncomment if you want soft deletes

    protected $fillable = [
        'name', 'sku', 'item_category_id', 'product_category_id', 'brand_id',
        'unit', 'reorder_level', 'image_path', 'is_active',
    ];

    protected $casts = [
        'item_category_id'    => 'integer',
        'product_category_id' => 'integer',
        'brand_id'            => 'integer',
        'reorder_level'       => 'integer',
        'is_active'           => 'boolean',
        // if you ever store money on product table:
        // 'some_amount'      => 'decimal:2',
    ];

    // If you want to always include stock in JSON:
    // protected $appends = ['stock'];

    /*
    |--------------------------------------------------------------------------
    | Relationships
    |--------------------------------------------------------------------------
    */
    public function itemCategory()      { return $this->belongsTo(ItemCategory::class); }
    public function productCategory()   { return $this->belongsTo(Category::class, 'product_category_id'); }
    public function brand()             { return $this->belongsTo(Brand::class); }

    // IN: actual receipts (from purchases)
    public function purchaseLines()     { return $this->hasMany(PurchaseLine::class); }

    // OUT: issues to departments (if you implemented StoreIssue)
    // public function issues()            { return $this->hasMany(StoreIssue::class); }

    /*
    |--------------------------------------------------------------------------
    | Accessors
    |--------------------------------------------------------------------------
    */

    // Public URL for image (null if not set)
    public function imageUrl(): ?string
    {
        return $this->image_path ? asset('storage/' . ltrim($this->image_path, '/')) : null;
    }

    // Laravel 10+ â€œAttributeâ€ accessor (alternative to imageUrl() method)
    protected function imageUrlAttr(): Attribute
    {
        return Attribute::get(fn () => $this->imageUrl());
    }

    // Computed stock = sum(receipts) - sum(issues)
    public function getStockAttribute(): float
    {
        // Keep it simple; you can optimize with withSum() on listing pages.
        $in  = (float) $this->purchaseLines()->sum('qty');
        $out = (float) $this->issues()->sum('qty');
        return $in - $out;
    }

    /*
    |--------------------------------------------------------------------------
    | Scopes
    |--------------------------------------------------------------------------
    */
    public function scopeActive($q) { return $q->where('is_active', true); }

    public function scopeSearch($q, ?string $term)
    {
        if (!$term) return $q;
        $term = trim($term);
        return $q->where(function ($x) use ($term) {
            $x->where('name', 'like', "%{$term}%")
              ->orWhere('sku', 'like', "%{$term}%");
        });
    }
}
</file>

<file path="app/Models/Purchase.php">
<?php

namespace App\Models;

use Illuminate\Database\Eloquent\Model;
use Illuminate\Database\Eloquent\Relations\BelongsTo;
use Illuminate\Database\Eloquent\Relations\HasMany;
use Illuminate\Database\Eloquent\Relations\HasOne;


class Purchase extends Model
{
    protected $fillable = [
        'purchase_sn',
        'purchase_date',
        'supplier_id',
        'purchase_slip_id',
        'department_id',
       
        'remarks',

        // totals
        'sub_total',
        'tax_mode',      // 'VAT' or 'PAN'
        'vat_percent',   // e.g., 13.00
        'vat_amount',
        'grand_total',
        'total_amount',  // keep for backward-compat (mirror grand_total if you want)

        // attachments

        'bill_no',
        'bill_pic',
        'image_path',    // if you still store it here
    ];

    protected $casts = [
        'purchase_date'   => 'date',
        'sub_total'       => 'float',
        'vat_percent'     => 'float',
        'vat_amount'      => 'float',
        'grand_total'     => 'float',
        'total_amount'    => 'float',
    ];

    /** Relationships */


public function getRouteKeyName()
    {
        return 'purchase_sn';
    }    public function supplier(): BelongsTo
    {
        return $this->belongsTo(Supplier::class);
    }

    public function slip(): BelongsTo
    {
        return $this->belongsTo(PurchaseSlip::class, 'purchase_slip_id');
    }

    public function department(): BelongsTo
    {
        return $this->belongsTo(Department::class);
    }

    public function items(): HasMany
    {
        return $this->hasMany(PurchaseItem::class);
    }

    /** Backward-compatible alias used by your views */
    public function lines(): HasMany
    {
        return $this->items();
    }

    /** Helper to (re)compute totals from items + tax mode */
    public function recomputeTotals(): void
    {
        $sub = $this->items->sum(function ($i) {
            // Prefer explicit line_subtotal if you store it; else qty*rate
            if (!is_null($i->line_subtotal)) {
                return (float)$i->line_subtotal;
            }
            return (float)$i->qty * (float)$i->rate - (float)$i->discount_amount;
        });

        $this->sub_total = $sub;

        $vatPercent = ($this->tax_mode ?? 'PAN') === 'VAT'
            ? (float)($this->vat_percent ?? 13.00)
            : 0.0;

        $vatAmt = round($sub * ($vatPercent / 100), 2);
        $this->vat_amount  = $vatAmt;
        $this->grand_total = round($sub + $vatAmt, 2);

        // keep legacy field in sync if you like
        $this->total_amount = $this->grand_total;
    }
    public function storeEntry(): HasOne
{
    return $this->hasOne(\App\Models\StoreEntry::class);
}
}
</file>

<file path="app/Models/PurchaseItem.php">
<?php

namespace App\Models;

use Illuminate\Database\Eloquent\Model;
use Illuminate\Database\Eloquent\Relations\BelongsTo;

class PurchaseItem extends Model
{
    protected $table = 'purchase_items';

    protected $fillable = [
        'purchase_id',
        'item_category_id',
        'product_id',
        'temp_name',
        'temp_sn',
        'unit',
        'qty',
        'rate',
         'store_entry_sn',
        'store_entry_date',
        'discount_percent',
        'discount_amount',
        'line_subtotal',
        'notes',
    ];

    protected $casts = [
        'qty'               => 'decimal:3',
        'rate'              => 'decimal:2',
        
        'discount_percent'  => 'decimal:2',
        'discount_amount'   => 'decimal:2',
        'line_subtotal'     => 'decimal:2',
    ];

    public function purchase(): BelongsTo
    {
        return $this->belongsTo(Purchase::class);
    }

    public function category(): BelongsTo
    {
        return $this->belongsTo(ItemCategory::class, 'item_category_id');
    }

    public function product(): BelongsTo
    {
        // nullable
        return $this->belongsTo(Product::class);
    }

    protected static function booted(): void
    {
        static::saving(function (self $item) {
            // Default discount_amount if % provided and amount empty
            if ($item->discount_amount == 0 && $item->discount_percent > 0) {
                $gross = (float)$item->qty * (float)$item->rate;
                $item->discount_amount = round($gross * ((float)$item->discount_percent / 100), 2);
            }

            // Compute line_subtotal if not set: (qty * rate) - discount_amount
            if (is_null($item->line_subtotal)) {
                $item->line_subtotal = round(
                    (float)$item->qty * (float)$item->rate - (float)$item->discount_amount,
                    2
                );
            }
        });
    }
}
</file>

<file path="app/Models/PurchaseSlip.php">
<?php
namespace App\Models;

use Illuminate\Database\Eloquent\Model;
use Illuminate\Database\Eloquent\Relations\BelongsTo;
use Illuminate\Database\Eloquent\Relations\HasMany;
use Illuminate\Database\Eloquent\Relations\HasOne;



class PurchaseSlip extends Model
{
    protected $fillable = [
        'po_sn',
        'po_date',
        'department_id',
        'remarks',
    ];

    protected $casts = [
        'po_date' => 'date',   // ensures Carbon dates (works with orWhereDate / latest)
    ];

    /** Relationships */
    public function department(): BelongsTo
    {
        return $this->belongsTo(Department::class);
    }

    public function items(): HasMany
    {
        return $this->hasMany(PurchaseSlipItem::class);
    }

    // If you have a purchases table referencing purchase_slip_id
    public function purchases(): HasMany
   {
         return $this->hasMany(Purchase::class);
    }

    public function purchase_slip():HasOne
{
    return $this->hasOne(Purchase::class);
}



    public function purchase(): HasOne
{
    return $this->hasOne(Purchase::class);
}


    public function getRouteKeyName()
    {
        return 'po_sn';
    }

    /** Optional: quick search scope used in your controller */
    public function scopeSearch($q, ?string $term)
    {
        $s = trim((string) $term);
        if ($s === '') return $q;

        return $q->where('po_sn', 'like', "%{$s}%")
            ->orWhereDate('po_date', $s)
            ->orWhereHas('department', fn($x) => $x->where('name', 'like', "%{$s}%"));
    }
}
</file>

<file path="app/Models/PurchaseSlipItem.php">
<?php

namespace App\Models;

use Illuminate\Database\Eloquent\Model;
use Illuminate\Database\Eloquent\Relations\BelongsTo;


class PurchaseSlipItem extends Model
{
    protected $fillable = [
        'purchase_slip_id',
        'temp_name',
        'temp_sn',
        'ordered_qty',
        'max_rate',
        'line_total',
        'unit',
        'item_category_id',
    ];

    protected $casts = [
        'ordered_qty' => 'float',
        'max_rate'    => 'float',
        'line_total'  => 'float',
    ];

    /** Automatically calculate total before save */
    protected static function booted(): void
    {
        static::saving(function (self $item) {
            $item->line_total = (float)$item->ordered_qty * (float)$item->max_rate;
        });
    }

    /** Relationship to parent slip */
    public function slip(): BelongsTo
    {
        return $this->belongsTo(PurchaseSlip::class, 'purchase_slip_id');
    }
    public function itemCategory(): BelongsTo
    {
        return $this->belongsTo(ItemCategory::class, 'item_category_id');
    }
}
</file>

<file path="app/Models/StoreEntry.php">
<?php

namespace App\Models;

use Illuminate\Database\Eloquent\Model;
use Illuminate\Database\Eloquent\Relations\BelongsTo;
use Illuminate\Database\Eloquent\Relations\HasMany;

class StoreEntry extends Model
{
    protected $fillable = [
        'purchase_id','supplier_id','purchase_sn','purchase_date','supplier_name','remarks',
    ];

    public function purchase(): BelongsTo { return $this->belongsTo(Purchase::class); }
    public function supplier(): BelongsTo { return $this->belongsTo(Supplier::class); }
    public function items(): HasMany { return $this->hasMany(StoreEntryItem::class); }
}
</file>

<file path="app/Models/StoreEntryItem.php">
<?php

namespace App\Models;

use Illuminate\Database\Eloquent\Model;
use Illuminate\Database\Eloquent\Relations\BelongsTo;

class StoreEntryItem extends Model
{
    protected $fillable = [
        'store_entry_id','purchase_item_id','product_id',
        'item_category_id','category_id','brand_id',
        'item_name','item_sn','unit','qty','rate','total_price',
    ];

    protected $casts = [
        'qty' => 'float',
        'rate' => 'decimal:2',
        'total_price' => 'decimal:2',
    ];

    public function entry(): BelongsTo { return $this->belongsTo(StoreEntry::class, 'store_entry_id'); }
    public function purchaseItem(): BelongsTo { return $this->belongsTo(PurchaseItem::class); }
    public function product(): BelongsTo { return $this->belongsTo(Product::class); }
    public function itemCategory(): BelongsTo { return $this->belongsTo(ItemCategory::class, 'item_category_id'); }
    public function category(): BelongsTo { return $this->belongsTo(Category::class, 'category_id'); }
    public function brand(): BelongsTo { return $this->belongsTo(Brand::class, 'brand_id'); }
    public function categoryRef(){ return $this->belongsTo(Category::class,'category_id'); }

}
</file>

<file path="app/Models/StoreOut.php">
<?php

namespace App\Models;

use Illuminate\Database\Eloquent\Model;
use Illuminate\Database\Eloquent\Relations\BelongsTo;
use Illuminate\Database\Eloquent\Relations\HasMany;

class StoreOut extends Model
{
    protected $fillable = [
        'employee_id',
        'store_entry_id',
        'store_out_sn',
        'store_out_date_bs',
        'remarks',
    ];

    public function employee(): BelongsTo
    {
        return $this->belongsTo(Employee::class);
    }

    public function entry(): BelongsTo
    {
        return $this->belongsTo(StoreEntry::class, 'store_entry_id');
    }

    public function items(): HasMany
    {
        return $this->hasMany(StoreOutItem::class);
    }
}
</file>

<file path="app/Models/StoreOutItem.php">
<?php

namespace App\Models;

use Illuminate\Database\Eloquent\Model;
use Illuminate\Database\Eloquent\Relations\BelongsTo;

class StoreOutItem extends Model
{
    protected $fillable = [
        'store_out_id',
        'store_entry_item_id',
        'item_category_id',
        'category_id',
        'brand_id',
        'item_name',
        'item_sn',
        'unit',
        'qty',
    ];

    public function storeOut(): BelongsTo
    {
        return $this->belongsTo(StoreOut::class);
    }

    public function storeEntryItem(): BelongsTo
    {
        return $this->belongsTo(StoreEntryItem::class);
    }

    public function itemCategory(): BelongsTo
    {
        return $this->belongsTo(ItemCategory::class);
    }
}
</file>

<file path="app/Models/Supplier.php">
<?php

namespace App\Models;

use Illuminate\Database\Eloquent\Factories\HasFactory;
use Illuminate\Database\Eloquent\Model;

class Supplier extends Model
{
    use HasFactory;

    protected $fillable = [
        'name',
        'pan',
        'address',
    ];
}
</file>

<file path="app/Models/User.php">
<?php

namespace App\Models;

// use Illuminate\Contracts\Auth\MustVerifyEmail;
use Illuminate\Database\Eloquent\Factories\HasFactory;
use Illuminate\Foundation\Auth\User as Authenticatable;
use Illuminate\Notifications\Notifiable;
use Laravel\Sanctum\HasApiTokens;

class User extends Authenticatable
{
    use HasApiTokens, HasFactory, Notifiable;

    /**
     * The attributes that are mass assignable.
     *
     * @var array<int, string>
     */
    protected $fillable = [
        'name',
        'email',
        'password',
    ];

    /**
     * The attributes that should be hidden for serialization.
     *
     * @var array<int, string>
     */
    protected $hidden = [
        'password',
        'remember_token',
    ];

    /**
     * The attributes that should be cast.
     *
     * @var array<string, string>
     */
    protected $casts = [
        'email_verified_at' => 'datetime',
        'password' => 'hashed',
    ];
}
</file>

<file path="app/Providers/AppServiceProvider.php">
<?php

namespace App\Providers;

use Illuminate\Support\ServiceProvider;
use Illuminate\Support\Facades\View;
use App\Models\Admin;
use App\Models\Employee;
use App\Models\Student;

class AppServiceProvider extends ServiceProvider
{
    /**
     * Register any application services.
     */
    public function register(): void
    {
        //
    }

    /**
     * Bootstrap any application services.
     */
    public function boot(): void
    {
        View::composer('Backend.layouts.header', function ($view) {
            $view->with('admin', Admin::find(session('admin_id')));
        });
        View::composer('Frontend.layouts.header', function ($view) {
            $view->with('employee', Employee::find(session('employee_id')));
        });
    }
}
</file>

<file path="app/Providers/AuthServiceProvider.php">
<?php

namespace App\Providers;

// use Illuminate\Support\Facades\Gate;
use Illuminate\Foundation\Support\Providers\AuthServiceProvider as ServiceProvider;

class AuthServiceProvider extends ServiceProvider
{
    /**
     * The model to policy mappings for the application.
     *
     * @var array<class-string, class-string>
     */
    protected $policies = [
        //
    ];

    /**
     * Register any authentication / authorization services.
     */
    public function boot(): void
    {
        //
    }
}
</file>

<file path="app/Providers/BroadcastServiceProvider.php">
<?php

namespace App\Providers;

use Illuminate\Support\Facades\Broadcast;
use Illuminate\Support\ServiceProvider;

class BroadcastServiceProvider extends ServiceProvider
{
    /**
     * Bootstrap any application services.
     */
    public function boot(): void
    {
        Broadcast::routes();

        require base_path('routes/channels.php');
    }
}
</file>

<file path="app/Providers/EventServiceProvider.php">
<?php

namespace App\Providers;

use Illuminate\Auth\Events\Registered;
use Illuminate\Auth\Listeners\SendEmailVerificationNotification;
use Illuminate\Foundation\Support\Providers\EventServiceProvider as ServiceProvider;
use Illuminate\Support\Facades\Event;

class EventServiceProvider extends ServiceProvider
{
    /**
     * The event to listener mappings for the application.
     *
     * @var array<class-string, array<int, class-string>>
     */
    protected $listen = [
        Registered::class => [
            SendEmailVerificationNotification::class,
        ],
    ];

    /**
     * Register any events for your application.
     */
    public function boot(): void
    {
        //
    }

    /**
     * Determine if events and listeners should be automatically discovered.
     */
    public function shouldDiscoverEvents(): bool
    {
        return false;
    }
}
</file>

<file path="app/Providers/RouteServiceProvider.php">
<?php

namespace App\Providers;

use Illuminate\Cache\RateLimiting\Limit;
use Illuminate\Foundation\Support\Providers\RouteServiceProvider as ServiceProvider;
use Illuminate\Http\Request;
use Illuminate\Support\Facades\RateLimiter;
use Illuminate\Support\Facades\Route;

class RouteServiceProvider extends ServiceProvider
{
    /**
     * The path to your application's "home" route.
     *
     * Typically, users are redirected here after authentication.
     *
     * @var string
     */
    public const HOME = '/home';

    /**
     * Define your route model bindings, pattern filters, and other route configuration.
     */
    public function boot(): void
    {
        RateLimiter::for('api', function (Request $request) {
            return Limit::perMinute(60)->by($request->user()?->id ?: $request->ip());
        });

        $this->routes(function () {
            Route::middleware('api')
                ->prefix('api')
                ->group(base_path('routes/api.php'));

            Route::middleware('web')
                ->group(base_path('routes/web.php'));
        });
    }
}
</file>

<file path="app/Services/BSDateService.php">
<?php

namespace App\Services;

use Carbon\Carbon;
use RuntimeException;

class BSDateService
{
    /**
     * Map of BS year -> [1..12] month lengths.
     * IMPORTANT: You must fill this for every supported year (e.g., 1970..2100 BS).
     * I include a few sample years so it runs; extend it by loading from storage/app/bs_months.json.
     */
    protected array $daysInMonths = [
        //            1  2  3  4  5  6  7  8  9 10 11 12
        2080 => [0,  31,31,32,31,32,31,30,29,30,29,30,30],
        2081 => [0,  31,32,31,32,31,30,30,30,29,30,29,30],
        2082 => [0,  31,31,32,31,32,31,30,29,30,29,30,30],
        2083 => [0,  31,32,31,32,31,30,30,30,29,30,29,30],
        2084 => [0,  31,31,32,31,32,31,30,29,30,29,30,30],
        // add more years or call loadMapFromDisk() in __construct()
    ];

    /**
     * Anchor pair commonly used in Nepali calendar conversions:
     * 2000-01-01 BS = 1943-04-13 AD
     */
protected string $anchorBs = '2080-01-01';
protected string $anchorAd = '2023-04-14';

    public function __construct()
    {
        // If you save the full dataset at storage/app/bs_months.json, uncomment:
        $this->loadMapFromDisk();
    }

    protected function loadMapFromDisk(): void
    {
        $file = storage_path('app/bs_months.json');
        if (is_file($file)) {
            $json = json_decode(file_get_contents($file), true);
            if (is_array($json) && !empty($json)) {
                $this->daysInMonths = $json;
            }
        }
    }

    public function adToBs(\DateTimeInterface $ad): array
    {
        $adNepal = Carbon::instance((new Carbon($ad))->tz('Asia/Kathmandu'))->startOfDay();
        $anchor  = Carbon::parse($this->anchorAd, 'Asia/Kathmandu')->startOfDay();
        $diffDays = $anchor->diffInDays($adNepal, false);

        [$y, $m, $d] = array_map('intval', explode('-', $this->anchorBs));

        $step = $diffDays >= 0 ? 1 : -1;
        $remaining = abs($diffDays);

        while ($remaining > 0) {
            $d += $step;
            if ($step > 0) {
                if ($d > $this->daysInMonth($y, $m)) {
                    $d = 1; $m++; if ($m > 12) { $m = 1; $y++; }
                }
            } else {
                if ($d < 1) {
                    $m--; if ($m < 1) { $m = 12; $y--; }
                    $d = $this->daysInMonth($y, $m);
                }
            }
            $remaining--;
        }

        return ['year' => $y, 'month' => $m, 'day' => $d];
    }

    public function bsToAd(int $y, int $m, int $d): \DateTimeImmutable
    {
        $anchorAd = Carbon::parse($this->anchorAd, 'Asia/Kathmandu')->startOfDay();
        [$ay, $am, $adDay] = array_map('intval', explode('-', $this->anchorBs));

        $days = 0;
        if ($y === $ay && $m === $am) {
            $days = $d - $adDay;
        } else {
            // decide direction by comparing BS (target) vs BS (anchor)
            $backward = ($y < $ay) || ($y == $ay && $m < $am) || ($y == $ay && $m == $am && $d < $adDay);

            if ($backward) {
                while (!($ay == $y && $am == $m && $adDay == $d)) {
                    $adDay -= 1;
                    if ($adDay < 1) {
                        $am -= 1; if ($am < 1) { $am = 12; $ay -= 1; }
                        $adDay = $this->daysInMonth($ay, $am);
                    }
                    $days -= 1;
                }
            } else {
                while (!($ay == $y && $am == $m && $adDay == $d)) {
                    $adDay += 1;
                    if ($adDay > $this->daysInMonth($ay, $am)) {
                        $adDay = 1; $am += 1; if ($am > 12) { $am = 1; $ay += 1; }
                    }
                    $days += 1;
                }
            }
        }

        return Carbon::instance($anchorAd)->addDays($days)->toDateImmutable();
    }

    public function daysInMonth(int $y, int $m): int
    {
        if (!isset($this->daysInMonths[$y])) {
            throw new RuntimeException("BS year not supported: $y");
        }
        if (!isset($this->daysInMonths[$y][$m])) {
            throw new RuntimeException("BS month not supported: $y-$m");
        }
        return (int) $this->daysInMonths[$y][$m];
    }

    /**
     * Returns 6x7 cells grouped by weeks for a given BS month.
     * Each cell: ['bsY','bsM','bsD','ad','isCurrentMonth'=>bool]
     */
    public function monthGrid(int $y, int $m): array
    {
        $startAd = $this->bsToAd($y, $m, 1);
        $startWeekday = (int)date('w', $startAd->getTimestamp()); // 0=Sun..6=Sat

        $days = $this->daysInMonth($y, $m);

        // previous month
        $pm = $m - 1; $py = $y; if ($pm < 1) { $pm = 12; $py--; }
        $prevDays = $this->daysInMonth($py, $pm);

        $cells = [];
        for ($i=0; $i<$startWeekday; $i++) {
            $d = $prevDays - ($startWeekday - 1 - $i);
            $ad = $this->bsToAd($py, $pm, $d);
            $cells[] = ['bsY'=>$py,'bsM'=>$pm,'bsD'=>$d,'ad'=>$ad->format('Y-m-d'),'isCurrentMonth'=>false];
        }

        // current month
        for ($d=1; $d<=$days; $d++) {
            $ad = $this->bsToAd($y, $m, $d);
            $cells[] = ['bsY'=>$y,'bsM'=>$m,'bsD'=>$d,'ad'=>$ad->format('Y-m-d'),'isCurrentMonth'=>true];
        }

        // next month
        $nm = $m + 1; $ny = $y; if ($nm > 12) { $nm = 1; $ny++; }
        $nextD = 1;
        while (count($cells) < 42) {
            $ad = $this->bsToAd($ny, $nm, $nextD++);
            $cells[] = ['bsY'=>$ny,'bsM'=>$nm,'bsD'=>$nextD-1,'ad'=>$ad->format('Y-m-d'),'isCurrentMonth'=>false];
        }

        return array_chunk($cells, 7);
    }
}
</file>

<file path="bootstrap/cache/.gitignore">
*
!.gitignore
</file>

<file path="bootstrap/app.php">
<?php

/*
|--------------------------------------------------------------------------
| Create The Application
|--------------------------------------------------------------------------
|
| The first thing we will do is create a new Laravel application instance
| which serves as the "glue" for all the components of Laravel, and is
| the IoC container for the system binding all of the various parts.
|
*/

$app = new Illuminate\Foundation\Application(
    $_ENV['APP_BASE_PATH'] ?? dirname(__DIR__)
);

/*
|--------------------------------------------------------------------------
| Bind Important Interfaces
|--------------------------------------------------------------------------
|
| Next, we need to bind some important interfaces into the container so
| we will be able to resolve them when needed. The kernels serve the
| incoming requests to this application from both the web and CLI.
|
*/

$app->singleton(
    Illuminate\Contracts\Http\Kernel::class,
    App\Http\Kernel::class
);

$app->singleton(
    Illuminate\Contracts\Console\Kernel::class,
    App\Console\Kernel::class
);

$app->singleton(
    Illuminate\Contracts\Debug\ExceptionHandler::class,
    App\Exceptions\Handler::class
);

/*
|--------------------------------------------------------------------------
| Return The Application
|--------------------------------------------------------------------------
|
| This script returns the application instance. The instance is given to
| the calling script so we can separate the building of the instances
| from the actual running of the application and sending responses.
|
*/

return $app;
</file>

<file path="config/app.php">
<?php

use Illuminate\Support\Facades\Facade;
use Illuminate\Support\ServiceProvider;

return [

    /*
    |--------------------------------------------------------------------------
    | Application Name
    |--------------------------------------------------------------------------
    |
    | This value is the name of your application. This value is used when the
    | framework needs to place the application's name in a notification or
    | any other location as required by the application or its packages.
    |
    */

    'name' => env('APP_NAME', 'Laravel'),

    /*
    |--------------------------------------------------------------------------
    | Application Environment
    |--------------------------------------------------------------------------
    |
    | This value determines the "environment" your application is currently
    | running in. This may determine how you prefer to configure various
    | services the application utilizes. Set this in your ".env" file.
    |
    */

    'env' => env('APP_ENV', 'production'),

    /*
    |--------------------------------------------------------------------------
    | Application Debug Mode
    |--------------------------------------------------------------------------
    |
    | When your application is in debug mode, detailed error messages with
    | stack traces will be shown on every error that occurs within your
    | application. If disabled, a simple generic error page is shown.
    |
    */

    'debug' => (bool) env('APP_DEBUG', false),

    /*
    |--------------------------------------------------------------------------
    | Application URL
    |--------------------------------------------------------------------------
    |
    | This URL is used by the console to properly generate URLs when using
    | the Artisan command line tool. You should set this to the root of
    | your application so that it is used when running Artisan tasks.
    |
    */

    'url' => env('APP_URL', 'http://localhost'),

    'asset_url' => env('ASSET_URL'),

    /*
    |--------------------------------------------------------------------------
    | Application Timezone
    |--------------------------------------------------------------------------
    |
    | Here you may specify the default timezone for your application, which
    | will be used by the PHP date and date-time functions. We have gone
    | ahead and set this to a sensible default for you out of the box.
    |
    */

    'timezone' => 'UTC',

    /*
    |--------------------------------------------------------------------------
    | Application Locale Configuration
    |--------------------------------------------------------------------------
    |
    | The application locale determines the default locale that will be used
    | by the translation service provider. You are free to set this value
    | to any of the locales which will be supported by the application.
    |
    */

    'locale' => 'en',

    /*
    |--------------------------------------------------------------------------
    | Application Fallback Locale
    |--------------------------------------------------------------------------
    |
    | The fallback locale determines the locale to use when the current one
    | is not available. You may change the value to correspond to any of
    | the language folders that are provided through your application.
    |
    */

    'fallback_locale' => 'en',

    /*
    |--------------------------------------------------------------------------
    | Faker Locale
    |--------------------------------------------------------------------------
    |
    | This locale will be used by the Faker PHP library when generating fake
    | data for your database seeds. For example, this will be used to get
    | localized telephone numbers, street address information and more.
    |
    */

    'faker_locale' => 'en_US',

    /*
    |--------------------------------------------------------------------------
    | Encryption Key
    |--------------------------------------------------------------------------
    |
    | This key is used by the Illuminate encrypter service and should be set
    | to a random, 32 character string, otherwise these encrypted strings
    | will not be safe. Please do this before deploying an application!
    |
    */

    'key' => env('APP_KEY'),

    'cipher' => 'AES-256-CBC',

    /*
    |--------------------------------------------------------------------------
    | Maintenance Mode Driver
    |--------------------------------------------------------------------------
    |
    | These configuration options determine the driver used to determine and
    | manage Laravel's "maintenance mode" status. The "cache" driver will
    | allow maintenance mode to be controlled across multiple machines.
    |
    | Supported drivers: "file", "cache"
    |
    */

    'maintenance' => [
        'driver' => 'file',
        // 'store' => 'redis',
    ],

    /*
    |--------------------------------------------------------------------------
    | Autoloaded Service Providers
    |--------------------------------------------------------------------------
    |
    | The service providers listed here will be automatically loaded on the
    | request to your application. Feel free to add your own services to
    | this array to grant expanded functionality to your applications.
    |
    */

    'providers' => ServiceProvider::defaultProviders()->merge([
        /*
         * Package Service Providers...
         */

        /*
         * Application Service Providers...
         */
        App\Providers\AppServiceProvider::class,
        App\Providers\AuthServiceProvider::class,
        // App\Providers\BroadcastServiceProvider::class,
        App\Providers\EventServiceProvider::class,
        App\Providers\RouteServiceProvider::class,
    ])->toArray(),

    /*
    |--------------------------------------------------------------------------
    | Class Aliases
    |--------------------------------------------------------------------------
    |
    | This array of class aliases will be registered when this application
    | is started. However, feel free to register as many as you wish as
    | the aliases are "lazy" loaded so they don't hinder performance.
    |
    */

    'aliases' => Facade::defaultAliases()->merge([
        // 'Example' => App\Facades\Example::class,
    ])->toArray(),

];
</file>

<file path="config/auth.php">
<?php

return [

    /*
    |--------------------------------------------------------------------------
    | Authentication Defaults
    |--------------------------------------------------------------------------
    |
    | This option controls the default authentication "guard" and password
    | reset options for your application. You may change these defaults
    | as required, but they're a perfect start for most applications.
    |
    */

    'defaults' => [
        'guard' => 'web',
        'passwords' => 'users',
    ],

    /*
    |--------------------------------------------------------------------------
    | Authentication Guards
    |--------------------------------------------------------------------------
    |
    | Next, you may define every authentication guard for your application.
    | Of course, a great default configuration has been defined for you
    | here which uses session storage and the Eloquent user provider.
    |
    | All authentication drivers have a user provider. This defines how the
    | users are actually retrieved out of your database or other storage
    | mechanisms used by this application to persist your user's data.
    |
    | Supported: "session"
    |
    */

    'guards' => [
        'web' => [
            'driver' => 'session',
            'provider' => 'users',
        ],'employee' => [
        'driver' => 'session',
        'provider' => 'employees',
    ],
    ],

    /*
    |--------------------------------------------------------------------------
    | User Providers
    |--------------------------------------------------------------------------
    |
    | All authentication drivers have a user provider. This defines how the
    | users are actually retrieved out of your database or other storage
    | mechanisms used by this application to persist your user's data.
    |
    | If you have multiple user tables or models you may configure multiple
    | sources which represent each model / table. These sources may then
    | be assigned to any extra authentication guards you have defined.
    |
    | Supported: "database", "eloquent"
    |
    */

    'providers' => [
        'users' => [
            'driver' => 'eloquent',
            'model' => App\Models\User::class,
        ],'employees' => [
        'driver' => 'eloquent',
        'model' => App\Models\Employee::class,
    ],

        // 'users' => [
        //     'driver' => 'database',
        //     'table' => 'users',
        // ],
    ],

    /*
    |--------------------------------------------------------------------------
    | Resetting Passwords
    |--------------------------------------------------------------------------
    |
    | You may specify multiple password reset configurations if you have more
    | than one user table or model in the application and you want to have
    | separate password reset settings based on the specific user types.
    |
    | The expiry time is the number of minutes that each reset token will be
    | considered valid. This security feature keeps tokens short-lived so
    | they have less time to be guessed. You may change this as needed.
    |
    | The throttle setting is the number of seconds a user must wait before
    | generating more password reset tokens. This prevents the user from
    | quickly generating a very large amount of password reset tokens.
    |
    */

    'passwords' => [
        'users' => [
            'provider' => 'users',
            'table' => 'password_reset_tokens',
            'expire' => 60,
            'throttle' => 60,
        ],
    ],

    /*
    |--------------------------------------------------------------------------
    | Password Confirmation Timeout
    |--------------------------------------------------------------------------
    |
    | Here you may define the amount of seconds before a password confirmation
    | times out and the user is prompted to re-enter their password via the
    | confirmation screen. By default, the timeout lasts for three hours.
    |
    */

    'password_timeout' => 10800,

];
</file>

<file path="config/broadcasting.php">
<?php

return [

    /*
    |--------------------------------------------------------------------------
    | Default Broadcaster
    |--------------------------------------------------------------------------
    |
    | This option controls the default broadcaster that will be used by the
    | framework when an event needs to be broadcast. You may set this to
    | any of the connections defined in the "connections" array below.
    |
    | Supported: "pusher", "ably", "redis", "log", "null"
    |
    */

    'default' => env('BROADCAST_DRIVER', 'null'),

    /*
    |--------------------------------------------------------------------------
    | Broadcast Connections
    |--------------------------------------------------------------------------
    |
    | Here you may define all of the broadcast connections that will be used
    | to broadcast events to other systems or over websockets. Samples of
    | each available type of connection are provided inside this array.
    |
    */

    'connections' => [

        'pusher' => [
            'driver' => 'pusher',
            'key' => env('PUSHER_APP_KEY'),
            'secret' => env('PUSHER_APP_SECRET'),
            'app_id' => env('PUSHER_APP_ID'),
            'options' => [
                'cluster' => env('PUSHER_APP_CLUSTER'),
                'host' => env('PUSHER_HOST') ?: 'api-'.env('PUSHER_APP_CLUSTER', 'mt1').'.pusher.com',
                'port' => env('PUSHER_PORT', 443),
                'scheme' => env('PUSHER_SCHEME', 'https'),
                'encrypted' => true,
                'useTLS' => env('PUSHER_SCHEME', 'https') === 'https',
            ],
            'client_options' => [
                // Guzzle client options: https://docs.guzzlephp.org/en/stable/request-options.html
            ],
        ],

        'ably' => [
            'driver' => 'ably',
            'key' => env('ABLY_KEY'),
        ],

        'redis' => [
            'driver' => 'redis',
            'connection' => 'default',
        ],

        'log' => [
            'driver' => 'log',
        ],

        'null' => [
            'driver' => 'null',
        ],

    ],

];
</file>

<file path="config/cache.php">
<?php

use Illuminate\Support\Str;

return [

    /*
    |--------------------------------------------------------------------------
    | Default Cache Store
    |--------------------------------------------------------------------------
    |
    | This option controls the default cache connection that gets used while
    | using this caching library. This connection is used when another is
    | not explicitly specified when executing a given caching function.
    |
    */

    'default' => env('CACHE_DRIVER', 'file'),

    /*
    |--------------------------------------------------------------------------
    | Cache Stores
    |--------------------------------------------------------------------------
    |
    | Here you may define all of the cache "stores" for your application as
    | well as their drivers. You may even define multiple stores for the
    | same cache driver to group types of items stored in your caches.
    |
    | Supported drivers: "apc", "array", "database", "file",
    |         "memcached", "redis", "dynamodb", "octane", "null"
    |
    */

    'stores' => [

        'apc' => [
            'driver' => 'apc',
        ],

        'array' => [
            'driver' => 'array',
            'serialize' => false,
        ],

        'database' => [
            'driver' => 'database',
            'table' => 'cache',
            'connection' => null,
            'lock_connection' => null,
        ],

        'file' => [
            'driver' => 'file',
            'path' => storage_path('framework/cache/data'),
            'lock_path' => storage_path('framework/cache/data'),
        ],

        'memcached' => [
            'driver' => 'memcached',
            'persistent_id' => env('MEMCACHED_PERSISTENT_ID'),
            'sasl' => [
                env('MEMCACHED_USERNAME'),
                env('MEMCACHED_PASSWORD'),
            ],
            'options' => [
                // Memcached::OPT_CONNECT_TIMEOUT => 2000,
            ],
            'servers' => [
                [
                    'host' => env('MEMCACHED_HOST', '127.0.0.1'),
                    'port' => env('MEMCACHED_PORT', 11211),
                    'weight' => 100,
                ],
            ],
        ],

        'redis' => [
            'driver' => 'redis',
            'connection' => 'cache',
            'lock_connection' => 'default',
        ],

        'dynamodb' => [
            'driver' => 'dynamodb',
            'key' => env('AWS_ACCESS_KEY_ID'),
            'secret' => env('AWS_SECRET_ACCESS_KEY'),
            'region' => env('AWS_DEFAULT_REGION', 'us-east-1'),
            'table' => env('DYNAMODB_CACHE_TABLE', 'cache'),
            'endpoint' => env('DYNAMODB_ENDPOINT'),
        ],

        'octane' => [
            'driver' => 'octane',
        ],

    ],

    /*
    |--------------------------------------------------------------------------
    | Cache Key Prefix
    |--------------------------------------------------------------------------
    |
    | When utilizing the APC, database, memcached, Redis, or DynamoDB cache
    | stores there might be other applications using the same cache. For
    | that reason, you may prefix every cache key to avoid collisions.
    |
    */

    'prefix' => env('CACHE_PREFIX', Str::slug(env('APP_NAME', 'laravel'), '_').'_cache_'),

];
</file>

<file path="config/cors.php">
<?php

return [

    /*
    |--------------------------------------------------------------------------
    | Cross-Origin Resource Sharing (CORS) Configuration
    |--------------------------------------------------------------------------
    |
    | Here you may configure your settings for cross-origin resource sharing
    | or "CORS". This determines what cross-origin operations may execute
    | in web browsers. You are free to adjust these settings as needed.
    |
    | To learn more: https://developer.mozilla.org/en-US/docs/Web/HTTP/CORS
    |
    */

    'paths' => ['api/*', 'sanctum/csrf-cookie'],

    'allowed_methods' => ['*'],

    'allowed_origins' => ['*'],

    'allowed_origins_patterns' => [],

    'allowed_headers' => ['*'],

    'exposed_headers' => [],

    'max_age' => 0,

    'supports_credentials' => false,

];
</file>

<file path="config/database.php">
<?php

use Illuminate\Support\Str;

return [

    /*
    |--------------------------------------------------------------------------
    | Default Database Connection Name
    |--------------------------------------------------------------------------
    |
    | Here you may specify which of the database connections below you wish
    | to use as your default connection for all database work. Of course
    | you may use many connections at once using the Database library.
    |
    */

    'default' => env('DB_CONNECTION', 'mysql'),

    /*
    |--------------------------------------------------------------------------
    | Database Connections
    |--------------------------------------------------------------------------
    |
    | Here are each of the database connections setup for your application.
    | Of course, examples of configuring each database platform that is
    | supported by Laravel is shown below to make development simple.
    |
    |
    | All database work in Laravel is done through the PHP PDO facilities
    | so make sure you have the driver for your particular database of
    | choice installed on your machine before you begin development.
    |
    */

    'connections' => [

        'sqlite' => [
            'driver' => 'sqlite',
            'url' => env('DATABASE_URL'),
            'database' => env('DB_DATABASE', database_path('database.sqlite')),
            'prefix' => '',
            'foreign_key_constraints' => env('DB_FOREIGN_KEYS', true),
        ],

        'mysql' => [
            'driver' => 'mysql',
            'url' => env('DATABASE_URL'),
            'host' => env('DB_HOST', '127.0.0.1'),
            'port' => env('DB_PORT', '3306'),
            'database' => env('DB_DATABASE', 'forge'),
            'username' => env('DB_USERNAME', 'forge'),
            'password' => env('DB_PASSWORD', ''),
            'unix_socket' => env('DB_SOCKET', ''),
            'charset' => 'utf8mb4',
            'collation' => 'utf8mb4_unicode_ci',
            'prefix' => '',
            'prefix_indexes' => true,
            'strict' => true,
            'engine' => null,
            'options' => extension_loaded('pdo_mysql') ? array_filter([
                PDO::MYSQL_ATTR_SSL_CA => env('MYSQL_ATTR_SSL_CA'),
            ]) : [],
        ],

        'pgsql' => [
            'driver' => 'pgsql',
            'url' => env('DATABASE_URL'),
            'host' => env('DB_HOST', '127.0.0.1'),
            'port' => env('DB_PORT', '5432'),
            'database' => env('DB_DATABASE', 'forge'),
            'username' => env('DB_USERNAME', 'forge'),
            'password' => env('DB_PASSWORD', ''),
            'charset' => 'utf8',
            'prefix' => '',
            'prefix_indexes' => true,
            'search_path' => 'public',
            'sslmode' => 'prefer',
        ],

        'sqlsrv' => [
            'driver' => 'sqlsrv',
            'url' => env('DATABASE_URL'),
            'host' => env('DB_HOST', 'localhost'),
            'port' => env('DB_PORT', '1433'),
            'database' => env('DB_DATABASE', 'forge'),
            'username' => env('DB_USERNAME', 'forge'),
            'password' => env('DB_PASSWORD', ''),
            'charset' => 'utf8',
            'prefix' => '',
            'prefix_indexes' => true,
            // 'encrypt' => env('DB_ENCRYPT', 'yes'),
            // 'trust_server_certificate' => env('DB_TRUST_SERVER_CERTIFICATE', 'false'),
        ],

    ],

    /*
    |--------------------------------------------------------------------------
    | Migration Repository Table
    |--------------------------------------------------------------------------
    |
    | This table keeps track of all the migrations that have already run for
    | your application. Using this information, we can determine which of
    | the migrations on disk haven't actually been run in the database.
    |
    */

    'migrations' => 'migrations',

    /*
    |--------------------------------------------------------------------------
    | Redis Databases
    |--------------------------------------------------------------------------
    |
    | Redis is an open source, fast, and advanced key-value store that also
    | provides a richer body of commands than a typical key-value system
    | such as APC or Memcached. Laravel makes it easy to dig right in.
    |
    */

    'redis' => [

        'client' => env('REDIS_CLIENT', 'phpredis'),

        'options' => [
            'cluster' => env('REDIS_CLUSTER', 'redis'),
            'prefix' => env('REDIS_PREFIX', Str::slug(env('APP_NAME', 'laravel'), '_').'_database_'),
        ],

        'default' => [
            'url' => env('REDIS_URL'),
            'host' => env('REDIS_HOST', '127.0.0.1'),
            'username' => env('REDIS_USERNAME'),
            'password' => env('REDIS_PASSWORD'),
            'port' => env('REDIS_PORT', '6379'),
            'database' => env('REDIS_DB', '0'),
        ],

        'cache' => [
            'url' => env('REDIS_URL'),
            'host' => env('REDIS_HOST', '127.0.0.1'),
            'username' => env('REDIS_USERNAME'),
            'password' => env('REDIS_PASSWORD'),
            'port' => env('REDIS_PORT', '6379'),
            'database' => env('REDIS_CACHE_DB', '1'),
        ],

    ],

];
</file>

<file path="config/filesystems.php">
<?php

return [

    /*
    |--------------------------------------------------------------------------
    | Default Filesystem Disk
    |--------------------------------------------------------------------------
    |
    | Here you may specify the default filesystem disk that should be used
    | by the framework. The "local" disk, as well as a variety of cloud
    | based disks are available to your application. Just store away!
    |
    */

    'default' => env('FILESYSTEM_DISK', 'local'),

    /*
    |--------------------------------------------------------------------------
    | Filesystem Disks
    |--------------------------------------------------------------------------
    |
    | Here you may configure as many filesystem "disks" as you wish, and you
    | may even configure multiple disks of the same driver. Defaults have
    | been set up for each driver as an example of the required values.
    |
    | Supported Drivers: "local", "ftp", "sftp", "s3"
    |
    */

    'disks' => [

        'local' => [
            'driver' => 'local',
            'root' => storage_path('app'),
            'throw' => false,
        ],

        'public' => [
            'driver' => 'local',
            'root' => storage_path('app/public'),
            'url' => env('APP_URL').'/storage',
            'visibility' => 'public',
            'throw' => false,
        ],

        's3' => [
            'driver' => 's3',
            'key' => env('AWS_ACCESS_KEY_ID'),
            'secret' => env('AWS_SECRET_ACCESS_KEY'),
            'region' => env('AWS_DEFAULT_REGION'),
            'bucket' => env('AWS_BUCKET'),
            'url' => env('AWS_URL'),
            'endpoint' => env('AWS_ENDPOINT'),
            'use_path_style_endpoint' => env('AWS_USE_PATH_STYLE_ENDPOINT', false),
            'throw' => false,
        ],

    ],

    /*
    |--------------------------------------------------------------------------
    | Symbolic Links
    |--------------------------------------------------------------------------
    |
    | Here you may configure the symbolic links that will be created when the
    | `storage:link` Artisan command is executed. The array keys should be
    | the locations of the links and the values should be their targets.
    |
    */

    'links' => [
        public_path('storage') => storage_path('app/public'),
    ],

];
</file>

<file path="config/hashing.php">
<?php

return [

    /*
    |--------------------------------------------------------------------------
    | Default Hash Driver
    |--------------------------------------------------------------------------
    |
    | This option controls the default hash driver that will be used to hash
    | passwords for your application. By default, the bcrypt algorithm is
    | used; however, you remain free to modify this option if you wish.
    |
    | Supported: "bcrypt", "argon", "argon2id"
    |
    */

    'driver' => 'bcrypt',

    /*
    |--------------------------------------------------------------------------
    | Bcrypt Options
    |--------------------------------------------------------------------------
    |
    | Here you may specify the configuration options that should be used when
    | passwords are hashed using the Bcrypt algorithm. This will allow you
    | to control the amount of time it takes to hash the given password.
    |
    */

    'bcrypt' => [
        'rounds' => env('BCRYPT_ROUNDS', 12),
        'verify' => true,
    ],

    /*
    |--------------------------------------------------------------------------
    | Argon Options
    |--------------------------------------------------------------------------
    |
    | Here you may specify the configuration options that should be used when
    | passwords are hashed using the Argon algorithm. These will allow you
    | to control the amount of time it takes to hash the given password.
    |
    */

    'argon' => [
        'memory' => 65536,
        'threads' => 1,
        'time' => 4,
        'verify' => true,
    ],

];
</file>

<file path="config/logging.php">
<?php

use Monolog\Handler\NullHandler;
use Monolog\Handler\StreamHandler;
use Monolog\Handler\SyslogUdpHandler;
use Monolog\Processor\PsrLogMessageProcessor;

return [

    /*
    |--------------------------------------------------------------------------
    | Default Log Channel
    |--------------------------------------------------------------------------
    |
    | This option defines the default log channel that gets used when writing
    | messages to the logs. The name specified in this option should match
    | one of the channels defined in the "channels" configuration array.
    |
    */

    'default' => env('LOG_CHANNEL', 'stack'),

    /*
    |--------------------------------------------------------------------------
    | Deprecations Log Channel
    |--------------------------------------------------------------------------
    |
    | This option controls the log channel that should be used to log warnings
    | regarding deprecated PHP and library features. This allows you to get
    | your application ready for upcoming major versions of dependencies.
    |
    */

    'deprecations' => [
        'channel' => env('LOG_DEPRECATIONS_CHANNEL', 'null'),
        'trace' => false,
    ],

    /*
    |--------------------------------------------------------------------------
    | Log Channels
    |--------------------------------------------------------------------------
    |
    | Here you may configure the log channels for your application. Out of
    | the box, Laravel uses the Monolog PHP logging library. This gives
    | you a variety of powerful log handlers / formatters to utilize.
    |
    | Available Drivers: "single", "daily", "slack", "syslog",
    |                    "errorlog", "monolog",
    |                    "custom", "stack"
    |
    */

    'channels' => [
        'stack' => [
            'driver' => 'stack',
            'channels' => ['single'],
            'ignore_exceptions' => false,
        ],

        'single' => [
            'driver' => 'single',
            'path' => storage_path('logs/laravel.log'),
            'level' => env('LOG_LEVEL', 'debug'),
            'replace_placeholders' => true,
        ],

        'daily' => [
            'driver' => 'daily',
            'path' => storage_path('logs/laravel.log'),
            'level' => env('LOG_LEVEL', 'debug'),
            'days' => 14,
            'replace_placeholders' => true,
        ],

        'slack' => [
            'driver' => 'slack',
            'url' => env('LOG_SLACK_WEBHOOK_URL'),
            'username' => 'Laravel Log',
            'emoji' => ':boom:',
            'level' => env('LOG_LEVEL', 'critical'),
            'replace_placeholders' => true,
        ],

        'papertrail' => [
            'driver' => 'monolog',
            'level' => env('LOG_LEVEL', 'debug'),
            'handler' => env('LOG_PAPERTRAIL_HANDLER', SyslogUdpHandler::class),
            'handler_with' => [
                'host' => env('PAPERTRAIL_URL'),
                'port' => env('PAPERTRAIL_PORT'),
                'connectionString' => 'tls://'.env('PAPERTRAIL_URL').':'.env('PAPERTRAIL_PORT'),
            ],
            'processors' => [PsrLogMessageProcessor::class],
        ],

        'stderr' => [
            'driver' => 'monolog',
            'level' => env('LOG_LEVEL', 'debug'),
            'handler' => StreamHandler::class,
            'formatter' => env('LOG_STDERR_FORMATTER'),
            'with' => [
                'stream' => 'php://stderr',
            ],
            'processors' => [PsrLogMessageProcessor::class],
        ],

        'syslog' => [
            'driver' => 'syslog',
            'level' => env('LOG_LEVEL', 'debug'),
            'facility' => LOG_USER,
            'replace_placeholders' => true,
        ],

        'errorlog' => [
            'driver' => 'errorlog',
            'level' => env('LOG_LEVEL', 'debug'),
            'replace_placeholders' => true,
        ],

        'null' => [
            'driver' => 'monolog',
            'handler' => NullHandler::class,
        ],

        'emergency' => [
            'path' => storage_path('logs/laravel.log'),
        ],
    ],

];
</file>

<file path="config/mail.php">
<?php

return [

    /*
    |--------------------------------------------------------------------------
    | Default Mailer
    |--------------------------------------------------------------------------
    |
    | This option controls the default mailer that is used to send any email
    | messages sent by your application. Alternative mailers may be setup
    | and used as needed; however, this mailer will be used by default.
    |
    */

    'default' => env('MAIL_MAILER', 'smtp'),

    /*
    |--------------------------------------------------------------------------
    | Mailer Configurations
    |--------------------------------------------------------------------------
    |
    | Here you may configure all of the mailers used by your application plus
    | their respective settings. Several examples have been configured for
    | you and you are free to add your own as your application requires.
    |
    | Laravel supports a variety of mail "transport" drivers to be used while
    | sending an e-mail. You will specify which one you are using for your
    | mailers below. You are free to add additional mailers as required.
    |
    | Supported: "smtp", "sendmail", "mailgun", "ses", "ses-v2",
    |            "postmark", "log", "array", "failover", "roundrobin"
    |
    */

    'mailers' => [
        'smtp' => [
            'transport' => 'smtp',
            'url' => env('MAIL_URL'),
            'host' => env('MAIL_HOST', 'smtp.mailgun.org'),
            'port' => env('MAIL_PORT', 587),
            'encryption' => env('MAIL_ENCRYPTION', 'tls'),
            'username' => env('MAIL_USERNAME'),
            'password' => env('MAIL_PASSWORD'),
            'timeout' => null,
            'local_domain' => env('MAIL_EHLO_DOMAIN'),
        ],

        'ses' => [
            'transport' => 'ses',
        ],

        'postmark' => [
            'transport' => 'postmark',
            // 'message_stream_id' => null,
            // 'client' => [
            //     'timeout' => 5,
            // ],
        ],

        'mailgun' => [
            'transport' => 'mailgun',
            // 'client' => [
            //     'timeout' => 5,
            // ],
        ],

        'sendmail' => [
            'transport' => 'sendmail',
            'path' => env('MAIL_SENDMAIL_PATH', '/usr/sbin/sendmail -bs -i'),
        ],

        'log' => [
            'transport' => 'log',
            'channel' => env('MAIL_LOG_CHANNEL'),
        ],

        'array' => [
            'transport' => 'array',
        ],

        'failover' => [
            'transport' => 'failover',
            'mailers' => [
                'smtp',
                'log',
            ],
        ],

        'roundrobin' => [
            'transport' => 'roundrobin',
            'mailers' => [
                'ses',
                'postmark',
            ],
        ],
    ],

    /*
    |--------------------------------------------------------------------------
    | Global "From" Address
    |--------------------------------------------------------------------------
    |
    | You may wish for all e-mails sent by your application to be sent from
    | the same address. Here, you may specify a name and address that is
    | used globally for all e-mails that are sent by your application.
    |
    */

    'from' => [
        'address' => env('MAIL_FROM_ADDRESS', 'hello@example.com'),
        'name' => env('MAIL_FROM_NAME', 'Example'),
    ],

    /*
    |--------------------------------------------------------------------------
    | Markdown Mail Settings
    |--------------------------------------------------------------------------
    |
    | If you are using Markdown based email rendering, you may configure your
    | theme and component paths here, allowing you to customize the design
    | of the emails. Or, you may simply stick with the Laravel defaults!
    |
    */

    'markdown' => [
        'theme' => 'default',

        'paths' => [
            resource_path('views/vendor/mail'),
        ],
    ],

];
</file>

<file path="config/queue.php">
<?php

return [

    /*
    |--------------------------------------------------------------------------
    | Default Queue Connection Name
    |--------------------------------------------------------------------------
    |
    | Laravel's queue API supports an assortment of back-ends via a single
    | API, giving you convenient access to each back-end using the same
    | syntax for every one. Here you may define a default connection.
    |
    */

    'default' => env('QUEUE_CONNECTION', 'sync'),

    /*
    |--------------------------------------------------------------------------
    | Queue Connections
    |--------------------------------------------------------------------------
    |
    | Here you may configure the connection information for each server that
    | is used by your application. A default configuration has been added
    | for each back-end shipped with Laravel. You are free to add more.
    |
    | Drivers: "sync", "database", "beanstalkd", "sqs", "redis", "null"
    |
    */

    'connections' => [

        'sync' => [
            'driver' => 'sync',
        ],

        'database' => [
            'driver' => 'database',
            'table' => 'jobs',
            'queue' => 'default',
            'retry_after' => 90,
            'after_commit' => false,
        ],

        'beanstalkd' => [
            'driver' => 'beanstalkd',
            'host' => 'localhost',
            'queue' => 'default',
            'retry_after' => 90,
            'block_for' => 0,
            'after_commit' => false,
        ],

        'sqs' => [
            'driver' => 'sqs',
            'key' => env('AWS_ACCESS_KEY_ID'),
            'secret' => env('AWS_SECRET_ACCESS_KEY'),
            'prefix' => env('SQS_PREFIX', 'https://sqs.us-east-1.amazonaws.com/your-account-id'),
            'queue' => env('SQS_QUEUE', 'default'),
            'suffix' => env('SQS_SUFFIX'),
            'region' => env('AWS_DEFAULT_REGION', 'us-east-1'),
            'after_commit' => false,
        ],

        'redis' => [
            'driver' => 'redis',
            'connection' => 'default',
            'queue' => env('REDIS_QUEUE', 'default'),
            'retry_after' => 90,
            'block_for' => null,
            'after_commit' => false,
        ],

    ],

    /*
    |--------------------------------------------------------------------------
    | Job Batching
    |--------------------------------------------------------------------------
    |
    | The following options configure the database and table that store job
    | batching information. These options can be updated to any database
    | connection and table which has been defined by your application.
    |
    */

    'batching' => [
        'database' => env('DB_CONNECTION', 'mysql'),
        'table' => 'job_batches',
    ],

    /*
    |--------------------------------------------------------------------------
    | Failed Queue Jobs
    |--------------------------------------------------------------------------
    |
    | These options configure the behavior of failed queue job logging so you
    | can control which database and table are used to store the jobs that
    | have failed. You may change them to any database / table you wish.
    |
    */

    'failed' => [
        'driver' => env('QUEUE_FAILED_DRIVER', 'database-uuids'),
        'database' => env('DB_CONNECTION', 'mysql'),
        'table' => 'failed_jobs',
    ],

];
</file>

<file path="config/sanctum.php">
<?php

use Laravel\Sanctum\Sanctum;

return [

    /*
    |--------------------------------------------------------------------------
    | Stateful Domains
    |--------------------------------------------------------------------------
    |
    | Requests from the following domains / hosts will receive stateful API
    | authentication cookies. Typically, these should include your local
    | and production domains which access your API via a frontend SPA.
    |
    */

    'stateful' => explode(',', env('SANCTUM_STATEFUL_DOMAINS', sprintf(
        '%s%s',
        'localhost,localhost:3000,127.0.0.1,127.0.0.1:8000,::1',
        Sanctum::currentApplicationUrlWithPort()
    ))),

    /*
    |--------------------------------------------------------------------------
    | Sanctum Guards
    |--------------------------------------------------------------------------
    |
    | This array contains the authentication guards that will be checked when
    | Sanctum is trying to authenticate a request. If none of these guards
    | are able to authenticate the request, Sanctum will use the bearer
    | token that's present on an incoming request for authentication.
    |
    */

    'guard' => ['web'],

    /*
    |--------------------------------------------------------------------------
    | Expiration Minutes
    |--------------------------------------------------------------------------
    |
    | This value controls the number of minutes until an issued token will be
    | considered expired. This will override any values set in the token's
    | "expires_at" attribute, but first-party sessions are not affected.
    |
    */

    'expiration' => null,

    /*
    |--------------------------------------------------------------------------
    | Token Prefix
    |--------------------------------------------------------------------------
    |
    | Sanctum can prefix new tokens in order to take advantage of numerous
    | security scanning initiatives maintained by open source platforms
    | that notify developers if they commit tokens into repositories.
    |
    | See: https://docs.github.com/en/code-security/secret-scanning/about-secret-scanning
    |
    */

    'token_prefix' => env('SANCTUM_TOKEN_PREFIX', ''),

    /*
    |--------------------------------------------------------------------------
    | Sanctum Middleware
    |--------------------------------------------------------------------------
    |
    | When authenticating your first-party SPA with Sanctum you may need to
    | customize some of the middleware Sanctum uses while processing the
    | request. You may change the middleware listed below as required.
    |
    */

    'middleware' => [
        'authenticate_session' => Laravel\Sanctum\Http\Middleware\AuthenticateSession::class,
        'encrypt_cookies' => App\Http\Middleware\EncryptCookies::class,
        'verify_csrf_token' => App\Http\Middleware\VerifyCsrfToken::class,
    ],

];
</file>

<file path="config/services.php">
<?php

return [

    /*
    |--------------------------------------------------------------------------
    | Third Party Services
    |--------------------------------------------------------------------------
    |
    | This file is for storing the credentials for third party services such
    | as Mailgun, Postmark, AWS and more. This file provides the de facto
    | location for this type of information, allowing packages to have
    | a conventional file to locate the various service credentials.
    |
    */

    'mailgun' => [
        'domain' => env('MAILGUN_DOMAIN'),
        'secret' => env('MAILGUN_SECRET'),
        'endpoint' => env('MAILGUN_ENDPOINT', 'api.mailgun.net'),
        'scheme' => 'https',
    ],

    'postmark' => [
        'token' => env('POSTMARK_TOKEN'),
    ],

    'ses' => [
        'key' => env('AWS_ACCESS_KEY_ID'),
        'secret' => env('AWS_SECRET_ACCESS_KEY'),
        'region' => env('AWS_DEFAULT_REGION', 'us-east-1'),
    ],

];
</file>

<file path="config/session.php">
<?php

use Illuminate\Support\Str;

return [

    /*
    |--------------------------------------------------------------------------
    | Default Session Driver
    |--------------------------------------------------------------------------
    |
    | This option controls the default session "driver" that will be used on
    | requests. By default, we will use the lightweight native driver but
    | you may specify any of the other wonderful drivers provided here.
    |
    | Supported: "file", "cookie", "database", "apc",
    |            "memcached", "redis", "dynamodb", "array"
    |
    */

    'driver' => env('SESSION_DRIVER', 'file'),

    /*
    |--------------------------------------------------------------------------
    | Session Lifetime
    |--------------------------------------------------------------------------
    |
    | Here you may specify the number of minutes that you wish the session
    | to be allowed to remain idle before it expires. If you want them
    | to immediately expire on the browser closing, set that option.
    |
    */

    'lifetime' => env('SESSION_LIFETIME', 120),

    'expire_on_close' => false,

    /*
    |--------------------------------------------------------------------------
    | Session Encryption
    |--------------------------------------------------------------------------
    |
    | This option allows you to easily specify that all of your session data
    | should be encrypted before it is stored. All encryption will be run
    | automatically by Laravel and you can use the Session like normal.
    |
    */

    'encrypt' => false,

    /*
    |--------------------------------------------------------------------------
    | Session File Location
    |--------------------------------------------------------------------------
    |
    | When using the native session driver, we need a location where session
    | files may be stored. A default has been set for you but a different
    | location may be specified. This is only needed for file sessions.
    |
    */

    'files' => storage_path('framework/sessions'),

    /*
    |--------------------------------------------------------------------------
    | Session Database Connection
    |--------------------------------------------------------------------------
    |
    | When using the "database" or "redis" session drivers, you may specify a
    | connection that should be used to manage these sessions. This should
    | correspond to a connection in your database configuration options.
    |
    */

    'connection' => env('SESSION_CONNECTION'),

    /*
    |--------------------------------------------------------------------------
    | Session Database Table
    |--------------------------------------------------------------------------
    |
    | When using the "database" session driver, you may specify the table we
    | should use to manage the sessions. Of course, a sensible default is
    | provided for you; however, you are free to change this as needed.
    |
    */

    'table' => 'sessions',

    /*
    |--------------------------------------------------------------------------
    | Session Cache Store
    |--------------------------------------------------------------------------
    |
    | While using one of the framework's cache driven session backends you may
    | list a cache store that should be used for these sessions. This value
    | must match with one of the application's configured cache "stores".
    |
    | Affects: "apc", "dynamodb", "memcached", "redis"
    |
    */

    'store' => env('SESSION_STORE'),

    /*
    |--------------------------------------------------------------------------
    | Session Sweeping Lottery
    |--------------------------------------------------------------------------
    |
    | Some session drivers must manually sweep their storage location to get
    | rid of old sessions from storage. Here are the chances that it will
    | happen on a given request. By default, the odds are 2 out of 100.
    |
    */

    'lottery' => [2, 100],

    /*
    |--------------------------------------------------------------------------
    | Session Cookie Name
    |--------------------------------------------------------------------------
    |
    | Here you may change the name of the cookie used to identify a session
    | instance by ID. The name specified here will get used every time a
    | new session cookie is created by the framework for every driver.
    |
    */

    'cookie' => env(
        'SESSION_COOKIE',
        Str::slug(env('APP_NAME', 'laravel'), '_').'_session'
    ),

    /*
    |--------------------------------------------------------------------------
    | Session Cookie Path
    |--------------------------------------------------------------------------
    |
    | The session cookie path determines the path for which the cookie will
    | be regarded as available. Typically, this will be the root path of
    | your application but you are free to change this when necessary.
    |
    */

    'path' => '/',

    /*
    |--------------------------------------------------------------------------
    | Session Cookie Domain
    |--------------------------------------------------------------------------
    |
    | Here you may change the domain of the cookie used to identify a session
    | in your application. This will determine which domains the cookie is
    | available to in your application. A sensible default has been set.
    |
    */

    'domain' => env('SESSION_DOMAIN'),

    /*
    |--------------------------------------------------------------------------
    | HTTPS Only Cookies
    |--------------------------------------------------------------------------
    |
    | By setting this option to true, session cookies will only be sent back
    | to the server if the browser has a HTTPS connection. This will keep
    | the cookie from being sent to you when it can't be done securely.
    |
    */

    'secure' => env('SESSION_SECURE_COOKIE'),

    /*
    |--------------------------------------------------------------------------
    | HTTP Access Only
    |--------------------------------------------------------------------------
    |
    | Setting this value to true will prevent JavaScript from accessing the
    | value of the cookie and the cookie will only be accessible through
    | the HTTP protocol. You are free to modify this option if needed.
    |
    */

    'http_only' => true,

    /*
    |--------------------------------------------------------------------------
    | Same-Site Cookies
    |--------------------------------------------------------------------------
    |
    | This option determines how your cookies behave when cross-site requests
    | take place, and can be used to mitigate CSRF attacks. By default, we
    | will set this value to "lax" since this is a secure default value.
    |
    | Supported: "lax", "strict", "none", null
    |
    */

    'same_site' => 'lax',

    /*
    |--------------------------------------------------------------------------
    | Partitioned Cookies
    |--------------------------------------------------------------------------
    |
    | Setting this value to true will tie the cookie to the top-level site for
    | a cross-site context. Partitioned cookies are accepted by the browser
    | when flagged "secure" and the Same-Site attribute is set to "none".
    |
    */

    'partitioned' => false,

];
</file>

<file path="config/view.php">
<?php

return [

    /*
    |--------------------------------------------------------------------------
    | View Storage Paths
    |--------------------------------------------------------------------------
    |
    | Most templating systems load templates from disk. Here you may specify
    | an array of paths that should be checked for your views. Of course
    | the usual Laravel view path has already been registered for you.
    |
    */

    'paths' => [
        resource_path('views'),
    ],

    /*
    |--------------------------------------------------------------------------
    | Compiled View Path
    |--------------------------------------------------------------------------
    |
    | This option determines where all the compiled Blade templates will be
    | stored for your application. Typically, this is within the storage
    | directory. However, as usual, you are free to change this value.
    |
    */

    'compiled' => env(
        'VIEW_COMPILED_PATH',
        realpath(storage_path('framework/views'))
    ),

];
</file>

<file path="database/factories/UserFactory.php">
<?php

namespace Database\Factories;

use Illuminate\Database\Eloquent\Factories\Factory;
use Illuminate\Support\Facades\Hash;
use Illuminate\Support\Str;

/**
 * @extends \Illuminate\Database\Eloquent\Factories\Factory<\App\Models\User>
 */
class UserFactory extends Factory
{
    /**
     * The current password being used by the factory.
     */
    protected static ?string $password;

    /**
     * Define the model's default state.
     *
     * @return array<string, mixed>
     */
    public function definition(): array
    {
        return [
            'name' => fake()->name(),
            'email' => fake()->unique()->safeEmail(),
            'email_verified_at' => now(),
            'password' => static::$password ??= Hash::make('password'),
            'remember_token' => Str::random(10),
        ];
    }

    /**
     * Indicate that the model's email address should be unverified.
     */
    public function unverified(): static
    {
        return $this->state(fn (array $attributes) => [
            'email_verified_at' => null,
        ]);
    }
}
</file>

<file path="database/migrations/2014_10_12_000000_create_users_table.php">
<?php

use Illuminate\Database\Migrations\Migration;
use Illuminate\Database\Schema\Blueprint;
use Illuminate\Support\Facades\Schema;

return new class extends Migration
{
    /**
     * Run the migrations.
     */
    public function up(): void
    {
        Schema::create('users', function (Blueprint $table) {
            $table->id();
            $table->string('name');
            $table->string('email')->unique();
            $table->timestamp('email_verified_at')->nullable();
            $table->string('password');
            $table->rememberToken();
            $table->timestamps();
        });
    }

    /**
     * Reverse the migrations.
     */
    public function down(): void
    {
        Schema::dropIfExists('users');
    }
};
</file>

<file path="database/migrations/2014_10_12_100000_create_password_reset_tokens_table.php">
<?php

use Illuminate\Database\Migrations\Migration;
use Illuminate\Database\Schema\Blueprint;
use Illuminate\Support\Facades\Schema;

return new class extends Migration
{
    /**
     * Run the migrations.
     */
    public function up(): void
    {
        Schema::create('password_reset_tokens', function (Blueprint $table) {
            $table->string('email')->primary();
            $table->string('token');
            $table->timestamp('created_at')->nullable();
        });
    }

    /**
     * Reverse the migrations.
     */
    public function down(): void
    {
        Schema::dropIfExists('password_reset_tokens');
    }
};
</file>

<file path="database/migrations/2019_08_19_000000_create_failed_jobs_table.php">
<?php

use Illuminate\Database\Migrations\Migration;
use Illuminate\Database\Schema\Blueprint;
use Illuminate\Support\Facades\Schema;

return new class extends Migration
{
    /**
     * Run the migrations.
     */
    public function up(): void
    {
        Schema::create('failed_jobs', function (Blueprint $table) {
            $table->id();
            $table->string('uuid')->unique();
            $table->text('connection');
            $table->text('queue');
            $table->longText('payload');
            $table->longText('exception');
            $table->timestamp('failed_at')->useCurrent();
        });
    }

    /**
     * Reverse the migrations.
     */
    public function down(): void
    {
        Schema::dropIfExists('failed_jobs');
    }
};
</file>

<file path="database/migrations/2019_12_14_000001_create_personal_access_tokens_table.php">
<?php

use Illuminate\Database\Migrations\Migration;
use Illuminate\Database\Schema\Blueprint;
use Illuminate\Support\Facades\Schema;

return new class extends Migration
{
    /**
     * Run the migrations.
     */
    public function up(): void
    {
        Schema::create('personal_access_tokens', function (Blueprint $table) {
            $table->id();
            $table->morphs('tokenable');
            $table->string('name');
            $table->string('token', 64)->unique();
            $table->text('abilities')->nullable();
            $table->timestamp('last_used_at')->nullable();
            $table->timestamp('expires_at')->nullable();
            $table->timestamps();
        });
    }

    /**
     * Reverse the migrations.
     */
    public function down(): void
    {
        Schema::dropIfExists('personal_access_tokens');
    }
};
</file>

<file path="database/migrations/2023_08_21_084253_create_categories_table.php">
<?php
use Illuminate\Database\Migrations\Migration;
use Illuminate\Database\Schema\Blueprint;
use Illuminate\Support\Facades\Schema;

return new class extends Migration {
    public function up(): void
    {
        Schema::create('categories', function (Blueprint $table) {
            $table->id();
            $table->string('name')->unique();
            $table->boolean('is_active')->default(true);
            $table->timestamps();
        });
    }

    public function down(): void
    {
        Schema::dropIfExists('categories');
    }
};
</file>

<file path="database/migrations/2023_08_21_084353_create_brands_table.php">
<?php
use Illuminate\Database\Migrations\Migration;
use Illuminate\Database\Schema\Blueprint;
use Illuminate\Support\Facades\Schema;

return new class extends Migration {
    public function up(): void
    {
        Schema::create('brands', function (Blueprint $table) {
            $table->id();
            $table->string('name')->unique();
            $table->boolean('is_active')->default(true);
            $table->timestamps();
        });
    }

    public function down(): void
    {
        Schema::dropIfExists('brands');
    }
};
</file>

<file path="database/migrations/2025_09_14_121306_create_admins_table.php">
<?php
use Illuminate\Database\Migrations\Migration;
use Illuminate\Database\Schema\Blueprint;
use Illuminate\Support\Facades\Schema;


return new class extends Migration {
public function up(): void
{
Schema::create('admins', function (Blueprint $table) {
$table->id();
$table->string('name');
$table->string('email')->unique();
$table->string('password');
$table->string('contact')->nullable();
$table->timestamps();
});
}


public function down(): void
{
Schema::dropIfExists('admins');
}
};
</file>

<file path="database/migrations/2025_10_07_034553_create_suppliers_table.php">
<?php

use Illuminate\Database\Migrations\Migration;
use Illuminate\Database\Schema\Blueprint;
use Illuminate\Support\Facades\Schema;

return new class extends Migration {
    public function up(): void
    {
        Schema::create('suppliers', function (Blueprint $table) {
            $table->id();
            $table->string('name', 150);
            // Nepal PAN is typically 9 digits â€” store as string, enforce unique
            $table->string('pan', 20)->unique();
            $table->string('address', 255)->nullable();
            $table->timestamps();

            $table->index('name');
        });
    }

    public function down(): void
    {
        Schema::dropIfExists('suppliers');
    }
};
</file>

<file path="database/migrations/2025_10_07_041600_create_item_categories_table.php">
<?php

use Illuminate\Database\Migrations\Migration;
use Illuminate\Database\Schema\Blueprint;
use Illuminate\Support\Facades\Schema;

return new class extends Migration {
    public function up(): void
    {
        Schema::create('item_categories', function (Blueprint $table) {
            $table->id();
            $table->string('name_en', 100); // English name
            $table->string('name_np', 100)->nullable(); // Nepali name
            $table->timestamps();
        });
    }

    public function down(): void
    {
        Schema::dropIfExists('item_categories');
    }
};
</file>

<file path="database/migrations/2025_10_08_032327_create_departments_table.php">
<?php

use Illuminate\Database\Migrations\Migration;
use Illuminate\Database\Schema\Blueprint;
use Illuminate\Support\Facades\Schema;

class CreateDepartmentsTable extends Migration
{
    /**
     * Run the migrations.
     *
     * @return void
     */
    public function up()
    {
        Schema::create('departments', function (Blueprint $table) {
            $table->id();
            $table->string('name');
            $table->boolean('status')->default(1);
            $table->timestamps();
        });
    }

    /**
     * Reverse the migrations.
     *
     * @return void
     */
    public function down()
    {
        Schema::dropIfExists('departments');
    }
}
</file>

<file path="database/migrations/2025_10_08_041051_create_products_table.php">
<?php
// database/migrations/xxxx_xx_xx_create_products_table.php
use Illuminate\Database\Migrations\Migration;
use Illuminate\Database\Schema\Blueprint;
use Illuminate\Support\Facades\Schema;

return new class extends Migration {
  public function up(): void {
    Schema::create('products', function (Blueprint $table) {
      $table->id();
      $table->string('name', 150);
      $table->string('sku', 50)->nullable();               // your internal code
      $table->foreignId('item_category_id')->nullable()->constrained('item_categories')->nullOnDelete();
      $table->foreignId('product_category_id')->nullable()->constrained('categories')->nullOnDelete();
      $table->foreignId('brand_id')->nullable()->constrained('brands')->nullOnDelete();
      $table->string('unit', 20)->default('pcs');        // pcs, box, kg, etc.
      $table->unsignedInteger('reorder_level')->default(0);
      $table->string('image_path')->nullable();          // storage path
      $table->boolean('is_active')->default(true);
      $table->timestamps();
      $table->index(['name','sku']);
    });
  }
  public function down(): void { Schema::dropIfExists(table: 'products'); }
};
</file>

<file path="database/migrations/2025_10_08_041052_create_purchase_slips_table.php">
<?php

// database/migrations/xxxx_xx_xx_create_purchase_slips_table.php
use Illuminate\Database\Migrations\Migration;
use Illuminate\Database\Schema\Blueprint;
use Illuminate\Support\Facades\Schema;

return new class extends Migration {
  public function up(): void {
    Schema::create('purchase_slips', function (Blueprint $table) {
      $table->id();

      $table->string('po_sn', 50)->unique();   // Purchase Slip S.N.
      $table->date('po_date');                 // store as DATE (was string)

      $table->foreignId('department_id')
            ->constrained('departments')
            ->cascadeOnDelete();

      $table->text('remarks')->nullable();

      $table->timestamps();

      // Additional indexes to speed up filters
      $table->index('po_date');
      $table->index(['department_id', 'po_date']);
    });
  }

  public function down(): void {
    Schema::dropIfExists('purchase_slips');
  }
};
</file>

<file path="database/migrations/2025_10_08_041214_create_purchases_table.php">
<?php

use Illuminate\Database\Migrations\Migration;
use Illuminate\Database\Schema\Blueprint;
use Illuminate\Support\Facades\Schema;

return new class extends Migration {
  public function up(): void {
    Schema::create('purchases', function (Blueprint $table) {
      $table->id();

      $table->string('purchase_sn', 50)->unique();
      $table->string('purchase_date');

      // Supplier (single definition)
      $table->foreignId('supplier_id')
            ->constrained('suppliers')
            ->cascadeOnDelete();

      // Tie back to the internal order (purchase slip)
      $table->foreignId('purchase_slip_id')
            ->constrained('purchase_slips')
            ->cascadeOnDelete();

      // Copied from slip for convenience
      $table->foreignId('department_id')
            ->nullable()
            ->constrained('departments')
            ->nullOnDelete();
      

      // Totals
      $table->decimal('sub_total', 15, 2)->default(0);           // sum of line_subtotals
      $table->enum('tax_mode', ['VAT','PAN'])->default('PAN');    // VAT => add vat_percent; PAN => 0
      $table->decimal('vat_percent', 5, 2)->default(13.00);       // 13.00%
      $table->decimal('vat_amount', 15, 2)->default(0);
      $table->decimal('grand_total', 15, 2)->default(0);

      // Keep legacy/compat total if you need it (mirror grand_total in code)
      $table->decimal('total_amount', 14, 2)->default(0);

      // Bill image path (required at DB level)

      $table->string('bill_no')->nullable();
      $table->string('bill_pic')->nullable();

      $table->text('remarks')->nullable();

      $table->timestamps();

      $table->index(['purchase_sn','purchase_date']);
    });
  }

  public function down(): void {
    Schema::dropIfExists('purchases');
  }
};
</file>

<file path="database/migrations/2025_10_20_073427_create_purchase_slip_items_table.php">
<?php

use Illuminate\Database\Migrations\Migration;
use Illuminate\Database\Schema\Blueprint;
use Illuminate\Support\Facades\Schema;

return new class extends Migration {
  public function up(): void
  {
    Schema::create('purchase_slip_items', function (Blueprint $table) {
      $table->id();

      // Link to purchase_slips
      $table->foreignId('purchase_slip_id')
        ->constrained('purchase_slips')
        ->cascadeOnDelete();

      // Temporary item name / SKU (used when product_id is null)
      $table->string('temp_name')->nullable();
      $table->string('temp_sn', 100)->nullable();

      // Quantity, rate, unit, totals
      $table->decimal('ordered_qty', 12, 3);
      $table->decimal('max_rate', 12, 2);
      $table->decimal('line_total', 15, 2)->default(0);
      $table->string('unit', 20)->nullable();
      $table->foreignId('item_category_id')->nullable()->constrained('item_categories')->nullOnDelete();

      // Item category (optional)


      $table->timestamps();

      $table->index(['purchase_slip_id']);
    });
  }

  public function down(): void
  {
    Schema::dropIfExists('purchase_slip_items');
    Schema::table('purchase_slip_items', function (Blueprint $table) {
      $table->dropConstrainedForeignId('item_category_id');
    });
  }
};
</file>

<file path="database/migrations/2025_10_20_130421_create_purchase_items_table.php">
<?php

use Illuminate\Database\Migrations\Migration;
use Illuminate\Database\Schema\Blueprint;
use Illuminate\Support\Facades\Schema;

return new class extends Migration {
  public function up(): void {
    Schema::create('purchase_items', function (Blueprint $table) {
      $table->id();

      // Parent purchase
      $table->foreignId('purchase_id')
            ->constrained('purchases')
            ->cascadeOnDelete();

      // Category (required)
      $table->foreignId('item_category_id')
      ->nullable()
            ->constrained('item_categories')
            ->restrictOnDelete();

      // Optional link to products (if/when you use it)
      $table->foreignId('product_id')
            ->nullable()
            ->constrained('products')
            ->nullOnDelete();

      // Free-text item when product_id is null
      $table->string('temp_name')->nullable();
      $table->string('temp_sn', 100)->nullable();

      // Units / pricing
      $table->string('unit', 20)->nullable();
      $table->decimal('qty', 12, 3);
      $table->decimal('rate', 12, 2);

      // Optional per-line discount (either way you fill them)
      $table->decimal('discount_percent', 5, 2)->default(0);  // e.g. 5.00 = 5%
      $table->decimal('discount_amount', 12, 2)->default(0);  // absolute
$table->string('store_entry_sn')->nullable();
      $table->date('store_entry_date')->nullable();
      // Computed: (qty * rate) - discount_amount
      $table->decimal('line_subtotal', 15, 2)->default(0);

      $table->text('notes')->nullable();

      $table->timestamps();

      $table->index(['purchase_id']);
      $table->index(['item_category_id']);
      $table->index(['product_id']);
    });
  }

  public function down(): void {
    Schema::dropIfExists('purchase_items');
  }
};
</file>

<file path="database/migrations/2025_11_02_092000_create_store_entries_table.php">
<?php

use Illuminate\Database\Migrations\Migration;
use Illuminate\Database\Schema\Blueprint;
use Illuminate\Support\Facades\Schema;

return new class extends Migration {
    public function up(): void
    {
        Schema::create('store_entries', function (Blueprint $t) {
            $t->id();

            // link the purchase that was posted to store
            $t->foreignId('purchase_id')->constrained('purchases')->cascadeOnDelete();

            // supplier snapshot (optional FK + denormalized name)
            $t->foreignId('supplier_id')->nullable()->constrained('suppliers')->nullOnDelete();

            // header snapshot (keep types compatible with your 'purchases' table)
            $t->string('purchase_sn', 50);
            $t->string('purchase_date'); // purchases.purchase_date is string in your schema
            $t->string('supplier_name')->nullable();

            $t->string('remarks', 2000)->nullable();

            $t->timestamps();

            $t->index(['purchase_sn','purchase_date']);
        });
    }

    public function down(): void
    {
        Schema::dropIfExists('store_entries');
    }
};
</file>

<file path="database/migrations/2025_11_02_092214_create_store_entry_items_table.php">
<?php

use Illuminate\Database\Migrations\Migration;
use Illuminate\Database\Schema\Blueprint;
use Illuminate\Support\Facades\Schema;

return new class extends Migration {
    public function up(): void
    {
        Schema::create('store_entry_items', function (Blueprint $t) {
            $t->id();

            $t->foreignId('store_entry_id')->constrained('store_entries')->cascadeOnDelete();

            // link back to the exact purchase line that created it
            $t->foreignId('purchase_item_id')->nullable()->constrained('purchase_items')->nullOnDelete();

            // optional product link if you use products
            $t->foreignId('product_id')->nullable()->constrained('products')->nullOnDelete();

            // your existing taxonomies
            $t->foreignId('item_category_id')->nullable()->constrained('item_categories')->nullOnDelete();
            $t->foreignId('category_id')->nullable()->constrained('categories')->nullOnDelete(); // "product category"
            $t->foreignId('brand_id')->nullable()->constrained('brands')->nullOnDelete();

            // snapshots
            $t->string('item_name');        // from temp_name or product name
            $t->string('item_sn')->nullable();
            $t->string('unit', 20)->nullable();

            // qty/price
            $t->decimal('qty', 12, 3)->default(0);
            $t->decimal('rate', 12, 2)->default(0);
            $t->decimal('total_price', 14, 2)->default(0);

            $t->timestamps();

            $t->index(['store_entry_id']);
        });
    }

    public function down(): void
    {
        Schema::dropIfExists('store_entry_items');
    }
};
</file>

<file path="database/migrations/2025_11_14_013154_create_employees_table.php">
<?php

use Illuminate\Database\Migrations\Migration;
use Illuminate\Database\Schema\Blueprint;
use Illuminate\Support\Facades\Schema;

return new class extends Migration {
    public function up(): void
    {
        Schema::create('employees', function (Blueprint $table) {
            $table->id();
            $table->foreignId('department_id')->constrained()->cascadeOnUpdate()->restrictOnDelete();

            $table->string('full_name');
            $table->string('contact', 30)->nullable();
            $table->string('atten_no', 50)->nullable(); // Attendance/Invigilator number (free text)
            $table->string('email')->nullable()->unique(); // nullable but unique when present
            $table->string('password'); // admin sets first time
            $table->boolean('must_change_password')->default(true); // 1st login they must change
            $table->boolean('is_active')->default(true);

            $table->timestamps();
        });
    }

    public function down(): void
    {
        Schema::dropIfExists('employees');
    }
};
</file>

<file path="database/migrations/2025_11_14_041543_create_store_outs_table.php">
<?php

use Illuminate\Database\Migrations\Migration;
use Illuminate\Database\Schema\Blueprint;
use Illuminate\Support\Facades\Schema;

return new class extends Migration {
    public function up(): void
    {
        Schema::create('store_outs', function (Blueprint $t) {
            $t->id();

            // Who received the item
            $t->foreignId('employee_id')->constrained('employees')->cascadeOnDelete();

            // Optional: link back to a store entry header (if you want)
            $t->foreignId('store_entry_id')->nullable()->constrained('store_entries')->nullOnDelete();

            // Issue info
            $t->string('store_out_sn', 50);       // e.g. OUT-2079-001
            $t->string('store_out_date_bs', 10);  // BS date as string "YYYY-MM-DD"

            $t->string('remarks', 2000)->nullable();

            $t->timestamps();

            $t->index(['store_out_sn', 'store_out_date_bs']);
        });
    }

    public function down(): void
    {
        Schema::dropIfExists('store_outs');
    }
};
</file>

<file path="database/migrations/2025_11_14_041640_create_store_out_items_table.php">
<?php

use Illuminate\Database\Migrations\Migration;
use Illuminate\Database\Schema\Blueprint;
use Illuminate\Support\Facades\Schema;

return new class extends Migration {
    public function up(): void
    {
        Schema::create('store_out_items', function (Blueprint $t) {
            $t->id();

            $t->foreignId('store_out_id')->constrained('store_outs')->cascadeOnDelete();

            // From where this stock is coming (for traceability)
            $t->foreignId('store_entry_item_id')->nullable()->constrained('store_entry_items')->nullOnDelete();

            // Optional taxonomy for reporting
            $t->foreignId('item_category_id')->nullable()->constrained('item_categories')->nullOnDelete();
            $t->foreignId('category_id')->nullable()->constrained('categories')->nullOnDelete();
            $t->foreignId('brand_id')->nullable()->constrained('brands')->nullOnDelete();

            // Snapshots
            $t->string('item_name');
            $t->string('item_sn')->nullable();
            $t->string('unit', 20)->nullable();

            // Issued quantity
            $t->decimal('qty', 12, 3)->default(0);

            $t->timestamps();

            $t->index(['store_out_id']);
        });
    }

    public function down(): void
    {
        Schema::dropIfExists('store_out_items');
    }
};
</file>

<file path="database/seeders/AdminSeeder.php">
<?php

namespace Database\Seeders;

use Illuminate\Database\Seeder;
use App\Models\Admin;

class AdminSeeder extends Seeder
{
    public function run(): void
    {
        Admin::updateOrCreate(
            ['email' => 'sadanand@ioepc.edu.np'], // unique field
            [
                'name' => 'Sadanand Paneru',
                'password' => bcrypt('S@ddy9843'),
                'contact' => '9843521965',
            ]
        );
        Admin::updateOrCreate(
        ['email' => 'cit@ioepc.edu.np'], // unique field
        [
            'name' => 'Purwanchal Campus',
            'password' => bcrypt('Admin@ioepc123'),
            'contact' => '9843521965',
        ]
    );
    }
}
</file>

<file path="database/seeders/DatabaseSeeder.php">
<?php

namespace Database\Seeders;

// use Illuminate\Database\Console\Seeds\WithoutModelEvents;
use Illuminate\Database\Seeder;

class DatabaseSeeder extends Seeder
{
    /**
     * Seed the application's database.
     */
    public function run(): void
    {
        // \App\Models\User::factory(10)->create();

        // \App\Models\User::factory()->create([
        //     'name' => 'Test User',
        //     'email' => 'test@example.com',
        // ]);
 
    $this->call(AdminSeeder::class);

    }
}
</file>

<file path="database/.gitignore">
*.sqlite*
</file>

<file path="public/.htaccess">
<IfModule mod_rewrite.c>
    <IfModule mod_negotiation.c>
        Options -MultiViews -Indexes
    </IfModule>

    RewriteEngine On

    # Handle Authorization Header
    RewriteCond %{HTTP:Authorization} .
    RewriteRule .* - [E=HTTP_AUTHORIZATION:%{HTTP:Authorization}]

    # Redirect Trailing Slashes If Not A Folder...
    RewriteCond %{REQUEST_FILENAME} !-d
    RewriteCond %{REQUEST_URI} (.+)/$
    RewriteRule ^ %1 [L,R=301]

    # Send Requests To Front Controller...
    RewriteCond %{REQUEST_FILENAME} !-d
    RewriteCond %{REQUEST_FILENAME} !-f
    RewriteRule ^ index.php [L]
</IfModule>
</file>

<file path="public/bs-datepicker.js">
(function () {
  async function fetchMonth(y, m) {
    const res = await fetch(`/api/bs-month?year=${y}&month=${m}`);
    if (!res.ok) throw new Error('Failed to load month');
    return res.json();
  }

  async function bsToAd(y, m, d) {
    const res = await fetch(`/api/bs-to-ad?year=${y}&month=${m}&day=${d}`);
    if (!res.ok) throw new Error('Failed to convert');
    const j = await res.json();
    return j.result.ad;
  }

  async function adToBs(isoAd) {
    const res = await fetch(`/api/ad-to-bs?date=${isoAd}`);
    if (!res.ok) throw new Error('Failed to convert');
    const j = await res.json();
    return j.result.bs;
  }

  function clamp(v,a,b){ return Math.min(Math.max(v,a),b); }

  function buildMonthOptions(sel) {
    const names = ['à¤¬à¥ˆà¤¶à¤¾à¤–','à¤œà¥‡à¤ ','à¤…à¤¸à¤¾à¤°','à¤¶à¥à¤°à¤¾à¤µà¤£','à¤­à¤¦à¥Œ','à¤†à¤¶à¥à¤µà¤¿à¤¨','à¤•à¤¾à¤°à¥à¤¤à¤¿à¤•','à¤®à¤‚à¤¸à¤¿à¤°','à¤ªà¥Œà¤·','à¤®à¤¾à¤˜','à¤«à¤¾à¤²à¥à¤—à¥à¤¨','à¤šà¥ˆà¤¤à¥à¤°'];
    sel.innerHTML = '';
    names.forEach((n,i)=> {
      const op = document.createElement('option');
      op.value = String(i+1); op.textContent = n; sel.appendChild(op);
    });
  }

  function buildYearOptions(sel, startYear, endYear, current) {
    sel.innerHTML = '';
    for (let y=startYear; y<=endYear; y++) {
      const op = document.createElement('option');
      op.value = y; op.textContent = y;
      if (y===current) op.selected = true;
      sel.appendChild(op);
    }
  }

  async function initOne(wrapper) {
    const input = wrapper.querySelector('[data-bsdp]');
    const btn = wrapper.querySelector('[data-bsdp-toggle]');
    const popup = wrapper.querySelector('[data-bsdp-popup]');
    const grid = wrapper.querySelector('[data-bsdp-grid]');
    const yearSel = wrapper.querySelector('[data-bsdp-year]');
    const monthSel = wrapper.querySelector('[data-bsdp-month]');
    const prevBtn = wrapper.querySelector('[data-bsdp-prev]');
    const nextBtn = wrapper.querySelector('[data-bsdp-next]');
    const todayBtn = wrapper.querySelector('[data-bsdp-today]');
    const info = wrapper.querySelector('[data-bsdp-info]');
    const hiddenAd = wrapper.querySelector('[data-bsdp-ad]');

    const startYear = parseInt(input.dataset.startYear || '1970', 10);
    const endYear   = parseInt(input.dataset.endYear || '2100', 10);

    buildMonthOptions(monthSel);
    let curY, curM;

    async function setFromInputOrToday() {
      if (input.value && /^\d{4}-\d{2}-\d{2}$/.test(input.value)) {
        const [y,m] = input.value.split('-').map(n=>parseInt(n,10));
        curY = clamp(y,startYear,endYear);
        curM = clamp(m,1,12);
        await updateGrid(curY,curM);
      } else {
        const todayAd = new Date().toISOString().slice(0,10);
        const bs = await adToBs(todayAd);
        const [y,m,d] = bs.split('-').map(n=>parseInt(n,10));
        curY = clamp(y,startYear,endYear);
        curM = clamp(m,1,12);
        await updateGrid(curY,curM,d);
      }
    }

    async function updateGrid(y,m,highlightD=null) {
      buildYearOptions(yearSel,startYear,endYear,y);
      monthSel.value = String(m);

      const data = await fetchMonth(y,m);
      grid.innerHTML = '';

      data.weeks.forEach(week=>{
        const tr = document.createElement('tr');
        week.forEach(cell=>{
          const td = document.createElement('td');
          td.textContent = cell.bsD;
          td.classList.add('py-1');
          td.style.cursor = 'pointer';
          if (!cell.isCurrentMonth) td.classList.add('text-muted');
          if (highlightD && cell.isCurrentMonth && cell.bsD===highlightD) td.classList.add('table-primary');
          td.title = `AD ${cell.ad}`;
          td.addEventListener('click', async ()=>{
            const bsStr = `${String(cell.bsY).padStart(4,'0')}-${String(cell.bsM).padStart(2,'0')}-${String(cell.bsD).padStart(2,'0')}`;
            input.value = bsStr;
            const adStr = await bsToAd(cell.bsY, cell.bsM, cell.bsD);
            hiddenAd.value = adStr;
            info.textContent = `Selected: BS ${bsStr} (AD ${adStr})`;
            popup.classList.add('d-none');
            input.dispatchEvent(new Event('change'));
          });
          tr.appendChild(td);
        });
        grid.appendChild(tr);
      });
    }

    btn.addEventListener('click', async ()=>{
      if (popup.classList.contains('d-none')) {
        popup.classList.remove('d-none');
        await setFromInputOrToday();
      } else {
        popup.classList.add('d-none');
      }
    });

    yearSel.addEventListener('change', async ()=>{ curY=parseInt(yearSel.value,10); await updateGrid(curY,curM); });
    monthSel.addEventListener('change', async ()=>{ curM=parseInt(monthSel.value,10); await updateGrid(curY,curM); });

    prevBtn.addEventListener('click', async ()=>{
      curM--; if (curM<1){curM=12;curY=Math.max(startYear,curY-1);}
      await updateGrid(curY,curM);
    });
    nextBtn.addEventListener('click', async ()=>{
      curM++; if (curM>12){curM=1;curY=Math.min(endYear,curY+1);}
      await updateGrid(curY,curM);
    });
    todayBtn.addEventListener('click', async ()=>{
      const todayAd = new Date().toISOString().slice(0,10);
      const bs = await adToBs(todayAd);
      const [y,m,d] = bs.split('-').map(n=>parseInt(n,10));
      curY = clamp(y,startYear,endYear); curM = clamp(m,1,12);
      await updateGrid(curY,curM,d);
    });

    document.addEventListener('click', (e)=>{
      if (!wrapper.contains(e.target)) popup.classList.add('d-none');
    });

    // if pre-filled, compute hidden AD once
    if (input.value && /^\d{4}-\d{2}-\d{2}$/.test(input.value)) {
      const [y,m,d] = input.value.split('-').map(n=>parseInt(n,10));
      bsToAd(y,m,d).then(ad => hiddenAd.value = ad);
    }
  }

  function init() {
    document.querySelectorAll('[data-bsdp]').forEach(el=>{
      const wrapper = el.closest('.position-relative');
      if (wrapper) initOne(wrapper);
    });
  }

  if (document.readyState === 'loading') document.addEventListener('DOMContentLoaded', init);
  else init();
})();
</file>

<file path="public/index.php">
<?php

use Illuminate\Contracts\Http\Kernel;
use Illuminate\Http\Request;

define('LARAVEL_START', microtime(true));

/*
|--------------------------------------------------------------------------
| Check If The Application Is Under Maintenance
|--------------------------------------------------------------------------
|
| If the application is in maintenance / demo mode via the "down" command
| we will load this file so that any pre-rendered content can be shown
| instead of starting the framework, which could cause an exception.
|
*/

if (file_exists($maintenance = __DIR__.'/../storage/framework/maintenance.php')) {
    require $maintenance;
}

/*
|--------------------------------------------------------------------------
| Register The Auto Loader
|--------------------------------------------------------------------------
|
| Composer provides a convenient, automatically generated class loader for
| this application. We just need to utilize it! We'll simply require it
| into the script here so we don't need to manually load our classes.
|
*/

require __DIR__.'/../vendor/autoload.php';

/*
|--------------------------------------------------------------------------
| Run The Application
|--------------------------------------------------------------------------
|
| Once we have the application, we can handle the incoming request using
| the application's HTTP kernel. Then, we will send the response back
| to this client's browser, allowing them to enjoy our application.
|
*/

$app = require_once __DIR__.'/../bootstrap/app.php';

$kernel = $app->make(Kernel::class);

$response = $kernel->handle(
    $request = Request::capture()
)->send();

$kernel->terminate($request, $response);
</file>

<file path="public/robots.txt">
User-agent: *
Disallow:
</file>

<file path="resources/css/app.css">
@import 'tailwindcss';

@source '../../vendor/laravel/framework/src/Illuminate/Pagination/resources/views/*.blade.php';
@source '../../storage/framework/views/*.php';
@source '../**/*.blade.php';
@source '../**/*.js';
</file>

<file path="resources/js/app.js">
import './bootstrap';
</file>

<file path="resources/js/bootstrap.js">
/**
 * We'll load the axios HTTP library which allows us to easily issue requests
 * to our Laravel back-end. This library automatically handles sending the
 * CSRF token as a header based on the value of the "XSRF" token cookie.
 */

import axios from 'axios';
window.axios = axios;

window.axios.defaults.headers.common['X-Requested-With'] = 'XMLHttpRequest';

/**
 * Echo exposes an expressive API for subscribing to channels and listening
 * for events that are broadcast by Laravel. Echo and event broadcasting
 * allows your team to easily build robust real-time web applications.
 */

// import Echo from 'laravel-echo';

// import Pusher from 'pusher-js';
// window.Pusher = Pusher;

// window.Echo = new Echo({
//     broadcaster: 'pusher',
//     key: import.meta.env.VITE_PUSHER_APP_KEY,
//     cluster: import.meta.env.VITE_PUSHER_APP_CLUSTER ?? 'mt1',
//     wsHost: import.meta.env.VITE_PUSHER_HOST ? import.meta.env.VITE_PUSHER_HOST : `ws-${import.meta.env.VITE_PUSHER_APP_CLUSTER}.pusher.com`,
//     wsPort: import.meta.env.VITE_PUSHER_PORT ?? 80,
//     wssPort: import.meta.env.VITE_PUSHER_PORT ?? 443,
//     forceTLS: (import.meta.env.VITE_PUSHER_SCHEME ?? 'https') === 'https',
//     enabledTransports: ['ws', 'wss'],
// });
</file>

<file path="resources/views/Backend/brands/create.blade.php">
@extends('Backend.layouts.app')

@section('content')
<div class="max-w-6xl mx-auto px-4 py-8">
  {{-- Header --}}
  <div class="mb-6 flex flex-col sm:flex-row sm:items-center sm:justify-between gap-3">
    <div>
      <h1 class="text-2xl font-bold tracking-tight">Create Brand</h1>
      <p class="text-sm text-gray-500 mt-1">Add a new brand with an active/inactive status.</p>
    </div>
    <a href="{{ route('brands.index') }}"
       class="inline-flex items-center rounded-xl border border-gray-200 bg-white px-4 py-2.5 text-sm font-semibold text-gray-700 hover:bg-gray-50">
      â† Back to Brands
    </a>
  </div>

  {{-- Errors --}}
  @if ($errors->any())
    <div class="mb-4 rounded-xl border border-red-200 bg-red-50 px-4 py-3 text-red-800">
      <ul class="list-disc list-inside text-sm">
        @foreach ($errors->all() as $error)
          <li>{{ $error }}</li>
        @endforeach
      </ul>
    </div>
  @endif

  {{-- Form Card --}}
  <div class="rounded-2xl border border-gray-200 bg-white shadow-sm overflow-hidden">
    <div class="border-b bg-gray-50 px-5 py-4">
      <h2 class="text-sm font-semibold text-gray-700">Brand Information</h2>
    </div>

    <div class="px-5 py-6">
      <form action="{{ route('brands.store') }}" method="POST" class="space-y-6">
        @csrf

        {{-- Name Field --}}
        <div>
          <label for="name" class="block text-sm font-medium text-gray-700 mb-1">
            Brand Name <span class="text-red-500">*</span>
          </label>
          <input type="text" id="name" name="name" value="{{ old('name') }}"
                 class="w-full rounded-lg border border-gray-300 focus:border-gray-400 focus:ring-0 px-3 py-2"
                 placeholder="e.g., Samsung" required>
          @error('name')
            <p class="text-red-600 text-sm mt-1">{{ $message }}</p>
          @enderror
        </div>

        {{-- Active Toggle --}}
        <div class="flex items-center gap-2">
          <input type="checkbox" id="is_active" name="is_active" value="1" {{ old('is_active', true) ? 'checked' : '' }}
                 class="h-4 w-4 text-blue-600 border-gray-300 rounded focus:ring-blue-500">
          <label for="is_active" class="text-sm text-gray-700">Active</label>
        </div>

        {{-- Actions --}}
        <div class="flex flex-col sm:flex-row justify-end items-stretch sm:items-center gap-3 pt-2">
          <a href="{{ route('brands.index') }}"
             class="inline-flex justify-center rounded-xl border border-gray-200 bg-white px-5 py-2.5 text-sm font-semibold text-gray-700 hover:bg-gray-50">
            Cancel
          </a>
          <button type="submit"
                  class="inline-flex justify-center rounded-xl bg-gray-900 text-white px-5 py-2.5 text-sm font-semibold hover:bg-gray-800">
            Save Brand
          </button>
        </div>
      </form>
    </div>
  </div>
</div>
@endsection
</file>

<file path="resources/views/Backend/brands/edit.blade.php">
@extends('Backend.layouts.app')

@section('content')
<div class="max-w-6xl mx-auto px-4 py-8">
  {{-- Header --}}
  <div class="mb-6 flex flex-col sm:flex-row sm:items-center sm:justify-between gap-3">
    <div>
      <h1 class="text-2xl font-bold tracking-tight">Edit Brand</h1>
      <p class="text-sm text-gray-500 mt-1">Update the brand name and status.</p>
    </div>
    <a href="{{ route('brands.index') }}"
       class="inline-flex items-center rounded-xl border border-gray-200 bg-white px-4 py-2.5 text-sm font-semibold text-gray-700 hover:bg-gray-50">
      â† Back to Brands
    </a>
  </div>

  {{-- Errors --}}
  @if ($errors->any())
    <div class="mb-4 rounded-xl border border-red-200 bg-red-50 px-4 py-3 text-red-800">
      <ul class="list-disc list-inside text-sm">
        @foreach ($errors->all() as $error)
          <li>{{ $error }}</li>
        @endforeach
      </ul>
    </div>
  @endif

  {{-- Form Card --}}
  <div class="rounded-2xl border border-gray-200 bg-white shadow-sm overflow-hidden">
    <div class="border-b bg-gray-50 px-5 py-4">
      <h2 class="text-sm font-semibold text-gray-700">Brand Information</h2>
    </div>

    <div class="px-5 py-6">
      <form method="POST" action="{{ route('brands.update', $brand->id) }}" class="space-y-6">
        @csrf
        @method('PUT')

        {{-- Name --}}
        <div>
          <label for="name" class="block text-sm font-medium text-gray-700 mb-1">
            Brand Name <span class="text-red-500">*</span>
          </label>
          <input type="text" id="name" name="name"
                 value="{{ old('name', $brand->name) }}"
                 class="w-full rounded-lg border border-gray-300 focus:border-gray-400 focus:ring-0 px-3 py-2"
                 placeholder="e.g., Samsung" required>
          @error('name') <p class="text-red-600 text-sm mt-1">{{ $message }}</p> @enderror
        </div>

        {{-- Active --}}
        <div class="flex items-center gap-2">
          <input type="checkbox" id="is_active" name="is_active" value="1"
                 {{ old('is_active', $brand->is_active) ? 'checked' : '' }}
                 class="h-4 w-4 text-blue-600 border-gray-300 rounded focus:ring-blue-500">
          <label for="is_active" class="text-sm text-gray-700">Active</label>
        </div>

        {{-- Actions --}}
        <div class="flex flex-col sm:flex-row justify-end items-stretch sm:items-center gap-3 pt-2">
          <a href="{{ route('brands.index') }}"
             class="inline-flex justify-center rounded-xl border border-gray-200 bg-white px-5 py-2.5 text-sm font-semibold text-gray-700 hover:bg-gray-50">
            Cancel
          </a>
          <button type="submit"
                  class="inline-flex justify-center rounded-xl bg-gray-900 text-white px-5 py-2.5 text-sm font-semibold hover:bg-gray-800">
            Update Brand
          </button>
        </div>
      </form>
    </div>
  </div>
</div>
@endsection
</file>

<file path="resources/views/Backend/brands/index.blade.php">
@extends('Backend.layouts.app')

@section('content')
<div class="max-w-6xl mx-auto px-4 py-8">
  {{-- Header --}}
  <div class="mb-6 flex flex-col sm:flex-row sm:items-center sm:justify-between gap-3">
    <div>
      <h1 class="text-2xl font-bold tracking-tight">Brands</h1>
      <p class="text-sm text-gray-500 mt-1">Manage brand names and their status.</p>
    </div>
    <a href="{{ route('brands.create') }}"
       class="inline-flex items-center rounded-xl bg-gray-900 text-white px-4 py-2.5 text-sm font-semibold shadow hover:bg-gray-800 transition">
      + Add Brand
    </a>
  </div>

  {{-- Alerts --}}
  @if(session('success'))
    <div class="mb-4 rounded-xl border border-green-200 bg-green-50 px-4 py-3 text-green-800">
      {{ session('success') }}
    </div>
  @endif

  {{-- Search --}}
  <form method="GET" action="{{ route('brands.index') }}" class="mb-6">
    <div class="flex flex-col sm:flex-row gap-3 sm:items-center">
      <div class="flex-1 relative">
        <input type="text" name="search" value="{{ request('search') }}"
               class="w-full rounded-xl border border-gray-300 px-4 py-2.5 pr-10 text-sm focus:border-blue-400 focus:ring-1 focus:ring-blue-400"
               placeholder="Search brand name...">
        @if(request('search'))
          <a href="{{ route('brands.index') }}"
             class="absolute inset-y-0 right-3 flex items-center text-gray-400 hover:text-gray-600">
            <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none"
                 viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
              <path stroke-linecap="round" stroke-linejoin="round" d="M6 18L18 6M6 6l12 12"/>
            </svg>
          </a>
        @endif
      </div>
      <button type="submit"
              class="inline-flex items-center justify-center rounded-xl bg-blue-600 text-white px-5 py-2.5 text-sm font-medium hover:bg-blue-700 transition">
        <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 mr-2" fill="none"
             viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
          <path stroke-linecap="round" stroke-linejoin="round"
                d="M21 21l-4.35-4.35M10 18a8 8 0 100-16 8 8 0 000 16z"/>
        </svg>
        Search
      </button>
    </div>
  </form>

  {{-- Table Card --}}
  <div class="rounded-2xl border border-gray-200 bg-white shadow-sm overflow-hidden">
    <div class="border-b bg-gray-50 px-4 py-3 text-sm text-gray-600">
      Total: <span class="font-semibold">{{ $brands->total() }}</span>
    </div>

    <div class="overflow-x-auto">
      <table class="w-full text-left">
        <thead class="bg-gray-50 text-xs uppercase text-gray-600">
          <tr>
            <th class="px-4 py-3 w-16">S.N</th>
            <th class="px-4 py-3">Name</th>
            <th class="px-4 py-3">Status</th>
            <th class="px-4 py-3 text-right">Actions</th>
          </tr>
        </thead>
        <tbody class="divide-y divide-gray-100 bg-white">
          @forelse($brands as $row)
            <tr class="hover:bg-gray-50 transition">
              <td class="px-4 py-3">
                {{ $brands->firstItem() + $loop->index }}
              </td>
              <td class="px-4 py-3 font-medium text-gray-900">
                {{ $row->name }}
              </td>
              <td class="px-4 py-3">
                @php
                  $active = (bool) $row->is_active;
                  $badge = $active
                    ? 'bg-emerald-50 text-emerald-700 ring-1 ring-emerald-200'
                    : 'bg-red-50 text-red-700 ring-1 ring-red-200';
                @endphp
                <span class="inline-flex items-center rounded-full px-2.5 py-1 text-xs font-semibold {{ $badge }}">
                  {{ $active ? 'Active' : 'Inactive' }}
                </span>
              </td>
              <td class="px-4 py-3">
                <div class="flex justify-end gap-2">
                  <a href="{{ route('brands.edit', $row) }}"
                     class="inline-flex items-center rounded-lg border border-blue-200 bg-blue-50 px-3 py-1.5 text-xs font-semibold text-blue-700 hover:bg-blue-100">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 mr-1" viewBox="0 0 24 24" fill="currentColor">
                      <path d="M3 17.25V21h3.75L17.81 9.94l-3.75-3.75L3 17.25zm14.71-9.04a1.003 1.003 0 000-1.42l-2.5-2.5a1.003 1.003 0 00-1.42 0l-1.83 1.83 3.75 3.75 1.99-1.66z"/>
                    </svg>
                    Edit
                  </a>
                  <form action="{{ route('brands.destroy', $row) }}" method="POST"
                        onsubmit="return confirm('Delete this brand?')" class="inline">
                    @csrf @method('DELETE')
                    <button
                      class="inline-flex items-center rounded-lg border border-red-200 bg-red-50 px-3 py-1.5 text-xs font-semibold text-red-700 hover:bg-red-100">
                      <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 mr-1" viewBox="0 0 24 24" fill="currentColor">
                        <path d="M6 7h12l-1 13H7L6 7zm3-3h6l1 2H8l1-2z"/>
                      </svg>
                      Delete
                    </button>
                  </form>
                </div>
              </td>
            </tr>
          @empty
            <tr>
              <td colspan="4" class="px-4 py-6 text-center text-gray-500">No brands found.</td>
            </tr>
          @endforelse
        </tbody>
      </table>
    </div>

    {{-- Pagination --}}
    <div class="px-4 py-3 border-t bg-gray-50">
      {{ $brands->links('pagination::tailwind') }}
    </div>
  </div>
</div>
@endsection
</file>

<file path="resources/views/Backend/categories/create.blade.php">
@extends('Backend.layouts.app')

@section('content')
<div class="max-w-6xl mx-auto px-4 py-8">
  {{-- Header --}}
  <div class="mb-6 flex flex-col sm:flex-row sm:items-center sm:justify-between gap-3">
    <div>
      <h1 class="text-2xl font-bold tracking-tight">Create Category</h1>
      <p class="text-sm text-gray-500 mt-1">Add a new product category with active/inactive status.</p>
    </div>
    <a href="{{ route('product_categories.index') }}"
       class="inline-flex items-center rounded-xl border border-gray-200 bg-white px-4 py-2.5 text-sm font-semibold text-gray-700 hover:bg-gray-50">
      â† Back to Categories
    </a>
  </div>

  {{-- Errors --}}
  @if ($errors->any())
    <div class="mb-4 rounded-xl border border-red-200 bg-red-50 px-4 py-3 text-red-800">
      <ul class="list-disc list-inside text-sm">
        @foreach ($errors->all() as $error)
          <li>{{ $error }}</li>
        @endforeach
      </ul>
    </div>
  @endif

  {{-- Form Card --}}
  <div class="rounded-2xl border border-gray-200 bg-white shadow-sm overflow-hidden">
    <div class="border-b bg-gray-50 px-5 py-4">
      <h2 class="text-sm font-semibold text-gray-700">Category Information</h2>
    </div>

    <div class="px-5 py-6">
      <form action="{{ route('product_categories.store') }}" method="POST" class="space-y-6">
        @csrf

        {{-- Name Field --}}
        <div>
          <label for="name" class="block text-sm font-medium text-gray-700 mb-1">
            Category Name <span class="text-red-500">*</span>
          </label>
          <input type="text" id="name" name="name" value="{{ old('name') }}"
                 class="w-full rounded-lg border border-gray-300 focus:border-gray-400 focus:ring-0 px-3 py-2"
                 placeholder="e.g., Electronics" required>
          @error('name')
            <p class="text-red-600 text-sm mt-1">{{ $message }}</p>
          @enderror
        </div>

        {{-- Active Toggle --}}
        <div class="flex items-center gap-2">
          <input type="checkbox" id="is_active" name="is_active" value="1" {{ old('is_active', true) ? 'checked' : '' }}
                 class="h-4 w-4 text-blue-600 border-gray-300 rounded focus:ring-blue-500">
          <label for="is_active" class="text-sm text-gray-700">Active</label>
        </div>

        {{-- Actions --}}
        <div class="flex flex-col sm:flex-row justify-end items-stretch sm:items-center gap-3 pt-2">
          <a href="{{ route('product_categories.index') }}"
             class="inline-flex justify-center rounded-xl border border-gray-200 bg-white px-5 py-2.5 text-sm font-semibold text-gray-700 hover:bg-gray-50">
            Cancel
          </a>
          <button type="submit"
                  class="inline-flex justify-center rounded-xl bg-gray-900 text-white px-5 py-2.5 text-sm font-semibold hover:bg-gray-800">
            Save Category
          </button>
        </div>
      </form>
    </div>
  </div>
</div>
@endsection
</file>

<file path="resources/views/Backend/categories/edit.blade.php">
@extends('Backend.layouts.app')

@section('content')
<div class="max-w-6xl mx-auto px-4 py-8">
  {{-- Header --}}
  <div class="mb-6 flex flex-col sm:flex-row sm:items-center sm:justify-between gap-3">
    <div>
      <h1 class="text-2xl font-bold tracking-tight">Edit Category</h1>
      <p class="text-sm text-gray-500 mt-1">Update the category name and status.</p>
    </div>
    <a href="{{ route('product_categories.index') }}"
       class="inline-flex items-center rounded-xl border border-gray-200 bg-white px-4 py-2.5 text-sm font-semibold text-gray-700 hover:bg-gray-50">
      â† Back to Categories
    </a>
  </div>

  {{-- Errors --}}
  @if ($errors->any())
    <div class="mb-4 rounded-xl border border-red-200 bg-red-50 px-4 py-3 text-red-800">
      <ul class="list-disc list-inside text-sm">
        @foreach ($errors->all() as $error)
          <li>{{ $error }}</li>
        @endforeach
      </ul>
    </div>
  @endif

  {{-- Form Card --}}
  <div class="rounded-2xl border border-gray-200 bg-white shadow-sm overflow-hidden">
    <div class="border-b bg-gray-50 px-5 py-4">
      <h2 class="text-sm font-semibold text-gray-700">Category Information</h2>
    </div>

    <div class="px-5 py-6">
     <form method="POST" action="{{ route('product_categories.update', $category->id) }}" class="space-y-6">
    @csrf
    @method('PUT')

        {{-- Name --}}
        <div>
          <label for="name" class="block text-sm font-medium text-gray-700 mb-1">
            Category Name <span class="text-red-500">*</span>
          </label>
          <input type="text" id="name" name="name"
                 value="{{ old('name', $category->name) }}"
                 class="w-full rounded-lg border border-gray-300 focus:border-gray-400 focus:ring-0 px-3 py-2"
                 placeholder="e.g., Electronics" required>
          @error('name') <p class="text-red-600 text-sm mt-1">{{ $message }}</p> @enderror
        </div>

        {{-- Active --}}
        <div class="flex items-center gap-2">
          <input type="checkbox" id="is_active" name="is_active" value="1"
                 {{ old('is_active', $category->is_active) ? 'checked' : '' }}
                 class="h-4 w-4 text-blue-600 border-gray-300 rounded focus:ring-blue-500">
          <label for="is_active" class="text-sm text-gray-700">Active</label>
        </div>

        {{-- Actions --}}
        <div class="flex flex-col sm:flex-row justify-end items-stretch sm:items-center gap-3 pt-2">
          <a href="{{ route('product_categories.index') }}"
             class="inline-flex justify-center rounded-xl border border-gray-200 bg-white px-5 py-2.5 text-sm font-semibold text-gray-700 hover:bg-gray-50">
            Cancel
          </a>
          <button type="submit"
                  class="inline-flex justify-center rounded-xl bg-gray-900 text-white px-5 py-2.5 text-sm font-semibold hover:bg-gray-800">
            Update Category
          </button>
        </div>
      </form>
    </div>
  </div>
</div>
@endsection
</file>

<file path="resources/views/Backend/categories/index.blade.php">
@extends('Backend.layouts.app')

@section('content')
<div class="max-w-6xl mx-auto px-4 py-8">
  {{-- Header --}}
  <div class="mb-6 flex flex-col sm:flex-row sm:items-center sm:justify-between gap-3">
    <div>
      <h1 class="text-2xl font-bold tracking-tight">Product Categories</h1>
      <p class="text-sm text-gray-500 mt-1">Manage category names and status.</p>
    </div>
    <a href="{{ route('product_categories.create') }}"
       class="inline-flex items-center rounded-xl bg-gray-900 text-white px-4 py-2.5 text-sm font-semibold shadow hover:bg-gray-800">
      + Add Product Category
    </a>
  </div>

  {{-- Alerts --}}
  @if(session('success'))
    <div class="mb-4 rounded-xl border border-green-200 bg-green-50 px-4 py-3 text-green-800">
      {{ session('success') }}
    </div>
  @endif

  {{-- Search (optional) --}}
  <form method="GET" action="{{ route('product_categories.index') }}" class="mb-6">
    <div class="flex flex-col sm:flex-row gap-3 sm:items-center">
      <div class="flex-1 relative">
        <input type="text" name="search" value="{{ request('search') }}"
               class="w-full rounded-xl border border-gray-300 px-4 py-2.5 pr-10 text-sm focus:border-blue-400 focus:ring-1 focus:ring-blue-400"
               placeholder="Search category name...">
        @if(request('search'))
          <a href="{{ route('product_categories.index') }}"
             class="absolute inset-y-0 right-3 flex items-center text-gray-400 hover:text-gray-600">
            <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none"
                 viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
              <path stroke-linecap="round" stroke-linejoin="round" d="M6 18L18 6M6 6l12 12"/>
            </svg>
          </a>
        @endif
      </div>
      <button type="submit"
              class="inline-flex items-center justify-center rounded-xl bg-blue-600 text-white px-5 py-2.5 text-sm font-medium hover:bg-blue-700 transition">
        <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 mr-2" fill="none"
             viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
          <path stroke-linecap="round" stroke-linejoin="round"
                d="M21 21l-4.35-4.35M10 18a8 8 0 100-16 8 8 0 000 16z"/>
        </svg>
        Search
      </button>
    </div>
  </form>

  {{-- Table Card --}}
  <div class="rounded-2xl border border-gray-200 bg-white shadow-sm overflow-hidden">
    <div class="border-b bg-gray-50 px-4 py-3 text-sm text-gray-600">
      Total: <span class="font-semibold">{{ $categories->total() }}</span>
    </div>

    <div class="overflow-x-auto">
      <table class="w-full text-left">
        <thead class="bg-gray-50 text-xs uppercase text-gray-600">
          <tr>
            <th class="px-4 py-3 w-16">S.N</th>
            <th class="px-4 py-3">Name</th>
            <th class="px-4 py-3">Status</th>
            <th class="px-4 py-3 text-right">Actions</th>
          </tr>
        </thead>
        <tbody class="divide-y divide-gray-100 bg-white">
          @forelse($categories as $row)
            <tr class="hover:bg-gray-50 transition">
              <td class="px-4 py-3">
                {{ $categories->firstItem() + $loop->index }}
              </td>
              <td class="px-4 py-3 font-medium text-gray-900">
                {{ $row->name }}
              </td>
              <td class="px-4 py-3">
                @php
                  $active = (bool) $row->is_active;
                  $badge = $active
                    ? 'bg-emerald-50 text-emerald-700 ring-1 ring-emerald-200'
                    : 'bg-red-50 text-red-700 ring-1 ring-red-200';
                @endphp
                <span class="inline-flex items-center rounded-full px-2.5 py-1 text-xs font-semibold {{ $badge }}">
                  {{ $active ? 'Active' : 'Inactive' }}
                </span>
              </td>
              <td class="px-4 py-3">
                <div class="flex justify-end gap-2">
                  <a href="{{ route('product_categories.edit', $row) }}"
                     class="inline-flex items-center rounded-lg border border-blue-200 bg-blue-50 px-3 py-1.5 text-xs font-semibold text-blue-700 hover:bg-blue-100">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 mr-1" viewBox="0 0 24 24" fill="currentColor">
                      <path d="M3 17.25V21h3.75L17.81 9.94l-3.75-3.75L3 17.25zm14.71-9.04a1.003 1.003 0 000-1.42l-2.5-2.5a1.003 1.003 0 00-1.42 0l-1.83 1.83 3.75 3.75 1.99-1.66z"/>
                    </svg>
                    Edit
                  </a>
                  <form action="{{ route('product_categories.destroy', $row) }}" method="POST"
                        onsubmit="return confirm('Delete this category?')" class="inline">
                    @csrf @method('DELETE')
                    <button
                      class="inline-flex items-center rounded-lg border border-red-200 bg-red-50 px-3 py-1.5 text-xs font-semibold text-red-700 hover:bg-red-100">
                      <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 mr-1" viewBox="0 0 24 24" fill="currentColor">
                        <path d="M6 7h12l-1 13H7L6 7zm3-3h6l1 2H8l1-2z"/>
                      </svg>
                      Delete
                    </button>
                  </form>
                </div>
              </td>
            </tr>
          @empty
            <tr>
              <td colspan="4" class="px-4 py-6 text-center text-gray-500">No categories found.</td>
            </tr>
          @endforelse
        </tbody>
      </table>
    </div>

    {{-- Pagination --}}
    <div class="px-4 py-3 border-t bg-gray-50">
      {{ $categories->links('pagination::tailwind') }}
    </div>
  </div>
</div>
@endsection
</file>

<file path="resources/views/Backend/dashboard/index.blade.php">
@extends('Backend.layouts.app')

@section('content')
<section>
    <div class="container mx-auto p-4">
        <h1 class="text-3xl font-bold mb-6">Admin Dashboard</h1>
        <p>Welcome to your Admin  dashboard! Here you can manage your activities and view important information.</p>
    </div>
</section>


@endsection
</file>

<file path="resources/views/Backend/departments/index.blade.php">
@extends('Backend.layouts.app')

@section('content')
<div class="py-12">
  <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
    <div class="bg-white shadow-md rounded-2xl p-6">
      
      {{-- Header --}}
      <div class="flex justify-between items-center mb-6">
        <h2 class="text-2xl font-bold text-gray-800">Department List</h2>
      </div>

      {{-- Error Messages --}}
      @if ($errors->any())
        <div class="mb-4 rounded-lg border border-red-200 bg-red-50 p-4 text-red-700">
          <ul class="list-disc list-inside text-sm">
            @foreach ($errors->all() as $error)
              <li>{{ $error }}</li>
            @endforeach
          </ul>
        </div>
      @endif

      {{-- Success Message --}}
      @if (Session::has('message'))
        <div class="mb-4 rounded-lg border border-blue-200 bg-blue-50 p-4 text-blue-700">
          {{ Session::get('message') }}
        </div>
      @endif

      {{-- Table --}}
      <div class="overflow-x-auto">
        <table class="min-w-full divide-y divide-gray-200 text-sm">
          <thead class="bg-gray-100">
            <tr>
              <th class="px-4 py-2 text-left font-semibold text-gray-600">SN</th>
              <th class="px-4 py-2 text-left font-semibold text-gray-600">Name of Department</th>
              <th class="px-4 py-2 text-center font-semibold text-gray-600">Status</th>
              <th class="px-4 py-2 text-right font-semibold text-gray-600">Action</th>
            </tr>
          </thead>
          <tbody class="divide-y divide-gray-100">
            @foreach($department as $key => $department_)
              <tr class="hover:bg-gray-50 transition">
                <form method="POST" action="{{ route('department.update', $department_->id) }}">
                  @csrf
                  @method('PUT')
                  <input type="hidden" name="status" value="{{ $department_['status'] ? 1 : 0 }}">
                  <td class="px-4 py-2">{{ $key + 1 }}</td>

                  <td class="px-4 py-2">
                    <span id="label_{{ $key }}" class="text-gray-800">{{ $department_['name'] }}</span>
                    <input id="input_{{ $key }}" value="{{ $department_['name'] }}" 
                      class="hidden w-full border-gray-300 rounded-lg px-3 py-2 text-sm focus:border-gray-400 focus:ring-0" 
                      type="text" name="name" required placeholder="Enter Department Name">
                  </td>

                  <td class="px-4 py-2 text-center">
                    <button type="button" onclick="document.getElementById('submitStatus_{{ $key }}').submit()" 
                      class="p-2 rounded-full hover:bg-gray-100 transition">
                      @if($department_['status'] == 1)
                        <i class="fa fa-check-circle text-green-500 text-lg"></i>
                      @else
                        <i class="fa fa-times-circle text-red-500 text-lg"></i>
                      @endif
                    </button>
                  </td>

                  <td class="px-4 py-2 text-right">
                    <button type="button"
                      onclick="document.getElementById('label_{{ $key }}').classList.add('hidden'); 
                               document.getElementById('input_{{ $key }}').classList.remove('hidden'); 
                               document.getElementById('btn_{{ $key }}').classList.remove('hidden'); 
                               this.classList.add('hidden');"
                      class="inline-flex items-center px-3 py-1.5 bg-gray-200 hover:bg-gray-300 rounded-lg text-gray-700 text-sm font-medium">
                      <i class="fa fa-edit mr-2"></i> Edit
                    </button>

                    <button id="btn_{{ $key }}" type="submit"
                      class="hidden inline-flex items-center px-3 py-1.5 bg-green-600 hover:bg-green-700 text-white rounded-lg text-sm font-medium">
                      <i class="fa fa-save mr-2"></i> Save
                    </button>
                  </td>
                </form>

                {{-- Toggle Form --}}
                <form id="submitStatus_{{ $key }}" method="POST" action="{{ route('department.update', $department_->id) }}">
                  @csrf
                  @method('PUT')
                  <input type="hidden" name="name" value="{{ $department_['name'] }}">
                  <input type="hidden" name="status" value="{{ $department_['status'] ? 0 : 1 }}">
                </form>
              </tr>
            @endforeach

          {{-- Add New Row --}}
<tr class="bg-gray-50">
    <form method="POST" action="{{ route('department.store') }}">
        @csrf
        <td class="px-4 py-2 font-medium text-gray-700">{{ $department->count() + 1 }}</td>
        <td class="px-4 py-2">
            <input type="text" name="name" placeholder="Enter Department Name" required
                   class="w-full border-gray-300 rounded-lg px-3 py-2 text-sm focus:border-gray-400 focus:ring-0">
        </td>
        <td class="px-4 py-2 text-center">
            <i class="fa fa-check-circle text-green-500 text-lg"></i>
        </td>
        <td class="px-4 py-2 text-right">
            <button type="submit"
                    class="inline-flex items-center px-3 py-1.5 bg-blue-600 hover:bg-blue-700 text-white rounded-lg text-sm font-medium">
                <i class="fa fa-plus-circle mr-2"></i> Add
            </button>
        </td>
    </form>
</tr>

          </tbody>
    
        </table>
      </div>
    </div>
  </div>
</div>
@endsection
</file>

<file path="resources/views/Backend/employees/create.blade.php">
@extends('Backend.layouts.app')

@section('content')
<div class="max-w-3xl mx-auto px-4 py-8">
  <h1 class="text-2xl font-bold mb-6">Add Employee</h1>

  @if ($errors->any())
    <div class="mb-4 rounded-xl border border-red-200 bg-red-50 px-4 py-3 text-red-800">
      <ul class="list-disc list-inside text-sm">
        @foreach ($errors->all() as $e)<li>{{ $e }}</li>@endforeach
      </ul>
    </div>
  @endif

  <form method="POST" action="{{ route('employees.store') }}" class="space-y-4">
    @csrf

    <div>
      <label class="block text-sm mb-1">Department *</label>
      <select name="department_id" required class="w-full rounded-lg border px-3 py-2">
        <option value="">-- Select Department --</option>
        @foreach ($departments as $d)
          <option value="{{ $d->id }}" @selected(old('department_id')==$d->id)>{{ $d->name }}</option>
        @endforeach
      </select>
    </div>

    <div>
      <label class="block text-sm mb-1">Full Name *</label>
      <input name="full_name" value="{{ old('full_name') }}" required class="w-full rounded-lg border px-3 py-2">
    </div>

    <div class="grid grid-cols-1 sm:grid-cols-3 gap-3">
      <div>
        <label class="block text-sm mb-1">Contact</label>
        <input name="contact" value="{{ old('contact') }}" class="w-full rounded-lg border px-3 py-2">
      </div>
      <div>
        <label class="block text-sm mb-1">Atten No</label>
        <input name="atten_no" value="{{ old('atten_no') }}" class="w-full rounded-lg border px-3 py-2">
      </div>
      <div>
        <label class="block text-sm mb-1">Email (optional)</label>
        <input type="email" name="email" value="{{ old('email') }}" class="w-full rounded-lg border px-3 py-2">
      </div>
    </div>

    <div>
      <label class="block text-sm mb-1">Initial Password (first login will force change) *</label>
      <input type="password" name="password" required class="w-full rounded-lg border px-3 py-2">
    </div>

    <div class="flex items-center gap-3">
      <label class="text-sm">Active</label>
      <input type="checkbox" name="is_active" value="1" checked>
    </div>

    <div class="pt-2">
      <button class="rounded-xl bg-gray-900 text-white px-4 py-2.5 text-sm">Save</button>
      <a href="{{ route('employees.index') }}" class="ml-3 text-sm text-gray-600 hover:underline">Cancel</a>
    </div>
  </form>
</div>
@endsection
</file>

<file path="resources/views/Backend/employees/edit.blade.php">
@extends('Backend.layouts.app')

@section('content')
<div class="max-w-3xl mx-auto px-4 py-8">
  <h1 class="text-2xl font-bold mb-6">Edit Employee</h1>

  @if ($errors->any())
    <div class="mb-4 rounded-xl border border-red-200 bg-red-50 px-4 py-3 text-red-800">
      <ul class="list-disc list-inside text-sm">
        @foreach ($errors->all() as $e)<li>{{ $e }}</li>@endforeach
      </ul>
    </div>
  @endif

  <form method="POST" action="{{ route('employees.update',$employee) }}" class="space-y-4">
    @csrf @method('PUT')

    <div>
      <label class="block text-sm mb-1">Department *</label>
      <select name="department_id" required class="w-full rounded-lg border px-3 py-2">
        @foreach ($departments as $d)
          <option value="{{ $d->id }}" @selected(old('department_id',$employee->department_id)==$d->id)>{{ $d->name }}</option>
        @endforeach
      </select>
    </div>

    <div>
      <label class="block text-sm mb-1">Full Name *</label>
      <input name="full_name" value="{{ old('full_name',$employee->full_name) }}" required class="w-full rounded-lg border px-3 py-2">
    </div>

    <div class="grid grid-cols-1 sm:grid-cols-3 gap-3">
      <div>
        <label class="block text-sm mb-1">Contact</label>
        <input name="contact" value="{{ old('contact',$employee->contact) }}" class="w-full rounded-lg border px-3 py-2">
      </div>
      <div>
        <label class="block text-sm mb-1">Atten No</label>
        <input name="atten_no" value="{{ old('atten_no',$employee->atten_no) }}" class="w-full rounded-lg border px-3 py-2">
      </div>
      <div>
        <label class="block text-sm mb-1">Email (optional)</label>
        <input type="email" name="email" value="{{ old('email',$employee->email) }}" class="w-full rounded-lg border px-3 py-2">
      </div>
    </div>

    <div>
      <label class="block text-sm mb-1">Reset Password (optional)</label>
      <input type="password" name="password" class="w-full rounded-lg border px-3 py-2" placeholder="Leave blank to keep same">
      <p class="text-xs text-gray-500 mt-1">If you set a new password, the user will be forced to change it on next login.</p>
    </div>

    <div class="flex items-center gap-4">
      <label class="text-sm">Active</label>
      <input type="checkbox" name="is_active" value="1" @checked(old('is_active',$employee->is_active))>
      <label class="text-sm">Require password change</label>
      <input type="checkbox" name="must_change_password" value="1" @checked(old('must_change_password',$employee->must_change_password))>
    </div>

    <div class="pt-2">
      <button class="rounded-xl bg-gray-900 text-white px-4 py-2.5 text-sm">Update</button>
      <a href="{{ route('employees.index') }}" class="ml-3 text-sm text-gray-600 hover:underline">Cancel</a>
    </div>
  </form>
</div>
@endsection
</file>

<file path="resources/views/Backend/employees/index.blade.php">
@extends('Backend.layouts.app')

@section('content')
<div class="max-w-6xl mx-auto px-4 py-8">
  <div class="flex items-center justify-between mb-6">
    <h1 class="text-2xl font-bold">Employees</h1>
    <a href="{{ route('employees.create') }}" class="rounded-xl bg-gray-900 text-white px-4 py-2.5 text-sm">+ Add Employee</a>
  </div>

  @if (session('success'))
    <div class="mb-4 rounded-xl border border-green-200 bg-green-50 px-4 py-3 text-green-800">
      {{ session('success') }}
    </div>
  @endif

  <form method="GET" class="mb-4">
    <input type="text" name="search" value="{{ request('search') }}" placeholder="Search name/email/atten no"
           class="w-full sm:w-96 rounded-lg border px-3 py-2">
  </form>

  <div class="overflow-x-auto rounded-xl border">
    <table class="min-w-full text-sm">
      <thead class="bg-gray-50">
        <tr>
          <th class="px-3 py-2 text-left">#</th>
          <th class="px-3 py-2 text-left">Full Name</th>
          <th class="px-3 py-2 text-left">Department</th>
          <th class="px-3 py-2 text-left">Contact</th>
          <th class="px-3 py-2 text-left">Atten No</th>
          <th class="px-3 py-2 text-left">Email</th>
          <th class="px-3 py-2 text-left">Must Change?</th>
          <th class="px-3 py-2 text-left">Active</th>
          <th class="px-3 py-2"></th>
        </tr>
      </thead>
      <tbody>
        @foreach ($employees as $i => $e)
          <tr class="border-t">
            <td class="px-3 py-2">{{ $employees->firstItem() + $i }}</td>
            <td class="px-3 py-2">{{ $e->full_name }}</td>
            <td class="px-3 py-2">{{ $e->department->name ?? 'â€”' }}</td>
            <td class="px-3 py-2">{{ $e->contact ?? 'â€”' }}</td>
            <td class="px-3 py-2">{{ $e->atten_no ?? 'â€”' }}</td>
            <td class="px-3 py-2">{{ $e->email ?? 'â€”' }}</td>
            <td class="px-3 py-2">{{ $e->must_change_password ? 'Yes' : 'No' }}</td>
            <td class="px-3 py-2">{{ $e->is_active ? 'Yes' : 'No' }}</td>
            <td class="px-3 py-2 text-right">
              <a href="{{ route('employees.edit',$e) }}" class="text-blue-600 hover:underline mr-3">Edit</a>
              <form action="{{ route('employees.destroy',$e) }}" method="POST" class="inline"
                    onsubmit="return confirm('Delete this employee?')">
                @csrf @method('DELETE')
                <button class="text-red-600 hover:underline">Delete</button>
              </form>
            </td>
          </tr>
        @endforeach
      </tbody>
    </table>
  </div>

  <div class="mt-4">
    {{ $employees->links() }}
  </div>
</div>
@endsection
</file>

<file path="resources/views/Backend/items/create.blade.php">
@extends('Backend.layouts.app')

@section('content')
<div class="max-w-md mx-auto px-4 py-8">
  <h1 class="text-2xl font-semibold mb-6">Add Item Category</h1>

  <form method="POST" action="{{ route('categories.store') }}" class="space-y-5">
    @csrf

    <div>
      <label class="block text-sm font-medium mb-1">Category Name (English)</label>
      <input type="text" name="name_en" class="w-full rounded-lg border-gray-300 focus:border-gray-400 focus:ring-0" placeholder="Consumable" required>
    </div>

    <div>
      <label class="block text-sm font-medium mb-1">Category Name (Nepali)</label>
      <input type="text" name="name_np" class="w-full rounded-lg border-gray-300 focus:border-gray-400 focus:ring-0" placeholder="à¤¸à¤‚à¤šà¤²à¤¨ à¤¸à¤¾à¤®à¤—à¥à¤°à¥€">
    </div>

    <div class="flex gap-3">
      <button class="bg-gray-900 text-white px-4 py-2 rounded-lg">Save</button>
      <a href="{{ route('categories.index') }}" class="text-gray-600 hover:underline">Cancel</a>
    </div>
  </form>
</div>
@endsection
</file>

<file path="resources/views/Backend/items/edit.blade.php">
@extends('Backend.layouts.app')

@section('content')
<div class="max-w-md mx-auto px-4 py-8">
  <div class="mb-6">
    <h1 class="text-2xl font-bold">Edit Category</h1>
    <p class="text-sm text-gray-500">Update English and Nepali names.</p>
  </div>

  @if ($errors->any())
    <div class="mb-4 rounded-xl border border-red-200 bg-red-50 px-4 py-3 text-red-800">
      <ul class="list-disc list-inside text-sm">
        @foreach ($errors->all() as $error)
          <li>{{ $error }}</li>
        @endforeach
      </ul>
    </div>
  @endif

  <form method="POST" action="{{ route('categories.update', $category) }}"
        class="space-y-5 rounded-2xl border border-gray-200 bg-white p-5 shadow-sm">
    @csrf @method('PUT')

    <div>
      <label class="block text-sm font-medium mb-1">Category Name (English) <span class="text-red-500">*</span></label>
      <input type="text" name="name_en" value="{{ old('name_en', $category->name_en) }}"
             class="w-full rounded-lg border-gray-300 focus:border-gray-400 focus:ring-0" required>
    </div>

    <div>
      <label class="block text-sm font-medium mb-1">Category Name (Nepali)</label>
      <input type="text" name="name_np" value="{{ old('name_np', $category->name_np) }}"
             class="w-full rounded-lg border-gray-300 focus:border-gray-400 focus:ring-0" placeholder="à¤¸à¤‚à¤šà¤²à¤¨ à¤¸à¤¾à¤®à¤—à¥à¤°à¥€">
    </div>

    <div class="flex items-center gap-3">
      <button class="rounded-xl bg-gray-900 text-white px-4 py-2">Update</button>
      <a href="{{ route('categories.index') }}" class="text-gray-600 hover:underline">Cancel</a>
    </div>
  </form>
</div>
@endsection
</file>

<file path="resources/views/Backend/items/index.blade.php">
@extends('Backend.layouts.app')

@section('content')
<div class="max-w-6xl mx-auto px-4 py-8">
  <div class="mb-6 flex flex-col sm:flex-row sm:items-center sm:justify-between gap-3">
    <div>
      <h1 class="text-2xl font-bold tracking-tight">Item Categories</h1>
      <p class="text-sm text-gray-500 mt-1">Manage consumable / non-consumable / other (with Nepali labels).</p>
    </div>
    <a href="{{ route('categories.create') }}"
       class="inline-flex items-center gap-2 rounded-xl bg-gray-900 text-white px-4 py-2.5 text-sm font-semibold shadow hover:bg-gray-800">
      <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" viewBox="0 0 24 24" fill="currentColor"><path d="M12 5a1 1 0 011 1v5h5a1 1 0 110 2h-5v5a1 1 0 11-2 0v-5H6a1 1 0 110-2h5V6a1 1 0 011-1z"/></svg>
      Add Category
    </a>
  </div>

  @if(session('success'))
    <div class="mb-4 rounded-xl border border-green-200 bg-green-50 px-4 py-3 text-green-800">
      {{ session('success') }}
    </div>
  @endif

  <div class="rounded-2xl border border-gray-200 bg-white shadow-sm overflow-hidden">
    <div class="flex items-center justify-between border-b bg-gray-50 px-4 py-3">
      <div class="text-sm text-gray-600">
        Total:
        <span class="font-semibold">
          {{-- safe with paginator; if you later return a Collection, use count() --}}
          {{ method_exists($categories, 'total') ? $categories->total() : $categories->count() }}
        </span>
      </div>
      <div class="text-xs text-gray-500">Tip: Click a row to edit.</div>
    </div>

    <div class="overflow-x-auto">
      <table class="w-full text-left">
        <thead class="bg-gray-50 text-xs uppercase text-gray-600">
          <tr>
            <th class="px-4 py-3">English Name</th>
            <th class="px-4 py-3">Nepali Name</th>
            <th class="px-4 py-3">Badge</th>
            <th class="px-4 py-3 text-right">Actions</th>
          </tr>
        </thead>

        <tbody class="divide-y divide-gray-100">
          @forelse($categories as $cat)
            @php
              $badge = strtolower($cat->name_en ?? '');
              $badgeClasses = str_contains($badge, 'consum')
                ? 'bg-emerald-50 text-emerald-700 ring-1 ring-emerald-200'
                : (str_contains($badge, 'non')
                    ? 'bg-indigo-50 text-indigo-700 ring-1 ring-indigo-200'
                    : 'bg-gray-50 text-gray-700 ring-1 ring-gray-200');
            @endphp

            {{-- whole row clickable â†’ edit --}}
            <tr onclick="window.location='{{ route('categories.edit', $cat) }}'"
                class="group cursor-pointer bg-white hover:bg-gray-50 transition">
              <td class="px-4 py-3 font-medium text-gray-900">
                <span class="group-hover:underline">{{ $cat->name_en }}</span>
              </td>
              <td class="px-4 py-3 text-gray-800">{{ $cat->name_np }}</td>
              <td class="px-4 py-3">
                <span class="inline-flex items-center rounded-full px-2.5 py-1 text-xs font-medium {{ $badgeClasses }}">
                  {{ $cat->name_en }}
                </span>
              </td>
              <td class="px-4 py-3">
                <div class="flex items-center justify-end gap-2" onclick="event.stopPropagation()">
                  <a href="{{ route('categories.edit', $cat) }}"
                     class="inline-flex items-center rounded-lg border border-blue-200 bg-blue-50 px-3 py-1.5 text-xs font-semibold text-blue-700 hover:bg-blue-100"
                     title="Edit">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 mr-1" viewBox="0 0 24 24" fill="currentColor"><path d="M3 17.25V21h3.75L17.81 9.94l-3.75-3.75L3 17.25zm14.71-9.04a1.003 1.003 0 000-1.42l-2.5-2.5a1.003 1.003 0 00-1.42 0l-1.83 1.83 3.75 3.75 1.99-1.66z"/></svg>
                    Edit
                  </a>
                  <form action="{{ route('categories.destroy', $cat) }}" method="POST"
                        onsubmit="return confirm('Delete this category?')" class="inline">
                    @csrf @method('DELETE')
                    <button
                      class="inline-flex items-center rounded-lg border border-red-200 bg-red-50 px-3 py-1.5 text-xs font-semibold text-red-700 hover:bg-red-100"
                      title="Delete">
                      <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 mr-1" viewBox="0 0 24 24" fill="currentColor"><path d="M6 7h12l-1 13H7L6 7zm3-3h6l1 2H8l1-2z"/></svg>
                      Delete
                    </button>
                  </form>
                </div>
              </td>
            </tr>
          @empty
            <tr>
              <td class="px-4 py-6 text-gray-500" colspan="4">No categories yet.</td>
            </tr>
          @endforelse
        </tbody>
      </table>
    </div>

    @if(method_exists($categories, 'links'))
      <div class="px-4 py-3 border-t bg-gray-50">
        {{ $categories->links() }}
      </div>
    @endif
  </div>
</div>
@endsection
</file>

<file path="resources/views/Backend/layouts/app.blade.php">
@include('Backend.layouts.header')
<script defer src="https://cdn.jsdelivr.net/npm/alpinejs@3.x.x/dist/cdn.min.js"></script>

{{-- Page-level scripts pushed by views/components --}}
@stack('scripts')
</file>

<file path="resources/views/Backend/layouts/header.blade.php">
<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>@yield('title', 'Admin Dashboard ')</title>

    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css" />
    <script src="https://unpkg.com/alpinejs@3.x.x/dist/cdn.min.js" defer></script>
    <script src="{{asset('bs-datepicker.js')}}" ></script>
    @vite('resources/css/app.css')

</head>

<body class="antialiased bg-gray-50 text-gray-900">

    <!-- HEADER (fixed to screen sides) -->
    <header class="fixed inset-x-0 top-0 h-16 bg-white shadow-lg z-50">
        <div class="h-full px-4 md:px-6 flex items-center justify-between">
            <a href="{{ url('/') }}" class="flex items-center gap-2">
                <img src="{{ asset('asset/assets/ioe_logo.png') }}" class="h-10 w-auto" alt="Logo">
                <span class="text-lg md:text-xl font-bold text-blue-900"> STORE IOEPC</span>
            </a>

            <div class="flex items-center gap-2">
                @if (session('admin_id'))
                    <!-- Mobile sidebar toggle -->
                    <button id="sidebarToggle"
                        class="lg:hidden inline-flex items-center justify-center w-10 h-10 rounded-lg hover:bg-gray-100"
                        title="Menu">
                        <i class="fa-solid fa-bars text-lg"></i>
                    </button>

                    <!-- Notifications (optional) -->
                    <button class="relative p-2 text-gray-600 hover:text-gray-900 hidden sm:inline-flex">
                        <i class="fas fa-bell text-lg"></i>
                        <span
                            class="absolute -top-1 -right-1 bg-red-500 text-white text-[10px] rounded-full h-4 w-4 flex items-center justify-center">3</span>
                    </button>

                    <!-- Profile -->
                    <div class="relative">
                        <button id="profileDropdownBtn"
                            class="flex items-center gap-2 px-2 py-1 rounded-lg hover:bg-gray-100">
                            <div
                                class="w-8 h-8 rounded-full bg-blue-600 text-white flex items-center justify-center font-semibold">
                                {{ strtoupper(mb_substr($admin->name, 0, 1)) }}
                            </div>
                            <span class="hidden md:inline-block font-medium">{{ $admin->name }}</span>
                            <i class="fa-solid fa-chevron-down text-sm text-gray-500"></i>
                        </button>

                        <div id="profileDropdownMenu"
                            class="hidden absolute right-0 mt-2 w-48 bg-white rounded-md shadow-lg border border-gray-100 z-50">
                            <div class="px-4 py-2 text-sm text-gray-600 border-b">
                                Admin
                            </div>
                            <form method="POST" action="{{ route('logout') }}">
                                @csrf
                                <button type="submit"
                                    class="block w-full text-left px-4 py-2 text-sm text-gray-700 hover:bg-gray-100">
                                    Logout
                                </button>
                            </form>
                        </div>
                    </div>
                @else
                    <a href="{{ route('student.login.form') }}"
                        class="px-4 py-2 bg-blue-700 text-white rounded-lg hover:bg-blue-800 transition">
                        Login
                    </a>
                @endif
            </div>
        </div>
    </header>

    @if (session('admin_id'))
        <!-- SIDEBAR BACKDROP (mobile) -->
        <div id="sidebarBackdrop" class="hidden fixed inset-0 bg-black/30 z-40 lg:hidden"></div>

        <!-- SIDEBAR (fixed, aligned to screen sides; never under header) -->
        <aside id="sidebar"
            class="fixed left-0 top-16 w-64 h-[calc(100vh-4rem)] bg-gray-900 text-white z-50
                  transform -translate-x-full transition-transform duration-300
                  overflow-y-auto lg:translate-x-0">
            <nav class="py-4">
                <ul class="space-y-1 px-3 text-sm">
                    <li>
                        <a href="{{ route('admin.dashboard') }}"
                            class="flex items-center gap-3 px-3 py-2 rounded-lg hover:bg-gray-800">
                            <i class="fas fa-tachometer-alt w-5 text-gray-300"></i>
                            <span>Dashboard</span>
                        </a>
                    </li>
                    <li>
                        <a href="{{ route('suppliers.index') }}"
                            class="flex items-center gap-3 px-3 py-2 rounded-lg hover:bg-gray-800">
                            <i class="fa fa-bank w-5 text-gray-300"></i><span>Suppliers</span>
                        </a>
                    </li>
                    <li>
                        <a href="{{ route('categories.index') }}"
                            class="flex items-center gap-3 px-3 py-2 rounded-lg hover:bg-gray-800">
                            <i class="fa fa-list-alt text-gray-300" aria-hidden="true" ></i><span>Items Category</span>
                        </a>
                    </li>
                    <li>
                        <a href="{{ route('product_categories.index') }}"
                            class="flex items-center gap-3 px-3 py-2 rounded-lg hover:bg-gray-800">
                            <i class="fas fa-file-invoice w-5 text-gray-300"></i><span>Product Category</span>
                        </a>
                    </li>
                    <li>
                        <a href="{{ route('brands.index') }}"
                            class="flex items-center gap-3 px-3 py-2 rounded-lg hover:bg-gray-800">
                            <i class="fa fa-file w-5 text-gray-300"></i><span>Brand</span>
                        </a>
                    </li>
                    <li>
                        <a href="{{ route('department.index') }}"
                            class="flex items-center gap-3 px-3 py-2 rounded-lg hover:bg-gray-800">
                            <i class="fas fa-building  w-5 text-gray-300"></i><span>Departments</span>
                        </a>
                    </li>
                    <li>
                        <a href="{{ route('store.ledger') }}"
                            class="flex items-center gap-3 px-3 py-2 rounded-lg hover:bg-gray-800">
                           <i class="fas fa-drum-steelpan"></i><span>Product</span>
                        </a>
                    </li>

                         <li>
                        <a href="{{ route('slips.index') }}"
                            class="flex items-center gap-3 px-3 py-2 rounded-lg hover:bg-gray-800">
                            <i class=" fas fa-book text-gray-300"></i><span>à¤®à¤¾à¤— à¤«à¤¾à¤°à¤®</span>
                        </a>
                    </li>
                     <li>
                        <a href="{{ route('purchases.index') }}"
                            class="flex items-center gap-3 px-3 py-2 rounded-lg hover:bg-gray-800">
                            <i class="fa fa-file w-5 text-gray-300"></i><span>à¤¸à¥à¤Ÿà¥‹à¤° à¤ªà¥à¤°à¤¾à¤ªà¥à¤¤à¤¿</span>
                        </a>
                    </li>
                    <li>
                        <a href="{{ route('employees.index') }}" class="flex items-center gap-3 px-3 py-2 rounded-lg hover:bg-gray-800">
                            <i class="fas fa-cog w-5 text-gray-300"></i><span>Staff</span>
                        </a>
                    </li>

                    <li>
                        <a href="#settings" class="flex items-center gap-3 px-3 py-2 rounded-lg hover:bg-gray-800">
                            <i class="fas fa-cog w-5 text-gray-300"></i><span>Settings</span>
                        </a>
                    </li>
                </ul>
            </nav>
        </aside>
    @endif

    <!-- MAIN (never sits under header; only shifts when sidebar is present) -->
    <main class="pt-16 lg:ml-64 min-h-screen px-4 md:px-6">
        {{-- @if (session('success'))
            <div class="mb-4 rounded-lg bg-green-50 border border-green-200 text-green-800 px-4 py-3">
                {{ session('success') }}
            </div>
        @endif
        @if (session('error'))
            <div class="mb-4 rounded-lg bg-red-50 border border-red-200 text-red-800 px-4 py-3">
                {{ session('error') }}
            </div>
        @endif --}}

        @yield('content')
    </main>

    <script>
        // Profile dropdown
        const profileBtn = document.getElementById('profileDropdownBtn');
        const profileMenu = document.getElementById('profileDropdownMenu');
        if (profileBtn && profileMenu) {
            profileBtn.addEventListener('click', (e) => {
                e.stopPropagation();
                profileMenu.classList.toggle('hidden');
            });
            document.addEventListener('click', () => profileMenu.classList.add('hidden'));
        }

        // Sidebar toggle (mobile)
        const sidebar = document.getElementById('sidebar');
        const sidebarToggle = document.getElementById('sidebarToggle');
        const backdrop = document.getElementById('sidebarBackdrop');

        function openSidebar() {
            if (!sidebar) return;
            sidebar.classList.remove('-translate-x-full');
            if (backdrop) backdrop.classList.remove('hidden');
        }

        function closeSidebar() {
            if (!sidebar) return;
            sidebar.classList.add('-translate-x-full');
            if (backdrop) backdrop.classList.add('hidden');
        }

        if (sidebarToggle && sidebar) {
            sidebarToggle.addEventListener('click', openSidebar);
        }
        if (backdrop) {
            backdrop.addEventListener('click', closeSidebar);
        }
        // Close on Escape
        document.addEventListener('keydown', (e) => {
            if (e.key === 'Escape') closeSidebar();
        });

    </script>
    <script>
  (function () {
    function toMasked(value) {
      let d = (value || '').replace(/\D/g, '').slice(0, 8); // YYYYMMDD
      const y = d.slice(0,4), m = d.slice(4,6), day = d.slice(6,8);

      if (d.length === 0) return '';
      if (d.length < 4)   return d;
      if (d.length === 4) return y + '-';
      if (d.length < 6)   return y + '-' + m;
      if (d.length === 6) return y + '-' + m + '-';
      return y + '-' + m + '-' + day;
    }

    function attachMask(el) {
      el.addEventListener('keypress', e => { if (!/[0-9]/.test(e.key)) e.preventDefault(); });
      el.addEventListener('input', () => {
        const masked = toMasked(el.value);
        if (el.value !== masked) el.value = masked;
        const len = el.value.length;
        el.setSelectionRange(len, len);
      });
      el.addEventListener('blur', () => { el.value = toMasked(el.value); });
    }

    document.addEventListener('DOMContentLoaded', () => {
      document.querySelectorAll('.date-mask').forEach(attachMask);
    });
  })();
</script>
</body>

</html>
</file>

<file path="resources/views/Backend/products/_form.blade.php">
{{-- resources/views/backend/products/_form.blade.php --}}
<div class="grid grid-cols-1 sm:grid-cols-2 gap-5">
  <div>
    <label class="block text-sm font-medium mb-1">Name *</label>
    <input name="name" value="{{ old('name', $product->name ?? '') }}" required
           class="w-full rounded-lg border-gray-300 focus:border-gray-400 focus:ring-0 px-3 py-2">
  </div>
  <div>
    <label class="block text-sm font-medium mb-1">SKU *</label>
    <input name="sku" value="{{ old('sku', $product->sku ?? '') }}" required
           class="w-full rounded-lg border-gray-300 focus:border-gray-400 focus:ring-0 px-3 py-2">
  </div>

  <div>
    <label class="block text-sm font-medium mb-1">Item Category</label>
    <select name="item_category_id" class="w-full rounded-lg border-gray-300 focus:border-gray-400 focus:ring-0 px-3 py-2">
      <option value="">-- Select --</option>
      @foreach($itemCategories as $c)
        <option value="{{ $c->id }}" @selected(old('item_category_id', $product->item_category_id ?? null) == $c->id)>{{ $c->name_en }} @if($c->name_np) ({{ $c->name_np }}) @endif</option>
      @endforeach
    </select>
  </div>

  <div>
    <label class="block text-sm font-medium mb-1">Product Category</label>
    <select name="product_category_id" class="w-full rounded-lg border-gray-300 focus:border-gray-400 focus:ring-0 px-3 py-2">
      <option value="">-- Select --</option>
      @foreach($productCategories as $c)
        <option value="{{ $c->id }}" @selected(old('product_category_id', $product->product_category_id ?? null) == $c->id)>{{ $c->name }}</option>
      @endforeach
    </select>
  </div>

  <div>
    <label class="block text-sm font-medium mb-1">Brand</label>
    <select name="brand_id" class="w-full rounded-lg border-gray-300 focus:border-gray-400 focus:ring-0 px-3 py-2">
      <option value="">-- Select --</option>
      @foreach($brands as $b)
        <option value="{{ $b->id }}" @selected(old('brand_id', $product->brand_id ?? null) == $b->id)>{{ $b->name }}</option>
      @endforeach
    </select>
  </div>

  <div>
    <label class="block text-sm font-medium mb-1">Unit *</label>
    <input name="unit" value="{{ old('unit', $product->unit ?? 'pcs') }}" required
           class="w-full rounded-lg border-gray-300 focus:border-gray-400 focus:ring-0 px-3 py-2">
  </div>

  <div>
    <label class="block text-sm font-medium mb-1">Reorder Level</label>
    <input type="number" min="0" name="reorder_level" value="{{ old('reorder_level', $product->reorder_level ?? 0) }}"
           class="w-full rounded-lg border-gray-300 focus:border-gray-400 focus:ring-0 px-3 py-2">
  </div>

  <div class="sm:col-span-2">
    <label class="block text-sm font-medium mb-1">Image</label>
    <input type="file" name="image" accept="image/*"
           class="block w-full rounded-lg border-gray-300 focus:border-gray-400 focus:ring-0 px-3 py-2">
    @isset($product)
      @if($product->imageUrl())
        <img src="{{ $product->imageUrl() }}" class="mt-2 h-24 rounded-md border">
      @endif
    @endisset
  </div>

  <div class="sm:col-span-2 flex items-center gap-2">
    <input type="checkbox" id="is_active" name="is_active" value="1"
           {{ old('is_active', $product->is_active ?? true) ? 'checked' : '' }}
           class="h-4 w-4 text-blue-600 border-gray-300 rounded">
    <label for="is_active" class="text-sm">Active</label>
  </div>
</div>

<div class="flex flex-col sm:flex-row justify-end gap-3 pt-4">
  <a href="{{ route('products.index') }}" class="rounded-xl border border-gray-200 bg-white px-5 py-2.5 text-sm font-semibold text-gray-700 hover:bg-gray-50">Cancel</a>
  <button class="rounded-xl bg-gray-900 text-white px-5 py-2.5 text-sm font-semibold hover:bg-gray-800">
    {{ isset($product) ? 'Update Product' : 'Save Product' }}
  </button>
</div>
</file>

<file path="resources/views/Backend/products/create.blade.php">
@extends('Backend.layouts.app')

@section('content')
<div class="max-w-6xl mx-auto px-4 py-8">
  <div class="mb-6 flex items-center justify-between">
    <h1 class="text-2xl font-bold">Add Product</h1>
    <a href="{{ route('products.index') }}" class="rounded-xl border border-gray-200 bg-white px-4 py-2.5 text-sm font-semibold text-gray-700 hover:bg-gray-50">â† Back</a>
  </div>

  @if ($errors->any())
    <div class="mb-4 rounded-xl border border-red-200 bg-red-50 px-4 py-3 text-red-800">
      <ul class="list-disc list-inside text-sm">@foreach ($errors->all() as $e)<li>{{ $e }}</li>@endforeach</ul>
    </div>
  @endif

  <div class="rounded-2xl border border-gray-200 bg-white shadow-sm overflow-hidden">
    <div class="border-b bg-gray-50 px-5 py-4"><h2 class="text-sm font-semibold text-gray-700">Product Information</h2></div>
    <div class="px-5 py-6">
      <form method="POST" action="{{ route('products.store') }}" enctype="multipart/form-data" class="space-y-6">
        @csrf
        @include('backend.products._form')
      </form>
    </div>
  </div>
</div>
@endsection
</file>

<file path="resources/views/Backend/products/edit.blade.php">
@extends('Backend.layouts.app')

@section('content')
<div class="max-w-6xl mx-auto px-4 py-8">
  <div class="mb-6 flex items-center justify-between">
    <h1 class="text-2xl font-bold">Edit Product</h1>
    <a href="{{ route('products.index') }}" class="rounded-xl border border-gray-200 bg-white px-4 py-2.5 text-sm font-semibold text-gray-700 hover:bg-gray-50">â† Back</a>
  </div>

  @if ($errors->any())
    <div class="mb-4 rounded-xl border border-red-200 bg-red-50 px-4 py-3 text-red-800">
      <ul class="list-disc list-inside text-sm">@foreach ($errors->all() as $e)<li>{{ $e }}</li>@endforeach</ul>
    </div>
  @endif

  <div class="rounded-2xl border border-gray-200 bg-white shadow-sm overflow-hidden">
    <div class="border-b bg-gray-50 px-5 py-4"><h2 class="text-sm font-semibold text-gray-700">Product Information</h2></div>
    <div class="px-5 py-6">
      <form method="POST" action="{{ route('products.update', $product) }}" enctype="multipart/form-data" class="space-y-6">
        @csrf @method('PUT')
        @include('backend.products._form', ['product' => $product])
      </form>
    </div>
  </div>
</div>
@endsection
</file>

<file path="resources/views/Backend/products/index.blade.php">
@extends('Backend.layouts.app')

@section('content')
<div class="max-w-6xl mx-auto px-4 py-8">
  <div class="mb-6 flex flex-col sm:flex-row sm:items-center sm:justify-between gap-3">
    <h1 class="text-2xl font-bold">Products</h1>
    <a href="{{ route('products.create') }}"
       class="inline-flex items-center rounded-xl bg-gray-900 text-white px-4 py-2.5 text-sm font-semibold hover:bg-gray-800">
      + Add Product
    </a>
  </div>

  <form method="GET" action="{{ route('products.index') }}" class="mb-6">
    <div class="flex flex-col sm:flex-row gap-3 sm:items-center">
      <input type="text" name="search" value="{{ request('search') }}"
             class="w-full rounded-xl border border-gray-300 px-4 py-2.5 text-sm focus:border-blue-400 focus:ring-1 focus:ring-blue-400"
             placeholder="Search by name or SKU...">
      <button class="rounded-xl bg-blue-600 text-white px-5 py-2.5 text-sm hover:bg-blue-700">Search</button>
    </div>
  </form>

  <div class="rounded-2xl border border-gray-200 bg-white shadow-sm overflow-hidden">
    <table class="w-full text-left">
      <thead class="bg-gray-50 text-xs uppercase text-gray-600">
        <tr>
          <th class="px-4 py-3 w-16">S.N</th>
          <th class="px-4 py-3">Image</th>
          <th class="px-4 py-3">Name (SKU)</th>
          <th class="px-4 py-3">Category / Brand</th>
          <th class="px-4 py-3">Unit</th>
          <th class="px-4 py-3">Stock</th>
          <th class="px-4 py-3 text-right">Actions</th>
        </tr>
      </thead>
      <tbody class="divide-y divide-gray-100">
        @php $sn = ($products->currentPage() - 1) * $products->perPage() + 1; @endphp
        @forelse($products as $p)
          @php
            // If you used withSum in controller:
            $stock = (float)($p->qty_in ?? 0) - (float)($p->qty_out ?? 0);
          @endphp
          <tr class="hover:bg-gray-50">
            <td class="px-4 py-3">{{ $sn++ }}</td>
            <td class="px-4 py-3">
              @if($p->imageUrl())
                <img src="{{ $p->imageUrl() }}" class="h-10 w-10 rounded object-cover border">
              @else
                <div class="h-10 w-10 rounded border bg-gray-50"></div>
              @endif
            </td>
            <td class="px-4 py-3">
              <div class="font-medium text-gray-900">{{ $p->name }}</div>
              <div class="text-xs text-gray-500">{{ $p->sku }}</div>
            </td>
            <td class="px-4 py-3 text-gray-700">
              <div>{{ $p->productCategory->name ?? 'â€”' }}</div>
              <div class="text-xs text-gray-500">{{ $p->brand->name ?? 'â€”' }}</div>
            </td>
            <td class="px-4 py-3">{{ $p->unit }}</td>
            <td class="px-4 py-3">{{ number_format($stock, 3) }}</td>
            <td class="px-4 py-3 text-right space-x-2">
              <a href="{{ route('products.edit', $p) }}" class="text-blue-600 hover:underline text-sm">Edit</a>
              <form action="{{ route('products.destroy', $p) }}" method="POST" class="inline" onsubmit="return confirm('Delete product?')">
                @csrf @method('DELETE')
                <button class="text-red-600 hover:underline text-sm">Delete</button>
              </form>
            </td>
          </tr>
        @empty
          <tr><td colspan="7" class="px-4 py-6 text-center text-gray-500">No products found.</td></tr>
        @endforelse
      </tbody>
    </table>
    <div class="px-4 py-3 border-t bg-gray-50">
      {{ $products->links() }}
    </div>
  </div>
</div>
@endsection
</file>

<file path="resources/views/Backend/purchases/create.blade.php">
{{-- resources/views/backend/purchases/create.blade.php --}}
@extends('Backend.layouts.app')

@section('content')
@php
  /** @var \App\Models\PurchaseSlip $slip */
  $slipDate = $slip->po_date?->toDateString();
@endphp

<div class="max-w-6xl mx-auto px-4 py-8">
  <div class="mb-6 flex items-center justify-between">
    <h1 class="text-2xl font-bold">à¤¸à¥à¤Ÿà¥‹à¤° à¤ªà¥à¤°à¤¾à¤ªà¥à¤¤à¤¿ à¤¤à¤¯à¤¾à¤° à¤—à¤°à¥à¤¨à¥à¤¹à¥‹à¤¸ </h1>
    <a href="{{ route('purchases.index') }}"
       class="rounded-xl border border-gray-200 bg-white px-4 py-2.5 text-sm font-semibold text-gray-700 hover:bg-gray-50">â† à¤¸à¥à¤Ÿà¥‹à¤° à¤ªà¥à¤°à¤¾à¤ªà¥à¤¤à¤¿</a>
  </div>

  @if ($errors->any())
    <div class="mb-4 rounded-2xl border border-red-200 bg-red-50 px-4 py-3 text-red-800">
      <ul class="list-disc list-inside text-sm">
        @foreach ($errors->all() as $e)
          <li>{{ $e }}</li>
        @endforeach
      </ul>
    </div>
  @endif

  <div class="rounded-2xl border border-gray-200 bg-white shadow-sm overflow-hidden"
       x-data="purchaseForm(@json($slip), @json(old('tax_mode','PAN')), @json(old('vat_percent', 13)))">
    <div class="border-b bg-gray-50 px-5 py-4">
      <h2 class="text-sm font-semibold text-gray-700">à¤–à¤°à¤¿à¤¦ à¤µà¤¿à¤µà¤°à¤£ </h2>
    </div>

    <div class="px-5 py-6">
      <form method="POST" action="{{ route('purchases.store') }}" class="space-y-6" id="purchase-form">
        @csrf
        <input type="hidden" name="purchase_slip_id" value="{{ $slip->id }}">

        {{-- Header fields --}}
        <div class="grid grid-cols-1 sm:grid-cols-4 gap-5">
          <div>
            <label class="block text-sm font-medium mb-1">à¤–à¤°à¤¿à¤¦ à¤®à¤¾à¤— à¤«à¤¾à¤°à¤® à¤¨à¤‚  *</label>
            <input name="purchase_sn" value="{{ $slip->po_sn }}" required
                   class="w-full rounded-lg border border-gray-300 focus:border-gray-400 focus:ring-0 px-3 py-2" readonly>
          </div>
          <div>
            <label class="block text-sm font-medium mb-1">à¤¸à¥à¤Ÿà¥‹à¤° à¤ªà¥à¤°à¤¾à¤ªà¥à¤¤à¤¿ à¤¨à¤‚  *</label>
            <input name="purchase_sn" value="{{ old('purchase_sn') }}" required
                   class="w-full rounded-lg border border-gray-300 focus:border-gray-400 focus:ring-0 px-3 py-2">
          </div>

          <div>
            <label class="block text-sm font-medium mb-1">à¤¸à¥à¤Ÿà¥‹à¤° à¤ªà¥à¤°à¤¾à¤ªà¥à¤¤à¤¿ à¤®à¤¿à¤¤à¤¿ * (BS)</label>
            <input
              type="text"
              name="purchase_date"
              value="{{ old('purchase_date') }}"
              class="w-full rounded-lg border border-gray-300 focus:border-gray-400 focus:ring-0 px-3 py-2 date-mask"
              placeholder="YYYY-MM-DD"
              inputmode="numeric"
              maxlength="10"
              pattern="\d{4}-\d{2}-\d{2}"
              autocomplete="off"
              title="Use format YYYY-MM-DD"
              data-slip-date="{{ $slipDate }}"
            >
            <div class="text-[11px] text-gray-500 mt-1">Must be on/after Slip Date: {{ $slipDate }}</div>
          </div>
           <div>
            <label class="block text-sm font-medium mb-1">à¤¬à¤¿à¤² à¤¨à¤‚ *</label>
            <input name="bill_no" value="{{ old('bill_no')}}" required
                   class="w-full rounded-lg border border-gray-300 focus:border-gray-400 focus:ring-0 px-3 py-2">
          </div>
</div> <div class="grid grid-cols-1 sm:grid-cols-3 gap-5">
          <div>
            <label class="block text-sm font-medium mb-1">à¤¸à¤ªà¥à¤²à¤¾à¤¯à¤°à¥à¤¸ *</label>
            <select name="supplier_id" required class="w-full rounded-lg border border-gray-300 focus:border-gray-400 focus:ring-0 px-3 py-2">
              <option value="">-- Select Supplier --</option>
              @foreach ($suppliers as $s)
                <option value="{{ $s->id }}" @selected(old('supplier_id') == $s->id)>{{ $s->name }} {{ $s->pan ? "({$s->pan})" : '' }}</option>
              @endforeach
            </select>
          </div>

          <div>
            <label class="block text-sm font-medium mb-1">à¤¬à¤¿à¤­à¤¾à¤— </label>
            <select name="department_id" class="w-full rounded-lg border border-gray-300 focus:border-gray-400 focus:ring-0 px-3 py-2">
              <option value="">-- Select Department --</option>
              @foreach ($departments as $d)
                <option value="{{ $d->id }}" @selected(old('department_id', $slip->department_id) == $d->id)>{{ $d->name }}</option>
              @endforeach
            </select>
          </div>

          <div>
            <label class="block text-sm font-medium mb-1">Tax Mode</label>
            <select name="tax_mode" x-model="taxMode" class="w-full rounded-lg border border-gray-300 focus:border-gray-400 focus:ring-0 px-3 py-2">
              <option value="PAN" @selected(old('tax_mode') === 'PAN')>PAN</option>
              <option value="VAT" @selected(old('tax_mode') === 'VAT')>VAT</option>
            </select>
          </div>

          <div x-show="taxMode==='VAT'">
            <label class="block text-sm font-medium mb-1">VAT %</label>
            <input type="number" step="0.01" min="0" max="100" name="vat_percent"
                   x-model.number="vatPercent" value="{{ old('vat_percent', 13) }}"
                   class="w-full rounded-lg border border-gray-300 focus:border-gray-400 focus:ring-0 px-3 py-2">
          </div>
        </div>

        {{-- ITEMS from Slip with editable name --}}
        <div class="pt-2">
          <label class="block text-sm font-semibold mb-2">
            Items from Purchase Slip: {{ $slip->po_sn }}
          </label>

          <div id="itemsWrap" class="space-y-3">
            @foreach ($slip->items as $i => $it)
              @php
                $purchased = \App\Models\PurchaseItem::where('product_id', $it->product_id)
                    ->whereHas('purchase', fn($q) => $q->where('purchase_slip_id', $slip->id))
                    ->sum('qty');
                $remaining = max(0, (float) $it->ordered_qty - (float) $purchased);
                $displayName = $it->temp_name ?: ($it->product?->name ?? 'Product #'.$it->product_id);
              @endphp

              <div class="grid grid-cols-1 sm:grid-cols-12 gap-2 sm:gap-3 p-3 border rounded-xl item-row"
                   x-data="{ qty: 0, rate: 0 }"
                   x-init="$watch('qty', () => $dispatch('recalc')); $watch('rate', () => $dispatch('recalc'));">
                {{-- Keep linkage to Slip/Product for server checks --}}
                <input type="hidden" name="items[{{ $i }}][product_id]" value="{{ $it->product_id }}">

                {{-- Editable display name --}}
                <div class="sm:col-span-4">
                  <label class="block text-xs text-gray-600 mb-1">Item Name (editable)</label>
                  <input name="items[{{ $i }}][name]" type="text"
                         value="{{ old("items.$i.name", $displayName) }}"
                         class="w-full rounded-lg border border-gray-300 focus:border-gray-400 focus:ring-0 px-3 py-2">
                  <div class="text-[11px] text-gray-500 mt-1">
                    Unit: {{ $it->unit ?? ($it->product->unit ?? 'â€”') }}
                    @if($it->product?->sku)
                      â€¢ SKU: {{ $it->product->sku }}
                    @endif
                  </div>
                </div>
                
                <input type="hidden" name="items[{{ $i }}][unit]" value="{{ $it->unit }}">

                {{-- Quantity --}}
                <div class="sm:col-span-3">
                  <label class="block text-xs text-gray-600 mb-1">Quantity *({{ $it->unit }})</label>
                  <input name="items[{{ $i }}][qty]" type="number" step="0.001" min="0.001"
                         max="{{ $remaining }}"
                         @input="qty = +$event.target.value"
                         class="w-full rounded-lg border border-gray-300 focus:border-gray-400 focus:ring-0 px-3 py-2"
                         placeholder="Qty â‰¤ {{ $remaining }}"
                         {{ $remaining > 0 ? 'required' : 'disabled' }}>
                  <div class="text-[11px] text-gray-500 mt-1">Remaining: {{ number_format($remaining, 3) }}</div>
                </div>

                {{-- Rate --}}
                <div class="sm:col-span-3">
                  <label class="block text-xs text-gray-600 mb-1">Rate *</label>
                  <input name="items[{{ $i }}][rate]" type="number" step="0.01" min="0"
                         max="{{ $it->max_rate }}"
                         @input="rate = +$event.target.value"
                         class="w-full rounded-lg border border-gray-300 focus:border-gray-400 focus:ring-0 px-3 py-2"
                         placeholder="Rate â‰¤ {{ $it->max_rate }}"
                         {{ $remaining > 0 ? 'required' : 'disabled' }}>
                  <div class="text-[11px] text-gray-500 mt-1">Max rate: {{ number_format($it->max_rate, 2) }}</div>
                </div>

                {{-- Line Total (readonly) --}}
                <div class="sm:col-span-2">
                  <label class="block text-xs text-gray-600 mb-1">Line Total</label>
                  <input type="text" :value="(qty * rate).toFixed(2)"
                         class="w-full rounded-lg border border-gray-300 bg-gray-50 px-3 py-2" readonly>
                </div>
              </div>
            @endforeach
          </div>
        </div>

        {{-- Live totals + hidden vat_amount --}}
        <div class="pt-4 flex flex-col items-end gap-1 text-sm" x-data
             @recalc.window="
                let sub = 0;
                document.querySelectorAll('#itemsWrap .item-row').forEach(r=>{
                  const q = parseFloat(r.querySelector('[name$=&quot;[qty]&quot;]')?.value||0);
                  const rt= parseFloat(r.querySelector('[name$=&quot;[rate]&quot;]')?.value||0);
                  sub += (q*rt)||0;
                });

                const subEl = document.getElementById('js-subtotal');
                if (subEl) subEl.innerText = sub.toFixed(2);

                const mode = document.querySelector('[name=tax_mode]')?.value||'PAN';
                const v = mode==='VAT' ? parseFloat(document.querySelector('[name=vat_percent]')?.value||13) : 0;
                const vat = +(sub * (v/100)).toFixed(2);

                const vatEl = document.getElementById('js-vat');
                if (vatEl) vatEl.innerText = vat.toFixed(2);

                const grand = sub + vat;
                const grandEl = document.getElementById('js-grand');
                if (grandEl) grandEl.innerText = grand.toFixed(2);

                const vatField = document.querySelector('[name=vat_amount]');
                if (vatField) vatField.value = vat.toFixed(2);
             ">
          <div>Sub Total: <span id="js-subtotal" class="font-semibold">0.00</span></div>
          <div>VAT Amount: <span id="js-vat" class="font-semibold">0.00</span></div>
          <div class="text-lg">Grand Total: <span id="js-grand" class="font-bold">0.00</span></div>

          {{-- Client mirrors live VAT for convenience; server is authoritative --}}
          <input type="hidden" name="vat_amount" value="0.00">
        </div>

        {{-- Remarks --}}
        <div>
          <label class="block text-sm font-medium mb-1">Remarks</label>
          <textarea name="remarks" rows="2"
                    class="w-full rounded-lg border border-gray-300 focus:border-gray-400 focus:ring-0 px-3 py-2"
                    placeholder="Optional">{{ old('remarks') }}</textarea>
        </div>

        {{-- Submit --}}
        <div class="flex justify-end">
          <button class="rounded-xl bg-gray-900 text-white px-5 py-2.5 text-sm font-semibold hover:bg-gray-800">
            Save Purchase
          </button>
        </div>
      </form>
    </div>
  </div>
</div>
@endsection

@push('scripts')
  {{-- Ensure Alpine is present (safe no-op if already loaded) --}}
  <script>
    (function ensureAlpine() {
      if (!window.Alpine) {
        var s = document.createElement('script');
        s.src = "https://unpkg.com/alpinejs@3.x.x/dist/cdn.min.js";
        s.defer = true;
        document.head.appendChild(s);
      }
    })();
  </script>

  <script>
    function purchaseForm(slip, initialTaxMode = 'PAN', initialVat = 13) {
      return {
        slip,
        taxMode: initialTaxMode,
        vatPercent: initialVat
      };
    }

    // Trigger recalc on changes
    document.addEventListener('change', (e) => {
      if (e.target && (e.target.name === 'tax_mode' || e.target.name === 'vat_percent')) {
        window.dispatchEvent(new Event('recalc'));
      }
    });
    document.addEventListener('input', (e) => {
      if (e.target && (/\[qty\]$/.test(e.target.name) || /\[rate\]$/.test(e.target.name))) {
        window.dispatchEvent(new Event('recalc'));
      }
    });

    // Client date guard: purchase_date >= slip_date
    (function () {
      const pd = document.querySelector('[name="purchase_date"]');
      if (!pd) return;
      const slipDate = pd.getAttribute('data-slip-date') || '';

      const warn = (msg) => {
        let hint = pd.parentElement.querySelector('.date-warn');
        if (!hint) {
          hint = document.createElement('div');
          hint.className = 'date-warn text-xs text-red-600 mt-1';
          pd.parentElement.appendChild(hint);
        }
        hint.textContent = msg;
      };
      const clearWarn = () => {
        const hint = pd.parentElement.querySelector('.date-warn');
        if (hint) hint.remove();
      };

      const validYMD = (s) => /^\d{4}-\d{2}-\d{2}$/.test(s);

      const check = () => {
        const v = (pd.value || '').trim();
        if (!validYMD(v) || !validYMD(slipDate)) { clearWarn(); return true; }
        if (v < slipDate) { warn(`Purchase Date cannot be earlier than Slip Date (${slipDate}).`); return false; }
        clearWarn(); return true;
      };

      pd.addEventListener('blur', check);

      const form = document.getElementById('purchase-form');
      if (form) {
        form.addEventListener('submit', (e) => {
          if (!check()) { e.preventDefault(); pd.focus(); }
        });
      }
    })();

    // Kick an initial totals compute
    window.dispatchEvent(new Event('recalc'));
  </script>
@endpush
</file>

<file path="resources/views/Backend/purchases/edit.blade.php">
@extends('Backend.layouts.app')

@section('content')
<div class="max-w-6xl mx-auto px-4 py-8">
  <div class="mb-6 flex items-center justify-between">
    <h1 class="text-2xl font-bold">Edit Purchase #{{ $purchase->purchase_sn }}</h1>
    <a href="{{ route('purchases.show', $purchase) }}" class="rounded-xl border border-gray-200 bg-white px-4 py-2.5 text-sm font-semibold text-gray-700 hover:bg-gray-50">â† Back</a>
  </div>

  @if ($errors->any())
    <div class="mb-4 rounded-xl border border-red-200 bg-red-50 px-4 py-3 text-red-800">
      <ul class="list-disc list-inside text-sm">@foreach ($errors->all() as $e)<li>{{ $e }}</li>@endforeach</ul>
    </div>
  @endif

  <div class="rounded-2xl border border-gray-200 bg-white shadow-sm overflow-hidden" x-data="editForm()">
    <div class="border-b bg-gray-50 px-5 py-4"><h2 class="text-sm font-semibold text-gray-700">Purchase Details</h2></div>

    <div class="px-5 py-6">
      <form method="POST" action="{{ route('purchases.update', $purchase) }}" class="space-y-6">
        @csrf @method('PUT')

        <div class="grid grid-cols-1 sm:grid-cols-3 gap-5">
          <div>
            <label class="block text-sm font-medium mb-1">Purchase S.N *</label>
            <input name="purchase_sn" value="{{ old('purchase_sn', $purchase->purchase_sn) }}" required class="w-full rounded-lg border px-3 py-2">
          </div>
          <div>
            <label class="block text-sm font-medium mb-1">Purchase Date *</label>
            <input type="date" name="purchase_date" value="{{ old('purchase_date', optional($purchase->purchase_date)->toDateString()) }}" required class="w-full rounded-lg border px-3 py-2">
          </div>
          <div>
            <label class="block text-sm font-medium mb-1">Supplier *</label>
            <select name="supplier_id" required class="w-full rounded-lg border px-3 py-2">
              <option value="">-- Select Supplier --</option>
              @foreach($suppliers as $s)
                <option value="{{ $s->id }}" @selected(old('supplier_id', $purchase->supplier_id)==$s->id)>{{ $s->name }} {{ $s->pan ? "({$s->pan})" : '' }}</option>
              @endforeach
            </select>
          </div>

          <div>
            <label class="block text-sm font-medium mb-1">Department</label>
            <select name="department_id" class="w-full rounded-lg border px-3 py-2">
              <option value="">-- Select Department --</option>
              @foreach($departments as $d)
                <option value="{{ $d->id }}" @selected(old('department_id', $purchase->department_id)==$d->id)>{{ $d->name }}</option>
              @endforeach
            </select>
          </div>

          <div>
            <label class="block text-sm font-medium mb-1">Store Entry S.N</label>
            <input name="store_entry_sn" value="{{ old('store_entry_sn', $purchase->store_entry_sn) }}" class="w-full rounded-lg border px-3 py-2">
          </div>

          <div>
            <label class="block text-sm font-medium mb-1">Store Entry Date</label>
            <input type="date" name="store_entry_date" value="{{ old('store_entry_date', optional($purchase->store_entry_date)->toDateString()) }}" class="w-full rounded-lg border px-3 py-2">
          </div>

          <div>
            <label class="block text-sm font-medium mb-1">Tax Mode</label>
            <select name="tax_mode" id="tax_mode" class="w-full rounded-lg border px-3 py-2">
              @php $tm = old('tax_mode', $purchase->tax_mode ?? 'PAN'); @endphp
              <option value="PAN" @selected($tm==='PAN')>PAN (No VAT)</option>
              <option value="VAT" @selected($tm==='VAT')>VAT</option>
            </select>
          </div>

          <div id="vat_box" style="{{ $tm==='VAT' ? '' : 'display:none' }}">
            <label class="block text-sm font-medium mb-1">VAT %</label>
            <input type="number" step="0.01" min="0" max="100" name="vat_percent"
                   value="{{ old('vat_percent', $purchase->vat_percent ?? 13) }}"
                   class="w-full rounded-lg border px-3 py-2">
          </div>
        </div>

        <div class="pt-2">
          <label class="block text-sm font-semibold mb-2">Items</label>
          <div id="itemsWrap" class="space-y-2">
            @foreach($purchase->slip->items as $i => $it)
              @php
                // Remaining excluding this purchase (controller also validates)
                $ordered = (float)$it->ordered_qty;
                $purchasedOther = \App\Models\PurchaseItem::where('product_id',$it->product_id)
                    ->whereHas('purchase', fn($q)=>$q->where('purchase_slip_id',$purchase->slip->id)->where('id','!=',$purchase->id))
                    ->sum('qty');
                $remaining = max(0, $ordered - (float)$purchasedOther);
                $existingLine = $purchase->items->firstWhere('product_id', $it->product_id);
              @endphp

              <div class="grid grid-cols-12 gap-2 items-center item-row" x-data="{qty: {{ (float)($existingLine->qty ?? 0) }}, rate: {{ (float)($existingLine->rate ?? 0) }}}">
                <div class="col-span-4">
                  <input type="hidden" name="items[{{ $i }}][product_id]" value="{{ $it->product_id }}">
                  <div class="text-sm font-medium text-gray-900">
                    {{ $it->product->name ?? 'Product #'.$it->product_id }}
                    <span class="text-xs text-gray-500">{{ $it->product?->sku ? '('.$it->product->sku.')' : '' }}</span>
                  </div>
                  <div class="text-[11px] text-gray-500">Unit: {{ $it->unit ?? $it->product->unit ?? 'â€”' }}</div>
                </div>

                <div class="col-span-3">
                  <input name="items[{{ $i }}][qty]" type="number" step="0.001" min="0.001" max="{{ $remaining + (float)($existingLine->qty ?? 0) }}"
                         @input="qty = +$event.target.value"
                         value="{{ old("items.$i.qty", $existingLine->qty ?? '') }}"
                         class="w-full rounded-lg border px-3 py-2" placeholder="Qty â‰¤ {{ $remaining + (float)($existingLine->qty ?? 0) }}" required>
                  <div class="text-[11px] text-gray-500 mt-1">Remaining (with current): {{ number_format($remaining + (float)($existingLine->qty ?? 0),3) }}</div>
                </div>

                <div class="col-span-3">
                  <input name="items[{{ $i }}][rate]" type="number" step="0.01" min="0" max="{{ $it->max_rate }}"
                         @input="rate = +$event.target.value"
                         value="{{ old("items.$i.rate", $existingLine->rate ?? '') }}"
                         class="w-full rounded-lg border px-3 py-2" placeholder="Rate â‰¤ {{ $it->max_rate }}" required>
                  <div class="text-[11px] text-gray-500 mt-1">Max rate: {{ number_format($it->max_rate,2) }}</div>
                </div>

                <div class="col-span-2">
                  <input type="text" :value="(qty*rate).toFixed(2)" class="w-full rounded-lg border px-3 py-2 bg-gray-50" readonly>
                </div>
              </div>
            @endforeach
          </div>
        </div>

        <div class="pt-4 flex flex-col items-end gap-1 text-sm" id="summaryBox">
          <div>Sub Total: <span id="js-subtotal" class="font-semibold">{{ number_format($purchase->sub_total,2) }}</span></div>
          <div>VAT: <span id="js-vat" class="font-semibold">{{ number_format($purchase->vat_amount,2) }}</span></div>
          <div class="text-lg">Grand Total: <span id="js-grand" class="font-bold">{{ number_format($purchase->grand_total ?: $purchase->total_amount,2) }}</span></div>
        </div>

        <div>
          <label class="block text-sm font-medium mb-1">Remarks</label>
          <textarea name="remarks" rows="2" class="w-full rounded-lg border border-gray-300 focus:border-gray-400 focus:ring-0 px-3 py-2">{{ old('remarks', $purchase->remarks) }}</textarea>
        </div>

        <div class="flex justify-end">
          <button class="rounded-xl bg-gray-900 text-white px-5 py-2.5 text-sm font-semibold hover:bg-gray-800">Update Purchase</button>
        </div>
      </form>
    </div>
  </div>
</div>

@push('scripts')
<script>
function editForm(){ return {} }

document.getElementById('tax_mode').addEventListener('change', (e)=>{
  document.getElementById('vat_box').style.display = e.target.value==='VAT' ? '' : 'none';
  recalcTotals();
});
document.addEventListener('input', (e)=>{
  if (!e.target.form) return;
  if (/\[qty\]$/.test(e.target.name) || /\[rate\]$/.test(e.target.name) || e.target.name==='vat_percent') {
    recalcTotals();
  }
});
function recalcTotals(){
  let sub = 0;
  document.querySelectorAll('#itemsWrap .item-row').forEach(r=>{
    const q = parseFloat(r.querySelector('[name$=\"[qty]\"]')?.value||0);
    const rt= parseFloat(r.querySelector('[name$=\"[rate]\"]')?.value||0);
    sub += (q*rt)||0;
  });
  document.getElementById('js-subtotal').innerText = sub.toFixed(2);
  const mode = document.getElementById('tax_mode').value;
  const vpEl = document.querySelector('[name=vat_percent]');
  const v = mode==='VAT' ? parseFloat(vpEl?.value||13) : 0;
  const vat = +(sub * (v/100)).toFixed(2);
  document.getElementById('js-vat').innerText = vat.toFixed(2);
  document.getElementById('js-grand').innerText = (sub+vat).toFixed(2);
}
recalcTotals();
</script>
@endpush
@endsection
</file>

<file path="resources/views/Backend/purchases/index.blade.php">
@extends('Backend.layouts.app')

@section('content')
    <div class="max-w-6xl mx-auto px-4 py-8">
        <div class="mb-6 flex items-center justify-between">
            <h1 class="text-2xl font-bold">à¤¸à¥à¤Ÿà¥‹à¤° à¤ªà¥à¤°à¤¾à¤ªà¥à¤¤à¤¿</h1>
            <a href="{{ route('slips.index') }}"
                class="rounded-xl border border-gray-200 bg-white px-4 py-2.5 text-sm font-semibold text-gray-700 hover:bg-gray-50">
                â† à¤–à¤°à¤¿à¤¦ à¤®à¤¾à¤— à¤«à¤¾à¤°à¤¾à¤®
            </a>
        </div>

        <form method="GET" action="{{ route('purchases.index') }}" class="mb-6">
            <div class="flex flex-col sm:flex-row gap-3 sm:items-center">
                <input type="text" name="search" value="{{ request('search') }}"
                    class="w-full rounded-xl border border-gray-300 px-4 py-2.5 text-sm focus:border-blue-400 focus:ring-1 focus:ring-blue-400"
                    placeholder="Search by Purchase SN / Date / Supplier / Slip SN">
                <button class="rounded-xl bg-blue-600 text-white px-5 py-2.5 text-sm hover:bg-blue-700">Search</button>
            </div>
        </form>

        <div class="rounded-2xl border border-gray-200 bg-white shadow-sm overflow-hidden">
            <table class="w-full text-left">
                <thead class="bg-gray-50 text-xs uppercase text-gray-600">
                    <tr>
                        <th class="px-4 py-3 w-16">à¤•à¥à¤°à¤® à¤¸à¤‚à¤–à¥à¤¯à¤¾</th>
                        <th class="px-4 py-3">à¤¸à¥à¤Ÿà¥‹à¤° à¤ªà¥à¤°à¤¾à¤ªà¥à¤¤à¤¿ à¤¨à¤‚ / à¤®à¤¿à¤¤à¤¿ </th>
                        <th class="px-4 py-3">Supplier</th>
                        <th class="px-4 py-3">à¤–à¤°à¤¿à¤¦ à¤®à¤¾à¤— à¤«à¤¾à¤°à¤¾à¤®</th>
                        <th class="px-4 py-3">Grand Total</th>
                        <th class="px-4 py-3">Store</th> {{-- âœ… new --}}

                        <th class="px-4 py-3 text-right">Actions</th>
                    </tr>
                </thead>
                <tbody class="divide-y divide-gray-100">
                    @php $sn = ($orders->currentPage()-1)*$orders->perPage()+1; @endphp
                    @forelse($orders as $o)
                        <tr class="hover:bg-gray-50">
                            <td class="px-4 py-3">{{ $sn++ }}</td>
                            <td class="px-4 py-3">
                                <div class="font-medium">{{ $o->purchase_sn }}</div>
                                <div class="text-xs text-gray-500">{{ optional($o->purchase_date)->format('Y-m-d') }}</div>
                            </td>
                            <td class="px-4 py-3">{{ $o->supplier->name ?? 'â€”' }}</td>
                            <td class="px-4 py-3">
                                <a class="text-blue-600 hover:underline text-sm"
                                    href="{{ route('slips.print', $o->slip->po_sn) }}">
                                    à¤–à¤°à¤¿à¤¦ à¤®à¤¾à¤— à¤«à¤¾à¤°à¤¾à¤® #{{ $o->slip->po_sn ?? $o->purchase_slip_id }}
                                </a>
                            </td>
                            <td class="px-4 py-3">{{ number_format($o->grand_total ?: $o->total_amount, 2) }}</td>

                            <td class="px-4 py-3">
                                @if ($o->storeEntry)
                                    <a href="{{ route('store.show', $o->storeEntry) }}"
                                        class="text-emerald-700 hover:underline text-sm">
                                        View Store Entry
                                    </a>
                                @else
                                    <a href="{{ route('store.prepare', $o) }}"
                                        class="text-indigo-600 hover:underline text-sm">
                                        Create Store Entry
                                    </a>
                                @endif
                            </td>
                            <td class="px-4 py-3 text-right">
                            

                            <a class="text-blue-600 hover:underline text-sm"
   href="{{ route('purchases.show', $o->purchase_sn) }}">View</a>

@if(!$o->storeEntry)
    <span class="mx-1 text-gray-300">|</span>
    <a class="text-indigo-600 hover:underline text-sm"
       href="{{ route('purchases.edit', $o) }}">Edit</a>
@else
    <span class="mx-1 text-gray-300">|</span>
    <span class="text-gray-400 text-sm italic">Locked (Store done)</span>
@endif

                            </td>
                        </tr>
                    @empty
                        <tr>
                            <td colspan="6" class="px-4 py-6 text-center text-gray-500">No purchases found.</td>
                        </tr>
                    @endforelse
                </tbody>
            </table>
            <div class="px-4 py-3 border-t bg-gray-50">
                {{ $orders->links() }}
            </div>
        </div>
    </div>
@endsection
</file>

<file path="resources/views/Backend/purchases/show_print.blade.php">
@extends('Backend.layouts.app')
@section('content')
    <style>
        @page {
            size: A4;
            margin: 14mm 12mm;
        }

        body {
            font-family: "Noto Sans Devanagari", "Mangal", "Kalimati", Arial, sans-serif;
            color: #111;
        }

        .a4 {
            width: 190mm;
            margin: 0 auto;
        }

        .line {
            border-top: 1px solid #000;
            margin: 6px 0 12px;
        }

        @media screen {
            body {
                background: #f9fafb;
                padding: 24px;
            }

            .a4 {
                background: #fff;
                padding: 12mm;
                box-shadow: 0 4px 20px rgba(0, 0, 0, .1);
                border-radius: 8px;
            }

            .printbar {
                display: flex;
                justify-content: space-between;
                align-items: center;
                gap: 8px;
                margin-bottom: 16px;
            }

            .printbar a,
            .printbar button {
                padding: 8px 16px;
                border: 1px solid #d1d5db;
                border-radius: 8px;
                background: white;
                font-size: 14px;
            }

            .printbar a:hover,
            .printbar button:hover {
                background: #f3f4f6;
            }
        }

        /* ===== PRINT ONLY THE A4 BLOCK ===== */
        @media print {

            /* Hide common layout chrome */
            .printbar,
            header,
            nav,
            aside,
            .sidebar,
            .navbar,
            .app-header,
            .app-footer,
            .site-header,
            .site-footer {
                display: none !important;
            }

            /* Hide everything by default */
            body * {
                visibility: hidden !important;
            }

            /* Show only the printable block */
            #printable,
            #printable * {
                visibility: visible !important;
            }

            /* Position printable block at page origin & remove on-screen padding/bg */
            body {
                padding: 0 !important;
                background: #fff !important;
            }

            #printable {
                position: absolute;
                left: 0;
                top: 0;
                width: 190mm;
                /* match .a4 width */
                margin: 0 !important;
                box-shadow: none !important;
                border-radius: 0 !important;
            }

            /* Keep footer of the A4 block at bottom of page if you want */
            footer {
                position: fixed;
                bottom: 14mm;
                left: 0;
                right: 0;
            }
        }

        body {
            display: flex;
            flex-direction: column;
            min-height: 100vh;
        }

        .a4 {
            display: flex;
            flex-direction: column;
            min-height: 100%;
        }

        footer {
            margin-top: auto;
        }
    </style>

    <!-- Screen header with actions (won't print) -->
    <div class="printbar no-print">
        <div class="text-sm text-gray-600">
            <a href="{{ route('purchases.index') }}">â† Back</a>
        </div>
        <div class="space-x-2">
            @if ($purchase->purchase_slip_id)
                <a href="{{ route('slips.show', $purchase->purchase_slip_id) }}">View Slip</a>
            @endif
            <button onclick="window.print()">ðŸ–¨ï¸ Print / Save as PDF</button>
        </div>
    </div>

    {{-- âœ… Add id="printable" to ensure only this prints --}}
    <div id="printable" class="a4">
        <!-- Top-right code (optional) -->
        <div class="text-right text-xs text-gray-700 mb-2">à¤¤à¥à¤°à¤¿. à¤µà¤¿ à¤«à¤¾. à¤¨à¤‚. à¥§à¥¯</div>

        <!-- Header -->
        <div class="text-center leading-tight mb-6">
            <div class="text-xl font-bold">à¤¤à¥à¤°à¤¿à¤­à¥à¤µà¤¨ à¤µà¤¿à¤¶à¥à¤µà¤µà¤¿à¤¦à¥à¤¯à¤¾à¤²à¤¯</div>
            <div class="text-base font-medium mt-1">à¤ªà¥‚à¤°à¥à¤µà¤¾à¤žà¥à¤šà¤² à¤•à¥à¤¯à¤¾à¤®à¥à¤ªà¤¸, à¤§à¤°à¤¾à¤¨</div>
            <div class="text-lg font-semibold mt-2 ">à¤¸à¥à¤Ÿà¥‹à¤°Â à¤ªà¥à¤°à¤¾à¤ªà¥à¤¤à¤¿ à¤¤à¤¥à¤¾ à¤¨à¤¿à¤°à¥€à¤•à¥à¤·à¤£ à¤¨à¥‹à¤Ÿ </div>
        </div>



        <div>
            <div class="text-right  mb-2">à¤•à¥à¤°à¤® à¤¸à¤‚à¤–à¥à¤¯à¤¾ : <strong>{{ $meta['purchase_sn'] }}</strong> </div>

            à¤¶à¥à¤°à¥€ <strong>{{ $meta['supplier'] }}</strong> à¤¬à¤¾à¤Ÿ à¤¨à¤¿à¤®à¥à¤¨à¤²à¤¿à¤–à¤¿à¤¤ à¤®à¤¾à¤² à¤ªà¥à¤°à¤¾à¤ªà¥à¤¤ à¤­à¤¯à¥‹ à¥¤

        </div>
        <!-- Metadata grid -->
        <br>

        <div class="grid grid-cols-2 sm:grid-cols-2 gap-y-1 text-sm mb-3">
            <div>à¤¬à¤¿à¤² à¤¨à¤‚.: <strong>{{ $meta['purchase_sn'] }}</strong></div>
            <div class="text-right">à¤®à¤¿à¤¤à¤¿: <strong>{{ $meta['purchase_date'] ?? 'â€”' }}</strong></div>


        </div>

        {{-- <div class="line"></div> --}}



        <!-- Items table -->
        <div class="overflow-x-auto">
            <table class="w-full border border-black border-collapse text-sm leading-snug">
                <thead>
                    <tr>
                        <th class="border border-black px-2 py-1 text-center w-10">à¤¸à¤¿.à¤¨à¤‚</th>
                        <th class="border border-black px-2 py-1 text-left w-56">à¤µà¤¿à¤µà¤°à¤£ (Name)</th>

                        {{-- âœ… New merged Slip No/Date column after description --}}
                        <th class="border border-black px-2 py-1 text-center w-40">Order Slip No / Date</th>

                        <th class="border border-black px-2 py-1 text-center w-10">à¤à¤•à¤¾à¤ˆ</th>
                        <th class="border border-black px-2 py-1 text-center w-10">à¤ªà¤°à¤¿à¤®à¤¾à¤£</th>
                        <th class="border border-black px-2 py-1 text-center w-15">à¤¦à¤°</th>
                        <th class="border border-black px-2 py-1 text-center w-24">à¤°à¤•à¤®</th>
                        <th class="border border-black px-2 py-1 text-center w-10">Ledger No</th>
                        <th class="border border-black px-2 py-1 text-center w-20">à¤•à¥ˆà¤«à¤¿à¤¯à¤¤</th>
                    </tr>
                </thead>

                <tbody>
                    @php
                        $total = 0;
                        $rowCount = max(count($items), 1); // number of item rows
                    @endphp

                    @forelse($items as $i => $row)
                        @php
                            $amt = (float) str_replace(',', '', $row['amount'] ?? 0);
                            $total += $amt;
                        @endphp
                        <tr class="align-top">
                            <td class="border border-black text-center">{{ $row['sn'] }}</td>
                            <td class="border border-black px-2 break-words">{{ $row['desc'] }}</td>

                            {{-- âœ… Slip info (merged once, right after Name) --}}
                            @if ($i === 0)
                                <td rowspan="{{ $rowCount }}"
                                    class="border border-black px-2 py-2 text-sm text-center align-middle">
                                    <div class="leading-snug">
                                        <div><span class="font-medium"></span> {{ $meta['slip_sn'] ?? 'â€”' }}</div>
                                        <div><span class="font-medium"></span> {{ $meta['slip_date'] ?? 'â€”' }}</div>
                                    </div>
                                </td>
                            @endif

                            <td class="border border-black text-center">{{ $row['unit'] ?: 'â€”' }}</td>
                            <td class="border border-black text-center">{{ $row['required'] }}</td>
                            <td class="border border-black text-center">{{ $row['rate'] }}</td>
                            <td class="border border-black text-center">{{ $row['amount'] }}</td>
                            <td class="border border-black text-center">{{ $row['store_entry_sn']?:'-' }}</td>

                            {{-- âœ… Merged remarks (spans all item rows) --}}
                            @if ($i === 0)
                                <td rowspan="{{ $rowCount }}" class="border border-black p-0 align-middle">
                                    <div
                                        class="h-full w-full flex items-center justify-center text-[13px] font-medium text-gray-800 px-2 text-center">
                                        {{ $meta['remarks'] }}
                                    </div>
                                </td>
                            @endif
                        </tr>
                    @empty
                        <tr>
                            <td colspan="8" class="text-center py-8 text-gray-600">
                                à¤•à¥à¤¨à¥ˆ à¤¸à¤¾à¤®à¤—à¥à¤°à¥€ à¤–à¤°à¤¿à¤¦ à¤µà¤¿à¤µà¤°à¤£ à¤‰à¤ªà¤²à¤¬à¥à¤§ à¤›à¥ˆà¤¨ à¥¤
                            </td>
                        </tr>
                    @endforelse

                    @if (count($items))
                        {{-- Totals rows (keep same number of columns for alignment) --}}
                        <tr class="font-semibold">
                            <td colspan="6" class="border border-black text-center px-3 py-2">à¤‰à¤ª-à¤¯à¥‹à¤— (Sub Total)</td>
                            <td  colspan="3" class="border border-black text-center px-3 py-2">{{ $meta['sub_total'] }}</td>
                           
                        </tr>
                        @if ($meta['tax_mode'] === 'VAT')
                            <tr class="font-semibold">
                                <td colspan="6" class="border border-black text-center px-3 py-2">
                                    VAT @if ($meta['tax_mode'] === 'VAT')
                                        ({{ $meta['vat_percent'] }}%)
                                    @endif
                                </td>
                                <td  colspan="3" class="border border-black text-center px-3 py-2">{{ $meta['vat_amount'] }}</td>
                                
                            </tr>
                        @endif
                        <tr class="font-bold">
                            <td colspan="6" class="border border-black text-center px-3 py-2">à¤œà¤®à¥à¤®à¤¾ à¤°à¤•à¤® (Grand Total)</td>
                            <td colspan="3"class="border border-black text-center px-3 py-2">{{ $meta['grand_total'] }}</td>
                            
                        </tr>
                    @endif
                </tbody>

            </table>
        </div>

        <!-- Footer / signatures (stays at bottom in print) -->
        <footer class="mt-auto pt-8">
            <div class="flex justify-between text-sm mt-10">
                <div class="text-left w-1/2">
                    <div class="mt-6 leading-tight">
                        à¤¸à¥à¤Ÿà¥‹à¤°à¤®à¤¾ à¤¬à¥à¤à¤¿à¤²à¤¿à¤¨à¥‡  ..........................<br>
                        à¤®à¤¿à¤¤à¤¿ : ..........................
                    </div>
                </div>
                
                <div class="text-right w-1/2">
                    <div class="mt-6 leading-tight">
                        à¤¨à¤¿à¤°à¥€à¤•à¥à¤·à¤£ à¤—à¤°à¥€ à¤¸à¥à¤µà¥€à¤•à¥ƒà¤¤à¤¿ à¤¦à¤¿à¤¨à¥‡  ......................<br>
                         à¤®à¤¿à¤¤à¤¿ : ..........................
                    </div>
                </div>
            </div>

            
        </footer>
    </div>
@endsection
</file>

<file path="resources/views/Backend/purchases/show.blade.php">
@extends('Backend.layouts.app')
@section('content')
<div class="max-w-5xl mx-auto px-4 py-8">
  <div class="mb-4 flex items-start justify-between">
    <div>
      <h1 class="text-2xl font-bold">Purchase #{{ $purchase->purchase_sn }}</h1>
      <p class="text-sm text-gray-500">
        Date: {{ optional($purchase->purchase_date)->format('Y-m-d') }} â€¢
        Supplier: {{ $purchase->supplier->name ?? 'â€”' }} â€¢
        Tax: {{ $purchase->tax_mode ?? 'PAN' }} {{ $purchase->tax_mode === 'VAT' ? "({$purchase->vat_percent}%)" : '' }}
      </p>
      <p class="text-sm text-gray-500">
        Slip: <a class="text-blue-600 hover:underline" href="{{ route('slips.show', $purchase->purchase_slip_id) }}">{{ $purchase->slip->po_sn ?? $purchase->purchase_slip_id }}</a>
        â€¢ Dept: {{ $purchase->department->name ?? $purchase->slip->department->name ?? 'â€”' }}
      </p>
    </div>
    <a href="{{ route('purchases.index') }}" class="rounded-xl border border-gray-200 bg-white px-4 py-2.5 text-sm font-semibold text-gray-700 hover:bg-gray-50">â† Back</a>
  </div>

  <div class="rounded-2xl border bg-white shadow-sm overflow-hidden">
    <table class="w-full text-left">
      <thead class="bg-gray-50 text-xs uppercase text-gray-600">
        <tr>
          <th class="px-4 py-3">Product</th>
          <th class="px-4 py-3">Qty</th>
          <th class="px-4 py-3">Rate</th>
          <th class="px-4 py-3">Line Subtotal</th>
        </tr>
      </thead>
      <tbody class="divide-y">
        @foreach($purchase->items as $line)
          @php
            $p = $line->product;
            $name = $p?->name ?? ($line->temp_name ?: 'â€”');
            $sku  = $p?->sku  ?? $line->temp_sn;
          @endphp
          <tr>
            <td class="px-4 py-3">
              <div class="font-medium">{{ $name }}</div>
              <div class="text-xs text-gray-500">{{ $sku ? "SKU: $sku" : '' }}</div>
            </td>
            <td class="px-4 py-3">{{ number_format($line->qty,3) }} {{ $line->unit }}</td>
            <td class="px-4 py-3">{{ number_format($line->rate,2) }}</td>
            <td class="px-4 py-3">{{ number_format($line->line_subtotal ?? ($line->qty*$line->rate),2) }}</td>
          </tr>
        @endforeach
      </tbody>
    </table>

    <div class="px-4 py-4 border-t bg-gray-50">
      <div class="flex flex-col items-end gap-1 text-sm">
        <div>Sub Total: <span class="font-semibold">{{ number_format($purchase->sub_total,2) }}</span></div>
        <div>VAT ({{ $purchase->tax_mode === 'VAT' ? $purchase->vat_percent : 0 }}%): <span class="font-semibold">{{ number_format($purchase->vat_amount,2) }}</span></div>
        <div class="text-lg">Grand Total: <span class="font-bold">{{ number_format($purchase->grand_total ?: $purchase->total_amount,2) }}</span></div>
      </div>
    </div>
  </div>
</div>
@endsection
</file>

<file path="resources/views/Backend/slips/create.blade.php">
@extends('Backend.layouts.app')

@section('content')
<div class="max-w-6xl mx-auto px-4 py-8">
  <div class="mb-6 flex items-center justify-between">
    <h1 class="text-2xl font-bold">à¤®à¤¾à¤— à¤«à¤¾à¤°à¤® à¤¤à¤¯à¤¾à¤° à¤—à¤°à¥à¤¨à¥à¤¹à¥‹à¤¸</h1>
    <a href="{{ route('slips.index') }}"
       class="rounded-xl border border-gray-200 bg-white px-4 py-2.5 text-sm font-semibold text-gray-700 hover:bg-gray-50">
      â† Back
    </a>
  </div>

  @if ($errors->any())
    <div class="mb-4 rounded-xl border border-red-200 bg-red-50 px-4 py-3 text-red-800">
      <ul class="list-disc list-inside text-sm">
        @foreach ($errors->all() as $e)
          <li>{{ $e }}</li>
        @endforeach
      </ul>
    </div>
  @endif

  <div class="rounded-2xl border border-gray-200 bg-white shadow-sm overflow-hidden" x-data="slipForm()" x-init="init()">
    <div class="border-b bg-gray-50 px-5 py-4">
      <h2 class="text-sm font-semibold text-gray-700">Slip Information</h2>
    </div>

    <div class="px-5 py-6">
      <form method="POST" action="{{ route('slips.store') }}" class="space-y-6">
        @csrf

        <div class="grid grid-cols-1 sm:grid-cols-4 gap-4">
          <div>
            <label class="block text-sm font-medium mb-1">à¤®à¤¾à¤— à¤«à¤¾à¤°à¤® à¤¨à¤‚ *</label>
            <input name="po_sn" value="{{ old('po_sn') }}" required
                   class="w-full rounded-lg border border-gray-300 focus:border-gray-400 focus:ring-0 px-3 py-2">
          </div>

          <div>
            <label class="block text-sm font-medium mb-1">à¤®à¤¾à¤— à¤—à¤°à¤¿à¤à¤•à¥‹ à¤®à¤¿à¤¤à¤¿ (BS)</label>
            <input type="text" name="po_date" value="{{ old('po_date') }}"
                   class="w-full rounded-lg border border-gray-300 focus:border-gray-400 focus:ring-0 px-3 py-2 date-mask"
                   placeholder="YYYY-MM-DD" inputmode="numeric" maxlength="10" pattern="\d{4}-\d{2}-\d{2}"
                   autocomplete="off" title="Use format YYYY-MM-DD">
          </div>

          <div class="sm:col-span-2">
            <label class="block text-sm font-medium mb-1">à¤®à¤¾à¤— à¤—à¤°à¥à¤¨à¥‡ à¤¬à¤¿à¤­à¤¾à¤— *</label>
            <select name="department_id" required
                    class="w-full rounded-lg border border-gray-300 focus:border-gray-400 focus:ring-0 px-3 py-2">
              <option value="">-- Select Department --</option>
              @foreach ($departments as $d)
                <option value="{{ $d->id }}" @selected(old('department_id') == $d->id)>{{ $d->name }}</option>
              @endforeach
            </select>
          </div>
        </div>

        {{-- ITEMS --}}
        <div>
          <label class="block text-sm font-semibold mb-2">à¤®à¤¾à¤— à¤—à¤°à¥‡à¤•à¥‹ à¤¸à¤¾à¤®à¤—à¥à¤°à¥€ *</label>

          {{-- Row template --}}
          <template id="row-template">
            <div class="grid grid-cols-12 gap-2 items-start row">
              {{-- Name + Suggestions + Detail --}}
              <div class="col-span-4 space-y-2">
                <label class="block text-xs text-gray-600">Item (search previous slips or type custom)</label>

                <input type="text" class="w-full rounded-lg border px-3 py-2 product-search"
                       placeholder="Search by name or SNâ€¦">

                <div class="suggestions hidden border rounded-lg bg-white shadow z-10 max-h-48 overflow-auto"></div>

                {{-- hidden fields posted to server --}}
                <input type="hidden" class="product-id-field">
                <input type="hidden" class="temp-name-field">
                <input type="hidden" class="temp-sn-field">

                {{-- Visible Detail input (maps to temp_sn via hidden field) --}}
                <input type="text" class="w-full rounded-lg border px-3 py-2 detail-input"
                       placeholder="Detail (e.g., model/spec)">
              </div>

              {{-- Qty --}}
              <div class="col-span-1">
                <label class="block text-xs text-gray-600">Quantity *</label>
                <input type="number" step="0.001" min="0.001" placeholder="Qty"
                       class="w-full rounded-lg border px-3 py-2 ordered-qty" required>
              </div>

              {{-- Max Rate --}}
              <div class="col-span-2">
                <label class="block text-xs text-gray-600">Max Rate *</label>
                <input type="number" step="0.01" min="0" placeholder="Max Rate"
                       class="w-full rounded-lg border px-3 py-2 max-rate" required>
              </div>

              {{-- Unit --}}
              <div class="col-span-1">
                <label class="block text-xs text-gray-600">Unit</label>
                <input type="text" placeholder="e.g., pcs"
                       class="w-full rounded-lg border px-3 py-2 unit">
              </div>

              {{-- Item Category --}}
              <div class="col-span-3">
                <label class="block text-sm font-medium mb-1">Item Category *</label>
                <select class="w-full rounded-lg border border-gray-300 focus:border-gray-400 focus:ring-0 px-3 py-2 item-category" required>
                  <option value="">-- Select Category --</option>
                  @foreach ($item_category as $c)
                    <option value="{{ $c->id }}">{{ $c->name_en }} ({{ $c->name_np }})</option>
                  @endforeach
                </select>
              </div>

              {{-- Delete --}}
              <div class="col-span-1 flex justify-end pt-6">
                <button type="button" class="text-red-600 text-sm hover:underline del-btn">Del</button>
              </div>
            </div>
          </template>

          {{-- Rows wrapper --}}
          <div id="rows" class="space-y-2"></div>

          <div class="mt-3">
            <button type="button"
                    class="rounded-lg border border-gray-300 px-3 py-1.5 text-sm hover:bg-gray-50 cursor-pointer"
                    @click="addRow()">
              + Add Item
            </button>
          </div>
        </div>

        <div>
          <label class="block text-sm font-medium mb-1">Remarks</label>
          <textarea name="remarks" rows="2"
                    class="w-full rounded-lg border border-gray-300 focus:border-gray-400 focus:ring-0 px-3 py-2"
                    placeholder="Optional">{{ old('remarks') }}</textarea>
        </div>

        <div class="flex justify-end">
          <button class="rounded-xl bg-gray-900 text-white px-5 py-2.5 text-sm font-semibold hover:bg-gray-800">
            Save Slip
          </button>
        </div>
      </form>
    </div>
  </div>
</div>

<script>
  (function ensureAlpine(){
    if (!window.Alpine) {
      var s = document.createElement('script');
      s.src = "https://unpkg.com/alpinejs@3.x.x/dist/cdn.min.js";
      s.defer = true;
      document.head.appendChild(s);
    }
  })();



  // old input after validation failure
  window.__OLD_ITEMS__ = @json(old('items', []));


function slipForm() {
  return {
    booted: false,

    init() {
      if (this.booted) return;
      this.booted = true;

      const oldItems = Array.isArray(window.__OLD_ITEMS__) ? window.__OLD_ITEMS__ : [];
      if (oldItems.length) {
        oldItems.forEach(row => this.addRow(row));
      } else {
        this.addRow();
      }
    },

    addRow(prefill = null) {
      const wrap = document.getElementById('rows');
      const tmpl = document.getElementById('row-template');
      const node = tmpl.content.firstElementChild.cloneNode(true);
      wrap.appendChild(node);
      this.bindRow(node, prefill);
      this.reindex();
    },

    bindRow(row, prefill = null) {
      // delete row
      row.querySelector('.del-btn').addEventListener('click', () => {
        const wrap = document.getElementById('rows');
        if (wrap.querySelectorAll('.row').length <= 1) return;
        row.remove();
        this.reindex();
      });

      // elements
      const searchInput = row.querySelector('.product-search');
      const listBox     = row.querySelector('.suggestions');
      const pidField    = row.querySelector('.product-id-field');
      const tempName    = row.querySelector('.temp-name-field');
      const tempSN      = row.querySelector('.temp-sn-field');
      const detailInput = row.querySelector('.detail-input');

      const qtyInput    = row.querySelector('.ordered-qty');
      const rateInput   = row.querySelector('.max-rate');
      const unitInput   = row.querySelector('.unit');
      const catSelect   = row.querySelector('.item-category');

      // sync visible detail -> hidden temp_sn
      detailInput.addEventListener('input', () => {
        tempSN.value = detailInput.value.trim();
      });

      // typeahead state
      let debounceTimer = null;
      let currentResults = [];
      let activeIndex = -1;
      let aborter = null;

      const hideList = () => { listBox.classList.add('hidden'); activeIndex = -1; };
      const showList = () => { listBox.classList.remove('hidden'); };

      const renderList = () => {
        if (!currentResults.length) { hideList(); return; }
        listBox.innerHTML = currentResults.map((r,i) => `
          <div class="px-3 py-2 hover:bg-gray-50 cursor-pointer ${i===activeIndex ? 'bg-gray-100' : ''}" data-idx="${i}">
            <div class="text-sm font-medium">${r.text}</div>
            <div class="text-xs text-gray-500">
              ${r.last_qty ?? 'â€”'} @ ${r.last_rate ?? 'â€”'}${r.last_unit ? ' ('+r.last_unit+')' : ''}
              ${r.last_category_name ? ' â€¢ ' + r.last_category_name : ''}
            </div>
          </div>
        `).join('');
        showList();

        [...listBox.children].forEach(el => {
          el.addEventListener('mousedown', (e) => { e.preventDefault(); choose(parseInt(el.dataset.idx, 10)); });
          el.addEventListener('mouseenter', () => { activeIndex = parseInt(el.dataset.idx, 10); renderList(); });
        });
      };

      const choose = (idx) => {
        const item = currentResults[idx];
        if (!item) return;

        // we store custom fields, not a product id
        pidField.value   = '';
        tempName.value   = (item.temp_name || '').trim();
        tempSN.value     = (item.temp_sn || '').trim();

        searchInput.value = item.text;
        detailInput.value = tempSN.value;

        // auto-fill values (editable)
        if (item.last_unit)  unitInput.value = item.last_unit;
        else                 unitInput.value = 'pcs'; // default to pcs if none

        if (item.last_rate)  rateInput.value = item.last_rate;
        if (item.last_qty)   qtyInput.value  = item.last_qty;

        // preselect category
        if (item.last_category_id && catSelect) {
          catSelect.value = String(item.last_category_id);
        }

        hideList();
      };

      const fetchResults = (term) => {
        if (aborter) aborter.abort();
        aborter = new AbortController();

        if (!term) { currentResults = []; renderList(); return; }

        fetch(`{{ route('products.search') }}?q=${encodeURIComponent(term)}`, {
          signal: aborter.signal,
          headers: { 'Accept': 'application/json' }
        })
        .then(r => r.ok ? r.json() : [])
        .then(json => {
          if (!Array.isArray(json)) json = [];
          // map server results; supports category + detail
          currentResults = json.map(x => ({
            id: x.id,
            text: (x.text || '').toString(),
            temp_name: x.temp_name || '',
            temp_sn: x.temp_sn || '',
            last_qty: x.last_qty ?? null,
            last_rate: x.last_rate ?? null,
            last_unit: x.last_unit || '',
            last_category_id: x.last_category_id ?? null,
            last_category_name: x.last_category_name ?? '',
          }));
          activeIndex = currentResults.length ? 0 : -1;
          renderList();
        })
        .catch(() => { currentResults = []; renderList(); });
      };

      // typing handlers
      searchInput.addEventListener('input', () => {
        // default to custom; suggestions can overwrite
        pidField.value = '';
        tempName.value = searchInput.value.trim();

        if (debounceTimer) clearTimeout(debounceTimer);
        debounceTimer = setTimeout(() => fetchResults(searchInput.value.trim()), 200);
      });

      searchInput.addEventListener('keydown', (e) => {
        if (e.key === 'ArrowDown' && currentResults.length) {
          e.preventDefault(); activeIndex = (activeIndex + 1) % currentResults.length; renderList();
        } else if (e.key === 'ArrowUp' && currentResults.length) {
          e.preventDefault(); activeIndex = (activeIndex - 1 + currentResults.length) % currentResults.length; renderList();
        } else if (e.key === 'Enter') {
          if (currentResults.length && activeIndex >= 0) {
            e.preventDefault(); choose(activeIndex);
          } else {
            // keep as custom user entry
            pidField.value  = '';
            tempName.value  = searchInput.value.trim();
            tempSN.value    = detailInput.value.trim();
            hideList();
          }
        } else if (e.key === 'Escape') {
          hideList();
        }
      });

      searchInput.addEventListener('blur', () => {
        setTimeout(() => {
          if (!pidField.value && searchInput.value.trim() !== '') {
            tempName.value = searchInput.value.trim();
            tempSN.value   = detailInput.value.trim();
          }
          hideList();
        }, 120);
      });

      // Prefill from old input after validation error
      if (prefill && typeof prefill === 'object') {
        if (prefill.product_id) {
          pidField.value     = String(prefill.product_id);
          searchInput.value  = `#${prefill.product_id} (selected)`;
          tempName.value     = '';
          tempSN.value       = '';
        } else {
          searchInput.value  = prefill.temp_name ?? '';
          detailInput.value  = prefill.temp_sn ?? '';
          pidField.value     = '';
          tempName.value     = prefill.temp_name ?? '';
          tempSN.value       = prefill.temp_sn ?? '';
        }
        if (prefill.ordered_qty != null) qtyInput.value = prefill.ordered_qty;
        if (prefill.max_rate   != null)  rateInput.value= prefill.max_rate;
        if (prefill.unit)                unitInput.value= prefill.unit;
        if (prefill.item_category_id)    catSelect.value= String(prefill.item_category_id);
      }
    },

    reindex() {
      const wrap = document.getElementById('rows');
      [...wrap.querySelectorAll('.row')].forEach((row, i) => {
        row.querySelector('.product-id-field')?.setAttribute('name', `items[${i}][product_id]`);
        row.querySelector('.temp-name-field')?.setAttribute('name', `items[${i}][temp_name]`);
        row.querySelector('.temp-sn-field')?.setAttribute('name', `items[${i}][temp_sn]`);
        row.querySelector('.ordered-qty')?.setAttribute('name', `items[${i}][ordered_qty]`);
        row.querySelector('.max-rate')?.setAttribute('name', `items[${i}][max_rate]`);
        row.querySelector('.unit')?.setAttribute('name', `items[${i}][unit]`);
        row.querySelector('.item-category')?.setAttribute('name', `items[${i}][item_category_id]`);
      });
    }
  }
}
</script>
@endsection
</file>

<file path="resources/views/Backend/slips/edit.blade.php">
@extends('Backend.layouts.app')

@section('content')
<div class="max-w-6xl mx-auto px-4 py-8">
  <div class="mb-6 flex items-center justify-between">
    <h1 class="text-2xl font-bold">à¤®à¤¾à¤— à¤«à¤¾à¤°à¤® à¤¸à¤®à¥à¤ªà¤¾à¤¦à¤¨ à¤—à¤°à¥à¤¨à¥à¤¹à¥‹à¤¸à¥</h1>
    <div class="flex gap-2">
      <a href="{{ route('slips.show', $slip) }}"
         class="rounded-xl border border-gray-200 bg-white px-4 py-2.5 text-sm font-semibold text-gray-700 hover:bg-gray-50">View</a>
      <a href="{{ route('slips.index') }}"
         class="rounded-xl border border-gray-200 bg-white px-4 py-2.5 text-sm font-semibold text-gray-700 hover:bg-gray-50">â† Back</a>
    </div>
  </div>

  @if ($errors->any())
    <div class="mb-4 rounded-xl border border-red-200 bg-red-50 px-4 py-3 text-red-800">
      <ul class="list-disc list-inside text-sm">
        @foreach ($errors->all() as $e)
          <li>{{ $e }}</li>
        @endforeach
      </ul>
    </div>
  @endif

  <div class="rounded-2xl border border-gray-200 bg-white shadow-sm overflow-hidden" 
       x-data="slipEditForm()" x-init="init()">
    <div class="border-b bg-gray-50 px-5 py-4">
      <h2 class="text-sm font-semibold text-gray-700">Slip Information</h2>
    </div>

    <div class="px-5 py-6">
      <form method="POST" action="{{ route('slips.update', $slip) }}" class="space-y-6">
        @csrf
        @method('PUT')

        <div class="grid grid-cols-1 sm:grid-cols-4 gap-4">
          <div>
            <label class="block text-sm font-medium mb-1">à¤®à¤¾à¤— à¤«à¤¾à¤°à¤® à¤¨à¤‚ *</label>
            <input name="po_sn" value="{{ old('po_sn', $slip->po_sn) }}" readonly required
                   class="w-full rounded-lg border border-gray-300 focus:border-gray-400 focus:ring-0 px-3 py-2">
          </div>

          <div>
            <label class="block text-sm font-medium mb-1">à¤®à¤¾à¤— à¤—à¤°à¤¿à¤à¤•à¥‹ à¤®à¤¿à¤¤à¤¿ (BS)</label>
            <input type="text" name="po_date" value="{{ old('po_date', optional($slip->po_date)->format('Y-m-d')) }}"
                   class="w-full rounded-lg border border-gray-300 focus:border-gray-400 focus:ring-0 px-3 py-2 date-mask"
                   placeholder="YYYY-MM-DD" inputmode="numeric" maxlength="10" pattern="\d{4}-\d{2}-\d{2}"
                   autocomplete="off" title="Use format YYYY-MM-DD">
          </div>

          <div class="sm:col-span-2">
            <label class="block text-sm font-medium mb-1">à¤®à¤¾à¤— à¤—à¤°à¥à¤¨à¥‡ à¤¬à¤¿à¤­à¤¾à¤— *</label>
            <select name="department_id" required
                    class="w-full rounded-lg border border-gray-300 focus:border-gray-400 focus:ring-0 px-3 py-2">
              <option value="">-- Select Department --</option>
              @foreach ($departments as $d)
                <option value="{{ $d->id }}" @selected(old('department_id', $slip->department_id) == $d->id)>
                  {{ $d->name }}
                </option>
              @endforeach
            </select>
          </div>
        </div>

        {{-- ITEMS --}}
        <div>
          <label class="block text-sm font-semibold mb-2">à¤®à¤¾à¤— à¤—à¤°à¥‡à¤•à¥‹ à¤¸à¤¾à¤®à¤—à¥à¤°à¥€ *</label>

          {{-- Row template --}}
          <template id="row-template">
            <div class="grid grid-cols-12 gap-2 items-start row">
              {{-- Name + Suggestions + Detail --}}
              <div class="col-span-4 space-y-2">
                <label class="block text-xs text-gray-600">Item (search previous slips or type custom)</label>

                <input type="text" class="w-full rounded-lg border px-3 py-2 product-search"
                       placeholder="Search by name or SNâ€¦">

                <div class="suggestions hidden border rounded-lg bg-white shadow z-10 max-h-48 overflow-auto"></div>

                {{-- hidden fields posted to server --}}
                <input type="hidden" class="product-id-field">
                <input type="hidden" class="temp-name-field">
                <input type="hidden" class="temp-sn-field">

                {{-- Visible Detail input (maps to temp_sn via hidden field) --}}
                <input type="text" class="w-full rounded-lg border px-3 py-2 detail-input"
                       placeholder="Detail (e.g., model/spec)">
              </div>

              {{-- Qty --}}
              <div class="col-span-1">
                <label class="block text-xs text-gray-600">Quantity *</label>
                <input type="number" step="0.001" min="0.001" placeholder="Qty"
                       class="w-full rounded-lg border px-3 py-2 ordered-qty" required>
              </div>

              {{-- Max Rate --}}
              <div class="col-span-2">
                <label class="block text-xs text-gray-600">Max Rate *</label>
                <input type="number" step="0.01" min="0" placeholder="Max Rate"
                       class="w-full rounded-lg border px-3 py-2 max-rate" required>
              </div>

              {{-- Unit --}}
              <div class="col-span-1">
                <label class="block text-xs text-gray-600">Unit</label>
                <input type="text" placeholder="e.g., pcs"
                       class="w-full rounded-lg border px-3 py-2 unit">
              </div>

              {{-- Item Category --}}
              <div class="col-span-3">
                <label class="block text-sm font-medium mb-1">Item Category *</label>
                <select class="w-full rounded-lg border border-gray-300 focus:border-gray-400 focus:ring-0 px-3 py-2 item-category" required>
                  <option value="">-- Select Category --</option>
                  @foreach ($item_category as $c)
                    <option value="{{ $c->id }}">{{ $c->name_en }} ({{ $c->name_np }})</option>
                  @endforeach
                </select>
              </div>

              {{-- Delete --}}
              <div class="col-span-1 flex justify-end pt-6">
                <button type="button" class="text-red-600 text-sm hover:underline del-btn">Del</button>
              </div>
            </div>
          </template>

          {{-- Rows wrapper --}}
          <div id="rows" class="space-y-2"></div>

          <div class="mt-3">
            <button type="button"
                    class="rounded-lg border border-gray-300 px-3 py-1.5 text-sm hover:bg-gray-50 cursor-pointer"
                    @click="addRow()">
              + Add Item
            </button>
          </div>
        </div>

        <div>
          <label class="block text-sm font-medium mb-1">Remarks</label>
          <textarea name="remarks" rows="2"
                    class="w-full rounded-lg border border-gray-300 focus:border-gray-400 focus:ring-0 px-3 py-2"
                    placeholder="Optional">{{ old('remarks', $slip->remarks) }}</textarea>
        </div>

        <div class="flex justify-end">
          <button class="rounded-xl bg-gray-900 text-white px-5 py-2.5 text-sm font-semibold hover:bg-gray-800">
            Update Slip
          </button>
        </div>
      </form>
    </div>
  </div>
</div>
@endsection

@push('scripts')
<script>
  (function ensureAlpine(){
    if (!window.Alpine) {
      var s = document.createElement('script');
      s.src = "https://unpkg.com/alpinejs@3.x.x/dist/cdn.min.js";
      s.defer = true;
      document.head.appendChild(s);
    }
  })();
</script>

{{-- CRITICAL: Pass slip items and old input to JavaScript --}}
<script>
  // Old input after validation failure
  window.__OLD_ITEMS__ = @json(old('items', []));
  
  // Existing slip items for editing
  window.__SLIP_ITEMS__ = @json($slipItemsForJs ?? []);
</script>

<script>
function slipEditForm() {
  return {
    booted: false,

    init() {
      if (this.booted) return;
      this.booted = true;

      const oldItems = Array.isArray(window.__OLD_ITEMS__) ? window.__OLD_ITEMS__ : [];
      const slipItems = Array.isArray(window.__SLIP_ITEMS__) ? window.__SLIP_ITEMS__ : [];

      // Priority: old input (after validation error) > existing slip items > empty row
      if (oldItems.length) {
        oldItems.forEach(row => this.addRow(row));
      } else if (slipItems.length) {
        slipItems.forEach(row => this.addRow(row));
      } else {
        this.addRow();
      }
    },

    addRow(prefill = null) {
      const wrap = document.getElementById('rows');
      const tmpl = document.getElementById('row-template');
      const node = tmpl.content.firstElementChild.cloneNode(true);
      wrap.appendChild(node);
      this.bindRow(node, prefill);
      this.reindex();
    },

    bindRow(row, prefill = null) {
      // delete row
      row.querySelector('.del-btn').addEventListener('click', () => {
        const wrap = document.getElementById('rows');
        if (wrap.querySelectorAll('.row').length <= 1) return;
        row.remove();
        this.reindex();
      });

      // elements
      const searchInput = row.querySelector('.product-search');
      const listBox     = row.querySelector('.suggestions');
      const pidField    = row.querySelector('.product-id-field');
      const tempName    = row.querySelector('.temp-name-field');
      const tempSN      = row.querySelector('.temp-sn-field');
      const detailInput = row.querySelector('.detail-input');

      const qtyInput    = row.querySelector('.ordered-qty');
      const rateInput   = row.querySelector('.max-rate');
      const unitInput   = row.querySelector('.unit');
      const catSelect   = row.querySelector('.item-category');

      // sync visible detail -> hidden temp_sn
      detailInput.addEventListener('input', () => {
        tempSN.value = detailInput.value.trim();
      });

      // typeahead state
      let debounceTimer = null;
      let currentResults = [];
      let activeIndex = -1;
      let aborter = null;

      const hideList = () => { listBox.classList.add('hidden'); activeIndex = -1; };
      const showList = () => { listBox.classList.remove('hidden'); };

      const renderList = () => {
        if (!currentResults.length) { hideList(); return; }
        listBox.innerHTML = currentResults.map((r,i) => `
          <div class="px-3 py-2 hover:bg-gray-50 cursor-pointer ${i===activeIndex ? 'bg-gray-100' : ''}" data-idx="${i}">
            <div class="text-sm font-medium">${r.text}</div>
            <div class="text-xs text-gray-500">
              ${r.last_qty ?? 'â€”'} @ ${r.last_rate ?? 'â€”'}${r.last_unit ? ' ('+r.last_unit+')' : ''}
              ${r.last_category_name ? ' â€¢ ' + r.last_category_name : ''}
            </div>
          </div>
        `).join('');
        showList();

        [...listBox.children].forEach(el => {
          el.addEventListener('mousedown', (e) => { e.preventDefault(); choose(parseInt(el.dataset.idx, 10)); });
          el.addEventListener('mouseenter', () => { activeIndex = parseInt(el.dataset.idx, 10); renderList(); });
        });
      };

      const choose = (idx) => {
        const item = currentResults[idx];
        if (!item) return;

        // we store custom fields, not a product id
        pidField.value   = '';
        tempName.value   = (item.temp_name || '').trim();
        tempSN.value     = (item.temp_sn || '').trim();

        searchInput.value = item.text;
        detailInput.value = tempSN.value;

        // auto-fill values (editable)
        if (item.last_unit)  unitInput.value = item.last_unit;
        else                 unitInput.value = 'pcs';

        if (item.last_rate)  rateInput.value = item.last_rate;
        if (item.last_qty)   qtyInput.value  = item.last_qty;

        // preselect category
        if (item.last_category_id && catSelect) {
          catSelect.value = String(item.last_category_id);
        }

        hideList();
        qtyInput.focus();
        qtyInput.select();
      };

      const fetchResults = (term) => {
        if (aborter) aborter.abort();
        aborter = new AbortController();

        if (!term) { currentResults = []; renderList(); return; }

        fetch(`{{ route('products.search') }}?q=${encodeURIComponent(term)}`, {
          signal: aborter.signal,
          headers: { 
            'Accept': 'application/json',
            'X-Requested-With': 'XMLHttpRequest'
          }
        })
        .then(r => r.ok ? r.json() : [])
        .then(json => {
          if (!Array.isArray(json)) json = [];
          currentResults = json.map(x => ({
            id: x.id,
            text: (x.text || '').toString(),
            temp_name: x.temp_name || '',
            temp_sn: x.temp_sn || '',
            last_qty: x.last_qty ?? null,
            last_rate: x.last_rate ?? null,
            last_unit: x.last_unit || '',
            last_category_id: x.last_category_id ?? null,
            last_category_name: x.last_category_name ?? '',
          }));
          activeIndex = currentResults.length ? 0 : -1;
          renderList();
        })
        .catch(() => { currentResults = []; renderList(); });
      };

      // typing handlers
      searchInput.addEventListener('input', () => {
        pidField.value = '';
        tempName.value = searchInput.value.trim();

        if (debounceTimer) clearTimeout(debounceTimer);
        debounceTimer = setTimeout(() => fetchResults(searchInput.value.trim()), 200);
      });

      searchInput.addEventListener('keydown', (e) => {
        if (e.key === 'ArrowDown' && currentResults.length) {
          e.preventDefault(); activeIndex = (activeIndex + 1) % currentResults.length; renderList();
        } else if (e.key === 'ArrowUp' && currentResults.length) {
          e.preventDefault(); activeIndex = (activeIndex - 1 + currentResults.length) % currentResults.length; renderList();
        } else if (e.key === 'Enter') {
          if (currentResults.length && activeIndex >= 0) {
            e.preventDefault(); choose(activeIndex);
          } else {
            pidField.value  = '';
            tempName.value  = searchInput.value.trim();
            tempSN.value    = detailInput.value.trim();
            hideList();
          }
        } else if (e.key === 'Escape') {
          hideList();
        }
      });

      searchInput.addEventListener('blur', () => {
        setTimeout(() => {
          if (!pidField.value && searchInput.value.trim() !== '') {
            tempName.value = searchInput.value.trim();
            tempSN.value   = detailInput.value.trim();
          }
          hideList();
        }, 120);
      });

      // Prefill from old input (after validation error) or existing slip items
      if (prefill && typeof prefill === 'object') {
        if (prefill.product_id) {
          pidField.value     = String(prefill.product_id);
          searchInput.value  = `#${prefill.product_id} (selected)`;
          tempName.value     = '';
          tempSN.value       = '';
        } else {
          searchInput.value  = prefill.temp_name ?? '';
          detailInput.value  = prefill.temp_sn ?? '';
          pidField.value     = '';
          tempName.value     = prefill.temp_name ?? '';
          tempSN.value       = prefill.temp_sn ?? '';
        }
        if (prefill.ordered_qty != null) qtyInput.value = prefill.ordered_qty;
        if (prefill.max_rate   != null)  rateInput.value= prefill.max_rate;
        if (prefill.unit)                unitInput.value= prefill.unit;
        if (prefill.item_category_id)    catSelect.value= String(prefill.item_category_id);
      }
    },

    reindex() {
      const wrap = document.getElementById('rows');
      [...wrap.querySelectorAll('.row')].forEach((row, i) => {
        row.querySelector('.product-id-field')?.setAttribute('name', `items[${i}][product_id]`);
        row.querySelector('.temp-name-field')?.setAttribute('name', `items[${i}][temp_name]`);
        row.querySelector('.temp-sn-field')?.setAttribute('name', `items[${i}][temp_sn]`);
        row.querySelector('.ordered-qty')?.setAttribute('name', `items[${i}][ordered_qty]`);
        row.querySelector('.max-rate')?.setAttribute('name', `items[${i}][max_rate]`);
        row.querySelector('.unit')?.setAttribute('name', `items[${i}][unit]`);
        row.querySelector('.item-category')?.setAttribute('name', `items[${i}][item_category_id]`);
      });
    }
  }
}
</script>
@endpush
</file>

<file path="resources/views/Backend/slips/index.blade.php">
@extends('Backend.layouts.app')
@section('content')
<div class="max-w-6xl mx-auto px-4 py-8">
  <div class="mb-6 flex items-center justify-between">
    <h1 class="text-2xl font-bold"> à¤–à¤°à¤¿à¤¦ à¤®à¤¾à¤— à¤«à¤¾à¤°à¤¾à¤®</h1>
    <a href="{{ route('slips.create') }}" class="rounded-xl bg-gray-900 text-white px-4 py-2.5 text-sm">+ New Slip</a>
  </div>
  <form class="mb-4" method="GET">
    <input class="rounded-lg border px-3 py-2" name="search" value="{{ request('search') }}" placeholder="Search SN/Date/Dept">
    <button class="rounded-lg bg-blue-600 text-white px-3 py-2 text-sm">Search</button>
  </form>
  <div class="rounded-2xl border bg-white shadow-sm overflow-hidden">
    <table class="w-full text-left">
      <thead class="bg-gray-50 text-xs uppercase text-gray-600">
        <tr><th class="px-4 py-3">à¤•à¥à¤°à¤® à¤¸à¤‚à¤–à¥à¤¯à¤¾</th><th class="px-4 py-3">à¤®à¤¾à¤— à¤«à¤¾à¤°à¤® à¤¨à¤‚ / à¤®à¤¿à¤¤à¤¿ </th><th class="px-4 py-3">Department</th><th class="px-4 py-3 text-right">Actions</th></tr>
      </thead>
      <tbody class="divide-y">
        @php $sn = ($slips->currentPage()-1)*$slips->perPage()+1; @endphp
        @forelse($slips as $slip)
          <tr class="hover:bg-gray-50">
            <td class="px-4 py-3">{{ $sn++ }}</td>
            <td class="px-4 py-3"><div class="font-medium">{{ $slip->po_sn }}</div><div class="text-xs text-gray-500">{{ $slip->po_date->format('Y-m-d') }}</div></td>
            <td class="px-4 py-3">{{ $slip->department->name ?? 'â€”' }}</td>
            <td class="px-4 py-3 text-right space-x-2">
              <td class="px-4 py-3 text-right space-x-2">
  @if(($slip->purchases_count ?? 0) > 0)
  <a class="text-indigo-600 hover:underline text-sm" href="{{ route('slips.print', $slip) }}">
      à¤–à¤°à¤¿à¤¦ à¤®à¤¾à¤— à¤«à¤¾à¤°à¤¾à¤®
    </a>
    {{-- Already purchased: hide Edit/Delete/Purchase; show Purchased Slip + Print --}}
    <a class="text-emerald-700 hover:underline text-sm " href="{{ route('purchases.show', parameters: $slip->purchase_slip->purchase_sn) }}">
     à¤¸à¥à¤Ÿà¥‹à¤° à¤ªà¥à¤°à¤¾à¤ªà¥à¤¤à¤¿
    </a>
    
  @else
    {{-- Not purchased yet: allow Purchase/Edit/Delete + normal Print --}}
    <a class="text-indigo-600 hover:underline text-sm" href="{{ route('purchases.create', ['slip_id' => $slip->id]) }}">
      Purchase
    </a>
    <a class="text-blue-600 hover:underline text-sm" href="{{ route('slips.edit', parameters: $slip->po_sn) }}">Edit</a>
    <form class="inline" method="POST" action="{{ route('slips.destroy', $slip->po_sn) }}" onsubmit="return confirm('Delete slip?')">
      @csrf @method('DELETE')
      <button class="text-red-600 hover:underline text-sm">Delete</button>
    </form>
    <a class="text-emerald-700 hover:underline text-sm" href="{{ route('slips.print', $slip->po_sn) }}">
      Print / PDF
    </a>
  @endif
</td>

            </td>
          </tr>
        @empty
          <tr><td colspan="4" class="px-4 py-6 text-center text-gray-500">No slips found.</td></tr>
        @endforelse
      </tbody>
    </table>
    <div class="px-4 py-3 border-t bg-gray-50">{{ $slips->links() }}</div>
  </div>
</div>
@endsection
</file>

<file path="resources/views/Backend/slips/print.blade.php">
@extends('Backend.layouts.app')

@section('content')
<style>
    @page {
        size: A4;
        margin: 14mm 12mm;
    }

    body {
        font-family: "Noto Sans Devanagari", "Mangal", "Kalimati", Arial, sans-serif;
        color: #111;
        display: flex;
        flex-direction: column;
        min-height: 100vh;
    }

    .a4 {
        width: 190mm;
        margin: 0 auto;
        display: flex;
        flex-direction: column;
        min-height: 100%;
    }

    .line {
        border-top: 1px solid #000;
        margin: 6px 0 12px;
    }

    /* ===== SCREEN STYLE ===== */
    @media screen {
        body {
            background: #f9fafb;
            padding: 24px;
        }

        .a4 {
            background: #fff;
            padding: 12mm;
            box-shadow: 0 4px 20px rgba(0, 0, 0, .1);
            border-radius: 8px;
        }

        .printbar {
            display: flex;
            justify-content: end;
            gap: 8px;
            margin-bottom: 16px;
        }

        button {
            padding: 8px 16px;
            border: 1px solid #ccc;
            border-radius: 8px;
            background: white;
            font-size: 14px;
            cursor: pointer;
        }

        button:hover {
            background: #f3f4f6;
        }
    }

    /* ===== PRINT STYLE ===== */
    @media print {
        .printbar,
        header,
        nav,
        aside,
        .sidebar,
        .navbar,
        .footer,
        .app-header,
        .app-footer {
            display: none !important;
        }

        body * {
            visibility: hidden !important;
        }

        .a4,
        .a4 * {
            visibility: visible !important;
        }

        .a4 {
            position: absolute;
            left: 0;
            top: 0;
            margin: 0 !important;
            box-shadow: none !important;
            border-radius: 0 !important;
            width: 190mm;
        }

        footer {
            position: fixed;
            bottom: 14mm;
            left: 0;
            right: 0;
        }
    }
</style>

<!-- Print button (screen only) -->
<div class="printbar">
    <button onclick="window.print()">ðŸ–¨ï¸ Print / Save as PDF</button>
</div>

<!-- Printable content -->
<div class="a4" id="printable">
    <!-- Top-right code -->
    <div class="text-center text-xs text-gray-700 mb-2">à¤¤à¥à¤°à¤¿. à¤µà¤¿ à¤«à¤¾. à¤¨à¤‚. à¥§à¥­</div>

    <!-- Header -->
    <div class="text-center leading-tight mb-6">
        <div class="text-xl font-bold">à¤¤à¥à¤°à¤¿à¤­à¥à¤µà¤¨ à¤µà¤¿à¤¶à¥à¤µà¤µà¤¿à¤¦à¥à¤¯à¤¾à¤²à¤¯</div>
        <div class="text-base font-medium mt-1">à¤ªà¥‚à¤°à¥à¤µà¤¾à¤žà¥à¤šà¤² à¤•à¥à¤¯à¤¾à¤®à¥à¤ªà¤¸, à¤§à¤°à¤¾à¤¨</div>
        <div class="text-lg font-semibold mt-2 underline underline-offset-4">à¤–à¤°à¤¿à¤¦ à¤®à¤¾à¤— à¤«à¤¾à¤°à¤¾à¤®</div>
    </div>

    <!-- Metadata -->
    <div class="flex justify-between text-sm mb-3">
        <div>à¤•à¥à¤°.à¤¸.: <strong>{{ $slip->po_sn }}</strong></div>
        <div>à¤®à¤¿à¤¤à¤¿: 
            <strong>
                {{ optional(\Illuminate\Support\Carbon::parse($slip->po_date))->format('Y-m-d') ?? 'â€”' }}
            </strong>
        </div>
    </div>

    <div class="line"></div>

    <div class="text-sm mb-2">à¤¶à¥à¤°à¥€à¤®à¤¾à¤¨ à¤•à¥à¤¯à¤¾à¤®à¥à¤ªà¤¸ à¤ªà¥à¤°à¤®à¥à¤–à¤œà¥à¤¯à¥‚,</div>
    <p class="text-sm mt-4 mb-3 leading-relaxed">
        à¤¨à¤¿à¤®à¥à¤¨ à¤µà¤¿à¤µà¤°à¤£ à¤…à¤¨à¥à¤¸à¤¾à¤°à¤•à¥‹ à¤®à¤¾à¤²à¤¸à¤¾à¤®à¤¾à¤¨à¤•à¥‹ à¤†à¤µà¤¶à¥à¤¯à¤•à¤¤à¤¾ à¤ªà¤°à¥‡à¤•à¥‹ à¤¹à¥à¤à¤¦à¤¾ à¤–à¤°à¤¿à¤¦à¤•à¤¾ à¤²à¤¾à¤—à¤¿ à¤†à¤µà¤¶à¥à¤¯à¤• à¤µà¥à¤¯à¤µà¤¸à¥à¤¥à¤¾ à¤—à¤°à¤¿à¤¦à¤¿à¤¨à¥à¤¹à¥à¤¨ à¤…à¤¨à¥à¤°à¥‹à¤§ à¤—à¤°à¥à¤¦à¤›à¥à¥¤
    </p>
    <div class="text-sm mb-3 text-right">
        <span class="font-medium">
            ...............................<br>à¤¸à¥à¤Ÿà¥‹à¤° à¤•à¤¿à¤ªà¤°, à¤®à¤¾à¤— à¤—à¤°à¥à¤¨à¥‡
        </span>
    </div>

    <!-- Table -->
    <div class="overflow-x-auto text-center">
        <table class="w-full border border-black border-collapse text-sm leading-snug">
            <thead>
                <tr>
                    <th class="border border-black px-2 py-1 text-center w-10">à¤¸à¤¿.à¤¨à¤‚</th>
                    <th class="border border-black px-2 py-1 text-center w-56">à¤®à¤¾à¤²à¤¸à¤¾à¤®à¤¾à¤¨à¤•à¥‹ à¤µà¤¿à¤µà¤°à¤£</th>
                    <th class="border border-black px-2 py-1 text-center w-14">à¤à¤•à¤¾à¤ˆ</th>
                    <th class="border border-black px-2 py-1 text-center w-20">à¤¨à¥à¤¯à¥‚à¤¨à¤¤à¤® à¤®à¥Œà¤œà¥à¤¦à¤¾à¤¤</th>
                    <th class="border border-black px-2 py-1 text-center w-20">à¤¸à¥à¤Ÿà¥‹à¤° à¤®à¥Œà¤œà¥à¤¦à¤¾à¤¤</th>
                    <th class="border border-black px-2 py-1 text-center w-20">à¤†à¤µà¤¶à¥à¤¯à¤• à¤ªà¤°à¤¿à¤®à¤¾à¤£</th>
                    <th class="border border-black px-2 py-1 text-center w-24">à¤°à¤•à¤®</th>
                    <th class="border border-black px-2 py-1 text-center w-20">à¤¬à¤œà¥‡à¤Ÿ à¤•à¥‹à¤¡ à¤¨à¤‚.</th>
                    <th class="border border-black px-2 py-1 text-center w-16">à¤•à¥ˆà¤«à¤¿à¤¯à¤¤</th>
                </tr>
            </thead>

            <tbody>
                @php
                    $total = 0;
                    $rowCount = count($items) ?: 1;
                @endphp

                @forelse($items as $i => $row)
                    @php
                        $amt = (float) str_replace(',', '', $row['amount'] ?? 0);
                        $total += $amt;
                    @endphp
                    <tr class="align-top">
                        <td class="border border-black text-center">{{ $row['sn'] }}</td>
                        <td class="border border-black px-2 break-words">{{ $row['desc'] }}</td>
                        <td class="border border-black text-center">{{ $row['unit'] ?? 'â€”' }}</td>
                        <td class="border border-black text-center">{{ $row['min_stock'] ?? 'â€”' }}</td>
                        <td class="border border-black text-center">{{ $row['store_bal'] ?? 'â€”' }}</td>
                        <td class="border border-black text-center">{{ $row['required'] ?? 'â€”' }}</td>
                        <td class="border border-black text-center">{{ $row['amount'] ?? 'â€”' }}</td>
                        <td class="border border-black text-center">{{ $row['budget'] ?? 'â€”' }}</td>

                        @if ($i === 0)
                            <td rowspan="{{ $rowCount + 1 }}" class="border border-black p-0">
                                <div class="h-full w-full flex items-center justify-center text-[13px] font-medium text-gray-800 px-1">
                                    {{ $slip->remarks ?? 'â€”' }}
                                </div>
                            </td>
                        @endif
                    </tr>
                @empty
                    <tr>
                        <td colspan="9" class="text-center py-8 text-gray-600">
                            à¤•à¥à¤¨à¥ˆ à¤¸à¤¾à¤®à¤¾à¤—à¥à¤°à¥€ à¤¸à¥‚à¤šà¥€à¤¬à¤¦à¥à¤§ à¤—à¤°à¤¿à¤à¤•à¥‹ à¤›à¥ˆà¤¨ à¥¤
                        </td>
                    </tr>
                @endforelse

                @if (count($items))
                    <tr class="font-semibold">
                        <td colspan="6" class="border border-black text-center px-3 py-2">à¤œà¤®à¥à¤®à¤¾ à¤°à¤•à¤®</td>
                        <td class="border border-black text-center px-3 py-2">{{ number_format($total, 2) }}</td>
                        <td colspan="2" class="border border-black"></td>
                    </tr>
                @endif
            </tbody>
        </table>
    </div>

    <!-- Footer -->
    <footer class="mt-auto pt-8">
        <div class="flex justify-between text-sm mt-10">
            <div class="text-center w-1/3">
                <p class="text-left text-[13px] font-medium mb-4">à¤¬à¤œà¥‡à¤Ÿà¤²à¥‡ à¤­à¥à¤¯à¤¾à¤‰à¤¨à¥‡ / à¤¨à¤­à¥à¤¯à¤¾à¤‰à¤¨à¥‡</p>
                <div class="mt-6 leading-tight">
                    .........................................<br>à¤²à¥‡à¤–à¤¾
                </div>
            </div>

            <div class="text-center w-1/3">
                <div class="mt-12 leading-tight">
                    .........................................<br>à¤¸à¤¿à¤«à¤¾à¤°à¤¿à¤¸ à¤—à¤°à¥à¤¨à¥‡
                </div>
            </div>

            <div class="text-center w-1/3">
                <div class="mt-12 leading-tight">
                    .........................................<br>à¤¸à¥à¤µà¥€à¤•à¥ƒà¤¤ à¤—à¤°à¥à¤¨à¥‡
                </div>
            </div>
        </div>

        <div class="text-xs text-gray-700 mt-8 border-t border-gray-300 pt-3 leading-relaxed">
            <strong>à¤¦à¥à¤°à¤·à¥à¤Ÿà¤µà¥à¤¯:</strong> à¤¸à¤¾à¤®à¤¾à¤¨à¤•à¥‹ à¤²à¤¾à¤—à¤¿ à¤®à¤¾à¤— à¤«à¤¾à¤°à¤¾à¤® à¤­à¤°à¥à¤¨à¤¾ à¤†à¤µà¤¶à¥à¤¯à¤• à¤­à¤à¤•à¥‹ à¤•à¤¾à¤°à¤£ à¤¸à¥à¤ªà¤·à¥à¤Ÿ à¤–à¥à¤²à¤¾à¤‰à¤¨à¥ à¤¹à¥‹à¤²à¤¾à¥¤
        </div>
    </footer>
</div>
@endsection
</file>

<file path="resources/views/Backend/slips/show.blade.php">
@extends('Backend.layouts.app')

@section('content')
<div class="max-w-6xl mx-auto px-4 py-8">
  <div class="mb-4 flex items-center justify-between">
    <div>
      <h1 class="text-2xl font-bold">Slip #{{ $slip->po_sn }}</h1>
      <p class="text-sm text-gray-500">
        Date: {{ $slip->po_date->format('Y-m-d') }}
        â€¢ Dept: {{ $slip->department->name ?? 'â€”' }}
      </p>
    </div>
    <a href="{{ route('purchases.create', ['slip_id' => $slip->id]) }}"
       class="rounded-xl bg-gray-900 text-white px-4 py-2.5 text-sm font-semibold hover:bg-gray-800">
      + Create Purchase
    </a>
  </div>

  @if (session('success'))
    <div class="mb-4 rounded-xl border border-green-200 bg-green-50 px-4 py-3 text-green-800 text-sm">
      {{ session('success') }}
    </div>
  @endif
  @if (session('error'))
    <div class="mb-4 rounded-xl border border-red-200 bg-red-50 px-4 py-3 text-red-800 text-sm">
      {{ session('error') }}
    </div>
  @endif

  <div class="rounded-2xl border border-gray-200 bg-white shadow-sm overflow-hidden">
    <table class="w-full text-left">
      <thead class="bg-gray-50 text-xs uppercase text-gray-600">
        <tr>
          <th class="px-4 py-3">Item</th>
          <th class="px-4 py-3">Ordered</th>
          <th class="px-4 py-3">Purchased</th>
          <th class="px-4 py-3">Remaining</th>
          <th class="px-4 py-3">Max Rate</th>
        </tr>
      </thead>
      <tbody class="divide-y divide-gray-100">
        @forelse($slip->items as $it)
          @php
            // Use precomputed map from controller to avoid N+1; null product_id => 0 purchased
            $purchased = $it->product_id ? (float)($purchasedByProduct[$it->product_id] ?? 0) : 0.0;
            $remaining = max(0, (float)$it->ordered_qty - $purchased);
          @endphp
          <tr class="align-top">
            <td class="px-4 py-3">
              @if($it->product_id && $it->product)
                <div class="font-medium">
                  {{ $it->product->name }}
                  @if($it->product->sku)
                    <span class="text-gray-500">({{ $it->product->sku }})</span>
                  @endif
                </div>
                <div class="mt-1 text-xs inline-flex items-center gap-1 rounded-full bg-blue-50 text-blue-700 px-2 py-0.5">
                  Linked Product
                </div>
              @else
                <div class="font-medium">
                  {{ $it->temp_name ?? 'â€”' }}
                  @if($it->temp_sn)
                    <span class="text-gray-500">({{ $it->temp_sn }})</span>
                  @endif
                </div>
                <div class="mt-1 text-xs inline-flex items-center gap-1 rounded-full bg-amber-50 text-amber-700 px-2 py-0.5">
                  Custom Slip Item
                </div>
              @endif
            </td>

            <td class="px-4 py-3 whitespace-nowrap">
              {{ number_format((float)$it->ordered_qty, 3) }}
              @if($it->unit) <span class="text-gray-500 text-xs">{{ $it->unit }}</span> @endif
            </td>

            <td class="px-4 py-3 whitespace-nowrap">
              {{ number_format($purchased, 3) }}
              @if($it->unit) <span class="text-gray-500 text-xs">{{ $it->unit }}</span> @endif
            </td>

            <td class="px-4 py-3 font-semibold whitespace-nowrap">
              {{ number_format($remaining, 3) }}
              @if($it->unit) <span class="text-gray-500 text-xs">{{ $it->unit }}</span> @endif
            </td>

            <td class="px-4 py-3 whitespace-nowrap">
              {{ number_format((float)$it->max_rate, 2) }}
            </td>
          </tr>
        @empty
          <tr>
            <td colspan="5" class="px-4 py-6 text-center text-gray-500">No items on this slip yet.</td>
          </tr>
        @endforelse
      </tbody>

      @if($slip->items->count())
        @php
          $totalOrdered = $slip->items->sum(fn($i) => (float)$i->ordered_qty);
          $totalPurchased = $slip->items->sum(function($i) use ($purchasedByProduct){
            return $i->product_id ? (float)($purchasedByProduct[$i->product_id] ?? 0) : 0.0;
          });
          $totalRemaining = max(0, $totalOrdered - $totalPurchased);
          $grossCap = $slip->items->sum(fn($i) => (float)$i->line_total);
        @endphp
        <tfoot class="bg-gray-50">
          <tr class="font-semibold">
            <td class="px-4 py-3">Totals</td>
            <td class="px-4 py-3">{{ number_format($totalOrdered, 3) }}</td>
            <td class="px-4 py-3">{{ number_format($totalPurchased, 3) }}</td>
            <td class="px-4 py-3">{{ number_format($totalRemaining, 3) }}</td>
            <td class="px-4 py-3">{{ number_format($grossCap, 2) }}</td>
          </tr>
        </tfoot>
      @endif
    </table>
  </div>

  <div class="mt-4 text-xs text-gray-500">
    <p>
      Note: Rows marked <span class="inline-block rounded-full bg-amber-50 text-amber-700 px-2 py-0.5">Custom Slip Item</span>
      were entered as free text on the slip and are not yet linked to a Product. Theyâ€™ll be linked/created when you make a Purchase.
    </p>
  </div>
</div>
@endsection
</file>

<file path="resources/views/Backend/store/browse_ic_categories.blade.php">
@extends('Backend.layouts.app')
@section('content')
<div class="max-w-6xl mx-auto px-4 py-8">
  <div class="mb-6 flex items-center justify-between">
    <div>
      <h1 class="text-2xl font-bold">Product Categories under: {{ $itemCategoryName }}</h1>
      <div class="text-sm text-gray-500">
        <a href="{{ route('store.browse.ic') }}" class="text-blue-600 hover:underline">â† Item Categories</a>
      </div>
    </div>
    <a href="{{ route('store.browse') }}"
       class="rounded-xl border border-gray-200 bg-white px-4 py-2.5 text-sm font-semibold text-gray-700 hover:bg-gray-50">
      Browse Home
    </a>
  </div>

  <div class="rounded-2xl border border-gray-200 bg-white shadow-sm overflow-hidden">
    <table class="w-full text-left">
      <thead class="bg-gray-50 text-xs uppercase text-gray-600">
        <tr>
          <th class="px-4 py-3 w-16">S.N</th>
          <th class="px-4 py-3">Product Category</th>
          <th class="px-4 py-3">Items</th>
          <th class="px-4 py-3">Amount</th>
          <th class="px-4 py-3 text-right">Actions</th>
        </tr>
      </thead>
      <tbody class="divide-y divide-gray-100">
        @php $sn = 1; @endphp
        @forelse($rows as $r)
          <tr class="hover:bg-gray-50">
            <td class="px-4 py-3">{{ $sn++ }}</td>
            <td class="px-4 py-3 font-medium">{{ $r['category'] }}</td>
            <td class="px-4 py-3">{{ $r['items_count'] }}</td>
            <td class="px-4 py-3">{{ $r['total_amount'] }}</td>
            <td class="px-4 py-3 text-right space-x-2">
              {{-- View Items scoped by both category & item-category --}}
              <a href="{{ route('store.categories.items', ['category' => $r['category_id'], 'ic' => $itemCategoryId]) }}"
                 class="text-blue-700 hover:underline text-sm">
                View Items
              </a>
              <span class="mx-1 text-gray-300">|</span>
              {{-- Ledger by Product Category (not item-category scoped) --}}
              <a href="{{ route('store.categories.show', $r['category_id']) }}"
                 class="text-indigo-600 hover:underline text-sm">
                View Ledger
              </a>
            </td>
          </tr>
        @empty
          <tr><td colspan="5" class="px-4 py-6 text-center text-gray-500">No product categories under this item category.</td></tr>
        @endforelse
      </tbody>
    </table>
  </div>
</div>
@endsection
</file>

<file path="resources/views/Backend/store/browse_item_categories.blade.php">
@extends('Backend.layouts.app')
@section('content')
<div class="max-w-5xl mx-auto px-4 py-8">
  <div class="mb-6 flex items-center justify-between">
    <h1 class="text-2xl font-bold">Item Categories in Store</h1>
    <a href="{{ route('store.browse') }}"
       class="rounded-xl border border-gray-200 bg-white px-4 py-2.5 text-sm font-semibold text-gray-700 hover:bg-gray-50">
      â† Browse
    </a>
  </div>

  <div class="rounded-2xl border border-gray-200 bg-white shadow-sm overflow-hidden">
    <table class="w-full text-left">
      <thead class="bg-gray-50 text-xs uppercase text-gray-600">
        <tr>
          <th class="px-4 py-3 w-16">S.N</th>
          <th class="px-4 py-3">Item Category</th>
          <th class="px-4 py-3">Items</th>
          <th class="px-4 py-3">Amount</th>
          <th class="px-4 py-3 text-right">Actions</th>
        </tr>
      </thead>
      <tbody class="divide-y divide-gray-100">
        @php $sn = 1; @endphp
        @forelse($ics as $r)
          <tr class="hover:bg-gray-50">
            <td class="px-4 py-3">{{ $sn++ }}</td>
            <td class="px-4 py-3 font-medium">{{ $r['name'] }}</td>
            <td class="px-4 py-3">{{ $r['items_count'] }}</td>
            <td class="px-4 py-3">{{ $r['total_amount'] }}</td>
            <td class="px-4 py-3 text-right">
              <a href="{{ route('store.browse.ic.categories', $r['item_category_id']) }}"
                 class="text-blue-600 hover:underline text-sm">
                Choose Product Category â†’
              </a>
            </td>
          </tr>
        @empty
          <tr><td colspan="5" class="px-4 py-6 text-center text-gray-500">No item categories found in store.</td></tr>
        @endforelse
      </tbody>
    </table>
  </div>
</div>
@endsection
</file>

<file path="resources/views/Backend/store/browse_root.blade.php">
@extends('Backend.layouts.app')
@section('content')
<div class="max-w-4xl mx-auto px-4 py-10">
  <h1 class="text-2xl font-bold mb-6">Browse Store</h1>

  <div class="grid sm:grid-cols-2 gap-4">
    <a href="{{ route('store.browse.ic') }}"
       class="block rounded-2xl border border-gray-200 bg-white p-6 shadow-sm hover:shadow">
      <div class="text-lg font-semibold mb-1">Browse by Item Category</div>
      <p class="text-sm text-gray-600">Pick an Item Category first, then choose a Product Category under it.</p>
    </a>

    <a href="{{ route('store.categories') }}"
       class="block rounded-2xl border border-gray-200 bg-white p-6 shadow-sm hover:shadow">
      <div class="text-lg font-semibold mb-1">Browse by Product Category (All)</div>
      <p class="text-sm text-gray-600">See all Product Categories that have Store Entries.</p>
    </a>
  </div>
</div>
@endsection
</file>

<file path="resources/views/Backend/store/categories.blade.php">
@extends('Backend.layouts.app')
@section('content')
    <style>
        @media screen {
            .printbar {
                display: flex;
                justify-content: space-between;
                align-items: center;
                gap: 8px;
                margin-bottom: 16px;
                flex-wrap: wrap;
            }

            .printbar a,
            .printbar button {
                padding: 8px 16px;
                border: 1px solid #d1d5db;
                border-radius: 8px;
                background: white;
                font-size: 14px;
            }

            .printbar a:hover,
            .printbar button:hover {
                background: #f3f4f6;
            }
        }
    </style>

    <div class="max-w-6xl mx-auto px-4 py-8">
        <div class="mb-6 flex items-center justify-between">
            <h1 class="text-2xl font-bold">Store: Browse by Product Category</h1>
            <a href="{{ route('store.index') }}"
                class="rounded-xl border border-gray-200 bg-white px-4 py-2.5 text-sm font-semibold text-gray-700 hover:bg-gray-50">
                â† Store Entries
            </a>
        </div>

        <div class="printbar">
            <form method="GET" class="flex gap-2 items-center flex-wrap">
                <input type="date" name="from" value="{{ $filters['from'] }}" class="rounded border px-3 py-2 text-sm">
                <input type="date" name="to" value="{{ $filters['to'] }}" class="rounded border px-3 py-2 text-sm">
                <button class="rounded bg-blue-600 text-white px-4 py-2 text-sm">Filter</button>
                @if ($filters['from'] || $filters['to'])
                    <a href="{{ route('store.categories') }}" class="text-sm text-gray-700">Reset</a>
                @endif
            </form>
        </div>

        <div class="rounded-2xl border border-gray-200 bg-white shadow-sm overflow-hidden">
            <table class="w-full text-left">
                <thead class="bg-gray-50 text-xs uppercase text-gray-600">
                    <tr>
                        <th class="px-4 py-3 w-16">S.N</th>
                        <th class="px-4 py-3">Product Category</th>
                        <th class="px-4 py-3">Items in Store</th>
                        <th class="px-4 py-3">Total Amount</th>
                        <th class="px-4 py-3 text-right">Actions</th>
                    </tr>
                </thead>
                <tbody class="divide-y divide-gray-100">
                    @forelse($rows as $i => $r)
                        <tr class="hover:bg-gray-50">
                            <td class="px-4 py-3">{{ $i + 1 }}</td>
                            <td class="px-4 py-3 font-medium">{{ $r['category_name'] }}</td>
                            <td class="px-4 py-3">{{ $r['items_count'] }}</td>
                            <td class="px-4 py-3">{{ $r['total_amount'] }}</td>
                            <td class="px-4 py-3 text-right">
                                <a class="text-indigo-600 hover:underline text-sm"
                                    href="{{ route('store.categories.show', $r['category_id']) }}">
                                    View Ledger
                                </a>
                                <span class="mx-1 text-gray-300">|</span>
                                <a class="text-blue-700 hover:underline text-sm"
                                    href="{{ route('store.categories.items', $r['category_id']) }}">
                                    View Items
                                </a>
                            </td>
                        </tr>
                    @empty
                        <tr>
                            <td colspan="5" class="px-4 py-6 text-center text-gray-500">
                                No categories found in Store
                                Entries{{ $filters['from'] || $filters['to'] ? ' for the selected period' : '' }}.
                            </td>
                        </tr>
                    @endforelse
                </tbody>
            </table>
        </div>
    </div>
    
@endsection
</file>

<file path="resources/views/Backend/store/category_items.blade.php">
@extends('Backend.layouts.app')
@section('content')
<div class="max-w-6xl mx-auto px-4 py-8">
  <div class="mb-6 flex flex-col sm:flex-row sm:items-center sm:justify-between gap-3">
    <div>
      <h1 class="text-2xl font-bold">Items â€” {{ $categoryName }}</h1>
      <div class="text-sm text-gray-500">
        <a href="{{ route('store.ledger') }}" class="text-blue-600 hover:underline">â† All Categories</a>
      </div>
    </div>
    <div class="flex gap-2">
      <a href="{{ route('store.categories.show', $categoryId) }}"
         class="rounded-xl border border-gray-200 bg-white px-4 py-2.5 text-sm font-semibold text-gray-700 hover:bg-gray-50">
        View Ledger
      </a>
    </div>
  </div>

  <form method="GET" action="{{ route('store.categories.items', $categoryId) }}" class="mb-6">
    <div class="flex flex-col sm:flex-row gap-3 sm:items-center">
      <input type="text" name="search" value="{{ $filters['search'] }}"
             class="w-full rounded-xl border border-gray-300 px-4 py-2.5 text-sm focus:border-blue-400 focus:ring-1 focus:ring-blue-400"
             placeholder="Search item name / SN / supplier / purchase SN / slip SN...">

      <input type="date" name="from" value="{{ $filters['from'] }}"
             class="rounded-xl border border-gray-300 px-4 py-2.5 text-sm">
      <input type="date" name="to"   value="{{ $filters['to']   }}"
             class="rounded-xl border border-gray-300 px-4 py-2.5 text-sm">

      <button class="rounded-xl bg-blue-600 text-white px-5 py-2.5 text-sm hover:bg-blue-700">Search</button>

      @if($filters['search'] || $filters['from'] || $filters['to'])
        <a href="{{ route('store.categories.items', $categoryId) }}"
           class="rounded-xl border border-gray-200 bg-white px-4 py-2.5 text-sm font-semibold text-gray-700 hover:bg-gray-50">
          Reset
        </a>
      @endif
    </div>
  </form>

  <div class="rounded-2xl border border-gray-200 bg-white shadow-sm overflow-hidden">
    <table class="w-full text-left">
      <thead class="bg-gray-50 text-xs uppercase text-gray-600">
        <tr>
          <th class="px-4 py-3 w-16">S.N</th>
          <th class="px-4 py-3">Name (SN)</th>
          <th class="px-4 py-3">Supplier</th>
          <th class="px-4 py-3">Slip</th>
          <th class="px-4 py-3">Purchase</th>
          <th class="px-4 py-3">Unit</th>
          <th class="px-4 py-3">Qty</th>
          <th class="px-4 py-3">Rate</th>
          <th class="px-4 py-3">Amount</th>
          <th class="px-4 py-3 text-right">Actions</th>
        </tr>
      </thead>
      <tbody class="divide-y divide-gray-100">
        @php $sn = ($items->currentPage() - 1) * $items->perPage() + 1; @endphp
        @forelse($items as $it)
          @php
            $p   = $it->entry?->purchase;
            $sl  = $p?->slip;
            $sup = $p?->supplier?->name;
            $qty = (float)($it->qty ?? 0);
            $rate= (float)($it->rate ?? 0);
            $amt = (float)($it->total_price ?? ($qty * $rate));
          @endphp
          <tr class="hover:bg-gray-50">
            <td class="px-4 py-3">{{ $sn++ }}</td>

            <td class="px-4 py-3">
              <div class="font-medium text-gray-900">{{ $it->item_name }}</div>
              <div class="text-xs text-gray-500">{{ $it->item_sn }}</div>
            </td>

            <td class="px-4 py-3">{{ $sup ?? 'â€”' }}</td>

            <td class="px-4 py-3 text-sm">
              @if($sl)
                <div>
                  <a class="text-blue-600 hover:underline"
                     href="{{ route('slips.show', $sl->id ?? $p->purchase_slip_id) }}">
                    {{ $sl->po_sn }}
                  </a>
                </div>
                <div class="text-xs text-gray-500">{{ optional($sl->po_date)->format('Y-m-d') }}</div>
              @else
                â€”
              @endif
            </td>

            <td class="px-4 py-3 text-sm">
              @if($p)
                <div>
                  <a class="text-blue-600 hover:underline"
                     href="{{ route('purchases.show', $p->id) }}">
                    {{ $p->purchase_sn }}
                  </a>
                </div>
                <div class="text-xs text-gray-500">{{ optional($p->purchase_date)->format('Y-m-d') }}</div>
              @else
                â€”
              @endif
            </td>

            <td class="px-4 py-3">{{ $it->unit ?: 'â€”' }}</td>
            <td class="px-4 py-3">{{ number_format($qty, 3) }}</td>
            <td class="px-4 py-3">{{ number_format($rate, 2) }}</td>
            <td class="px-4 py-3">{{ number_format($amt, 2) }}</td>

            <td class="px-4 py-3 text-right space-x-2">
              {{-- Go to Ledger for this category --}}
              <a href="{{ route('store.categories.show', $categoryId) }}" class="text-indigo-600 hover:underline text-sm">
                See Ledger
              </a>
              {{-- Optional: view the Store Entry that contains this item --}}
              @if($it->entry)
                <span class="mx-1 text-gray-300">|</span>
                <a href="{{ route('store.show', $it->entry) }}" class="text-blue-600 hover:underline text-sm">
                  Store Entry
                </a>
                <a href="{{ route('store.out.create', ['item_id' => $it->id]) }}"
     class="text-emerald-600 hover:underline text-sm">
    Store OUT
  </a>
              @endif
            </td>
            
          </tr>
        @empty
          <tr>
            <td colspan="10" class="px-4 py-6 text-center text-gray-500">No items found in this category.</td>
          </tr>
        @endforelse
      </tbody>
    </table>

    <div class="px-4 py-3 border-t bg-gray-50">
      {{ $items->links() }}
    </div>
  </div>
</div>
@endsection
</file>

<file path="resources/views/Backend/store/index.blade.php">
@extends('Backend.layouts.app')

@section('content')
<div class="max-w-6xl mx-auto px-4 py-8">
  <div class="mb-6 flex items-center justify-between">
    <h1 class="text-2xl font-bold">Store Entries</h1>
    <a href="{{ route('purchases.index') }}"
       class="rounded-xl border border-gray-200 bg-white px-4 py-2.5 text-sm font-semibold text-gray-700 hover:bg-gray-50">
      â† Purchases
    </a>
  </div>

  <form method="GET" action="{{ route('store.index') }}" class="mb-6">
    <div class="flex flex-col sm:flex-row gap-3 sm:items-center">
      <input type="text" name="search" value="{{ request('search') }}"
             class="w-full rounded-xl border border-gray-300 px-4 py-2.5 text-sm focus:border-blue-400 focus:ring-1 focus:ring-blue-400"
             placeholder="Search by Purchase SN / Supplier">
      <button class="rounded-xl bg-blue-600 text-white px-5 py-2.5 text-sm hover:bg-blue-700">Search</button>
    </div>
  </form>

  <div class="rounded-2xl border border-gray-200 bg-white shadow-sm overflow-hidden">
    <table class="w-full text-left">
      <thead class="bg-gray-50 text-xs uppercase text-gray-600">
        <tr>
          <th class="px-4 py-3 w-16">S.N</th>
          <th class="px-4 py-3">Purchase SN / Date</th>
          <th class="px-4 py-3">Supplier</th>
          <th class="px-4 py-3">Items</th>
          <th class="px-4 py-3 text-right">Actions</th>
        </tr>
      </thead>
      <tbody class="divide-y divide-gray-100">
        @php $sn = ($entries->currentPage()-1)*$entries->perPage()+1; @endphp
        @forelse($entries as $e)
          <tr class="hover:bg-gray-50">
            <td class="px-4 py-3">{{ $sn++ }}</td>
            <td class="px-4 py-3">
              <div class="font-medium">{{ $e->purchase_sn }}</div>
              <div class="text-xs text-gray-500">{{ $e->purchase_date }}</div>
            </td>
            <td class="px-4 py-3">{{ $e->supplier_name ?? $e->supplier?->name ?? 'â€”' }}</td>
            <td class="px-4 py-3">{{ $e->items()->count() }}</td>
            <td class="px-4 py-3 text-right">
              <a class="text-blue-600 hover:underline text-sm" href="{{ route('store.show', $e) }}">View</a>
            </td>
          </tr>
        @empty
          <tr><td colspan="5" class="px-4 py-6 text-center text-gray-500">No store entries yet.</td></tr>
        @endforelse
      </tbody>
    </table>
    <div class="px-4 py-3 border-t bg-gray-50">
      {{ $entries->links() }}
    </div>
  </div>
</div>
@endsection
</file>

<file path="resources/views/Backend/store/ledger_category.blade.php">
@extends('Backend.layouts.app')
@section('content')
    <style>
        /* ----------- PRINT (A4 Landscape) ----------- */
        @page {
            size: A4 landscape;
            margin: 14mm 12mm;
        }

        /* ----------- BASE STYLES ----------- */
        body {
            font-family: "Noto Sans Devanagari", "Mangal", "Kalimati", Arial, sans-serif;
            color: #111;
            overflow-x: hidden;
        }

        .a4 {
            width: 100%;
            max-width: 100%;
            margin: 0 auto;
            background: #fff;
            padding: 1rem;
            box-sizing: border-box;
        }

        .line {
            border-top: 1px solid #000;
            margin: 6px 0 12px;
        }

        @media screen {
            body {
                background: #f9fafb;
                padding: 24px;
            }

            .a4 {
                background: #fff;
                padding: 16px;
                box-shadow: 0 4px 20px rgba(0, 0, 0, .1);
                border-radius: 8px;
                overflow-x: auto;
                /* âœ… allows horizontal scroll if table overflows */
            }

            .printbar {
                display: flex;
                justify-content: space-between;
                align-items: center;
                gap: 8px;
                margin-bottom: 16px;
                flex-wrap: wrap;
            }

            .printbar a,
            .printbar button {
                padding: 8px 16px;
                border: 1px solid #d1d5db;
                border-radius: 8px;
                background: white;
                font-size: 14px;
                white-space: nowrap;
            }

            .printbar a:hover,
            .printbar button:hover {
                background: #f3f4f6;
            }
        }

        /* ----------- PRINT ONLY ----------- */
        @media print {

            .printbar,
            header,
            nav,
            aside,
            .sidebar,
            .navbar,
            .app-header,
            .app-footer,
            .site-header,
            .site-footer {
                display: none !important;
            }

            body * {
                visibility: hidden !important;
            }

            #printable,
            #printable * {
                visibility: visible !important;
            }

            body {
                padding: 0 !important;
                background: #fff !important;
                overflow: visible !important;
            }

            #printable {
                position: absolute;
                left: 0;
                top: 0;
                width: 100%;
                margin: 0 !important;
                box-shadow: none !important;
                border-radius: 0 !important;
                padding: 0 !important;
            }

            footer {
                position: fixed;
                bottom: 14mm;
                left: 0;
                right: 0;
            }
        }

        /* ----------- TABLE ----------- */
        table.ledger {
            width: 100%;
            border-collapse: collapse;
            table-layout: auto;
        }

        table.ledger th,
        table.ledger td {
            border: 1px solid #000;
            padding: 4px 6px;
            font-size: 12px;
            line-height: 1.3;
            word-break: break-word;
        }

        .tcenter {
            text-align: center;
        }

        .tright {
            text-align: right;
        }

        .small {
            font-size: 11px;
        }
    </style>

    <div class="printbar">
        <div class="text-sm text-gray-600">
            <a href="{{ route('store.index') }}">â† Store Entries</a>
        </div>
        <div class="flex gap-2 flex-wrap items-center">
            <form method="GET" class="flex gap-2 items-center flex-wrap">
                <input type="date" name="from" value="{{ request('from') }}" class="rounded border px-2 py-1 text-sm">
                <input type="date" name="to" value="{{ request('to') }}" class="rounded border px-2 py-1 text-sm">
                <button class="rounded bg-blue-600 text-white px-3 py-1.5 text-sm">Filter</button>
            </form>
            <button onclick="window.print()">ðŸ–¨ï¸ Print</button>
        </div>
    </div>

    <div id="printable" class="a4">
        <div class="tcenter mb-4">
            <div class="small">à¤¤à¥à¤°à¤¿à¤­à¥à¤µà¤¨ à¤µà¤¿à¤¶à¥à¤µà¤µà¤¿à¤¦à¥à¤¯à¤¾à¤²à¤¯</div>
            <div style="font-weight:700;">à¤ªà¥‚à¤°à¥à¤µà¤¾à¤žà¥à¤šà¤² à¤•à¥à¤¯à¤¾à¤®à¥à¤ªà¤¸, à¤§à¤°à¤¾à¤¨</div>
            <div style="font-weight:700; margin-top:4px;">à¤¸à¥à¤Ÿà¥‹à¤° à¤¶à¥à¤°à¥‡à¤£à¥€à¤—à¤¤ à¤–à¤¾à¤¤à¤¾ (Category Ledger)</div>
            <div class="text-2xl text-left" style="margin-top:4px;">
                à¤¶à¥à¤°à¥‡à¤£à¥€: <b>{{ $meta['category_name'] }}</b>
                @if ($meta['from'] || $meta['to'])
                    â€” à¤…à¤µà¤§à¤¿: <b>{{ $meta['from'] ?? 'â€¦' }}</b> à¤¦à¥‡à¤–à¤¿ <b>{{ $meta['to'] ?? 'â€¦' }}</b>
                @endif
            </div>
        </div>

        <div class="overflow-x-auto">
            <table class="ledger min-w-max">
                <thead>
                    <tr>
                        <th colspan="8" class="tcenter" style="width:40px;">à¤†à¤®à¥à¤¦à¤¾à¤¨à¥€ </th>
                        <th colspan="5" class="tcenter" style="width:40px;">kharcha </th>
                        <th colspan="5" class="tcenter" style="width:40px;">Baki </th>

                    </tr>


                    <tr>

                        <td colspan="2" class="tcenter" style="width:110px;">à¤–à¤°à¤¿à¤¦ à¤†à¤¦à¥‡à¤¶</td>
                        <td rowspan="2" class="tcenter" style="min-width:180px;">à¤¸à¤ªà¥à¤²à¤¾à¤¯à¤°à¥à¤¸ </td>
                        <td colspan="2" class="tcenter" style="width:110px;">à¤¸à¥à¤Ÿà¥‹à¤° à¤ªà¥à¤°à¤¾à¤ªà¥à¤¤à¤¿</th>
                        <td rowspan="2" class="tcenter" style="width:70px;">à¤ªà¤°à¤¿à¤®à¤¾à¤£</td>
                        <td rowspan="2" class="tcenter" style="width:90px;">à¤à¤•à¤¾à¤ˆÂ à¤¦à¤°</td>


                        <td rowspan="2" class="tcenter" style="width:90px;">à¤°à¤•à¤®</td>
                        <th colspan="2" class="tcenter" style="width:70px;">à¤–à¤°à¥à¤š à¤¨à¥‹à¤Ÿ </td>
                        <td rowspan="2" class="tcenter" style="width:70px;">à¤®à¤¾à¤²à¤¸à¤¾à¤®à¤¾à¤¨ à¤ªà¤ à¤¾à¤à¤•à¥‹ à¤¸à¥à¤¥à¤¾à¤¨ </td>
                        <th rowspan="2" class="tcenter" style="width:70px;">à¤ªà¤°à¤¿à¤®à¤¾à¤£</td>
                        <td rowspan="2" class="tcenter" style="width:90px;">à¤°à¤•à¤®</td>
                        <td rowspan="2" class="tcenter" style="width:90px;">à¤®à¥Œà¤œà¥à¤¦à¤¾à¤¤ à¤ªà¤°à¤¿à¤®à¤¾à¤£ </td>
                        <td rowspan="2" class="tcenter" style="width:90px;">à¤°à¤•à¤®</td>

                        <td rowspan="2" class="tcenter" style="width:150px;">à¤•à¥ˆà¤«à¤¿à¤¯à¤¤</td>

                    </tr>
                    <tr>
                        <td class="tcenter" style="width:70px;">à¤•à¥à¤°à¤®à¤¾à¤‚à¤•</td>
                        <td class="tcenter" style="width:80px;">à¤®à¤¿à¤¤à¤¿</td>
                        <td class="tcenter" style="width:70px;">à¤•à¥à¤°à¤®à¤¾à¤‚à¤•</td>
                        <td class="tcenter" style="width:70px;">à¤®à¤¿à¤¤à¤¿</td>
                        <td class="tcenter" style="width:70px;">à¤•à¥à¤°à¤®à¤¾à¤‚à¤•</td>

                        <td class="tcenter" style="width:70px;">à¤®à¤¿à¤¤à¤¿</td>



                    </tr>
                </thead>

                <tbody>


                    @forelse($rows as $r)
                        <tr>
                            <td class="tcenter">{{ $r['slip_sn'] }}</td>
                            <td class="tcenter small"><br>{{ $r['slip_date'] }}</td>
                            <td class="small text-center " style="width: 120px">{{ $r['supplier'] }} <br>( {{ $r['desc'] }})</td>
                            <td class="tcenter small">{{ $r['purchase_sn'] }}</td>
                            
                            
                            <td class="tcenter">{{ $r['purchase_date'] }}</td>
                            <td class="tcenter">{{ $r['qty'] }}({{ $r['unit']}})</td>
                            <td class="tright">{{ $r['rate'] }}</td>
                            <td class="tright">{{ $r['amount'] }}</td>
                            {{-- <td class="tcenter">{{ $r['ledger'] ?: '' }}</td> --}}
                            {{-- <td class="small">{{ $r['remarks'] }}</td> --}}
                        </tr>
                    @empty
                        <tr>
                            <td colspan="11" class="tcenter py-4">à¤¹à¤¾à¤² à¤•à¥à¤¨à¥ˆ à¤…à¤­à¤¿à¤²à¥‡à¤– à¤›à¥ˆà¤¨</td>
                        </tr>
                    @endforelse

                    @if (count($rows))
                        <tr>
                            <td colspan="7" class="tright font-bold">à¤œà¤®à¥à¤®à¤¾</td>
                            <td class="tright font-bold">{{ $meta['grand_total'] }}</td>
                            <td colspan="2"></td>
                        </tr>
                    @endif
                </tbody>
            </table>
        </div>

        <footer class="mt-6">
            <div class="small text-gray-700">à¤Ÿà¤¿à¤ªà¥à¤ªà¤£à¥€: à¤¯à¥‹ à¤«à¤°à¥à¤® à¤‰à¤¤à¥à¤ªà¤¾à¤¦ à¤¶à¥à¤°à¥‡à¤£à¥€ (Product Category) à¤…à¤¨à¥à¤¸à¤¾à¤° Store Entry à¤¬à¤¾à¤Ÿ
                à¤¸à¥à¤µà¤šà¤¾à¤²à¤¿à¤¤ à¤°à¥‚à¤ªà¤®à¤¾ à¤¬à¤¨à¥‡à¤•à¥‹ à¤¹à¥‹à¥¤</div>
        </footer>
    </div>
@endsection
</file>

<file path="resources/views/Backend/store/prepare.blade.php">
@extends('Backend.layouts.app')

@section('content')
<div class="max-w-6xl mx-auto px-4 py-8">
  <div class="mb-6 flex items-center justify-between">
    <div>
      <h1 class="text-2xl font-bold">Store Entry â€” Choose Categories & Brand</h1>
      <p class="text-sm text-gray-500">
        Purchase: <strong>{{ $purchase->purchase_sn }}</strong> â€¢
        Date: <strong>{{ $purchase->purchase_date }}</strong> â€¢
        Supplier: <strong>{{ $purchase->supplier->name ?? 'â€”' }}</strong>
      </p>
    </div>
    <a href="{{ route('purchases.index') }}" class="rounded-xl border border-gray-200 bg-white px-4 py-2.5 text-sm font-semibold text-gray-700 hover:bg-gray-50">â† Purchases</a>
  </div>

  <form method="POST" action="{{ route('store.post-from-purchase', $purchase) }}">
    @csrf

    <div class="rounded-2xl border border-gray-200 bg-white shadow-sm overflow-hidden">
      <table class="w-full text-left">
        <thead class="bg-gray-50 text-xs uppercase text-gray-600">
          <tr>
            <th class="px-4 py-3 w-12">S.N</th>
            <th class="px-4 py-3">Item</th>
            <th class="px-4 py-3">Item Category</th>
            <th class="px-4 py-3">Product Category</th>
            <th class="px-4 py-3">Brand</th>
            <th class="px-4 py-3 text-right">Qty</th>
            <th class="px-4 py-3 text-right">Rate</th>
            <th class="px-4 py-3 text-right">Total</th>
          </tr>
        </thead>
        <tbody class="divide-y divide-gray-100">
          @php $sn=1; @endphp
          @foreach($rows as $i => $r)
            <tr class="hover:bg-gray-50">
              <td class="px-4 py-3">{{ $sn++ }}</td>
              <td class="px-4 py-3">
                <div class="font-medium">{{ $r['display_name'] }}</div>
                @if($r['sn'])
                  <div class="text-xs text-gray-500">SN: {{ $r['sn'] }}</div>
                @endif
                @if($r['unit'])
                  <div class="text-xs text-gray-400">Unit: {{ $r['unit'] }}</div>
                @endif

                {{-- Hidden purchase_item_id --}}
                <input type="hidden" name="mapping[{{ $i }}][purchase_item_id]" value="{{ $r['purchase_item_id'] }}">
              </td>

              {{-- Item Category --}}
              <td class="px-4 py-3">
                <select name="mapping[{{ $i }}][item_category_id]"
                        class="w-full rounded-lg border px-3 py-2">
                  <option value="">â€” Select â€”</option>
                  @foreach($itemCategories as $c)
                    <option value="{{ $c->id }}" @selected($r['item_category_id']==$c->id)>{{ $c->name_en }}</option>
                  @endforeach
                </select>
              </td>

              {{-- Product Category --}}
              <td class="px-4 py-3">
                <select name="mapping[{{ $i }}][category_id]"
                        class="w-full rounded-lg border px-3 py-2">
                  <option value="">â€” Select â€”</option>
                  @foreach($productCategories as $c)
                    <option value="{{ $c->id }}" @selected($r['category_id']==$c->id)>{{ $c->name }}</option>
                  @endforeach
                </select>
              </td>

              {{-- Brand --}}
              <td class="px-4 py-3">
                <select name="mapping[{{ $i }}][brand_id]"
                        class="w-full rounded-lg border px-3 py-2">
                  <option value="">â€” Select â€”</option>
                  @foreach($brands as $b)
                    <option value="{{ $b->id }}" @selected($r['brand_id']==$b->id)>{{ $b->name }}</option>
                  @endforeach
                </select>
              </td>

              <td class="px-4 py-3 text-right">{{ number_format($r['qty'], 3) }}</td>
              <td class="px-4 py-3 text-right">{{ number_format($r['rate'], 2) }}</td>
              <td class="px-4 py-3 text-right">{{ number_format($r['total'], 2) }}</td>
            </tr>
          @endforeach
        </tbody>
      </table>

      <div class="px-4 py-3 border-t bg-gray-50 flex justify-end gap-2">
        <a href="{{ route('purchases.show', $purchase) }}"
           class="rounded-xl border border-gray-200 bg-white px-4 py-2.5 text-sm font-semibold text-gray-700 hover:bg-gray-50">
          Cancel
        </a>
        <button class="rounded-xl bg-emerald-600 text-white px-5 py-2.5 text-sm font-semibold hover:bg-emerald-700">
          Create Store Entry
        </button>
      </div>
    </div>
  </form>
</div>
@endsection
</file>

<file path="resources/views/Backend/store/show.blade.php">
@extends('Backend.layouts.app')

@section('content')
<div class="max-w-6xl mx-auto px-4 py-8">
  <div class="mb-6 flex items-center justify-between">
    <div>
      <h1 class="text-2xl font-bold">Store Entry #{{ $meta['id'] }}</h1>
      <p class="text-sm text-gray-600">
        Purchase: <b>{{ $meta['purchase_sn'] }}</b> â€¢ Date: {{ $meta['purchase_date'] ?? 'â€”' }} â€¢
        Supplier: {{ $meta['supplier'] }}
        @if($meta['slip_sn'])
          â€¢ Slip: {{ $meta['slip_sn'] }} ({{ $meta['slip_date'] ?? 'â€”' }})
        @endif
      </p>
    </div>
    <a href="{{ route('store.index') }}"
       class="rounded-xl border border-gray-200 bg-white px-4 py-2.5 text-sm font-semibold text-gray-700 hover:bg-gray-50">â† Store Entries</a>
  </div>

  <div class="rounded-2xl border border-gray-200 bg-white shadow-sm overflow-hidden">
    <table class="w-full text-left">
      <thead class="bg-gray-50 text-xs uppercase text-gray-600">
        <tr>
          <th class="px-4 py-3 w-14">S.N</th>
          <th class="px-4 py-3">Item</th>
          <th class="px-4 py-3">Unit</th>
          <th class="px-4 py-3">Qty</th>
          <th class="px-4 py-3">Rate</th>
          <th class="px-4 py-3">Amount</th>
          <th class="px-4 py-3">Product Category</th>
          <th class="px-4 py-3">Ledger</th>
          <th class="px-4 py-3 text-right">Actions</th>
        </tr>
      </thead>
      <tbody class="divide-y divide-gray-100">
        @forelse($rows as $r)
          <tr class="hover:bg-gray-50">
            <td class="px-4 py-3">{{ $r['sn'] }}</td>
            <td class="px-4 py-3">
              <div class="font-medium">{{ $r['name'] }}</div>
              <div class="text-xs text-gray-500">{{ $r['sn_code'] }}</div>
            </td>
            <td class="px-4 py-3">{{ $r['unit'] }}</td>
            <td class="px-4 py-3">{{ $r['qty'] }}</td>
            <td class="px-4 py-3">{{ $r['rate'] }}</td>
            <td class="px-4 py-3">{{ $r['amount'] }}</td>
            <td class="px-4 py-3">{{ $r['category'] }}</td>
            <td class="px-4 py-3">{{ $r['ledger'] }}</td>
            <td class="px-4 py-3 text-right">
              @if($r['category_id'])
                <a href="{{ route('store.ledger.category', $r['category_id']) }}"
                   class="inline-flex items-center gap-1 text-indigo-600 hover:underline text-sm"
                   title="See all items in this Product Category ledger">
                  {{-- icon --}}
                  <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" viewBox="0 0 24 24" fill="none" stroke="currentColor"><path stroke-width="2" d="M4 19.5V6a2 2 0 012-2h8.5M8 7h8M8 11h8M8 15h5M15 3.5L20.5 9"/></svg>
                  See in Ledger
                </a>
              @else
                <span class="text-xs text-gray-400">No category</span>
              @endif
            </td>
          </tr>
        @empty
          <tr><td colspan="9" class="px-4 py-6 text-center text-gray-500">No items in this store entry.</td></tr>
        @endforelse
      </tbody>
    </table>
  </div>

  @if($meta['remarks'])
    <div class="mt-4 rounded-xl border border-gray-200 bg-white p-4 text-sm">
      <b>Remarks:</b> {{ $meta['remarks'] }}
    </div>
  @endif
</div>
@endsection
</file>

<file path="resources/views/Backend/store_out/create.blade.php">
@extends('Backend.layouts.app')

@section('content')
<div class="max-w-4xl mx-auto px-4 py-8"
     x-data="storeOutForm()"
     x-init="init({{ $prefillItem ? json_encode([
        'store_entry_item_id' => $prefillItem->id,
        'item_name'           => $prefillItem->item_name,
        'item_sn'             => $prefillItem->item_sn,
        'unit'                => $prefillItem->unit,
        'item_category_id'    => $prefillItem->item_category_id,
     ]) : 'null' }})">

  <div class="mb-6 flex items-center justify-between">
    <h1 class="text-2xl font-bold">Store OUT</h1>
    <a href="{{ route('store.out.index') }}"
       class="rounded-xl border border-gray-200 bg-white px-4 py-2.5 text-sm font-semibold text-gray-700 hover:bg-gray-50">
      â† Back
    </a>
  </div>

  @if ($errors->any())
    <div class="mb-4 rounded-xl border border-red-200 bg-red-50 px-4 py-3 text-red-800">
      <ul class="list-disc list-inside text-sm">
        @foreach ($errors->all() as $e)
          <li>{{ $e }}</li>
        @endforeach
      </ul>
    </div>
  @endif

  <form method="POST" action="{{ route('store.out.store') }}" class="space-y-6">
    @csrf

    <div class="grid grid-cols-1 sm:grid-cols-3 gap-4">
      <div>
        <label class="block text-sm font-medium mb-1">Store OUT SN *</label>
        <input type="text" name="store_out_sn"
               value="{{ old('store_out_sn') }}"
               class="w-full rounded-lg border px-3 py-2" required>
      </div>

      <div>
        <label class="block text-sm font-medium mb-1">Date (BS) *</label>
        <input type="text" name="store_out_date_bs"
               value="{{ old('store_out_date_bs') }}"
               placeholder="YYYY-MM-DD"
               class="w-full rounded-lg border px-3 py-2" required>
      </div>

      {{-- Employee autocomplete --}}
      <div class="sm:col-span-1">
        <label class="block text-sm font-medium mb-1">Employee *</label>
        <input type="hidden" name="employee_id" x-ref="employeeId">
        <input type="text"
               x-ref="employeeSearch"
               x-model="employeeText"
               @input="searchEmployee"
               @keydown.arrow-down.prevent="moveSelection(1)"
               @keydown.arrow-up.prevent="moveSelection(-1)"
               @keydown.enter.prevent="chooseSelection"
               class="w-full rounded-lg border px-3 py-2"
               placeholder="Type name / email / atten no">
        <div x-show="employeeResults.length"
             class="mt-1 border rounded-lg bg-white shadow max-h-40 overflow-auto text-sm">
          <template x-for="(e,idx) in employeeResults" :key="e.id">
            <div class="px-3 py-2 cursor-pointer"
                 :class="idx === activeIndex ? 'bg-gray-100' : ''"
                 @mousedown.prevent="selectEmployee(idx)">
              <div x-text="e.text"></div>
            </div>
          </template>
        </div>
      </div>
    </div>

    <div>
      <label class="block text-sm font-semibold mb-2">Items to issue *</label>

      <div class="space-y-2">
        {{-- For now single item row; you can expand later --}}
        <div class="grid grid-cols-12 gap-2 items-end">
          <div class="col-span-4">
            <label class="block text-xs text-gray-600">Item Name *</label>
            <input type="text" name="items[0][item_name]"
                   x-model="item.item_name"
                   class="w-full rounded-lg border px-3 py-2" required>
          </div>
          <div class="col-span-2">
            <label class="block text-xs text-gray-600">Detail (SN)</label>
            <input type="text" name="items[0][item_sn]"
                   x-model="item.item_sn"
                   class="w-full rounded-lg border px-3 py-2">
          </div>
          <div class="col-span-2">
            <label class="block text-xs text-gray-600">Unit</label>
            <input type="text" name="items[0][unit]"
                   x-model="item.unit"
                   class="w-full rounded-lg border px-3 py-2">
          </div>
          <div class="col-span-2">
            <label class="block text-xs text-gray-600">Qty *</label>
            <input type="number" step="0.001" min="0.001"
                   name="items[0][qty]"
                   x-model="item.qty"
                   class="w-full rounded-lg border px-3 py-2" required>
          </div>
          <div class="col-span-2">
            <label class="block text-xs text-gray-600">Category</label>
            <select name="items[0][item_category_id]"
                    x-model="item.item_category_id"
                    class="w-full rounded-lg border px-3 py-2">
              <option value="">-- Select --</option>
              @foreach(\App\Models\ItemCategory::orderBy('name_en')->get() as $c)
                <option value="{{ $c->id }}">{{ $c->name_en }} ({{ $c->name_np }})</option>
              @endforeach
            </select>
          </div>
        </div>

        {{-- Hidden field for store_entry_item if we came from category item page --}}
        <template x-if="item.store_entry_item_id">
          <input type="hidden" name="items[0][store_entry_item_id]" :value="item.store_entry_item_id">
        </template>
      </div>
    </div>

    <div>
      <label class="block text-sm font-medium mb-1">Remarks</label>
      <textarea name="remarks" rows="2"
                class="w-full rounded-lg border px-3 py-2"
                placeholder="Optional">{{ old('remarks') }}</textarea>
    </div>

    <div class="flex justify-end">
      <button class="rounded-xl bg-gray-900 text-white px-5 py-2.5 text-sm font-semibold hover:bg-gray-800">
        Save Store OUT
      </button>
    </div>
  </form>
</div>
@endsection

@push('scripts')
<script>
function storeOutForm() {
  return {
    employeeText: '',
    employeeResults: [],
    activeIndex: -1,
    employeeSearchTimer: null,
    item: {
      store_entry_item_id: null,
      item_name: '',
      item_sn: '',
      unit: '',
      qty: '',
      item_category_id: '',
    },

    init(prefill) {
      if (prefill) {
        this.item.store_entry_item_id = prefill.store_entry_item_id;
        this.item.item_name           = prefill.item_name || '';
        this.item.item_sn             = prefill.item_sn || '';
        this.item.unit                = prefill.unit || '';
        this.item.item_category_id    = prefill.item_category_id || '';
      }
    },

    searchEmployee() {
      const term = this.employeeText.trim();
      if (this.employeeSearchTimer) clearTimeout(this.employeeSearchTimer);

      if (!term) {
        this.employeeResults = [];
        this.activeIndex = -1;
        this.$refs.employeeId.value = '';
        return;
      }

      this.employeeSearchTimer = setTimeout(() => {
        fetch(`{{ route('employees.search') }}?q=${encodeURIComponent(term)}`, {
          headers: { 'Accept': 'application/json' }
        })
        .then(r => r.ok ? r.json() : [])
        .then(json => {
          this.employeeResults = Array.isArray(json) ? json : [];
          this.activeIndex = this.employeeResults.length ? 0 : -1;
        })
        .catch(() => {
          this.employeeResults = [];
          this.activeIndex = -1;
        });
      }, 200);
    },

    moveSelection(step) {
      if (!this.employeeResults.length) return;
      this.activeIndex = (this.activeIndex + step + this.employeeResults.length) % this.employeeResults.length;
    },

    chooseSelection() {
      if (this.activeIndex >= 0 && this.employeeResults[this.activeIndex]) {
        this.selectEmployee(this.activeIndex);
      }
    },

    selectEmployee(idx) {
      const e = this.employeeResults[idx];
      if (!e) return;
      this.$refs.employeeId.value = e.id;
      this.employeeText = e.text;
      this.employeeResults = [];
      this.activeIndex = -1;
    }
  }
}
</script>
@endpush
</file>

<file path="resources/views/Backend/store_out/index.blade.php">
@extends('Backend.layouts.app')

@section('content')
<div class="max-w-6xl mx-auto px-4 py-8">
  <div class="mb-6 flex items-center justify-between">
    <div>
      <h1 class="text-2xl font-bold">Store OUT Records</h1>
    </div>
    <a href="{{ route('store.out.create') }}"
       class="rounded-xl bg-gray-900 text-white px-4 py-2.5 text-sm font-semibold hover:bg-gray-800">
      + New Store OUT
    </a>
  </div>

  @if (session('success'))
    <div class="mb-4 rounded-xl border border-green-200 bg-green-50 px-4 py-3 text-green-800">
      {{ session('success') }}
    </div>
  @endif

  <form method="GET" class="mb-4">
    <input type="text" name="search" value="{{ request('search') }}"
           class="w-full sm:w-72 rounded-lg border px-3 py-2 text-sm"
           placeholder="Search SN / date / employee">
  </form>

  <div class="rounded-2xl border border-gray-200 bg-white shadow-sm overflow-hidden">
    <table class="w-full text-sm">
      <thead class="bg-gray-50 text-xs uppercase text-gray-600">
        <tr>
          <th class="px-4 py-3 w-16">S.N</th>
          <th class="px-4 py-3">Store Out SN</th>
          <th class="px-4 py-3">Date (BS)</th>
          <th class="px-4 py-3">Employee</th>
          <th class="px-4 py-3">Items</th>
          <th class="px-4 py-3">Remarks</th>
        </tr>
      </thead>
      <tbody class="divide-y divide-gray-100">
        @php $sn = ($outs->currentPage()-1)*$outs->perPage() + 1; @endphp
        @forelse($outs as $o)
          <tr class="hover:bg-gray-50">
            <td class="px-4 py-3">{{ $sn++ }}</td>
            <td class="px-4 py-3">
              <a href="{{ route('store.out.show',$o) }}"
                 class="text-blue-600 hover:underline">
                {{ $o->store_out_sn }}
              </a>
            </td>
            <td class="px-4 py-3">{{ $o->store_out_date_bs }}</td>
            <td class="px-4 py-3">{{ $o->employee->full_name ?? 'â€”' }}</td>
            <td class="px-4 py-3">
              {{ $o->items->count() }} item(s)
            </td>
            <td class="px-4 py-3 text-xs text-gray-500">
              {{ \Illuminate\Support\Str::limit($o->remarks, 50) }}
            </td>
          </tr>
        @empty
          <tr>
            <td colspan="6" class="px-4 py-6 text-center text-gray-500">No store out records found.</td>
          </tr>
        @endforelse
      </tbody>
    </table>
    <div class="px-4 py-3 border-t bg-gray-50">
      {{ $outs->links() }}
    </div>
  </div>
</div>
@endsection
</file>

<file path="resources/views/Backend/supplier/create.blade.php">
@extends('Backend.layouts.app')

@section('content')
<div class="max-w-6xl mx-auto px-4 py-8">
  <!-- Header -->
  <div class="mb-6 flex flex-col sm:flex-row sm:items-center sm:justify-between gap-3">
    <div>
      <h1 class="text-2xl font-bold tracking-tight">Add Supplier</h1>
      <p class="text-sm text-gray-500 mt-1">Create a new supplier with name, PAN, and address.</p>
    </div>
    <a href="{{ route('suppliers.index') }}"
       class="inline-flex items-center rounded-xl border border-gray-200 bg-white px-4 py-2.5 text-sm font-semibold text-gray-700 hover:bg-gray-50">
      â† Back to Suppliers
    </a>
  </div>

  <!-- Alerts -->
  @if ($errors->any())
    <div class="mb-4 rounded-xl border border-red-200 bg-red-50 px-4 py-3 text-red-800">
      <ul class="list-disc list-inside text-sm">
        @foreach ($errors->all() as $error)
          <li>{{ $error }}</li>
        @endforeach
      </ul>
    </div>
  @endif

  <!-- Card -->
  <div class="rounded-2xl border border-gray-200 bg-white shadow-sm overflow-hidden">
    <div class="border-b bg-gray-50 px-5 py-4">
      <h2 class="text-sm font-semibold text-gray-700">Supplier Information</h2>
    </div>

    <div class="px-5 py-6">
      <form method="POST" action="{{ route('suppliers.store') }}" class="space-y-6">
        @csrf
       {{-- Shared form fields for Create & Edit --}}

<div class="grid grid-cols-1 sm:grid-cols-2 gap-5">
  {{-- Name --}}
  <div class="col-span-1">
    <label class="block text-sm font-medium text-gray-700 mb-1">
      Supplier Name <span class="text-red-500">*</span>
    </label>
    <input type="text" name="name"
           value="{{ old('name', $supplier->name ?? '') }}"
           class="w-full rounded-lg border border-gray-300 focus:border-gray-400 focus:ring-0 px-3 py-2"
           placeholder="e.g., ABC Traders" required>
    @error('name')
      <p class="mt-1 text-xs text-red-600">{{ $message }}</p>
    @enderror
  </div>

  {{-- PAN --}}
  <div class="col-span-1">
    <label class="block text-sm font-medium text-gray-700 mb-1">
      PAN Number <span class="text-red-500">*</span>
    </label>
    <input id="pan" type="text" name="pan"
           value="{{ old('pan', $supplier->pan ?? '') }}"
           class="w-full rounded-lg border border-gray-300 focus:border-gray-400 focus:ring-0 px-3 py-2"
           inputmode="numeric" autocomplete="off" maxlength="9" placeholder="9-digit PAN (e.g., 123456789)" required>
    <p class="text-xs text-gray-500 mt-1">Use digits only; 9 characters.</p>
    @error('pan')
      <p class="mt-1 text-xs text-red-600">{{ $message }}</p>
    @enderror
  </div>

  {{-- Address (full width on sm+) --}}
  <div class="sm:col-span-2">
    <label class="block text-sm font-medium text-gray-700 mb-1">Address</label>
    <input type="text" name="address"
           value="{{ old('address', $supplier->address ?? '') }}"
           class="w-full rounded-lg border border-gray-300 focus:border-gray-400 focus:ring-0 px-3 py-2"
           placeholder="e.g., Patan, Lalitpur">
    @error('address')
      <p class="mt-1 text-xs text-red-600">{{ $message }}</p>
    @enderror
  </div>
</div>

{{-- Actions --}}
<div class="flex flex-col sm:flex-row items-stretch sm:items-center gap-3 pt-2">
  <button class="inline-flex justify-center rounded-xl bg-gray-900 text-white px-5 py-2.5 text-sm font-semibold hover:bg-gray-800">
    {{ ($mode ?? 'create') === 'edit' ? 'Update Supplier' : 'Save Supplier' }}
  </button>
  <a href="{{ route('suppliers.index') }}"
     class="inline-flex justify-center rounded-xl border border-gray-200 bg-white px-5 py-2.5 text-sm font-semibold text-gray-700 hover:bg-gray-50">
    Cancel
  </a>
</div>

      </form>
    </div>
  </div>
</div>

@push('scripts')
<script>
  // Keep PAN numeric and max 9
  document.addEventListener('DOMContentLoaded', function () {
    const pan = document.getElementById('pan');
    if (!pan) return;
    pan.addEventListener('input', () => {
      pan.value = pan.value.replace(/\D/g,'').slice(0, 9);
    });
  });
</script>
@endpush
@endsection
</file>

<file path="resources/views/Backend/supplier/edit.blade.php">
@extends('Backend.layouts.app')

@section('content')
<div class="max-w-6xl mx-auto px-4 py-8">
  {{-- Page header --}}
  <div class="mb-6 flex flex-col sm:flex-row sm:items-center sm:justify-between gap-3">
    <div>
      <h1 class="text-2xl font-bold tracking-tight">Edit Supplier</h1>
      <p class="text-sm text-gray-500 mt-1">Update name, PAN, and address.</p>
    </div>
    <div class="flex gap-2">
      <a href="{{ route('suppliers.index') }}"
         class="inline-flex items-center rounded-xl border border-gray-200 bg-white px-4 py-2.5 text-sm font-semibold text-gray-700 hover:bg-gray-50">
        â† Back to Suppliers
      </a>
    </div>
  </div>

  {{-- Alerts --}}
  @if(session('success'))
    <div class="mb-4 rounded-xl border border-green-200 bg-green-50 px-4 py-3 text-green-800">
      {{ session('success') }}
    </div>
  @endif

  @if ($errors->any())
    <div class="mb-4 rounded-xl border border-red-200 bg-red-50 px-4 py-3 text-red-800">
      <ul class="list-disc list-inside text-sm">
        @foreach ($errors->all() as $error)
          <li>{{ $error }}</li>
        @endforeach
      </ul>
    </div>
  @endif

  {{-- Card --}}
  <div class="rounded-2xl border border-gray-200 bg-white shadow-sm overflow-hidden">
    <div class="border-b bg-gray-50 px-5 py-4">
      <h2 class="text-sm font-semibold text-gray-700">Supplier Information</h2>
    </div>

    <div class="px-5 py-6">
      <form method="POST" action="{{ route('suppliers.update', $supplier->id) }}" class="space-y-6">
        @csrf @method('PUT')

        {{-- Responsive grid --}}
        <div class="grid grid-cols-1 sm:grid-cols-2 gap-5">
          <div class="col-span-1">
            <label class="block text-sm font-medium mb-1">Name <span class="text-red-500">*</span></label>
            <input type="text" name="name" value="{{ old('name', $supplier->name) }}"
                   class="w-full rounded-lg border-gray-300 focus:border-gray-400 focus:ring-0"
                   placeholder="e.g., ABC Traders" required>
          </div>

          <div class="col-span-1">
            <label class="block text-sm font-medium mb-1">PAN <span class="text-red-500">*</span></label>
            <input id="pan" type="text" name="pan" value="{{ old('pan', $supplier->pan) }}"
                   class="w-full rounded-lg border-gray-300 focus:border-gray-400 focus:ring-0"
                   inputmode="numeric" autocomplete="off" maxlength="9" required>
            <p class="text-xs text-gray-500 mt-1">9 digits only.</p>
          </div>

          <div class="sm:col-span-2">
            <label class="block text-sm font-medium mb-1">Address</label>
            <input type="text" name="address" value="{{ old('address', $supplier->address) }}"
                   class="w-full rounded-lg border-gray-300 focus:border-gray-400 focus:ring-0"
                   placeholder="e.g., Patan, Lalitpur">
          </div>
        </div>

        {{-- Actions --}}
        <div class="flex flex-col sm:flex-row items-stretch sm:items-center gap-3 pt-2">
          <button class="inline-flex justify-center rounded-xl bg-gray-900 text-white px-5 py-2.5 text-sm font-semibold hover:bg-gray-800">
            Update
          </button>
          <a href="{{ route('suppliers.index') }}"
             class="inline-flex justify-center rounded-xl border border-gray-200 bg-white px-5 py-2.5 text-sm font-semibold text-gray-700 hover:bg-gray-50">
            Cancel
          </a>
        </div>
      </form>
    </div>
  </div>
</div>

{{-- Small helper to keep PAN numeric and max 9 --}}
@push('scripts')
<script>
  document.addEventListener('DOMContentLoaded', function () {
    const pan = document.getElementById('pan');
    if (!pan) return;
    pan.addEventListener('input', () => {
      pan.value = pan.value.replace(/\D/g,'').slice(0, 9);
    });
  });
</script>
@endpush
@endsection
</file>

<file path="resources/views/Backend/supplier/index.blade.php">
@extends('Backend.layouts.app')

@section('content')
<div class="max-w-6xl mx-auto px-4 py-8">
  {{-- Success message --}}
  @if(session('success'))
    <div class="mb-4 rounded-xl border border-green-200 bg-green-50 px-4 py-3 text-green-800">
      {{ session('success') }}
    </div>
  @endif

  {{-- Header --}}
  <div class="flex flex-col sm:flex-row sm:items-center sm:justify-between gap-4 mb-6">
    <h1 class="text-2xl font-bold tracking-tight">Suppliers</h1>
    <a href="{{ route('suppliers.create') }}"
       class="inline-flex items-center rounded-xl bg-gray-900 text-white px-4 py-2.5 text-sm font-semibold shadow hover:bg-gray-800">
      + Add Supplier
    </a>
  </div>

  {{-- Search Bar --}}
  <form method="GET" action="{{ route('suppliers.index') }}" class="mb-6">
    <div class="flex flex-col sm:flex-row gap-3 sm:items-center">
      <div class="flex-1 relative">
        <input type="text" name="search"
               value="{{ request('search') }}"
               class="w-full rounded-xl border border-gray-300 px-4 py-2.5 pr-10 text-sm focus:border-blue-400 focus:ring-1 focus:ring-blue-400"
               placeholder="Search by supplier name or PAN...">
        @if(request('search'))
          <a href="{{ route('suppliers.index') }}"
             class="absolute inset-y-0 right-3 flex items-center text-gray-400 hover:text-gray-600">
            <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none"
                 viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
              <path stroke-linecap="round" stroke-linejoin="round" d="M6 18L18 6M6 6l12 12" />
            </svg>
          </a>
        @endif
      </div>
      <button type="submit"
              class="inline-flex items-center justify-center rounded-xl bg-blue-600 text-white px-5 py-2.5 text-sm font-medium hover:bg-blue-700 transition">
        <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 mr-2" fill="none"
             viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
          <path stroke-linecap="round" stroke-linejoin="round"
                d="M21 21l-4.35-4.35M10 18a8 8 0 100-16 8 8 0 000 16z" />
        </svg>
        Search
      </button>
    </div>
  </form>

  {{-- Table --}}
  <div class="rounded-2xl border border-gray-200 bg-white shadow-sm overflow-hidden">
    <table class="w-full text-left">
      <thead class="bg-gray-50 text-xs uppercase text-gray-600">
        <tr>
          <th class="px-4 py-3 w-16">S.N</th>
          <th class="px-4 py-3">Name</th>
          <th class="px-4 py-3">PAN</th>
          <th class="px-4 py-3">Address</th>
          <th class="px-4 py-3 text-right">Actions</th>
        </tr>
      </thead>
      <tbody class="divide-y divide-gray-100 bg-white">
        @php
          // get the starting index based on current page
          $sn = ($suppliers->currentPage() - 1) * $suppliers->perPage() + 1;
        @endphp

        @forelse($suppliers as $s)
          <tr class="hover:bg-gray-50 transition">
            <td class="px-4 py-3 text-gray-800">{{ $sn++ }}</td>
            <td class="px-4 py-3 font-medium text-gray-900">{{ $s->name }}</td>
            <td class="px-4 py-3 text-gray-700">{{ $s->pan }}</td>
            <td class="px-4 py-3 text-gray-700">{{ $s->address }}</td>
            <td class="px-4 py-3 text-right space-x-2">
              <a href="{{ route('suppliers.edit', $s) }}"
                 class="inline-flex items-center text-blue-600 hover:text-blue-800 text-sm font-medium">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 mr-1" fill="none"
                     viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                  <path stroke-linecap="round" stroke-linejoin="round"
                        d="M15.232 5.232l3.536 3.536m-2.036-1.5a2.121 2.121 0 113.001 3.001L7.5 21H4v-3.5L16.732 7.268z" />
                </svg>
                Edit
              </a>
              <form action="{{ route('suppliers.destroy', $s) }}" method="POST" class="inline">
                @csrf @method('DELETE')
                <button class="inline-flex items-center text-red-600 hover:text-red-800 text-sm font-medium"
                        onclick="return confirm('Delete this supplier?')">
                  <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 mr-1" fill="none"
                       viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                    <path stroke-linecap="round" stroke-linejoin="round"
                          d="M6 18L18 6M6 6l12 12" />
                  </svg>
                  Delete
                </button>
              </form>
            </td>
          </tr>
        @empty
          <tr>
            <td colspan="5" class="px-4 py-6 text-center text-gray-500">No suppliers found.</td>
          </tr>
        @endforelse
      </tbody>
    </table>
  </div>

  {{-- Pagination --}}
  <div class="mt-4">
    {{ $suppliers->links() }}
  </div>
</div>
@endsection
</file>

<file path="resources/views/Backend/index.blade.php">
<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>@yield('title', 'Portal')</title>

    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css" />

</head>

<body class="antialiased bg-gray-50 text-gray-900">

    <!-- HEADER (fixed to screen sides) -->
    <header class="fixed inset-x-0 top-0 h-16 bg-white shadow-lg z-50">
        <div class="h-full px-4 md:px-6 flex items-center justify-between">
            <a href="{{ url('/') }}" class="flex items-center gap-2">
                <img src="{{ asset('asset/assets/ioe_logo.png') }}" class="h-10 w-auto" alt="Logo">
                <span class="text-lg md:text-xl font-bold text-blue-900"> STORE IOE Purwanchal Campus</span>
            </a>

            <div class="flex items-center gap-2">

                <a href="{{ route('student.login.form') }}"
                    class="px-4 py-2 bg-blue-700 text-white rounded-lg hover:bg-blue-800 transition">
                    Login
                </a>

            </div>
        </div>
    </header>



    <div class="min-h-screen flex flex-col">
        <!-- Header -->


        <div
            class="min-h-screen flex items-center justify-center bg-gradient-to-r from-slate-100 via-blue-100 to-slate-200 p-4">
            <div class="w-full max-w-md bg-white p-6 rounded-2xl shadow-lg border border-slate-200">

                <!-- Heading -->
                <div class="text-center mb-6">
                    <h1 class="text-2xl font-bold text-blue-900">Admin Login</h1>
                    <p class="text-sm text-slate-600 mt-1">
                        Use your admin email and password to access the dashboard.
                    </p>
                </div>

                <!-- Login Form -->
                <form method="POST" action="{{ route('admin.login') }}" class="space-y-4">
                    @csrf

                    <!-- Email -->
                    <div>
                        <label class="block text-sm font-medium mb-1 text-slate-700">Email</label>
                        <input type="email" name="email" value="{{ old('email') }}" required
                            class="w-full rounded-lg border border-slate-300 focus:border-blue-500 focus:ring focus:ring-blue-200 p-2 text-sm"
                            placeholder="admin@example.com" />
                        @error('email')
                            <p class="text-red-600 text-xs mt-1">{{ $message }}</p>
                        @enderror
                    </div>

                    <!-- Password -->
                    <div>
                        <label class="block text-sm font-medium mb-1 text-slate-700">Password</label>
                        <input type="password" name="password" required
                            class="w-full rounded-lg border border-slate-300 focus:border-blue-500 focus:ring focus:ring-blue-200 p-2 text-sm"
                            placeholder="â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢" />
                        @error('password')
                            <p class="text-red-600 text-xs mt-1">{{ $message }}</p>
                        @enderror
                    </div>

                    <!-- Submit Button -->
                    <button type="submit"
                        class="w-full bg-blue-700 text-white py-2 rounded-lg hover:bg-blue-800 transition shadow-md">
                        Sign In
                    </button>
                </form>
            </div>
        </div>

        <!-- Footer -->
        <footer class="bg-gray-800 text-white text-center py-4">
    <p class="text-sm">Â© {{ date('Y') }} IOE Purwanchal Campus. All Rights Reserved.</p>
    <p class="text-sm mt-1">Developed by <a href="https://sadanandpaneru.com.np" class="underline hover:text-gray-300">Sadanand Paneru</a></p>
</footer>

    </div>


</body>

</html>
</file>

<file path="resources/views/Frontend/auth/student-login.blade.php">
@extends('Frontend.layouts.app')

@section('content')
    <div class="min-h-screen flex items-center justify-center bg-gradient-to-r from-blue-100 via-blue-200 to-blue-300 p-4">
        <div class="w-full max-w-md bg-white p-8 rounded-2xl shadow-lg border border-slate-200">

            <!-- Heading -->
            <div class="text-center mb-6">
                <h1 class="text-2xl font-bold text-blue-900">Student Login</h1>
                <p class="text-sm text-slate-600 mt-1">Enter your Token and Roll Number to continue</p>
            </div>

            <!-- Form -->
            <form method="POST" action="{{ route('student.login') }}" class="space-y-4">
                @csrf

                <!-- Token Number -->
                <div>
                    <label class="block text-sm font-medium mb-1 text-slate-700">Token Number</label>
                    <input type="text" name="token_num" value="{{ old('token_num') }}" required
                        class="w-full rounded-lg border border-slate-300 focus:border-blue-500 focus:ring focus:ring-blue-200 p-2 text-sm"
                        placeholder="e.g., T123456" />
                    @error('token_num')
                        <p class="text-red-600 text-xs mt-1">{{ $message }}</p>
                    @enderror
                </div>

                <!-- Roll Number -->
                <div>
                    <label class="block text-sm font-medium mb-1 text-slate-700">
                        Roll Number <span class="text-slate-400 text-xs">(format: PUR123ABC456)</span>
                    </label>
                    <input type="text" name="roll_num" value="{{ old('roll_num') }}" required
                        class="w-full rounded-lg border border-slate-300 focus:border-blue-500 focus:ring focus:ring-blue-200 p-2 text-sm"
                        placeholder="PUR123ABC456" />
                    @error('roll_num')
                        <p class="text-red-600 text-xs mt-1">{{ $message }}</p>
                    @enderror
                </div>

                <!-- Submit Button -->
                <button type="submit"
                    class="w-full bg-blue-700 text-white py-2 rounded-lg hover:bg-blue-800 transition shadow-md">
                    Sign In
                </button>
                @if (session('success'))
                    <div class="mb-4 rounded-lg bg-green-50 border border-green-200 text-green-800 px-4 py-3">
                        {{ session('success') }}
                    </div>
                @endif
                @if (session('error'))
                    <div class="mb-4 rounded-lg bg-red-50 border border-red-200 text-red-800 px-4 py-3">
                        {{ session('error') }}
                    </div>
                @endif
            </form>
        </div>
    </div>
@endsection
</file>

<file path="resources/views/Frontend/dashboard/application.blade.php">
@extends('Frontend.layouts.app')

@section('title', 'Student Dashboard')

@section('content')
    <section class="bg-gradient-to-br from-blue-50 via-white to-purple-50 min-h-screen py-10">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">

            @if (!$data->payment_id)
                <!-- Heading -->
                <div class="mb-8">
                    <h1 class="text-3xl sm:text-4xl font-extrabold text-indigo-700 text-center">
                        Payment Dashboard
                    </h1>
                </div>


                <form action="{{ route('verify.payment') }}" method="POST" id="txnForm">
                    @csrf
                    <input type="hidden" name="token_num" value="{{ $data->token_num }}">

                    <!-- Note -->
                    <div class="max-w-3xl mx-auto mt-6">
                        <div class="text-center rounded-lg border border-red-200 bg-red-50 text-red-700 px-4 py-3">
                            <h5 class="font-semibold">Verify Your Payment For Rs. {{ $data->amount }}</h5>
                            <div class="mt-1 text-sm">
                                Note: Please ensure you provide correct payment details.
                            </div>
                        </div>

                        <!-- Card -->
                        <div class="max-w-3xl mx-auto mt-6">
                            <div class="bg-white rounded-2xl shadow-lg ring-1 ring-gray-200 p-6">

                                <!-- Header (Logo + Title) -->
                                <div class="flex items-center justify-center gap-4">
                                    <img src="https://www.nicasiabank.com/_next/image/?url=https%3A%2F%2Fcms.nicasiabank.com%2Fframework%2Fuploads%2FLogo%2FNIC-logo%20-%20footer.png&w=256&q=75"
                                        alt="NIC Asia Logo" class="h-12 w-auto" />
                                    <h3 class="text-xl font-bold text-red-600">Payment Detail</h3>
                                </div>

                                <!-- Success Message -->
                                @if (session('success'))
                                    <div class="max-w-3xl mx-auto mt-4">
                                        <div
                                            class="rounded-lg bg-green-50 border border-green-200 text-green-800 px-4 py-3 shadow-sm">
                                            âœ… {{ session('success') }}
                                        </div>
                                    </div>
                                @endif

                                <!-- Error Messages -->
                                @if ($errors->any())
                                    <div class="max-w-3xl mx-auto mt-4">
                                        <div
                                            class="rounded-lg bg-red-50 border border-red-200 text-red-700 px-4 py-3 shadow-sm">
                                            <ul class="list-disc list-inside space-y-1">
                                                @foreach ($errors->all() as $error)
                                                    <li>âš ï¸ {{ $error }}</li>
                                                @endforeach
                                            </ul>
                                        </div>
                                    </div>
                                @endif


                                <!-- Fields -->
                                <div class="mt-6 grid grid-cols-1 md:grid-cols-2 gap-4">
                                    <!-- TXN Number -->
                                    <div>
                                        <label for="txn_number" class="block text-sm font-medium text-gray-700 mb-1">TXN
                                            Number</label>
                                        <input type="text" id="txn_number" name="txn_number"
                                            placeholder="Enter TXN Number" required
                                            class="block w-full p-2 border border-red-300 focus:border-indigo-600 focus:ring-indigo-600" />
                                        @error('txn_number')
                                            <p class="mt-1 text-xs text-red-600">{{ $message }}</p>
                                        @enderror
                                    </div>

                                    <!-- TXN Date -->
                                    <div>
                                        <label for="txn_date" class="block text-sm font-medium text-gray-700 mb-1">TXN
                                            Date</label>
                                        <input type="date" id="txn_date" name="txn_date" required
                                            class="block w-full p-2 border border-gray-300 focus:border-indigo-600 focus:ring-indigo-600" />
                                        @error('txn_date')
                                            <p class="mt-1 text-xs text-red-600">{{ $message }}</p>
                                        @enderror
                                    </div>
                                </div>

                                <!-- Submit -->
                                <div class="mt-8 text-center">
                                    <button type="submit"
                                        class="inline-flex items-center justify-center px-6 py-3 rounded-xl bg-green-600 text-white font-semibold shadow-lg hover:bg-green-700 hover:scale-105 transform transition-all duration-200 focus:outline-none focus:ring-2 focus:ring-green-600 focus:ring-offset-2">
                                        âœ… Verify Payment
                                    </button>
                                </div>
                            </div>
                        </div>
                </form>
            @elseif ($data->status == 'unsubmitted')
                {{-- Payment verified alert (unchanged) --}}
                <div class="max-w-3xl mx-auto mt-6">
                    <div class="text-center rounded-lg border border-green-200 bg-green-50 text-green-700 px-4 py-3">
                        <h5 class="font-semibold">Your Payment is Verified Successfully!</h5>
                        <div class="mt-1 text-sm"> Thank you for your payment of Rs. {{ $data->amount }}. Your transaction
                            ID is <strong>{{ $data->payment_id }}</strong>. </div>
                    </div>
                </div>

                {{-- Voucher upload --}}
                <div class="max-w-3xl mx-auto mt-8">
                    <div class="flex items-center gap-3">
                        <h3 class="text-lg font-bold text-slate-900">Voucher Details</h3>
                        <div class="flex-1 h-px bg-gradient-to-r from-red-500/60 to-transparent"></div>
                    </div>

                    {{-- Success flash --}}
                    @if (session('success'))
                        <div class="mt-4 rounded-xl border border-green-200 bg-green-50 text-green-800 px-4 py-3">
                            {{ session('success') }}
                        </div>
                    @endif

                    {{-- Global error summary --}}
                    @if ($errors->any())
                        <div class="mt-4 rounded-xl border border-red-200 bg-red-50 text-red-800">
                            <div class="px-4 py-3 font-semibold">Please fix the following:</div>
                            <ul class="px-6 pb-4 list-disc text-sm">
                                @foreach ($errors->all() as $error)
                                    <li>{{ $error }}</li>
                                @endforeach
                            </ul>
                        </div>
                    @endif

                    <form action="{{ route('vouchers.store') }}" method="POST" enctype="multipart/form-data"
                        class="mt-4">
                        @csrf
                        <input type="hidden" name="token_num" value="{{ $data->token_num }}">


                        <div class="rounded-2xl bg-white ring-1 ring-slate-200 shadow-sm p-6">
                            <div class="grid grid-cols-1 sm:grid-cols-2 gap-6">
                                {{-- Payment Voucher (PDF only, < 2MB) --}}
                                <div>
                                    <label for="payment_voucher" class="block text-sm font-medium text-slate-700 mb-1">
                                        Upload Payment Voucher (PDF) <span class="text-red-600">*</span>
                                    </label>

                                    <input type="file" id="payment_voucher" name="payment_voucher" required
                                        accept=".pdf,application/pdf" onchange="validatePDF(this)"
                                        aria-describedby="payment_voucher_error"
                                        aria-invalid="@error('payment_voucher') true @else false @enderror"
                                        class="block w-full rounded-lg border text-sm text-slate-900
                   file:mr-4 file:rounded-lg file:border-0 file:bg-indigo-50 file:px-4 file:py-2
                   file:text-sm file:font-semibold file:text-indigo-700 hover:file:bg-indigo-100
                   focus:outline-none
                   @error('payment_voucher')
                     border-red-500 focus:ring-red-500
                   @else
                     border-slate-300 focus:border-indigo-600 focus:ring-indigo-600
                   @enderror" />
                                    @error('payment_voucher')
                                        <p class="mt-1 text-xs text-red-600">{{ $message }}</p>
                                    @enderror
                                    <p id="payment_voucher_error" class="mt-1 text-xs text-red-600"></p>
                                    <p class="mt-1 text-xs text-slate-500">PDF only, up to 2 MB.</p>
                                </div>

                                {{-- Confirmation Slip (PDF only, < 2MB) --}}
                                <div>
                                    <label for="token_slip" class="block text-sm font-medium text-slate-700 mb-1">
                                        Confirmation Slip (PDF) <span class="text-red-600">*</span>
                                    </label>

                                    <input type="file" id="token_slip" name="token_slip" required
                                        accept=".pdf,application/pdf" onchange="validatePDF(this)"
                                        aria-describedby="token_slip_error"
                                        aria-invalid="@error('token_slip') true @else false @enderror"
                                        class="block w-full rounded-lg border text-sm text-slate-900
                   file:mr-4 file:rounded-lg file:border-0 file:bg-indigo-50 file:px-4 file:py-2
                   file:text-sm file:font-semibold file:text-indigo-700 hover:file:bg-indigo-100
                   focus:outline-none
                   @error('token_slip')
                     border-red-500 focus:ring-red-500
                   @else
                     border-slate-300 focus:border-indigo-600 focus:ring-indigo-600
                   @enderror" />
                                    @error('token_slip')
                                        <p class="mt-1 text-xs text-red-600">{{ $message }}</p>
                                    @enderror
                                    <p id="token_slip_error" class="mt-1 text-xs text-red-600"></p>
                                    <p class="mt-1 text-xs text-slate-500">PDF only, up to 2 MB.</p>
                                </div>
                            </div>

                            <div class="mt-6 text-center">
                                <button type="submit"
                                    class="w-full sm:w-auto inline-flex items-center justify-center gap-2 px-5 py-2.5
                 rounded-lg bg-indigo-600 text-white font-medium shadow
                 hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-indigo-600 focus:ring-offset-2">
                                    Submit
                                </button>
                            </div>
                        </div>
                    </form>
                </div>

                <script>
                    // Client-side guard: PDF only, <= 2MB
                    function validatePDF(input) {
                        const err = document.getElementById(input.id + '_error');
                        if (err) err.textContent = '';

                        const file = input.files && input.files[0];
                        if (!file) return;

                        if (file.type !== 'application/pdf') {
                            if (err) err.textContent = 'Only PDF files are allowed.';
                            input.value = '';
                            return;
                        }
                        const maxBytes = 2 * 1024 * 1024; // 2 MB
                        if (file.size > maxBytes) {
                            if (err) err.textContent = 'File too large. Max size is 2 MB.';
                            input.value = '';
                        }
                    }
                </script>
            @elseif ($data->status == 'submitted')
                {{-- Payment verified and application submitted alert (unchanged) --}}
                <div class="max-w-3xl mx-auto mt-6">
                    <div class="text-center rounded-lg border border-blue-200 bg-blue-50 text-blue-700 px-4 py-3">
                        <h5 class="font-semibold">Your Application is Submitted Successfully!</h5>
                        <div class="mt-1 text-sm"> Your application has been received and is under review. We will
                            notify you of any updates via email. </div>
                    </div>
                </div>

            @endif
        </div>
    </section>
@endsection
</file>

<file path="resources/views/Frontend/dashboard/form.blade.php">
@extends('Frontend.layouts.app')

@section('title', 'Student Dashboard')

@section('content')
    <section class="bg-gradient-to-br from-blue-50 via-white to-purple-50 min-h-screen py-10">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">

            <!-- Heading -->
            <div class="mb-8">
                <h1 class="text-3xl sm:text-4xl font-extrabold text-indigo-700 text-center">
                    Student Dashboard
                </h1>
                <p class="mt-2 text-center text-sm text-slate-600">
                    Your academic details and payment status at a glance
                </p>
            </div>

            <!-- Cards -->
            <div class="grid grid-cols-1 sm:grid-cols-2 xl:grid-cols-3 gap-6">
                @forelse ($data as $user)
                    <div class="group bg-white rounded-2xl ring-1 ring-slate-200 shadow-sm hover:shadow-lg transition">
                        <div class="p-6">
                            <!-- Header row: avatar + name + status -->
                            <div class="flex items-start justify-between gap-3">
                                <div class="flex items-center gap-3">
                                    <div
                                        class="h-10 w-10 rounded-full bg-indigo-600 text-white flex items-center justify-center font-semibold">
                                        {{ strtoupper(mb_substr($user->name, 0, 1)) }}
                                    </div>
                                    <div>
                                        <h2 class="text-lg font-semibold text-slate-900 leading-tight">
                                            {{ $user->name }}
                                        </h2>
                                        <div class="mt-0.5 text-xs text-slate-500">
                                            Roll: <span class="font-mono">{{ $user->roll_num }}</span>
                                        </div>
                                    </div>
                                </div>

                                <span
                                    class="px-2 py-1 text-[11px] rounded-full
                           {{ $user->payment_id ? 'bg-green-100 text-green-700' : 'bg-amber-100 text-amber-700' }}">
                                    {{ $user->payment_id ? 'Payment Verified' : 'Payment Pending' }}
                                </span>
                            </div>

                            <!-- Details -->
                            <dl class="mt-5 grid grid-cols-2 gap-x-4 gap-y-3 text-sm">
                                <div>
                                    <dt class="text-slate-500">Batch</dt>
                                    <dd class="font-medium text-slate-900">
                                        {{ $user->batch }}
                                        @if (!empty($user->faculty))
                                            <span class="text-slate-500"> ({{ $user->faculty }})</span>
                                        @endif
                                    </dd>
                                </div>

                                <div>
                                    <dt class="text-slate-500">Year / Part</dt>
                                    <dd class="font-medium text-slate-900">
                                        {{ $user->year }} / {{ $user->part }}
                                    </dd>
                                </div>

                                <div >
                                    <dt class="text-green-500">Subject</dt>
                                    <dd class="font-medium text-slate-900">
                                        {{ $user->subject }}
                                    </dd>
                                </div>

                                 <div >
                                    <dt class="text-red-500">Exam Token</dt>
                                    <dd class="font-medium text-slate-900">
                                        {{ $user->token_num }}
                                    </dd>
                                </div>
                                
                            </dl>

                            <!-- Action -->
                            <div class="mt-6">
                                @if (!$user->payment_id)
                                    <a href="{{ route('form.verify', ['token' => $user->token_num]) }}"
                                        class="w-full inline-flex items-center justify-center gap-2 px-4 py-2.5 rounded-lg
                          bg-gradient-to-r from-indigo-600 to-purple-600 text-white font-medium
                          shadow-md hover:from-indigo-700 hover:to-purple-700 focus:outline-none
                          focus:ring-2 focus:ring-indigo-500 focus:ring-offset-2">
                                        <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" viewBox="0 0 24 24"
                                            fill="currentColor">
                                            <path
                                                d="M12 3a1 1 0 0 1 1 1v1.055a7 7 0 1 1-2 0V4a1 1 0 0 1 1-1Zm0 6a5 5 0 1 0 0 10 5 5 0 0 0 0-10Z" />
                                        </svg>
                                        Verify Payment Rs.{{ number_format($user->amount ?? 0) }}
                                    </a>
                                @else
                                    <!-- Payment Verified (always disabled) -->
                                    <button disabled
                                        class="w-full inline-flex items-center justify-center gap-2 px-4 py-2.5 rounded-lg bg-green-600 text-white font-medium shadow-md cursor-not-allowed opacity-80">
                                        <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" viewBox="0 0 24 24"
                                            fill="currentColor">
                                            <path d="M9 12.75 7.5 11.25 6.439 12.31 9 14.871 14.561 9.31 13.5 8.25z" />
                                        </svg>
                                        Payment Verified
                                    </button>

                                    <!-- Submit Application (only if unsubmitted) -->
                                    @if ($user->status == 'unsubmitted')
                                        <a href="{{ route('form.verify', ['token' => $user->token_num]) }}">
                                            <button type="submit"
                                                class="w-full inline-flex mt-2 items-center justify-center gap-2 px-4 py-2.5 rounded-lg bg-blue-600 hover:bg-blue-700 text-white font-medium shadow-md transition">
                                                <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" viewBox="0 0 24 24"
                                                    fill="currentColor">
                                                    <path d="M12 4v16m8-8H4" />
                                                </svg>
                                                Submit Application
                                            </button>
                                        </a>
                                    @else
                                        <button disabled
                                            class="w-full inline-flex mt-2 items-center justify-center gap-2 px-4 py-2.5 rounded-lg bg-slate-400 text-white font-medium shadow-md cursor-not-allowed opacity-80">
                                            <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" viewBox="0 0 24 24"
                                                fill="currentColor">
                                                <path d="M9 12.75 7.5 11.25 6.439 12.31 9 14.871 14.561 9.31 13.5 8.25z" />
                                            </svg>
                                            Application Submitted
                                        </button>
                                    @endif
                                @endif
                            </div>
                        </div>
                    </div>
                @empty
                    <div class="col-span-full">
                        <div class="text-center rounded-2xl border border-dashed border-slate-300 bg-white p-10">
                            <div class="mx-auto h-12 w-12 rounded-full bg-indigo-50 flex items-center justify-center">
                                <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 text-indigo-600" viewBox="0 0 24 24"
                                    fill="currentColor">
                                    <path
                                        d="M12 2a7 7 0 0 0-7 7v2.126A2 2 0 0 1 4.553 12H5v6a3 3 0 0 0 3 3h8a3 3 0 0 0 3-3v-6h.447A2 2 0 0 1 21 11.126V9a7 7 0 0 0-7-7Z" />
                                </svg>
                            </div>
                            <h3 class="mt-4 text-base font-semibold text-slate-900">No student data</h3>
                            <p class="mt-1 text-sm text-slate-600">Once your details are available, they will appear here.
                            </p>
                        </div>
                    </div>
                @endforelse
            </div>
        </div>
    </section>
@endsection
</file>

<file path="resources/views/Frontend/dashboard/index.blade.php">
@extends('Frontend.layouts.app')

@section('content')
<section>
    <section class="bg-gradient-to-r from-gray-600 to-blue-500 text-white py-16">
    <div class="container mx-auto px-6 text-center">
        <h1 class="text-5xl font-extrabold mb-4 drop-shadow-lg">Dashboard</h1>
        <p class="text-lg max-w-2xl mx-auto opacity-90">
            Welcome to your dashboard! Here you can manage {{$student->name}} your activities and view important information.
        </p>
    </div>
</section>
</section>


@endsection
</file>

<file path="resources/views/Frontend/employee/auth/change_password.blade.php">
@extends('Frontend.layouts.app')

@section('content')
<div class="max-w-md mx-auto px-4 py-16">
  <h1 class="text-2xl font-bold mb-6 text-center">Change Password</h1>

  @if (session('warning'))
    <div class="mb-4 rounded-xl border border-amber-200 bg-amber-50 px-4 py-3 text-amber-800">
      {{ session('warning') }}
    </div>
  @endif

  @if ($errors->any())
    <div class="mb-4 rounded-xl border border-red-200 bg-red-50 px-4 py-3 text-red-800">
      @foreach ($errors->all() as $e) <div>{{ $e }}</div> @endforeach
    </div>
  @endif

  <form method="POST" action="{{ route('employee.password.update') }}" class="space-y-4">
    @csrf
    <div>
      <label class="block text-sm mb-1">Current Password</label>
      <input type="password" name="current_password" class="w-full rounded-lg border px-3 py-2" required>
    </div>
    <div>
      <label class="block text-sm mb-1">New Password</label>
      <input type="password" name="password" class="w-full rounded-lg border px-3 py-2" required>
    </div>
    <div>
      <label class="block text-sm mb-1">Confirm Password</label>
      <input type="password" name="password_confirmation" class="w-full rounded-lg border px-3 py-2" required>
    </div>
    <button class="w-full rounded-xl bg-gray-900 text-white px-4 py-2.5 text-sm">Update Password</button>
  </form>
</div>
@endsection
</file>

<file path="resources/views/Frontend/employee/auth/login.blade.php">
@extends('Frontend.layouts.app') {{-- reuse your layout if you want --}}

@section('content')
<div class="max-w-md mx-auto px-4 py-16">
  <h1 class="text-2xl font-bold mb-6 text-center">Employee Login</h1>

  @if ($errors->any())
    <div class="mb-4 rounded-xl border border-red-200 bg-red-50 px-4 py-3 text-red-800">
      @foreach ($errors->all() as $e) <div>{{ $e }}</div> @endforeach
    </div>
  @endif

  <form method="POST" action="{{ route('employee.login.post') }}" class="space-y-4">
    @csrf
    <div>
      <label class="block text-sm mb-1">Email</label>
      <input type="email" name="email" class="w-full rounded-lg border px-3 py-2" required>
    </div>
    <div>
      <label class="block text-sm mb-1">Password</label>
      <input type="password" name="password" class="w-full rounded-lg border px-3 py-2" required>
    </div>
    <div class="flex items-center gap-2">
      <input type="checkbox" name="remember" id="remember">
      <label for="remember" class="text-sm">Remember me</label>
    </div>
    <button class="w-full rounded-xl bg-gray-900 text-white px-4 py-2.5 text-sm">Login</button>
  </form>
</div>
@endsection
</file>

<file path="resources/views/Frontend/employee/dashboard.blade.php">
@extends('Frontend.layouts.app')

@section('content')
<div class="max-w-3xl mx-auto px-4 py-12">
  <h1 class="text-2xl font-bold">Welcome, {{ auth('employee')->user()->full_name }}</h1>
  <p class="text-sm text-gray-600 mt-2">This is the employee dashboard. (Add invigilator features later.)</p>

 
</div>
@endsection
</file>

<file path="resources/views/Frontend/employee/index.blade.php">
@extends('Frontend.layouts.app')

@section('content')
<div class="max-w-5xl mx-auto px-4 py-8">
  <h1 class="text-2xl font-bold mb-4">Items Issued to You</h1>

  <div class="rounded-2xl border border-gray-200 bg-white shadow-sm overflow-hidden">
    <table class="w-full text-sm">
      <thead class="bg-gray-50 text-xs uppercase text-gray-600">
        <tr>
          <th class="px-4 py-3">Date (BS)</th>
          <th class="px-4 py-3">Store Out SN</th>
          <th class="px-4 py-3">Item</th>
          <th class="px-4 py-3">Unit</th>
          <th class="px-4 py-3">Qty</th>
        </tr>
      </thead>
      <tbody class="divide-y divide-gray-100">
        @forelse($outs as $o)
          @foreach($o->items as $it)
            <tr class="hover:bg-gray-50">
              <td class="px-4 py-3">{{ $o->store_out_date_bs }}</td>
              <td class="px-4 py-3">{{ $o->store_out_sn }}</td>
              <td class="px-4 py-3">
                <div class="font-medium text-gray-900">{{ $it->item_name }}</div>
                <div class="text-xs text-gray-500">{{ $it->item_sn }}</div>
              </td>
              <td class="px-4 py-3">{{ $it->unit ?: 'â€”' }}</td>
              <td class="px-4 py-3">{{ number_format($it->qty,3) }}</td>
            </tr>
          @endforeach
        @empty
          <tr>
            <td colspan="5" class="px-4 py-6 text-center text-gray-500">
              No items issued yet.
            </td>
          </tr>
        @endforelse
      </tbody>
    </table>

    <div class="px-4 py-3 border-t bg-gray-50">
      {{ $outs->links() }}
    </div>
  </div>
</div>
@endsection
</file>

<file path="resources/views/Frontend/layouts/app.blade.php">
@include('Frontend.layouts.header')
{{-- @yield('frontend_content')
@include('Frontend.layout.footer') --}}
</file>

<file path="resources/views/Frontend/layouts/header.blade.php">
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>@yield('title','Portal')</title>
@vite('resources/css/app.css')
  <link rel="stylesheet"
        href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css"/>

</head>
<body class="antialiased bg-gray-50 text-gray-900">

  <!-- HEADER (fixed to screen sides) -->
  <header class="fixed inset-x-0 top-0 h-16 bg-white shadow-lg z-50">
    <div class="h-full px-4 md:px-6 flex items-center justify-between">
      <a href="{{ url('/') }}" class="flex items-center gap-2">
        <img src="{{ asset('asset/assets/ioe_logo.png') }}" class="h-10 w-auto" alt="Logo">
        <span class="text-lg md:text-xl font-bold text-blue-900">IOE Purwanchal Campus</span>
      </a>

      <div class="flex items-center gap-2">
        @if(auth('employee')->check())
          <!-- Mobile sidebar toggle -->
          <button id="sidebarToggle"
                  class="lg:hidden inline-flex items-center justify-center w-10 h-10 rounded-lg hover:bg-gray-100"
                  title="Menu">
            <i class="fa-solid fa-bars text-lg"></i>
          </button>

          <!-- Notifications (optional) -->
          <button class="relative p-2 text-gray-600 hover:text-gray-900 hidden sm:inline-flex">
            <i class="fas fa-bell text-lg"></i>
            <span class="absolute -top-1 -right-1 bg-red-500 text-white text-[10px] rounded-full h-4 w-4 flex items-center justify-center">3</span>
          </button>

          <!-- Profile -->
          <div class="relative">
            <button id="profileDropdownBtn"
                    class="flex items-center gap-2 px-2 py-1 rounded-lg hover:bg-gray-100">
              <div class="w-8 h-8 rounded-full bg-blue-600 text-white flex items-center justify-center font-semibold">
                {{ strtoupper(mb_substr(auth('employee')->user()->full_name,0,1)) }}
              </div>
              <span class="hidden md:inline-block font-medium">{{ auth('employee')->user()->full_name}}</span>
              <i class="fa-solid fa-chevron-down text-sm text-gray-500"></i>
            </button>

            <div id="profileDropdownMenu"
                 class="hidden absolute right-0 mt-2 w-48 bg-white rounded-md shadow-lg border border-gray-100 z-50">
              <div class="px-4 py-2 text-sm text-gray-600 border-b">
                {{ auth('employee')->user()->email }}
              </div>
              <div class="px-4 py-2 text-sm text-gray-600 border-b">
                {{ auth('employee')->user()->department->name }}
              </div>
              <form method="POST" action="{{  route('employee.logout')}}">
                @csrf
                <button type="submit"
                        class="block w-full text-left px-4 py-2 text-sm text-gray-700 hover:bg-gray-100">
                  Logout
                </button>
              </form>
            </div>
          </div>
        @else
          <a href="{{ route('employee.login') }}"
             class="px-4 py-2 bg-blue-700 text-white rounded-lg hover:bg-blue-800 transition">
            Login
          </a>
        @endif
      </div>
    </div>
  </header>

  @if(auth('employee')->check())
    <!-- SIDEBAR BACKDROP (mobile) -->
    <div id="sidebarBackdrop"
         class="hidden fixed inset-0 bg-black/30 z-40 lg:hidden"></div>

    <!-- SIDEBAR (fixed, aligned to screen sides; never under header) -->
    <aside id="sidebar"
           class="fixed left-0 top-16 w-64 h-[calc(100vh-4rem)] bg-gray-900 text-white z-50
                  transform -translate-x-full transition-transform duration-300
                  overflow-y-auto lg:translate-x-0">
      <nav class="py-4">
        <ul class="space-y-1 px-3 text-sm">
          <li>
            <a href="{{ route('employee.dashboard') }}"
               class="flex items-center gap-3 px-3 py-2 rounded-lg hover:bg-gray-800">
              <i class="fas fa-tachometer-alt w-5 text-gray-300"></i>
              <span>Dashboard</span>
            </a>
          </li>
          {{-- <li>
            <a href="{{route('form.show',$student->roll_num)}}" class="flex items-center gap-3 px-3 py-2 rounded-lg hover:bg-gray-800">
              <i class="fas fa-tags w-5 text-gray-300"></i><span>Application</span>
            </a>
          </li> --}}
          {{-- <li>
            <a href="#stock" class="flex items-center gap-3 px-3 py-2 rounded-lg hover:bg-gray-800">
              <i class="fas fa-warehouse w-5 text-gray-300"></i><span>Stock Management</span>
            </a>
          </li>
          <li>
            <a href="#bills" class="flex items-center gap-3 px-3 py-2 rounded-lg hover:bg-gray-800">
              <i class="fas fa-file-invoice w-5 text-gray-300"></i><span>Bills & Invoices</span>
            </a>
          </li>
          <li>
            <a href="#analytics" class="flex items-center gap-3 px-3 py-2 rounded-lg hover:bg-gray-800">
              <i class="fas fa-chart-line w-5 text-gray-300"></i><span>Analytics</span>
            </a>
          </li>
          <li>
            <a href="#profit-loss" class="flex items-center gap-3 px-3 py-2 rounded-lg hover:bg-gray-800">
              <i class="fas fa-calculator w-5 text-gray-300"></i><span>Profit & Loss</span>
            </a>
          </li>
          <li>
            <a href="#customers" class="flex items-center gap-3 px-3 py-2 rounded-lg hover:bg-gray-800">
              <i class="fas fa-users w-5 text-gray-300"></i><span>Customers</span>
            </a>
          </li>
          <li>
            <a href="#settings" class="flex items-center gap-3 px-3 py-2 rounded-lg hover:bg-gray-800">
              <i class="fas fa-cog w-5 text-gray-300"></i><span>Settings</span>
            </a>
          </li> --}}
        </ul>
      </nav>
    </aside>
  @endif

  <!-- MAIN (never sits under header; only shifts when sidebar is present) -->
  <main class="pt-16 {{auth('employee')->check() ? 'lg:ml-64' : '' }} min-h-screen px-4 md:px-6">
    

    @yield('content')
  </main>

  <script>
    // Profile dropdown
    const profileBtn  = document.getElementById('profileDropdownBtn');
    const profileMenu = document.getElementById('profileDropdownMenu');
    if (profileBtn && profileMenu) {
      profileBtn.addEventListener('click', (e) => {
        e.stopPropagation();
        profileMenu.classList.toggle('hidden');
      });
      document.addEventListener('click', () => profileMenu.classList.add('hidden'));
    }

    // Sidebar toggle (mobile)
    const sidebar       = document.getElementById('sidebar');
    const sidebarToggle = document.getElementById('sidebarToggle');
    const backdrop      = document.getElementById('sidebarBackdrop');

    function openSidebar() {
      if (!sidebar) return;
      sidebar.classList.remove('-translate-x-full');
      if (backdrop) backdrop.classList.remove('hidden');
    }
    function closeSidebar() {
      if (!sidebar) return;
      sidebar.classList.add('-translate-x-full');
      if (backdrop) backdrop.classList.add('hidden');
    }

    if (sidebarToggle && sidebar) {
      sidebarToggle.addEventListener('click', openSidebar);
    }
    if (backdrop) {
      backdrop.addEventListener('click', closeSidebar);
    }
    // Close on Escape
    document.addEventListener('keydown', (e) => {
      if (e.key === 'Escape') closeSidebar();
    });
  </script>
</body>
</html>
</file>

<file path="resources/views/Frontend/index.blade.php">
<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>@yield('title', 'Portal')</title>

  <script src="https://cdn.tailwindcss.com"></script>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css" />
</head>

<body class="antialiased bg-gray-50 text-gray-900">
  <!-- HEADER (fixed to screen sides) -->
  <header class="fixed inset-x-0 top-0 h-16 bg-white shadow-lg z-50">
    <div class="h-full px-4 md:px-6 flex items-center justify-between">
      <a href="{{ url('/') }}" class="flex items-center gap-2">
        <img src="{{ asset('asset/assets/ioe_logo.png') }}" class="h-10 w-auto" alt="Logo">
        <span class="text-lg md:text-xl font-bold text-blue-900">IOE Purwanchal Campus</span>
      </a>

      <div class="flex items-center gap-2">
        <!-- NEW: Watch How to Apply button -->
        

        <!-- Mobile icon-only -->
        

        <a href="{{ route('employee.login') }}"
           class="px-4 py-2 bg-blue-700 text-white rounded-lg hover:bg-blue-800 transition">
          Login
        </a>
      </div>
    </div>
  </header>

  <div class="min-h-screen flex flex-col">
    <main class="flex-grow flex items-center justify-center bg-gradient-to-r from-blue-50 to-slate-100 pt-16">
      <div class="text-center px-6">
        <h1 class="text-3xl sm:text-5xl font-bold text-blue-900 mb-4">
          Welcome to Smart Store Management Portal
        </h1>
        <p class="text-gray-600 text-lg sm:text-xl mb-6">
          Login To See Your Dashboard
        </p>
        <a href="{{ route('employee.login') }}"
           class="px-6 py-3 bg-blue-700 text-white rounded-xl shadow hover:bg-blue-800 transition">
          Get Started
        </a>
      </div>
    </main>

    <footer class="bg-gray-800 text-white text-center py-4">
      <p class="text-sm">Â© {{ date('Y') }} IOE Purwanchal Campus. All Rights Reserved.</p>
    </footer>
  </div>

  <!-- VIDEO MODAL -->
  <div id="videoDialog"
       class="fixed inset-0 z-[60] hidden"
       role="dialog" aria-modal="true" aria-label="How to Apply Video">
    <!-- Backdrop -->
    <div id="videoBackdrop" class="absolute inset-0 bg-black/70"></div>

    <!-- Modal content -->
    <div class="absolute inset-0 flex items-center justify-center p-4">
      <div
        class="w-full max-w-5xl bg-white rounded-2xl shadow-2xl overflow-hidden ring-1 ring-black/5">
        <!-- Header -->
        <div class="flex items-center justify-between px-4 py-3 border-b">
          <div class="flex items-center gap-2">
            <i class="fa-solid fa-circle-play text-blue-700"></i>
            <h2 class="font-semibold text-slate-900">How to Apply</h2>
          </div>
          <button id="closeVideoBtn" class="p-2 rounded-md hover:bg-slate-100" aria-label="Close video">
            <i class="fa-solid fa-xmark text-xl"></i>
          </button>
        </div>

        <!-- Video -->
        <div class="bg-black">
          <video id="howtoVideo"
                 class="w-full h-auto max-h-[70vh] bg-black"
                 src="{{ asset('video/DEMO_V.mp4') }}"
                 controls
                 playsinline
                 preload="metadata">
              <!-- Optional alternate sources (uncomment when you add them)
              <source src="{{ asset('video/demo-1080p.mp4') }}" data-quality="1080p" type="video/mp4">
              <source src="{{ asset('video/demo-720p.mp4') }}" data-quality="720p" type="video/mp4">
              <source src="{{ asset('video/demo-480p.mp4') }}" data-quality="480p" type="video/mp4">
              -->
              Your browser does not support the video tag.
          </video>
        </div>

        <!-- Custom controls row -->
        <div class="flex flex-col sm:flex-row items-center justify-between gap-3 px-4 py-3">
          <!-- Speed -->
          <div class="flex items-center gap-2">
            <label for="speedSel" class="text-sm text-slate-700">Speed</label>
            <select id="speedSel"
                    class="rounded-md border-slate-300 text-sm focus:border-blue-600 focus:ring-blue-600">
              <option value="0.5">0.5Ã—</option>
              <option value="0.75">0.75Ã—</option>
              <option value="1" selected>1Ã— (Normal)</option>
              <option value="1.25">1.25Ã—</option>
              <option value="1.5">1.5Ã—</option>
              <option value="1.75">1.75Ã—</option>
              <option value="2">2Ã—</option>
            </select>
          </div>

          <!-- Quality (auto-hides if only one source) -->
          <div id="qualityWrap" class="flex items-center gap-2">
            <label for="qualitySel" class="text-sm text-slate-700">Quality</label>
            <select id="qualitySel"
                    class="rounded-md border-slate-300 text-sm focus:border-blue-600 focus:ring-blue-600">
              <!-- Filled by JS from <source data-quality> tags -->
            </select>
          </div>

          <!-- Open fullscreen quickly -->
          <div class="flex items-center gap-2">
            <button id="fsBtn"
                    class="inline-flex items-center gap-2 px-3 py-2 rounded-md border border-slate-300 hover:bg-slate-50 text-sm">
              <i class="fa-solid fa-expand"></i>
              Fullscreen
            </button>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Script -->
  <script>
    const openBtn = document.getElementById('openVideoBtn');
    const openBtnSm = document.getElementById('openVideoBtnSm');
    const dialog = document.getElementById('videoDialog');
    const backdrop = document.getElementById('videoBackdrop');
    const closeBtn = document.getElementById('closeVideoBtn');
    const videoEl = document.getElementById('howtoVideo');
    const speedSel = document.getElementById('speedSel');
    const fsBtn = document.getElementById('fsBtn');
    const qualitySel = document.getElementById('qualitySel');
    const qualityWrap = document.getElementById('qualityWrap');

    function openDialog() {
      dialog.classList.remove('hidden');
      // Focus the dialog for accessibility
      dialog.focus({ preventScroll: true });
    }
    function closeDialog() {
      dialog.classList.add('hidden');
      // Pause when closing
      if (!videoEl.paused) videoEl.pause();
    }

    // Open handlers
    openBtn?.addEventListener('click', openDialog);
    openBtnSm?.addEventListener('click', openDialog);

    // Close handlers
    closeBtn.addEventListener('click', closeDialog);
    backdrop.addEventListener('click', closeDialog);
    window.addEventListener('keydown', (e) => {
      if (e.key === 'Escape' && !dialog.classList.contains('hidden')) {
        closeDialog();
      }
    });

    // Speed control
    speedSel.addEventListener('change', () => {
      videoEl.playbackRate = parseFloat(speedSel.value);
    });

    // Fullscreen
    fsBtn.addEventListener('click', async () => {
      try {
        if (videoEl.requestFullscreen) await videoEl.requestFullscreen();
        else if (videoEl.webkitRequestFullscreen) videoEl.webkitRequestFullscreen();
      } catch (e) {
        console.error(e);
      }
    });

    // Quality handling (optional multi-source setup)
    (function setupQuality() {
      const sources = Array.from(videoEl.querySelectorAll('source[data-quality]'));
      if (sources.length <= 1) {
        // Only one (or none) alternate quality
        qualityWrap.classList.add('hidden');
        return;
      }
      // Populate selector by descending quality order (e.g., 1080p, 720pâ€¦)
      const qualityList = sources
        .map(s => s.getAttribute('data-quality'))
        .filter(Boolean)
        .sort((a, b) => parseInt(b) - parseInt(a));

      qualitySel.innerHTML = qualityList
        .map((q, idx) => `<option value="${q}" ${idx === 0 ? 'selected' : ''}>${q}</option>`)
        .join('');

      // Switch quality by swapping src and preserving currentTime & paused state
      qualitySel.addEventListener('change', () => {
        const selected = qualitySel.value;
        const match = sources.find(s => s.getAttribute('data-quality') === selected);
        if (!match) return;

        const currentTime = videoEl.currentTime;
        const wasPaused = videoEl.paused;

        // Replace the main src with chosen source (for broad browser support)
        videoEl.src = match.getAttribute('src');
        videoEl.load();
        videoEl.currentTime = currentTime;
        if (!wasPaused) videoEl.play();
      });
    })();
  </script>
</body>
</html>
</file>

<file path="routes/api.php">
<?php

use App\Http\Controllers\BankController;
use Illuminate\Http\Request;
use Illuminate\Support\Facades\Route;
use App\Http\Controllers\BSCalendarController;

/*
|--------------------------------------------------------------------------
| API Routes
|--------------------------------------------------------------------------
|
| Here is where you can register API routes for your application. These
| routes are loaded by the RouteServiceProvider and all of them will
| be assigned to the "api" middleware group. Make something great!
|
*/

Route::middleware('auth:sanctum')->get('/user', function (Request $request) {
    return $request->user();
});
Route::post('/upload-bank-details', [BankController::class, 'uploadBankDetails']);

Route::get('/ad-to-bs',   [BSCalendarController::class, 'adToBs']);   // AD â†’ BS conversion
Route::get('/bs-to-ad',   [BSCalendarController::class, 'bsToAd']);   // BS â†’ AD conversion
Route::get('/bs-month',   [BSCalendarController::class, 'bsMonth']);  // Full month grid
</file>

<file path="routes/channels.php">
<?php

use Illuminate\Support\Facades\Broadcast;

/*
|--------------------------------------------------------------------------
| Broadcast Channels
|--------------------------------------------------------------------------
|
| Here you may register all of the event broadcasting channels that your
| application supports. The given channel authorization callbacks are
| used to check if an authenticated user can listen to the channel.
|
*/

Broadcast::channel('App.Models.User.{id}', function ($user, $id) {
    return (int) $user->id === (int) $id;
});
</file>

<file path="routes/console.php">
<?php

use Illuminate\Foundation\Inspiring;
use Illuminate\Support\Facades\Artisan;

/*
|--------------------------------------------------------------------------
| Console Routes
|--------------------------------------------------------------------------
|
| This file is where you may define all of your Closure based console
| commands. Each Closure is bound to a command instance allowing a
| simple approach to interacting with each command's IO methods.
|
*/

Artisan::command('inspire', function () {
    $this->comment(Inspiring::quote());
})->purpose('Display an inspiring quote');
</file>

<file path="routes/web.php">
<?php

use Illuminate\Support\Facades\Route;
use App\Http\Controllers\AuthController;
use App\Http\Controllers\DashboardController;
use App\Http\Controllers\BankController;
use App\Http\Controllers\StudentController;
use App\Http\Controllers\FormController;
use App\Http\Controllers\VoucherController;
use App\Http\Controllers\SupplierController;
use App\Http\Controllers\ItemCategoryController;
use App\Http\Controllers\BrandController;
use App\Http\Controllers\CategoryController;
use App\Http\controllers\DepartmentController;
use App\Http\Controllers\PurchaseSlipController;
use App\Http\Controllers\PurchaseController;
use App\Http\Controllers\ProductController;
use App\Http\Controllers\EventController;
use App\Http\Controllers\BSCalendarController;
use App\Http\Controllers\StoreEntryController;
use App\Http\Controllers\EmployeeController;
use App\Http\Controllers\EmployeeAuthController;
use App\Http\Controllers\StoreOutController;
use App\Http\Controllers\EmployeeStoreOutController;

// Purchase Slips


use GuzzleHttp\Middleware;

Route::get('/', [DashboardController::class, 'home'])->name('home');


// Student auth
Route::get('/login/student', [AuthController::class, 'showStudentLogin'])->name('student.login.form');
Route::post('/login/student', [AuthController::class, 'studentLogin'])->name('student.login');
// routes/web.php
Route::get('/bank/import-public', [BankController::class, 'importFromPublicFile'])
    ->name('bank.import.public');


// Admin auth
Route::get('/admin', [AuthController::class, 'showAdminLogin'])->name('admin.login.form');
Route::post('/login/admin', [AuthController::class, 'adminLogin'])->name('admin.login');



// student Routes

Route::group(['middleware' => 'student.auth'], function () {
    Route::get('/dashboard/student', [DashboardController::class, 'student'])->name('student.dashboard');

    // Only logged-in student with matching roll can access
    Route::get('/form/{roll}', [FormController::class, 'showForm'])->name('form.show');

    // Only logged-in student with matching token can access
    Route::get('/verify-form/{token}', [FormController::class, 'VerifyForm'])->name('form.verify');

    Route::post('/verify-payment', [BankController::class, 'verify_payment'])->name('verify.payment');

    Route::post('/vouchers', [VoucherController::class, 'store'])->name('vouchers.store');
});










Route::group(['middleware' => 'admin.auth'], function () {
    Route::get('/dashboard/admin', [DashboardController::class, 'admin'])->name('admin.dashboard');

    Route::get('/backend/bank', [BankController::class, 'index'])->name('bank.index');
    Route::get('/import', [BankController::class, 'importForm'])->name('import.form');
    Route::post('/import', [BankController::class, 'import'])->name('bank.import');


    Route::get('/students/import', [StudentController::class, 'showImportForm'])->name('students.import.form');
    Route::post('/students/import', [StudentController::class, 'import'])->name('students.import');

    Route::get('/backend/applications', [VoucherController::class, 'show_application_form'])
        ->name('applications.index');

    Route::post('/backend/applications/{token_num}/approve', [VoucherController::class, 'approve'])
        ->name('applications.approve');


    Route::resource('suppliers', SupplierController::class);
    Route::resource('categories', ItemCategoryController::class);
    Route::resource('brands', BrandController::class);
    Route::resource('department', DepartmentController::class);



    Route::resource('product_categories', CategoryController::class);
    // Route::resource('products', ProductController::class);

    // Route::get('slips', [PurchaseSlipController::class, 'index'])->name('slips.index'); // build later
    // Route::get('slips/create', [PurchaseSlipController::class, 'create'])->name('slips.create');
    // Route::post('slips', [PurchaseSlipController::class, 'store'])->name('slips.store');
    // Route::get('slips/{slip}', [PurchaseSlipController::class, 'show'])->name('slips.show');

    // Route::get('purchases', [PurchaseController::class, 'index'])->name('purchases.index');
    // Route::get('purchases/create', [PurchaseController::class, 'create'])->name('purchases.create'); // needs ?slip_id=
    // Route::post('purchases', [PurchaseController::class, 'store'])->name('purchases.store');


    Route::prefix('store')->name('store.')->group(function () {
        Route::get('/',                             [StoreEntryController::class, 'index'])->name('index');
        Route::get('/{storeEntry}',                 [StoreEntryController::class, 'show'])->name('show');
        Route::get('/post/{purchase}/prepare',      [StoreEntryController::class, 'prepare'])->name('prepare');
        Route::post('/post/{purchase}',             [StoreEntryController::class, 'postFromPurchase'])->name('post-from-purchase');
        Route::get('/store/ledger/category/{category}', [StoreEntryController::class, 'ledgerByCategory'])
            ->name('ledger.category');

        route::get('/store/ledger',                 [StoreEntryController::class, 'ledger'])->name('ledger');
        Route::get('/categories/{category}/items',  [StoreEntryController::class, 'categoryItems'])->name('categories.items');

        Route::get('/categories/{category}',        [StoreEntryController::class, 'ledgerByCategory'])->name('categories.show');


        Route::get('/browse',                                                         [StoreEntryController::class, 'browseRoot'])->name('browse');
        Route::get('/browse/item-category',                                           [StoreEntryController::class, 'browseItemCategories'])->name('browse.ic');
        Route::get('/browse/item-category/{itemCategory}/product-categories',         [StoreEntryController::class, 'browseProductCategoriesUnderIC'])->name('browse.ic.categories');
    });


    Route::get('/slips/{slip}/print', [PurchaseSlipController::class, 'print'])
        ->name('slips.print');

    Route::get('/products/search', [PurchaseSlipController::class, 'productSearch'])
        ->name('products.search');

    Route::resource('products', ProductController::class);
    Route::resource('slips', PurchaseSlipController::class);

    Route::resource('purchases', PurchaseController::class);


    Route::get('/employees/search', [EmployeeController::class, 'search'])->name('employees.search');

    Route::resource('employees', EmployeeController::class);


Route::get('/employee/store-out', [EmployeeStoreOutController::class, 'index'])
        ->name('employee.store_out.index');

    Route::prefix('store')->name('store.')->group(function () {
        // ... your existing store routes ...

        Route::get('/out',          [StoreOutController::class, 'index'])->name('out.index');
        Route::get('/out/create',   [StoreOutController::class, 'create'])->name('out.create');
        Route::post('/out',         [StoreOutController::class, 'store'])->name('out.store');
        Route::get('/out/{storeOut}', [StoreOutController::class, 'show'])->name('out.show');
    });
});


// Logout
Route::post('/logout', [AuthController::class, 'logout'])->name('logout');

//EMployee Routes Begin
Route::get('/employee/login', [EmployeeAuthController::class, 'showLogin'])->name('employee.login');
Route::post('/employee/login', [EmployeeAuthController::class, 'login'])->name('employee.login.post');
Route::post('/employee/logout', [EmployeeAuthController::class, 'logout'])->name('employee.logout');
Route::group(['middleware' => ['auth:employee', 'employee.mustChange']], function () {
    // Simple dashboard placeholder
    Route::get('/employee/dashboard', function () {
        return view('Frontend.employee.dashboard');
    })->name('employee.dashboard');

    // Force change-password routes
    Route::get('/employee/change-password', [EmployeeAuthController::class, 'showChangePassword'])
        ->name('employee.password.show'); // note: this is whitelisted in middleware
    Route::post('/employee/change-password', [EmployeeAuthController::class, 'updatePassword'])
        ->name('employee.password.update');
});
//Employee Routes End
</file>

<file path="storage/app/public/.gitignore">
*
!.gitignore
</file>

<file path="storage/app/.gitignore">
*
!public/
!.gitignore
</file>

<file path="storage/framework/cache/data/.gitignore">
*
!.gitignore
</file>

<file path="storage/framework/cache/.gitignore">
*
!data/
!.gitignore
</file>

<file path="storage/framework/sessions/.gitignore">
*
!.gitignore
</file>

<file path="storage/framework/testing/.gitignore">
*
!.gitignore
</file>

<file path="storage/framework/views/.gitignore">
*
!.gitignore
</file>

<file path="storage/framework/.gitignore">
compiled.php
config.php
down
events.scanned.php
maintenance.php
routes.php
routes.scanned.php
schedule-*
services.json
</file>

<file path="storage/logs/.gitignore">
*
!.gitignore
</file>

<file path="tests/Feature/ExampleTest.php">
<?php

namespace Tests\Feature;

// use Illuminate\Foundation\Testing\RefreshDatabase;
use Tests\TestCase;

class ExampleTest extends TestCase
{
    /**
     * A basic test example.
     */
    public function test_the_application_returns_a_successful_response(): void
    {
        $response = $this->get('/');

        $response->assertStatus(200);
    }
}
</file>

<file path="tests/Unit/ExampleTest.php">
<?php

namespace Tests\Unit;

use PHPUnit\Framework\TestCase;

class ExampleTest extends TestCase
{
    /**
     * A basic test example.
     */
    public function test_that_true_is_true(): void
    {
        $this->assertTrue(true);
    }
}
</file>

<file path="tests/CreatesApplication.php">
<?php

namespace Tests;

use Illuminate\Contracts\Console\Kernel;
use Illuminate\Foundation\Application;

trait CreatesApplication
{
    /**
     * Creates the application.
     */
    public function createApplication(): Application
    {
        $app = require __DIR__.'/../bootstrap/app.php';

        $app->make(Kernel::class)->bootstrap();

        return $app;
    }
}
</file>

<file path="tests/TestCase.php">
<?php

namespace Tests;

use Illuminate\Foundation\Testing\TestCase as BaseTestCase;

abstract class TestCase extends BaseTestCase
{
    use CreatesApplication;
}
</file>

<file path=".editorconfig">
root = true

[*]
charset = utf-8
end_of_line = lf
indent_size = 4
indent_style = space
insert_final_newline = true
trim_trailing_whitespace = true

[*.md]
trim_trailing_whitespace = false

[*.{yml,yaml}]
indent_size = 2

[docker-compose.yml]
indent_size = 4
</file>

<file path=".env.example">
APP_NAME=Laravel
APP_ENV=local
APP_KEY=
APP_DEBUG=true
APP_URL=http://localhost

LOG_CHANNEL=stack
LOG_DEPRECATIONS_CHANNEL=null
LOG_LEVEL=debug

DB_CONNECTION=mysql
DB_HOST=127.0.0.1
DB_PORT=3306
DB_DATABASE=laravel
DB_USERNAME=root
DB_PASSWORD=

BROADCAST_DRIVER=log
CACHE_DRIVER=file
FILESYSTEM_DISK=local
QUEUE_CONNECTION=sync
SESSION_DRIVER=file
SESSION_LIFETIME=120

MEMCACHED_HOST=127.0.0.1

REDIS_HOST=127.0.0.1
REDIS_PASSWORD=null
REDIS_PORT=6379

MAIL_MAILER=smtp
MAIL_HOST=mailpit
MAIL_PORT=1025
MAIL_USERNAME=null
MAIL_PASSWORD=null
MAIL_ENCRYPTION=null
MAIL_FROM_ADDRESS="hello@example.com"
MAIL_FROM_NAME="${APP_NAME}"

AWS_ACCESS_KEY_ID=
AWS_SECRET_ACCESS_KEY=
AWS_DEFAULT_REGION=us-east-1
AWS_BUCKET=
AWS_USE_PATH_STYLE_ENDPOINT=false

PUSHER_APP_ID=
PUSHER_APP_KEY=
PUSHER_APP_SECRET=
PUSHER_HOST=
PUSHER_PORT=443
PUSHER_SCHEME=https
PUSHER_APP_CLUSTER=mt1

VITE_APP_NAME="${APP_NAME}"
VITE_PUSHER_APP_KEY="${PUSHER_APP_KEY}"
VITE_PUSHER_HOST="${PUSHER_HOST}"
VITE_PUSHER_PORT="${PUSHER_PORT}"
VITE_PUSHER_SCHEME="${PUSHER_SCHEME}"
VITE_PUSHER_APP_CLUSTER="${PUSHER_APP_CLUSTER}"
</file>

<file path=".gitattributes">
* text=auto eol=lf

*.blade.php diff=html
*.css diff=css
*.html diff=html
*.md diff=markdown
*.php diff=php

/.github export-ignore
CHANGELOG.md export-ignore
.styleci.yml export-ignore
</file>

<file path=".gitignore">
/.phpunit.cache
/node_modules
/public/build
/public/hot
/public/storage
/storage/*.key
/vendor
.env
.env.backup
.env.production
.phpunit.result.cache
Homestead.json
Homestead.yaml
auth.json
npm-debug.log
yarn-error.log
/.fleet
/.idea
/.vscode
</file>

<file path="artisan">
#!/usr/bin/env php
<?php

define('LARAVEL_START', microtime(true));

/*
|--------------------------------------------------------------------------
| Register The Auto Loader
|--------------------------------------------------------------------------
|
| Composer provides a convenient, automatically generated class loader
| for our application. We just need to utilize it! We'll require it
| into the script here so that we do not have to worry about the
| loading of any of our classes manually. It's great to relax.
|
*/

require __DIR__.'/vendor/autoload.php';

$app = require_once __DIR__.'/bootstrap/app.php';

/*
|--------------------------------------------------------------------------
| Run The Artisan Application
|--------------------------------------------------------------------------
|
| When we run the console application, the current CLI command will be
| executed in this console and the response sent back to a terminal
| or another output device for the developers. Here goes nothing!
|
*/

$kernel = $app->make(Illuminate\Contracts\Console\Kernel::class);

$status = $kernel->handle(
    $input = new Symfony\Component\Console\Input\ArgvInput,
    new Symfony\Component\Console\Output\ConsoleOutput
);

/*
|--------------------------------------------------------------------------
| Shutdown The Application
|--------------------------------------------------------------------------
|
| Once Artisan has finished running, we will fire off the shutdown events
| so that any final work may be done by the application before we shut
| down the process. This is the last thing to happen to the request.
|
*/

$kernel->terminate($input, $status);

exit($status);
</file>

<file path="composer.json">
{
    "name": "laravel/laravel",
    "type": "project",
    "description": "The skeleton application for the Laravel framework.",
    "keywords": ["laravel", "framework"],
    "license": "MIT",
    "require": {
        "php": "^8.1",
        "guzzlehttp/guzzle": "^7.2",
        "laravel/framework": "^10.10",
        "laravel/sanctum": "^3.3",
        "laravel/tinker": "^2.8",
        "maatwebsite/excel": "^3.1"
    },
    "require-dev": {
        "fakerphp/faker": "^1.9.1",
        "laravel/pint": "^1.0",
        "laravel/sail": "^1.18",
        "mockery/mockery": "^1.4.4",
        "nunomaduro/collision": "^7.0",
        "phpunit/phpunit": "^10.1",
        "spatie/laravel-ignition": "^2.0"
    },
    "autoload": {
        "psr-4": {
            "App\\": "app/",
            "Database\\Factories\\": "database/factories/",
            "Database\\Seeders\\": "database/seeders/"
        }
    },
    "autoload-dev": {
        "psr-4": {
            "Tests\\": "tests/"
        }
    },
    "scripts": {
        "post-autoload-dump": [
            "Illuminate\\Foundation\\ComposerScripts::postAutoloadDump",
            "@php artisan package:discover --ansi"
        ],
        "post-update-cmd": [
            "@php artisan vendor:publish --tag=laravel-assets --ansi --force"
        ],
        "post-root-package-install": [
            "@php -r \"file_exists('.env') || copy('.env.example', '.env');\""
        ],
        "post-create-project-cmd": [
            "@php artisan key:generate --ansi"
        ]
    },
    "extra": {
        "laravel": {
            "dont-discover": []
        }
    },
    "config": {
        "optimize-autoloader": true,
        "preferred-install": "dist",
        "sort-packages": true,
        "allow-plugins": {
            "pestphp/pest-plugin": true,
            "php-http/discovery": true
        }
    },
    "minimum-stability": "stable",
    "prefer-stable": true
}
</file>

<file path="package.json">
{
    "private": true,
    "type": "module",
    "scripts": {
        "dev": "vite",
        "build": "vite build"
    },
    "devDependencies": {
        "axios": "^1.6.4",
        "laravel-vite-plugin": "^1.0.0",
        "vite": "^5.0.0"
    },
    "dependencies": {
        "@tailwindcss/vite": "^4.1.13",
        "tailwindcss": "^4.1.13"
    }
}
</file>

<file path="phpunit.xml">
<?xml version="1.0" encoding="UTF-8"?>
<phpunit xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
         xsi:noNamespaceSchemaLocation="vendor/phpunit/phpunit/phpunit.xsd"
         bootstrap="vendor/autoload.php"
         colors="true"
>
    <testsuites>
        <testsuite name="Unit">
            <directory>tests/Unit</directory>
        </testsuite>
        <testsuite name="Feature">
            <directory>tests/Feature</directory>
        </testsuite>
    </testsuites>
    <source>
        <include>
            <directory>app</directory>
        </include>
    </source>
    <php>
        <env name="APP_ENV" value="testing"/>
        <env name="BCRYPT_ROUNDS" value="4"/>
        <env name="CACHE_DRIVER" value="array"/>
        <!-- <env name="DB_CONNECTION" value="sqlite"/> -->
        <!-- <env name="DB_DATABASE" value=":memory:"/> -->
        <env name="MAIL_MAILER" value="array"/>
        <env name="PULSE_ENABLED" value="false"/>
        <env name="QUEUE_CONNECTION" value="sync"/>
        <env name="SESSION_DRIVER" value="array"/>
        <env name="TELESCOPE_ENABLED" value="false"/>
    </php>
</phpunit>
</file>

<file path="README.md">
<p align="center"><a href="https://laravel.com" target="_blank"><img src="https://raw.githubusercontent.com/laravel/art/master/logo-lockup/5%20SVG/2%20CMYK/1%20Full%20Color/laravel-logolockup-cmyk-red.svg" width="400" alt="Laravel Logo"></a></p>

<p align="center">
<a href="https://github.com/laravel/framework/actions"><img src="https://github.com/laravel/framework/workflows/tests/badge.svg" alt="Build Status"></a>
<a href="https://packagist.org/packages/laravel/framework"><img src="https://img.shields.io/packagist/dt/laravel/framework" alt="Total Downloads"></a>
<a href="https://packagist.org/packages/laravel/framework"><img src="https://img.shields.io/packagist/v/laravel/framework" alt="Latest Stable Version"></a>
<a href="https://packagist.org/packages/laravel/framework"><img src="https://img.shields.io/packagist/l/laravel/framework" alt="License"></a>
</p>

## About Laravel

Laravel is a web application framework with expressive, elegant syntax. We believe development must be an enjoyable and creative experience to be truly fulfilling. Laravel takes the pain out of development by easing common tasks used in many web projects, such as:

- [Simple, fast routing engine](https://laravel.com/docs/routing).
- [Powerful dependency injection container](https://laravel.com/docs/container).
- Multiple back-ends for [session](https://laravel.com/docs/session) and [cache](https://laravel.com/docs/cache) storage.
- Expressive, intuitive [database ORM](https://laravel.com/docs/eloquent).
- Database agnostic [schema migrations](https://laravel.com/docs/migrations).
- [Robust background job processing](https://laravel.com/docs/queues).
- [Real-time event broadcasting](https://laravel.com/docs/broadcasting).

Laravel is accessible, powerful, and provides tools required for large, robust applications.

## Learning Laravel

Laravel has the most extensive and thorough [documentation](https://laravel.com/docs) and video tutorial library of all modern web application frameworks, making it a breeze to get started with the framework.

You may also try the [Laravel Bootcamp](https://bootcamp.laravel.com), where you will be guided through building a modern Laravel application from scratch.

If you don't feel like reading, [Laracasts](https://laracasts.com) can help. Laracasts contains thousands of video tutorials on a range of topics including Laravel, modern PHP, unit testing, and JavaScript. Boost your skills by digging into our comprehensive video library.

## Laravel Sponsors

We would like to extend our thanks to the following sponsors for funding Laravel development. If you are interested in becoming a sponsor, please visit the [Laravel Partners program](https://partners.laravel.com).

### Premium Partners

- **[Vehikl](https://vehikl.com/)**
- **[Tighten Co.](https://tighten.co)**
- **[WebReinvent](https://webreinvent.com/)**
- **[Kirschbaum Development Group](https://kirschbaumdevelopment.com)**
- **[64 Robots](https://64robots.com)**
- **[Curotec](https://www.curotec.com/services/technologies/laravel/)**
- **[Cyber-Duck](https://cyber-duck.co.uk)**
- **[DevSquad](https://devsquad.com/hire-laravel-developers)**
- **[Jump24](https://jump24.co.uk)**
- **[Redberry](https://redberry.international/laravel/)**
- **[Active Logic](https://activelogic.com)**
- **[byte5](https://byte5.de)**
- **[OP.GG](https://op.gg)**

## Contributing

Thank you for considering contributing to the Laravel framework! The contribution guide can be found in the [Laravel documentation](https://laravel.com/docs/contributions).

## Code of Conduct

In order to ensure that the Laravel community is welcoming to all, please review and abide by the [Code of Conduct](https://laravel.com/docs/contributions#code-of-conduct).

## Security Vulnerabilities

If you discover a security vulnerability within Laravel, please send an e-mail to Taylor Otwell via [taylor@laravel.com](mailto:taylor@laravel.com). All security vulnerabilities will be promptly addressed.

## License

The Laravel framework is open-sourced software licensed under the [MIT license](https://opensource.org/licenses/MIT).
</file>

<file path="vite.config.js">
import { defineConfig } from 'vite';
import laravel from 'laravel-vite-plugin';
import tailwindcss from '@tailwindcss/vite'

export default defineConfig({
    plugins: [
        laravel({
            input: ['resources/css/app.css', 'resources/js/app.js'],
            refresh: true,
        }), tailwindcss(),
    ],
});
</file>

</files>
